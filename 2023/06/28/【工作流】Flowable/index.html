<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="Fang">
    
    <title>
        
            【工作流】Flowable |
        
        念~旭
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/favicon.ico">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.4/source/css/font-awesome.min.css">
    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"example.com","root":"/","language":"en","path":"search.json"};
    KEEP.theme_config = {"toc":{"enable":true,"number":true,"expand_all":true,"init_open":false},"style":{"primary_color":"#0066CC","avatar":"/images/favicon.ico","favicon":"/images/favicon.ico","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":true,"scale":false},"first_screen":{"enable":true,"background_img":"source/images/bg.svg","description":"进来就别走了！"},"scroll":{"progress_bar":{"enable":true},"percent":{"enable":true}}},"local_search":{"enable":true,"preload":true},"code_copy":{"enable":true,"style":"default"},"pjax":{"enable":true},"lazyload":{"enable":true},"version":"3.4.4"};
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
  </script>
<meta name="generator" content="Hexo 6.1.0"><link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
</head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <span class="pjax-progress-icon">
            <i class="fas fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                念~旭
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                HOME
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                ARCHIVES
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/links"
                            >
                                LINKS
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/about"
                            >
                                ABOUT
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">HOME</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">ARCHIVES</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/links">LINKS</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/about">ABOUT</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">【工作流】Flowable</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/favicon.ico">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">Fang</span>
                        
                            <span class="author-label">Lv7</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;
        <span class="pc">2023-06-28 09:13:15</span>
        <span class="mobile">2023-06-28 09:13</span>
    </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/%E5%B7%A5%E4%BD%9C%E6%B5%81/">工作流</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fas fa-file-word"></i>&nbsp;<span>16.7k Words</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fas fa-clock"></i>&nbsp;<span>71 Mins</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <h1 id="一、Flowable介绍"><a href="#一、Flowable介绍" class="headerlink" title="一、Flowable介绍"></a>一、Flowable介绍</h1><p>&amp;emsp;&amp;emsp;Flowable是BPMN的一个基于java的软件实现，不过Flowable不仅仅包括BPMN，还有DMN决策表和CMMN Case管理引擎，并且有自己的用户管理、微服务API等一系列功能，是一个服务平台。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306280956056.png"
                      alt="image-20220317101115398"
                ></p>
<h1 id="二、Flowable基础"><a href="#二、Flowable基础" class="headerlink" title="二、Flowable基础"></a>二、Flowable基础</h1><p>官方手册：<a class="link"   target="_blank" rel="noopener" href="https://tkjohn.github.io/flowable-userguide/#_introduction" >https://tkjohn.github.io/flowable-userguide/#_introduction<i class="fas fa-external-link-alt"></i></a></p>
<h2 id="1-Flowable-获取ProcessEngine対象"><a href="#1-Flowable-获取ProcessEngine対象" class="headerlink" title="1.Flowable-获取ProcessEngine対象"></a>1.Flowable-获取ProcessEngine対象</h2><p>创建一个基本的maven工程，可以是Eclipse也可以是其他IDEA。然后添加两个依赖</p>
<ul>
<li>Flowable流程引擎。使我们可以创建一个ProcessEngine流程引擎对象，并访问Flowable API。</li>
<li>一个是MySQL的数据库驱动</li>
</ul>
<p>在<em>pom.xml</em>文件中添加下列行：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.flowable<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flowable-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>然后创建一个普通的Java类，添加对应的main方法，首先要做的是初始化<strong>ProcessEngine</strong>流程引擎实例。这是一个线程安全的对象，因此通常只需要在一个应用中初始化一次。 <em>ProcessEngine</em>由<strong>ProcessEngineConfiguration</strong>实例创建。该实例可以配置与调整流程引擎的设置。 通常使用一个配置XML文件创建<em>ProcessEngineConfiguration</em>，但是（像在这里做的一样）也可以编程方式创建它。 <em>ProcessEngineConfiguration</em>所需的最小配置，是数据库JDBC连接：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.fzx.flowable.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.flowable.engine.ProcessEngine;</span><br><span class="line"><span class="keyword">import</span> org.flowable.engine.ProcessEngineConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.flowable.engine.impl.cfg.StandaloneProcessEngineConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test01</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取流程引擎对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testProcessEngine</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//获取ProcessEngineConfiguration对象</span></span><br><span class="line">        <span class="type">ProcessEngineConfiguration</span> <span class="variable">configuration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StandaloneProcessEngineConfiguration</span>();</span><br><span class="line">        <span class="comment">//配置相关的数据库的连接信息</span></span><br><span class="line">        configuration.setJdbcDriver(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">        configuration.setJdbcUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        configuration.setJdbcPassword(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        configuration.setJdbcUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/flowable-learn?serverTimezone=UTC&amp;nullCatalogMeansCurrent=true&quot;</span>);</span><br><span class="line">        <span class="comment">//如果数据库中的表不存在就新建</span></span><br><span class="line">        configuration.setDatabaseSchemaUpdate(ProcessEngineConfiguration.DB_SCHEMA_UPDATE_TRUE);</span><br><span class="line">        <span class="comment">//通过ProcessEngineConfiguration构建我们需要的processEngine对象</span></span><br><span class="line">        <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> configuration.buildProcessEngine();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>注意：</strong>要在mysql的连接字符串中添加上nullCatalogMeansCurrent&#x3D;true，设置为只查当前连接的schema库。</li>
</ul>
<h2 id="2-Flowable-日志和表结构介绍"><a href="#2-Flowable-日志和表结构介绍" class="headerlink" title="2.Flowable-日志和表结构介绍"></a>2.Flowable-日志和表结构介绍</h2><ul>
<li>然后应用运行没有问题，但也没有在控制台提供有用的信息，只有一条消息提示日志没有正确配置。Flowable使用<a class="link"   target="_blank" rel="noopener" href="http://www.slf4j.org/" >SLF4J<i class="fas fa-external-link-alt"></i></a>作为内部日志框架。在这个例子中，我们使用log4j作为SLF4J的实现。因此在pom.xml文件中添加下列依赖：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Log4j需要一个配置文件。在<em>src&#x2F;main&#x2F;resources</em>文件夹下添加<em>log4j.properties</em>文件，并写入下列内容：</li>
</ul>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">log4j.rootLogger</span>=<span class="string">DEBUG, CA</span></span><br><span class="line"></span><br><span class="line"><span class="attr">log4j.appender.CA</span>=<span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="attr">log4j.appender.CA.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="attr">log4j.appender.CA.layout.ConversionPattern</span>= <span class="string">%d&#123;hh:mm:ss,SSS&#125; [%t] %-5p %c %x - %m%n</span></span><br></pre></td></tr></table></figure>

<ul>
<li>重新运行应用。应该可以看到关于引擎启动与创建数据库表结构的提示日志：</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281016629.png"
                      alt="image-20230628101630484"
                ></p>
<ul>
<li>同时可以看到创建了相关的表结构在数据库中</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281017549.png"
                      alt="image-20230628101741424"
                ></p>
<ul>
<li>这样就得到了一个启动可用的流程引擎。接下来为它提供一个流程！</li>
</ul>
<h2 id="3-部署流程定义"><a href="#3-部署流程定义" class="headerlink" title="3.部署流程定义"></a>3.部署流程定义</h2><ul>
<li>接下来我们构建一个非常简单的请假流程，Flowable引擎需要流程定义为BPMN 2.0格式，这是一个业界广泛接受的XML标准。 在Flowable术语中，我们将其称为一个*<em>流程定义(process definition)<strong>。一个<em>流程定义</em>可以启动多个</strong>流程实例(process instance)*<em>。</em>流程定义*可以看做是重复执行流程的蓝图。 在这个例子中，</em>流程定义<em>定义了请假的各个步骤，而一个</em>流程实例*对应某个雇员提出的一个请假申请。</li>
<li>BPMN 2.0存储为XML，并包含可视化的部分：使用标准方式定义了每个步骤类型（人工任务，自动服务调用，等等）如何呈现，以及如何互相连接。这样BPMN 2.0标准使技术人员与业务人员能用双方都能理解的方式交流业务流程。</li>
<li>我们要使用的流程定义为：</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281039864.png"
                      alt="image-20230628103952698"
                ></p>
<ul>
<li>流程定义说明：<ul>
<li>我们假定启动流程需要提供一些信息，例如雇员名字、请假时长以及说明。当然，这些可以单独建模为流程中的第一步。 但是如果将它们作为流程的“输入信息”，就能保证只有在实际请求时才会建立一个流程实例。否则（将提交作为流程的第一步），用户可能在提交之前改变主意并取消，但流程实例已经创建了。 在某些场景中，就可能影响重要的指标（例如启动了多少申请，但还未完成），取决于业务目标。</li>
<li>左侧的圆圈叫做**启动事件(start event)**。这是一个流程实例的起点。</li>
<li>第一个矩形是一个**用户任务(user task)**。这是流程中用户操作的步骤。在这个例子中，经理需要批准或驳回申请</li>
<li>取决于经理的决定，<strong>排他网关(exclusive gateway)</strong> (带叉的菱形)会将流程实例路由至批准或驳回路径</li>
<li>如果批准，则需要将申请注册至某个外部系统，并跟着另一个用户任务，将经理的决定通知给申请人。当然也可以改为发送邮件。</li>
<li>如果驳回，则为雇员发送一封邮件通知他。</li>
</ul>
</li>
<li>一般来说，这样的<em>流程定义</em>使用可视化建模工具建立，如Flowable Designer(Eclipse)或Flowable Web Modeler(Web应用)。但在这里我们直接撰写XML，以熟悉BPMN 2.0及其概念。</li>
<li>与上面展示的流程图对应的BPMN 2.0 XML在下面显示。请注意这只包含了“流程部分”。如果使用图形化建模工具，实际的XML文件还将包含“可视化部分”，用于描述图形信息，如流程定义中各个元素的坐标（所有的图形化信息包含在XML的<em>BPMNDiagram</em>标签中，作为<em>definitions</em>标签的子元素）。</li>
<li>将下面的XML保存在<em>src&#x2F;main&#x2F;resources</em>文件夹下名为<em>holiday-request.bpmn20.xml</em>的文件中。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">definitions</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.omg.org/spec/BPMN/20100524/MODEL&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">xmlns:xsd</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">xmlns:bpmndi</span>=<span class="string">&quot;http://www.omg.org/spec/BPMN/20100524/DI&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">xmlns:omgdc</span>=<span class="string">&quot;http://www.omg.org/spec/DD/20100524/DC&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">xmlns:omgdi</span>=<span class="string">&quot;http://www.omg.org/spec/DD/20100524/DI&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">xmlns:flowable</span>=<span class="string">&quot;http://flowable.org/bpmn&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">typeLanguage</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">expressionLanguage</span>=<span class="string">&quot;http://www.w3.org/1999/XPath&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">targetNamespace</span>=<span class="string">&quot;http://www.flowable.org/processdef&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">process</span> <span class="attr">id</span>=<span class="string">&quot;holidayRequest&quot;</span> <span class="attr">name</span>=<span class="string">&quot;Holiday Request&quot;</span> <span class="attr">isExecutable</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">startEvent</span> <span class="attr">id</span>=<span class="string">&quot;startEvent&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">sourceRef</span>=<span class="string">&quot;startEvent&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;approveTask&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">userTask</span> <span class="attr">id</span>=<span class="string">&quot;approveTask&quot;</span> <span class="attr">name</span>=<span class="string">&quot;Approve or reject request&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">sourceRef</span>=<span class="string">&quot;approveTask&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;decision&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusiveGateway</span> <span class="attr">id</span>=<span class="string">&quot;decision&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">sourceRef</span>=<span class="string">&quot;decision&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;externalSystemCall&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">conditionExpression</span> <span class="attr">xsi:type</span>=<span class="string">&quot;tFormalExpression&quot;</span>&gt;</span></span><br><span class="line">                &lt;![CDATA[</span><br><span class="line">          $&#123;approved&#125;</span><br><span class="line">        ]]&gt;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">conditionExpression</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">sequenceFlow</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sequenceFlow</span>  <span class="attr">sourceRef</span>=<span class="string">&quot;decision&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;sendRejectionMail&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">conditionExpression</span> <span class="attr">xsi:type</span>=<span class="string">&quot;tFormalExpression&quot;</span>&gt;</span></span><br><span class="line">                &lt;![CDATA[</span><br><span class="line">          $&#123;!approved&#125;</span><br><span class="line">        ]]&gt;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">conditionExpression</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">sequenceFlow</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">serviceTask</span> <span class="attr">id</span>=<span class="string">&quot;externalSystemCall&quot;</span> <span class="attr">name</span>=<span class="string">&quot;Enter holidays in external system&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">flowable:class</span>=<span class="string">&quot;org.flowable.CallExternalSystemDelegate&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">sourceRef</span>=<span class="string">&quot;externalSystemCall&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;holidayApprovedTask&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">userTask</span> <span class="attr">id</span>=<span class="string">&quot;holidayApprovedTask&quot;</span> <span class="attr">name</span>=<span class="string">&quot;Holiday approved&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">sourceRef</span>=<span class="string">&quot;holidayApprovedTask&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;approveEnd&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">serviceTask</span> <span class="attr">id</span>=<span class="string">&quot;sendRejectionMail&quot;</span> <span class="attr">name</span>=<span class="string">&quot;Send out rejection email&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">flowable:class</span>=<span class="string">&quot;org.flowable.SendRejectionMail&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">sourceRef</span>=<span class="string">&quot;sendRejectionMail&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;rejectEnd&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">endEvent</span> <span class="attr">id</span>=<span class="string">&quot;approveEnd&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">endEvent</span> <span class="attr">id</span>=<span class="string">&quot;rejectEnd&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">process</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">definitions</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>这个是在线编辑器：<a class="link"   target="_blank" rel="noopener" href="http://www.bpmnmodeler.com/flowable/" >http://www.bpmnmodeler.com/flowable/<i class="fas fa-external-link-alt"></i></a></li>
</ul>
<p>现在我们已经有了流程BPMN 2.0 XML文件，下来需要将它***部署(deploy)**<em>到引擎中。</em>部署*一个流程定义意味着：</p>
<ul>
<li>流程引擎会将XML文件存储在数据库中，这样可以在需要的时候获取它</li>
<li>流程定义转换为内部的、可执行的对象模型，这样使用它就可以启动<em>流程实例</em>。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281045836.png"
                      alt="image-20230628104512710"
                ></p>
<ul>
<li>将流程定义<em>部署</em>至Flowable引擎，需要使用<em>RepositoryService</em>，其可以从<em>ProcessEngine</em>对象获取。使用<em>RepositoryService</em>，可以通过XML文件的路径创建一个新的*部署(Deployment)<em>，并调用</em>deploy()*方法实际执行：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.fzx.flowable.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.flowable.engine.ProcessEngine;</span><br><span class="line"><span class="keyword">import</span> org.flowable.engine.ProcessEngineConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.flowable.engine.RepositoryService;</span><br><span class="line"><span class="keyword">import</span> org.flowable.engine.impl.cfg.StandaloneProcessEngineConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.flowable.engine.repository.Deployment;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test01</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">ProcessEngineConfiguration</span> <span class="variable">configuration</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//获取ProcessEngineConfiguration对象</span></span><br><span class="line">        configuration = <span class="keyword">new</span> <span class="title class_">StandaloneProcessEngineConfiguration</span>();</span><br><span class="line">        <span class="comment">//配置相关的数据库的连接信息</span></span><br><span class="line">        configuration.setJdbcDriver(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">        configuration.setJdbcUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        configuration.setJdbcPassword(<span class="string">&quot;ainianfzx521&quot;</span>);</span><br><span class="line">        configuration.setJdbcUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/flowable-learn?serverTimezone=UTC&amp;nullCatalogMeansCurrent=true&quot;</span>);</span><br><span class="line">        <span class="comment">//如果数据库中的表不存在就新建</span></span><br><span class="line">        configuration.setDatabaseSchemaUpdate(ProcessEngineConfiguration.DB_SCHEMA_UPDATE_TRUE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 部署流程</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeploy</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//1.获取ProcessEngine对象</span></span><br><span class="line">        <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> configuration.buildProcessEngine();</span><br><span class="line">        <span class="comment">//2.获取RepositoryService</span></span><br><span class="line">        <span class="type">RepositoryService</span> <span class="variable">repositoryService</span> <span class="operator">=</span> processEngine.getRepositoryService();</span><br><span class="line">        <span class="type">Deployment</span> <span class="variable">deploy</span> <span class="operator">=</span> repositoryService.createDeployment()</span><br><span class="line">                .addClasspathResource(<span class="string">&quot;holiday-request.bpmn20.xml&quot;</span>)<span class="comment">//关联要部署的流程文件</span></span><br><span class="line">                .name(<span class="string">&quot;请求流程&quot;</span>)</span><br><span class="line">                .deploy();</span><br><span class="line">        System.out.println(<span class="string">&quot;deploy.getId() = &quot;</span>+ deploy.getId());</span><br><span class="line">        System.out.println(<span class="string">&quot;deploy.getName() = &quot;</span> + deploy.getName());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>然后执行该方法日志操作成功：</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281058313.png"
                      alt="image-20230628105702402"
                ></p>
<ul>
<li>act_re_deployment: 流程定义部署表，每部署一次就增加一条记录</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281059558.png"
                      alt="image-20230628105915399"
                ></p>
<ul>
<li>act_re_procdef ：流程定义表，部署每个新的流程定义都会在这张表中增加一条记录</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281100047.png"
                      alt="image-20230628110000900"
                ></p>
<ul>
<li>act_ge_bytearray ：流程资源表，流程部署的 bpmn文件和png图片会保存在该表中</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281100083.png"
                      alt="image-20230628110057894"
                ></p>
<h2 id="4-Flowable-部署流程-查询和删除操作"><a href="#4-Flowable-部署流程-查询和删除操作" class="headerlink" title="4.Flowable-部署流程-查询和删除操作"></a>4.Flowable-部署流程-查询和删除操作</h2><ul>
<li>我们现在可以通过API查询验证流程定义已经部署在引擎中（并学习一些API）。通过<em>RepositoryService</em>创建的<em>ProcessDefinitionQuery</em>对象实现。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询流程定义的信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeployQuery</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> configuration.buildProcessEngine();</span><br><span class="line">    <span class="type">RepositoryService</span> <span class="variable">repositoryService</span> <span class="operator">=</span> processEngine.getRepositoryService();</span><br><span class="line">    <span class="type">ProcessDefinition</span> <span class="variable">processDefinition</span> <span class="operator">=</span> repositoryService.createProcessDefinitionQuery()</span><br><span class="line">            .deploymentId(<span class="string">&quot;2501&quot;</span>)</span><br><span class="line">            .singleResult();</span><br><span class="line">    System.out.println(<span class="string">&quot;processDefinition.getDeploymentId() = &quot;</span> + processDefinition.getDeploymentId());</span><br><span class="line">    System.out.println(<span class="string">&quot;processDefinition.getName() = &quot;</span> + processDefinition.getName());</span><br><span class="line">    System.out.println(<span class="string">&quot;processDefinition.getDescription() = &quot;</span> + processDefinition.getDescription());</span><br><span class="line">    System.out.println(<span class="string">&quot;processDefinition.getId() = &quot;</span> + processDefinition.getId());</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 删除流程定义</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeleteDeploy</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> configuration.buildProcessEngine();</span><br><span class="line">    <span class="type">RepositoryService</span> <span class="variable">repositoryService</span> <span class="operator">=</span> processEngine.getRepositoryService();</span><br><span class="line">    <span class="comment">//删除部署的流程 第一个参数是 id 如果部署的流程启动了就不允许删除了</span></span><br><span class="line">    repositoryService.deleteDeployment(<span class="string">&quot;2501&quot;</span>);</span><br><span class="line">    <span class="comment">//第二个参数是级联删除，如果流程启动了 相关的任务一并会被删除掉</span></span><br><span class="line">    repositoryService.deleteDeployment(<span class="string">&quot;2501&quot;</span>,<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-启动流程实例"><a href="#5-启动流程实例" class="headerlink" title="5.启动流程实例"></a>5.启动流程实例</h2><ul>
<li>现在已经在流程引擎中<em>部署</em>了流程定义，因此可以使用这个<em>流程定义</em>作为“模板”启动<em>流程实例</em>。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281333695.png"
                      alt="image-20230628133312546"
                ></p>
<ul>
<li>要启动流程实例，需要提供一些初始化<em>流程变量</em>。一般来说，可以通过呈现给用户的表单，<strong>或者</strong>在流程由其他系统自动触发时通过REST API，来获取这些变量。在这个例子里，我们简化直接在代码中定义了，我们使用<em>RuntimeService</em>启动一个<em>流程实例</em>。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 启动流程实例</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testRunProcess</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> configuration.buildProcessEngine();</span><br><span class="line">    <span class="comment">//我们需要通过RuntimeService来启动流程实例</span></span><br><span class="line">    <span class="type">RuntimeService</span> <span class="variable">runtimeService</span> <span class="operator">=</span> processEngine.getRuntimeService();</span><br><span class="line">    <span class="comment">//构建流程变量</span></span><br><span class="line">    Map&lt;String,Object&gt; variables = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    variables.put(<span class="string">&quot;employee&quot;</span>,<span class="string">&quot;张三&quot;</span>);<span class="comment">//谁申请请假</span></span><br><span class="line">    variables.put(<span class="string">&quot;nrOfHolidays&quot;</span>,<span class="number">3</span>);<span class="comment">//请几天假</span></span><br><span class="line">    variables.put(<span class="string">&quot;desciption&quot;</span>,<span class="string">&quot;工作累了，出去玩玩&quot;</span>);<span class="comment">//请假原因</span></span><br><span class="line">    <span class="comment">//启动流程实例</span></span><br><span class="line">    <span class="type">ProcessInstance</span> <span class="variable">holidayRequest</span> <span class="operator">=</span> runtimeService.startProcessInstanceByKey(<span class="string">&quot;holidayRequest&quot;</span>, variables);</span><br><span class="line">    System.out.println(<span class="string">&quot;holidayRequest.getProcessDefinitionId() = &quot;</span> + holidayRequest.getProcessDefinitionId());</span><br><span class="line">    System.out.println(<span class="string">&quot;holidayRequest.getActivityId() = &quot;</span> + holidayRequest.getActivityId());</span><br><span class="line">    System.out.println(<span class="string">&quot;holidayRequest.getId() = &quot;</span> + holidayRequest.getId());</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>启动成功，输出结果如下：</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281336811.png"
                      alt="image-20230628133638673"
                ></p>
<ul>
<li>启动流程实例涉及到的表结构：<ul>
<li>act_hi_actinst 流程实例执行历史</li>
<li>act_hi_identitylink 流程的参与用户的历史信息</li>
<li>act_hi_procinst 流程实例历史信息</li>
<li>act_hi_taskinst 流程任务历史信息</li>
<li>act_ru_execution 流程执行信息</li>
<li>act_ru_identitylink 流程的参与用户信息</li>
<li>act_ru_task 任务信息</li>
</ul>
</li>
</ul>
<h2 id="6-查询任务"><a href="#6-查询任务" class="headerlink" title="6.查询任务"></a>6.查询任务</h2><ul>
<li>上面员工发起了一个请假流程，接下来就会流转到总经理这儿来处理，之前我们没有指定经理这的处理人，我们可以加一个</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281348521.png"
                      alt="image-20230628134802278"
                ></p>
<ul>
<li>然后我们来查看下lisi的任务</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询任务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testQueryTask</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> configuration.buildProcessEngine();</span><br><span class="line">    <span class="type">TaskService</span> <span class="variable">taskService</span> <span class="operator">=</span> processEngine.getTaskService();</span><br><span class="line">    List&lt;Task&gt; list = taskService.createTaskQuery().processDefinitionKey(<span class="string">&quot;holidayRequest&quot;</span>)<span class="comment">//指定查询的流程</span></span><br><span class="line">            .taskAssignee(<span class="string">&quot;lisi&quot;</span>)<span class="comment">//查询这个任务的处理人</span></span><br><span class="line">            .list();</span><br><span class="line">    <span class="keyword">for</span> (Task task : list)&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;task.getProcessDefinitionId() = &quot;</span> + task.getProcessDefinitionId());</span><br><span class="line">        System.out.println(<span class="string">&quot;task.getName() = &quot;</span> + task.getName());</span><br><span class="line">        System.out.println(<span class="string">&quot;task.getAssignee() = &quot;</span> + task.getAssignee());</span><br><span class="line">        System.out.println(<span class="string">&quot;task.getDescription() = &quot;</span> + task.getDescription());</span><br><span class="line">        System.out.println(<span class="string">&quot;task.getId() = &quot;</span> + task.getId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>输出结果为：</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281356165.png"
                      alt="image-20230628135627025"
                ></p>
<h2 id="7-完成任务"><a href="#7-完成任务" class="headerlink" title="7.完成任务"></a>7.完成任务</h2><ul>
<li>现在李四这个角色可以来完成当前的任务了</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281416303.png"
                      alt="image-20230628141604102"
                ></p>
<ul>
<li>在此处我们直接解决掉这个请假，然后会走发送拒绝邮件的流程，这块我们需要用到JavaDelegate来触发。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281417469.png"
                      alt="image-20230628141701315"
                ></p>
<ul>
<li>我们定义这样一个Java类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.flowable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.flowable.engine.delegate.DelegateExecution;</span><br><span class="line"><span class="keyword">import</span> org.flowable.engine.delegate.JavaDelegate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SendRejectionMail</span> <span class="keyword">implements</span> <span class="title class_">JavaDelegate</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 这是一个Flowable中的触发器</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> delegateExecution</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">(DelegateExecution delegateExecution)</span> &#123;</span><br><span class="line">        <span class="comment">//触发执行的逻辑 按照我们在流程中的定义应该给被拒绝的员工发送的邮件</span></span><br><span class="line">        System.out.println(<span class="string">&quot;不好意思，你的请假申请被拒绝。。。。安心工作&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>然后来完成任务</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 完成当前任务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCompleteTask</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> configuration.buildProcessEngine();</span><br><span class="line">    <span class="type">TaskService</span> <span class="variable">taskService</span> <span class="operator">=</span> processEngine.getTaskService();</span><br><span class="line">    <span class="type">Task</span> <span class="variable">task</span> <span class="operator">=</span> taskService.createTaskQuery()</span><br><span class="line">            .processDefinitionKey(<span class="string">&quot;holidayRequest&quot;</span>)</span><br><span class="line">            .taskAssignee(<span class="string">&quot;lisi&quot;</span>)</span><br><span class="line">            .singleResult();</span><br><span class="line">    <span class="comment">//创建流程变量</span></span><br><span class="line">    HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    map.put(<span class="string">&quot;approved&quot;</span>,<span class="literal">false</span>);</span><br><span class="line">    <span class="comment">//完成任务</span></span><br><span class="line">    taskService.complete(task.getId(),map);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>然后可以看到JavaDelegate触发了</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281418003.png"
                      alt="image-20230628141845827"
                ></p>
<h2 id="8-Flowable-历史任务查询"><a href="#8-Flowable-历史任务查询" class="headerlink" title="8.Flowable-历史任务查询"></a>8.Flowable-历史任务查询</h2><ul>
<li><p>选择使用Flowable这样的流程引擎的原因之一，是它可以自动存储所有流程实例的<strong>审计数据</strong>或<strong>历史数据</strong>。这些数据可以用于创建报告，深入展现组织运行的情况，瓶颈在哪里，等等。</p>
</li>
<li><p>例如，如果希望显示流程实例已经执行的时间，就可以从<em>ProcessEngine</em>获取<em>HistoryService</em>，并创建*历史活动(historical activities)*的查询。在下面的代码片段中，可以看到我们添加了一些额外的过滤条件：</p>
<ul>
<li>只选择一个特定流程实例的活动</li>
<li>只选择已完成的活动</li>
<li>结果按照结束时间排序，代表其执行顺序。</li>
</ul>
</li>
<li><p>查询历史任务</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取流程任务的历史数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testHistory</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> configuration.buildProcessEngine();</span><br><span class="line">    <span class="type">HistoryService</span> <span class="variable">historyService</span> <span class="operator">=</span> processEngine.getHistoryService();</span><br><span class="line">    List&lt;HistoricActivityInstance&gt; list = historyService.createHistoricActivityInstanceQuery()</span><br><span class="line">            .processDefinitionId(<span class="string">&quot;holidayRequest:1:7503&quot;</span>)</span><br><span class="line">            .finished()</span><br><span class="line">            .orderByHistoricActivityInstanceEndTime().asc()</span><br><span class="line">            .list();</span><br><span class="line">    <span class="keyword">for</span> (HistoricActivityInstance history : list)&#123;</span><br><span class="line">        System.out.println(history.getActivityName()+<span class="string">&quot;:&quot;</span>+history.getAssignee()+<span class="string">&quot;--&quot;</span></span><br><span class="line">                            +history.getActivityId()+<span class="string">&quot;:&quot;</span>+history.getDurationInMillis()+<span class="string">&quot;毫秒&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>结果如下：</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281435027.png"
                      alt="image-20230628143535880"
                ></p>
<h1 id="三、Flowable流程设计器"><a href="#三、Flowable流程设计器" class="headerlink" title="三、Flowable流程设计器"></a>三、Flowable流程设计器</h1><h2 id="1-Eclipse-Designer"><a href="#1-Eclipse-Designer" class="headerlink" title="1.Eclipse Designer"></a>1.Eclipse Designer</h2><p>&amp;emsp;&amp;emsp;Flowable提供了名为Flowable Eclipse Designer的Eclipse插件，可以用于图形化地建模、测试与部署BPMN 2.0流程。</p>
<h3 id="1-1-下载安装Eclipse"><a href="#1-1-下载安装Eclipse" class="headerlink" title="1.1 下载安装Eclipse"></a>1.1 下载安装Eclipse</h3><p>&amp;emsp;&amp;emsp;去Eclipse官网下载即可：<a class="link"   target="_blank" rel="noopener" href="https://www.eclipse.org/downloads/packages/release" >https://www.eclipse.org/downloads/packages/release<i class="fas fa-external-link-alt"></i></a> 注意2020-09后的版本不再支持jdk8</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281505993.png"
                      alt="image-20220316202904261"
                ></p>
<p>&amp;emsp;解压缩就可以了，然后进入解压缩的目录</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281504125.png"
                      alt="image-20220316203036602"
                ></p>
<p>&amp;emsp;&amp;emsp;直接启动即可</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281504129.png"
                      alt="image-20220316203111301"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281505391.png"
                      alt="image-20220316203237316"
                ></p>
<h3 id="1-2-安装Flowable插件"><a href="#1-2-安装Flowable插件" class="headerlink" title="1.2 安装Flowable插件"></a>1.2 安装Flowable插件</h3><p>&amp;emsp;&amp;emsp;然后我们再安装下Flowable的插件，选择<strong>Help → Install New Software</strong>。在下图面板中，点击<em>Add</em>按钮，并填写下列字段</p>
<ul>
<li><strong>Name:</strong> Flowable BPMN 2.0 designer</li>
<li><strong>Location:</strong> <a class="link"   target="_blank" rel="noopener" href="http://www.flowable.org/designer/update/" >http://www.flowable.org/designer/update/<i class="fas fa-external-link-alt"></i></a></li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281505459.png"
                      alt="image-20220316203454281"
                ></p>
<p>&amp;emsp;&amp;emsp;这种在线更新的方式已经被官网移除了，操作不了</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281505871.png"
                      alt="image-20220316211319931"
                ></p>
<p>&amp;emsp;&amp;emsp;这时我们就只能通过离线安装的方式来实现了，下载对应的离线文件</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281504118.png"
                      alt="image-20220316211405001"
                ></p>
<p>&amp;emsp;&amp;emsp;安装步骤来操作，</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281504122.png"
                      alt="image-20220316211518520"
                ></p>
<p>然后继续：选择<strong>Help → Install New Software</strong></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281506514.png"
                      alt="image-20220316211622115"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281506393.png"
                      alt="image-20220316211651195"
                ></p>
<p>下一步</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281504144.png"
                      alt="image-20220316211729581"
                ></p>
<p>再下一步</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281504222.png"
                      alt="image-20220316211802548"
                ></p>
<p>然后finish。弹出如下窗口</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281506156.png"
                      alt="image-20220316212008477"
                ></p>
<p>重启即可</p>
<h3 id="1-3-创建项目"><a href="#1-3-创建项目" class="headerlink" title="1.3 创建项目"></a>1.3 创建项目</h3><p>&amp;emsp;&amp;emsp;然后我们就可以创建一个Flowable Project了</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281504858.png"
                      alt="image-20220316212418899"
                ></p>
<p>&amp;emsp;&amp;emsp;然后我们可以在src&#x2F;mian&#x2F;resources&#x2F; 的目录下创建对应的流程图了</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281504378.png"
                      alt="image-20220316212605146"
                ></p>
<p>&amp;emsp;&amp;emsp;看到如下的界面说明插件安装成功了</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281504497.png"
                      alt="image-20220316212720767"
                ></p>
<h3 id="1-4-创建流程图"><a href="#1-4-创建流程图" class="headerlink" title="1.4 创建流程图"></a>1.4 创建流程图</h3><p>使用滑板来绘制流程，通过从右侧把图标拖拽到左侧的面板，最终的效果</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281504708.png"
                      alt="image-20220316214339678"
                ></p>
<p>指定流程的主键</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281504342.png"
                      alt="image-20220316214430644"
                ></p>
<p>指定任务的负责人</p>
<p>在Properties视图中指定每个任务节点的负责人</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281504535.png"
                      alt="image-20220316214700887"
                ></p>
<p>创建请假单：zhangsan</p>
<p>审批请假单：lisi</p>
<p>当我们设置完成后保存文件，会同时生成png图片</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281506161.png"
                      alt="image-20220316214808400"
                ></p>
<p>注意：生成图片需要如下配置</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281504490.png"
                      alt="image-20220316214256235"
                ></p>
<h3 id="1-5-部署流程"><a href="#1-5-部署流程" class="headerlink" title="1.5 部署流程"></a>1.5 部署流程</h3><p>&amp;emsp;&amp;emsp;首先在Eclipse中生成bar文件，选中项目然后鼠标右击</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281504495.png"
                      alt="image-20220316215805503"
                ></p>
<p>然后会发现在项目的根目录下多了一个deployment文件夹，里面多了一个MyProcess.bar文件</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281504498.png"
                      alt="image-20220316215900052"
                ></p>
<p>然后我们就可以把这个bar文件拷贝到IDEA中，继续部署的流程</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281504913.png"
                      alt="image-20220316215945236"
                ></p>
<p>而部署的代码和前面没啥区别</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeploy</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">// 1.获取 ProcessEngine 对象</span></span><br><span class="line">    <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> configuration.buildProcessEngine();</span><br><span class="line">    <span class="comment">// 2.获取RepositoryService</span></span><br><span class="line">    <span class="type">RepositoryService</span> <span class="variable">repositoryService</span> <span class="operator">=</span> processEngine.getRepositoryService();</span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> <span class="built_in">this</span>.getClass().getClassLoader().getResourceAsStream(<span class="string">&quot;MyHoliday.bar&quot;</span>);</span><br><span class="line">    <span class="type">ZipInputStream</span> <span class="variable">zipInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ZipInputStream</span>(in);</span><br><span class="line">    <span class="comment">// 3.完成流程的部署操作 ZIP 或者 Bar文件</span></span><br><span class="line">    <span class="type">Deployment</span> <span class="variable">deploy</span> <span class="operator">=</span> repositoryService.createDeployment()</span><br><span class="line">           <span class="comment">// .addClasspathResource(&quot;MyHoliday.bar&quot;)// 关联要部署的流程文件</span></span><br><span class="line">            .addZipInputStream(zipInputStream)</span><br><span class="line">            .name(<span class="string">&quot;XXX公司请求流程&quot;</span>)</span><br><span class="line">            .deploy() ;<span class="comment">// 部署流程</span></span><br><span class="line">    System.out.println(<span class="string">&quot;deploy.getId() = &quot;</span> + deploy.getId());</span><br><span class="line">    System.out.println(<span class="string">&quot;deploy.getName() = &quot;</span> + deploy.getName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行后查看表结构，相关的信息就进去了</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281504247.png"
                      alt="image-20220316220121734"
                ></p>
<h2 id="2-我直接用网页的"><a href="#2-我直接用网页的" class="headerlink" title="2.我直接用网页的"></a>2.我直接用网页的</h2><ul>
<li><p><a class="link"   target="_blank" rel="noopener" href="http://www.bpmnmodeler.com/flowable/" >http://www.bpmnmodeler.com/flowable/<i class="fas fa-external-link-alt"></i></a></p>
</li>
<li><p>写部署代码</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 部署流程</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeploy</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//1.获取ProcessEngine对象</span></span><br><span class="line">    <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> configuration.buildProcessEngine();</span><br><span class="line">    <span class="comment">//2.获取RepositoryService</span></span><br><span class="line">    <span class="type">RepositoryService</span> <span class="variable">repositoryService</span> <span class="operator">=</span> processEngine.getRepositoryService();</span><br><span class="line">    <span class="type">Deployment</span> <span class="variable">deploy</span> <span class="operator">=</span> repositoryService.createDeployment()</span><br><span class="line">            .addClasspathResource(<span class="string">&quot;请假申请.bpmn20.xml&quot;</span>)<span class="comment">//关联要部署的流程文件</span></span><br><span class="line">            .name(<span class="string">&quot;xxx公司请求流程&quot;</span>)</span><br><span class="line">            .deploy();</span><br><span class="line">    System.out.println(<span class="string">&quot;deploy.getId() = &quot;</span>+ deploy.getId());</span><br><span class="line">    System.out.println(<span class="string">&quot;deploy.getName() = &quot;</span> + deploy.getName());</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>唯一的区别就是最后存储的时候，xml和png是分开存储的</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281510750.png"
                      alt="image-20230628150843102"
                ></p>
<ul>
<li>测试二完整代码与测试一雷同</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.fzx.flowable.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.flowable.engine.*;</span><br><span class="line"><span class="keyword">import</span> org.flowable.engine.history.HistoricActivityInstance;</span><br><span class="line"><span class="keyword">import</span> org.flowable.engine.impl.cfg.StandaloneProcessEngineConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.flowable.engine.repository.Deployment;</span><br><span class="line"><span class="keyword">import</span> org.flowable.engine.repository.ProcessDefinition;</span><br><span class="line"><span class="keyword">import</span> org.flowable.engine.runtime.ProcessInstance;</span><br><span class="line"><span class="keyword">import</span> org.flowable.task.api.Task;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test02</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">ProcessEngineConfiguration</span> <span class="variable">configuration</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//获取ProcessEngineConfiguration对象</span></span><br><span class="line">        configuration = <span class="keyword">new</span> <span class="title class_">StandaloneProcessEngineConfiguration</span>();</span><br><span class="line">        <span class="comment">//配置相关的数据库的连接信息</span></span><br><span class="line">        configuration.setJdbcDriver(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">        configuration.setJdbcUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        configuration.setJdbcPassword(<span class="string">&quot;ainianfzx521&quot;</span>);</span><br><span class="line">        configuration.setJdbcUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/flowable-learn?serverTimezone=UTC&amp;nullCatalogMeansCurrent=true&quot;</span>);</span><br><span class="line">        <span class="comment">//如果数据库中的表不存在就新建</span></span><br><span class="line">        configuration.setDatabaseSchemaUpdate(ProcessEngineConfiguration.DB_SCHEMA_UPDATE_TRUE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 部署流程</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeploy</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//1.获取ProcessEngine对象</span></span><br><span class="line">        <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> configuration.buildProcessEngine();</span><br><span class="line">        <span class="comment">//2.获取RepositoryService</span></span><br><span class="line">        <span class="type">RepositoryService</span> <span class="variable">repositoryService</span> <span class="operator">=</span> processEngine.getRepositoryService();</span><br><span class="line">        <span class="type">Deployment</span> <span class="variable">deploy</span> <span class="operator">=</span> repositoryService.createDeployment()</span><br><span class="line">                .addClasspathResource(<span class="string">&quot;请假申请.bpmn20.xml&quot;</span>)<span class="comment">//关联要部署的流程文件</span></span><br><span class="line">                .name(<span class="string">&quot;xxx公司请求流程&quot;</span>)</span><br><span class="line">                .deploy();</span><br><span class="line">        System.out.println(<span class="string">&quot;deploy.getId() = &quot;</span>+ deploy.getId());</span><br><span class="line">        System.out.println(<span class="string">&quot;deploy.getName() = &quot;</span> + deploy.getName());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询流程定义的信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeployQuery</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> configuration.buildProcessEngine();</span><br><span class="line">        <span class="type">RepositoryService</span> <span class="variable">repositoryService</span> <span class="operator">=</span> processEngine.getRepositoryService();</span><br><span class="line">        <span class="type">ProcessDefinition</span> <span class="variable">processDefinition</span> <span class="operator">=</span> repositoryService.createProcessDefinitionQuery()</span><br><span class="line">                .deploymentId(<span class="string">&quot;2501&quot;</span>)</span><br><span class="line">                .singleResult();</span><br><span class="line">        System.out.println(<span class="string">&quot;processDefinition.getDeploymentId() = &quot;</span> + processDefinition.getDeploymentId());</span><br><span class="line">        System.out.println(<span class="string">&quot;processDefinition.getName() = &quot;</span> + processDefinition.getName());</span><br><span class="line">        System.out.println(<span class="string">&quot;processDefinition.getDescription() = &quot;</span> + processDefinition.getDescription());</span><br><span class="line">        System.out.println(<span class="string">&quot;processDefinition.getId() = &quot;</span> + processDefinition.getId());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除流程定义</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeleteDeploy</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> configuration.buildProcessEngine();</span><br><span class="line">        <span class="type">RepositoryService</span> <span class="variable">repositoryService</span> <span class="operator">=</span> processEngine.getRepositoryService();</span><br><span class="line">        <span class="comment">//删除部署的流程 第一个参数是 id 如果部署的流程启动了就不允许删除了</span></span><br><span class="line">        <span class="comment">//repositoryService.deleteDeployment(&quot;2501&quot;);</span></span><br><span class="line">        <span class="comment">//第二个参数是级联删除，如果流程启动了 相关的任务一并会被删除掉</span></span><br><span class="line">        repositoryService.deleteDeployment(<span class="string">&quot;2501&quot;</span>,<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 启动流程实例</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testRunProcess</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> configuration.buildProcessEngine();</span><br><span class="line">        <span class="comment">//我们需要通过RuntimeService来启动流程实例</span></span><br><span class="line">        <span class="type">RuntimeService</span> <span class="variable">runtimeService</span> <span class="operator">=</span> processEngine.getRuntimeService();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//启动流程实例</span></span><br><span class="line">        <span class="type">ProcessInstance</span> <span class="variable">holidayRequest</span> <span class="operator">=</span> runtimeService.startProcessInstanceByKey(<span class="string">&quot;LeaveApplication&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;holidayRequest.getProcessDefinitionId() = &quot;</span> + holidayRequest.getProcessDefinitionId());</span><br><span class="line">        System.out.println(<span class="string">&quot;holidayRequest.getActivityId() = &quot;</span> + holidayRequest.getActivityId());</span><br><span class="line">        System.out.println(<span class="string">&quot;holidayRequest.getId() = &quot;</span> + holidayRequest.getId());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询任务</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testQueryTask</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> configuration.buildProcessEngine();</span><br><span class="line">        <span class="type">TaskService</span> <span class="variable">taskService</span> <span class="operator">=</span> processEngine.getTaskService();</span><br><span class="line">        List&lt;Task&gt; list = taskService.createTaskQuery().processDefinitionKey(<span class="string">&quot;LeaveApplication&quot;</span>)<span class="comment">//指定查询的流程</span></span><br><span class="line">                .taskAssignee(<span class="string">&quot;zhangsan&quot;</span>)<span class="comment">//查询这个任务的处理人</span></span><br><span class="line">                .list();</span><br><span class="line">        <span class="keyword">for</span> (Task task : list)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;task.getProcessDefinitionId() = &quot;</span> + task.getProcessDefinitionId());</span><br><span class="line">            System.out.println(<span class="string">&quot;task.getName() = &quot;</span> + task.getName());</span><br><span class="line">            System.out.println(<span class="string">&quot;task.getAssignee() = &quot;</span> + task.getAssignee());</span><br><span class="line">            System.out.println(<span class="string">&quot;task.getDescription() = &quot;</span> + task.getDescription());</span><br><span class="line">            System.out.println(<span class="string">&quot;task.getId() = &quot;</span> + task.getId());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 完成当前任务</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCompleteTask</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> configuration.buildProcessEngine();</span><br><span class="line">        <span class="type">TaskService</span> <span class="variable">taskService</span> <span class="operator">=</span> processEngine.getTaskService();</span><br><span class="line">        <span class="type">Task</span> <span class="variable">task</span> <span class="operator">=</span> taskService.createTaskQuery()</span><br><span class="line">                .processDefinitionKey(<span class="string">&quot;LeaveApplication&quot;</span>)</span><br><span class="line">                .singleResult();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//完成任务</span></span><br><span class="line">        taskService.complete(task.getId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取流程任务的历史数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testHistory</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> configuration.buildProcessEngine();</span><br><span class="line">        <span class="type">HistoryService</span> <span class="variable">historyService</span> <span class="operator">=</span> processEngine.getHistoryService();</span><br><span class="line">        List&lt;HistoricActivityInstance&gt; list = historyService.createHistoricActivityInstanceQuery()</span><br><span class="line">                .processDefinitionId(<span class="string">&quot;LeaveApplication:1:15004&quot;</span>)</span><br><span class="line">                .finished()</span><br><span class="line">                .orderByHistoricActivityInstanceEndTime().asc()</span><br><span class="line">                .list();</span><br><span class="line">        <span class="keyword">for</span> (HistoricActivityInstance history : list)&#123;</span><br><span class="line">            System.out.println(history.getActivityName()+<span class="string">&quot;:&quot;</span>+history.getAssignee()+<span class="string">&quot;--&quot;</span></span><br><span class="line">                                +history.getActivityId()+<span class="string">&quot;:&quot;</span>+history.getDurationInMillis()+<span class="string">&quot;毫秒&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-Flowable-UI应用"><a href="#3-Flowable-UI应用" class="headerlink" title="3.Flowable UI应用"></a>3.Flowable UI应用</h2><p>Flowable提供了几个web应用，用于演示及介绍Flowable项目提供的功能：</p>
<ul>
<li>Flowable IDM: 身份管理应用。为所有Flowable UI应用提供单点登录认证功能，并且为拥有IDM管理员权限的用户提供了管理用户、组与权限的功能。</li>
<li>Flowable Modeler: 让具有建模权限的用户可以创建流程模型、表单、选择表与应用定义。</li>
<li>Flowable Task: 运行时任务应用。提供了启动流程实例、编辑任务表单、完成任务，以及查询流程实例与任务的功能。</li>
<li>Flowable Admin: 管理应用。让具有管理员权限的用户可以查询BPMN、DMN、Form及Content引擎，并提供了许多选项用于修改流程实例、任务、作业等。管理应用通过REST API连接至引擎，并与Flowable Task应用及Flowable REST应用一同部署。</li>
</ul>
<p>&amp;emsp;&amp;emsp;所有其他的应用都需要Flowable IDM提供认证。每个应用的WAR文件可以部署在相同的servlet容器（如Apache Tomcat）中，也可以部署在不同的容器中。由于每个应用使用相同的cookie进行认证，因此应用需要运行在相同的域名下。</p>
<h3 id="3-1安装部署"><a href="#3-1安装部署" class="headerlink" title="3.1安装部署"></a>3.1安装部署</h3><ul>
<li>下载Tomcat：<a class="link"   target="_blank" rel="noopener" href="https://tomcat.apache.org/download-80.cgi" >https://tomcat.apache.org/download-80.cgi<i class="fas fa-external-link-alt"></i></a> 官网下载后解压缩到非中文目录即可，然后是下载FlowableUI的文件，在Flowable6.6之后把FlowableUI中提供的四个功能合并到了一起。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281636039.png"
                      alt="image-20230628163630811"
                ></p>
<ul>
<li>然后把解压缩后的两个war包拷贝到Tomcat的解压缩的webapps目录下</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281636052.png"
                      alt="image-20230628163645913"
                ></p>
<h3 id="3-2启动服务"><a href="#3-2启动服务" class="headerlink" title="3.2启动服务"></a>3.2启动服务</h3><ul>
<li>启动Tomcat服务，执行startup.bat文件</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281637801.png"
                      alt="image-20230628163742570"
                ></p>
<ul>
<li>如果启动中出现乱码修改Tomcat的conf目录下的 logging.properties 文件中的编码</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281637619.png"
                      alt="image-20230628163758418"
                ></p>
<ul>
<li>如果一闪而过则检查jdk的环境变量配置。启动成功后，在浏览器中访问 <a class="link"   target="_blank" rel="noopener" href="http://localhost:8080/flowable-ui" >http://localhost:8080/flowable-ui<i class="fas fa-external-link-alt"></i></a>, 默认的账号密码是 admin&#x2F;test</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281638454.png"
                      alt="image-20230628163818266"
                ></p>
<h3 id="3-3-用户管理"><a href="#3-3-用户管理" class="headerlink" title="3.3 用户管理"></a>3.3 用户管理</h3><ul>
<li>我们先在 <code>身份管理应用程序</code> 中创建用户并授权</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281652125.png"
                      alt="image-20220318102707368"
                ></p>
<ul>
<li>创建用户</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281652178.png"
                      alt="image-20220318102734238"
                ></p>
<ul>
<li>填写详细信息</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281651406.png"
                      alt="image-20220318102817782"
                ></p>
<ul>
<li>授权管理</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281652396.png"
                      alt="image-20220318102859814"
                ></p>
<h3 id="3-4-绘制流程"><a href="#3-4-绘制流程" class="headerlink" title="3.4 绘制流程"></a>3.4 绘制流程</h3><ul>
<li>创建新的流程</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281653300.png"
                      alt="image-20220318101239742"
                ></p>
<ul>
<li>流程图界面</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281651438.png"
                      alt="image-20220318101346692"
                ></p>
<p>创建流程，分配处理人</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281651694.png"
                      alt="image-20220318101639424"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281653524.png"
                      alt="image-20220318101611564"
                ></p>
<ul>
<li>继续完成流程图的创建</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281653086.png"
                      alt="image-20220318101810272"
                ></p>
<h3 id="3-5-部署流程"><a href="#3-5-部署流程" class="headerlink" title="3.5 部署流程"></a>3.5 部署流程</h3><ul>
<li>绘制好的流程图，我们只需要一键导出即可</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281657654.png"
                      alt="image-20220318103413285"
                ></p>
<ul>
<li>下载下来后拷贝到项目的resource目录下即可</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281656226.png"
                      alt="image-20220318103518807"
                ></p>
<ul>
<li>然后就是正常的操作流程了</li>
</ul>
<h3 id="3-6-FlowableUI-演示"><a href="#3-6-FlowableUI-演示" class="headerlink" title="3.6 FlowableUI 演示"></a>3.6 FlowableUI 演示</h3><h4 id="3-6-1-部署流程"><a href="#3-6-1-部署流程" class="headerlink" title="3.6.1 部署流程"></a>3.6.1 部署流程</h4><ul>
<li>在FlowableUI中提供了演示程序</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281708408.png"
                      alt="image-20220318104517967"
                ></p>
<ul>
<li>创建一个新的应用程序，并指定相关的信息</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281709494.png"
                      alt="image-20220318104614784"
                ></p>
<ul>
<li>创建应用后需要指定对应的流程图</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281709599.png"
                      alt="image-20220318104703306"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281709587.png"
                      alt="image-20220318104735714"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281710111.png"
                      alt="image-20220318104811812"
                ></p>
<ul>
<li>发布应用程序</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281711724.png"
                      alt="image-20220318105045345"
                ></p>
<h4 id="2-6-2-启动流程"><a href="#2-6-2-启动流程" class="headerlink" title="2.6.2 启动流程"></a>2.6.2 启动流程</h4><ul>
<li>发布了应用程序后我们就可以来启动流程了</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281712996.png"
                      alt="image-20220318105258331"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281708610.png"
                      alt="image-20220318105315908"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281712088.png"
                      alt="image-20220318105336107"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281712045.png"
                      alt="image-20220318105420011"
                ></p>
<ul>
<li>点击显示图：</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281708663.png"
                      alt="image-20220318105444672"
                ></p>
<ul>
<li>也就是可以看到当前是user1来处理，user1登录后可以看到要处理的流程，user2登录是看不到的。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281712512.png"
                      alt="image-20220318105646273"
                ></p>
<ul>
<li>点击完成后流程就向下一步流转了</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281708775.png"
                      alt="image-20220318105727192"
                ></p>
<ul>
<li>这时再通过user2登录，就可以看到对应的代办的信息</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281713743.png"
                      alt="image-20220318105808830"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306281708207.png"
                      alt="image-20220318105848185"
                ></p>
<ul>
<li>然后点击完成，那么整个流程就介绍了</li>
</ul>
<h1 id="四、表结构讲解"><a href="#四、表结构讲解" class="headerlink" title="四、表结构讲解"></a>四、表结构讲解</h1><p>&amp;emsp;&amp;emsp;工作流程的相关操作都是操作存储在对应的表结构中，为了能更好的弄清楚Flowable的实现原理和细节，我们有必要先弄清楚Flowable的相关表结构及其作用。在Flowable中的表结构在初始化的时候会创建五类表结构，具体如下：</p>
<ul>
<li><strong>ACT_RE</strong> ：’RE’表示 repository。 这个前缀的表包含了流程定义和流程静态资源 （图片，规则，等等）。</li>
<li><strong>ACT_RU</strong>：’RU’表示 runtime。 这些运行时的表，包含流程实例，任务，变量，异步任务，等运行中的数据。 Flowable只在流程实例执行过程中保存这些数据， 在流程结束时就会删除这些记录。 这样运行时表可以一直很小速度很快。</li>
<li><strong>ACT_HI</strong>：’HI’表示 history。 这些表包含历史数据，比如历史流程实例， 变量，任务等等。</li>
<li><strong>ACT_GE</strong>： GE 表示 general。 通用数据， 用于不同场景下 </li>
<li><strong>ACT_ID:</strong>   ’ID’表示identity(组织机构)。这些表包含标识的信息，如用户，用户组，等等。</li>
</ul>
<p>具体的表结构的含义:</p>
<table>
<thead>
<tr>
<th><strong>表分类</strong></th>
<th><strong>表名</strong></th>
<th><strong>解释</strong></th>
</tr>
</thead>
<tbody><tr>
<td>一般数据</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>[ACT_GE_BYTEARRAY]</td>
<td>通用的流程定义和流程资源</td>
</tr>
<tr>
<td></td>
<td>[ACT_GE_PROPERTY]</td>
<td>系统相关属性</td>
</tr>
<tr>
<td>流程历史记录</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>[ACT_HI_ACTINST]</td>
<td>历史的流程实例</td>
</tr>
<tr>
<td></td>
<td>[ACT_HI_ATTACHMENT]</td>
<td>历史的流程附件</td>
</tr>
<tr>
<td></td>
<td>[ACT_HI_COMMENT]</td>
<td>历史的说明性信息</td>
</tr>
<tr>
<td></td>
<td>[ACT_HI_DETAIL]</td>
<td>历史的流程运行中的细节信息</td>
</tr>
<tr>
<td></td>
<td>[ACT_HI_IDENTITYLINK]</td>
<td>历史的流程运行过程中用户关系</td>
</tr>
<tr>
<td></td>
<td>[ACT_HI_PROCINST]</td>
<td>历史的流程实例</td>
</tr>
<tr>
<td></td>
<td>[ACT_HI_TASKINST]</td>
<td>历史的任务实例</td>
</tr>
<tr>
<td></td>
<td>[ACT_HI_VARINST]</td>
<td>历史的流程运行中的变量信息</td>
</tr>
<tr>
<td>流程定义表</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>[ACT_RE_DEPLOYMENT]</td>
<td>部署单元信息</td>
</tr>
<tr>
<td></td>
<td>[ACT_RE_MODEL]</td>
<td>模型信息</td>
</tr>
<tr>
<td></td>
<td>[ACT_RE_PROCDEF]</td>
<td>已部署的流程定义</td>
</tr>
<tr>
<td>运行实例表</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>[ACT_RU_EVENT_SUBSCR]</td>
<td>运行时事件</td>
</tr>
<tr>
<td></td>
<td>[ACT_RU_EXECUTION]</td>
<td>运行时流程执行实例</td>
</tr>
<tr>
<td></td>
<td>[ACT_RU_IDENTITYLINK]</td>
<td>运行时用户关系信息，存储任务节点与参与者的相关信息</td>
</tr>
<tr>
<td></td>
<td>[ACT_RU_JOB]</td>
<td>运行时作业</td>
</tr>
<tr>
<td></td>
<td>[ACT_RU_TASK]</td>
<td>运行时任务</td>
</tr>
<tr>
<td></td>
<td>[ACT_RU_VARIABLE]</td>
<td>运行时变量表</td>
</tr>
<tr>
<td>用户用户组表</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>[ACT_ID_BYTEARRAY]</td>
<td>二进制数据表</td>
</tr>
<tr>
<td></td>
<td>[ACT_ID_GROUP]</td>
<td>用户组信息表</td>
</tr>
<tr>
<td></td>
<td>[ACT_ID_INFO]</td>
<td>用户信息详情表</td>
</tr>
<tr>
<td></td>
<td>[ACT_ID_MEMBERSHIP]</td>
<td>人与组关系表</td>
</tr>
<tr>
<td></td>
<td>[ACT_ID_PRIV]</td>
<td>权限表</td>
</tr>
<tr>
<td></td>
<td>[ACT_ID_PRIV_MAPPING]</td>
<td>用户或组权限关系表</td>
</tr>
<tr>
<td></td>
<td>[ACT_ID_PROPERTY]</td>
<td>属性表</td>
</tr>
<tr>
<td></td>
<td>[ACT_ID_TOKEN]</td>
<td>记录用户的token信息</td>
</tr>
<tr>
<td></td>
<td>[ACT_ID_USER]</td>
<td>用户表</td>
</tr>
</tbody></table>
<h2 id="2-ProcessEngine讲解"><a href="#2-ProcessEngine讲解" class="headerlink" title="2.ProcessEngine讲解"></a>2.ProcessEngine讲解</h2><h3 id="2-1-硬编码的方式"><a href="#2-1-硬编码的方式" class="headerlink" title="2.1 硬编码的方式"></a>2.1 硬编码的方式</h3><ul>
<li>我们前面讲解案例的时候是通过ProcessEngineConfiguration这个配置类来加载的。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取ProcessEngineConfiguration对象</span></span><br><span class="line"><span class="type">ProcessEngineConfiguration</span> <span class="variable">configuration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StandaloneProcessEngineConfiguration</span>();</span><br><span class="line"><span class="comment">//配置相关的数据库的连接信息</span></span><br><span class="line">configuration.setJdbcDriver(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">configuration.setJdbcUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">configuration.setJdbcPassword(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">configuration.setJdbcUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/flowable-learn?serverTimezone=UTC&amp;nullCatalogMeansCurrent=true&quot;</span>);</span><br><span class="line"><span class="comment">//如果数据库中的表不存在就新建</span></span><br><span class="line">configuration.setDatabaseSchemaUpdate(ProcessEngineConfiguration.DB_SCHEMA_UPDATE_TRUE);</span><br><span class="line"><span class="comment">// 获取流程引擎对象</span></span><br><span class="line"><span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> configuration.buildProcessEngine();</span><br></pre></td></tr></table></figure>

<h3 id="2-2-配置文件"><a href="#2-2-配置文件" class="headerlink" title="2.2 配置文件"></a>2.2 配置文件</h3><p>&amp;emsp;&amp;emsp;除了上面的硬编码的方式外，我们还可以在resources目录下创建一个<code>flowable.cfg.xml</code>文件，注意这个名称是固定的哦。内容如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;processEngineConfiguration&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">&quot;org.flowable.engine.impl.cfg.StandaloneProcessEngineConfiguration&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUrl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/flow1?allowMultiQueries=true<span class="symbol">&amp;amp;</span>useUnicode=true<span class="symbol">&amp;amp;</span>characterEncoding=UTF-8<span class="symbol">&amp;amp;</span>useSSL=false<span class="symbol">&amp;amp;</span>serverTimezone=UTC<span class="symbol">&amp;amp;</span>nullCatalogMeansCurrent=true&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcDriver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUsername&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcPassword&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123456&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;databaseSchemaUpdate&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;asyncExecutorActivate&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>在上面的配置文件中配置相关的信息。我们在Java代码中就可以简化为：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test03</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">// 获取流程引擎对象</span></span><br><span class="line">        <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">        System.out.println(<span class="string">&quot;processEngine = &quot;</span> + processEngine);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>可以看下getDefaultProcessEngine的源码，在里面最终还是执行了和硬编码一样的代码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ProcessEngine <span class="title function_">getProcessEngine</span><span class="params">(String processEngineName)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!isInitialized()) &#123;</span><br><span class="line">        init();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (ProcessEngine)processEngines.get(processEngineName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>进入init方法</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!isInitialized()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (processEngines == <span class="literal">null</span>) &#123;</span><br><span class="line">            processEngines = <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> ReflectUtil.getClassLoader();</span><br><span class="line">        <span class="type">Enumeration</span> <span class="variable">resources</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            resources = classLoader.getResources(<span class="string">&quot;flowable.cfg.xml&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException var6) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">FlowableIllegalArgumentException</span>(<span class="string">&quot;problem retrieving flowable.cfg.xml resources on the classpath: &quot;</span> + System.getProperty(<span class="string">&quot;java.class.path&quot;</span>), var6);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">HashSet</span> <span class="variable">configUrls</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashSet</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(resources.hasMoreElements()) &#123;</span><br><span class="line">            configUrls.add(resources.nextElement());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">Iterator</span> <span class="variable">iterator</span> <span class="operator">=</span> configUrls.iterator();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(iterator.hasNext()) &#123;</span><br><span class="line">            <span class="type">URL</span> <span class="variable">resource</span> <span class="operator">=</span> (URL)iterator.next();</span><br><span class="line">            LOGGER.info(<span class="string">&quot;Initializing process engine using configuration &#x27;&#123;&#125;&#x27;&quot;</span>, resource.toString());</span><br><span class="line">            initProcessEngineFromResource(resource);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            resources = classLoader.getResources(<span class="string">&quot;flowable-context.xml&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException var5) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">FlowableIllegalArgumentException</span>(<span class="string">&quot;problem retrieving flowable-context.xml resources on the classpath: &quot;</span> + System.getProperty(<span class="string">&quot;java.class.path&quot;</span>), var5);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(resources.hasMoreElements()) &#123;</span><br><span class="line">            <span class="type">URL</span> <span class="variable">resource</span> <span class="operator">=</span> (URL)resources.nextElement();</span><br><span class="line">            LOGGER.info(<span class="string">&quot;Initializing process engine using Spring configuration &#x27;&#123;&#125;&#x27;&quot;</span>, resource.toString());</span><br><span class="line">            initProcessEngineFromSpringResource(resource);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        setInitialized(<span class="literal">true</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        LOGGER.info(<span class="string">&quot;Process engines already initialized&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>在源码中提供了单独使用好整合Spring的配置加载方式。再进入到initProcessEngineFromResource(resource)方法中：</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306290908282.png"
                      alt="image-20230629090804982"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306290908624.png"
                      alt="image-20230629090833418"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306290909393.png"
                      alt="image-20230629090913187"
                ></p>
<ul>
<li>而且我们也可以看到ProcessEngine最终的实现是 ProcessEngineImpl对象。</li>
</ul>
<h3 id="2-3-自定义配置文件"><a href="#2-3-自定义配置文件" class="headerlink" title="2.3 自定义配置文件"></a>2.3 自定义配置文件</h3><ul>
<li>最后我们如果要加载自定义名称的配置文件可以通过ProcessEngineConfiguration中的对应构造方法来实现</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test03</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">ProcessEngineConfiguration</span> <span class="variable">configuration</span> <span class="operator">=</span> ProcessEngineConfiguration.createProcessEngineConfigurationFromResource(<span class="string">&quot;flowable.cfg.xml&quot;</span>);</span><br><span class="line">        <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> configuration.buildProcessEngine();</span><br><span class="line">        System.out.println(<span class="string">&quot;processEngine = &quot;</span> + processEngine);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-Servcie服务接口"><a href="#3-Servcie服务接口" class="headerlink" title="3. Servcie服务接口"></a>3. Servcie服务接口</h2><ul>
<li>Service是工作流引擎提供用于进行工作流部署、执行、管理的服务接口，我们使用这些接口可以就是操作服务对应的数据表</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306290918372.png"
                      alt="image-20230629091813205"
                ></p>
<h3 id="3-1-Service创建方式"><a href="#3-1-Service创建方式" class="headerlink" title="3.1 Service创建方式"></a>3.1 Service创建方式</h3><ul>
<li>通过ProcessEngine创建Service方式如下：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RuntimeService</span> <span class="variable">runtimeService</span> <span class="operator">=</span> processEngine.getRuntimeService();</span><br><span class="line"><span class="type">RepositoryService</span> <span class="variable">repositoryService</span> <span class="operator">=</span> processEngine.getRepositoryService();</span><br><span class="line"><span class="type">TaskService</span> <span class="variable">taskService</span> <span class="operator">=</span> processEngine.getTaskService();</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-Service总览"><a href="#3-2-Service总览" class="headerlink" title="3.2 Service总览"></a>3.2 Service总览</h3><table>
<thead>
<tr>
<th align="center">service名称</th>
<th align="center">service作用</th>
</tr>
</thead>
<tbody><tr>
<td align="center">RepositoryService</td>
<td align="center">Flowable的资源管理类</td>
</tr>
<tr>
<td align="center">RuntimeService</td>
<td align="center">Flowable的流程运行管理类</td>
</tr>
<tr>
<td align="center">TaskService</td>
<td align="center">Flowable的任务管理类</td>
</tr>
<tr>
<td align="center">HistoryService</td>
<td align="center">Flowable的历史管理类</td>
</tr>
<tr>
<td align="center">ManagerService</td>
<td align="center">Flowable的引擎管理类</td>
</tr>
</tbody></table>
<ul>
<li><p><strong>RepositoryService</strong></p>
<ul>
<li>是activiti的资源管理类，提供了管理和控制流程发布包和流程定义的操作。使用工作流建模工具设计的业务流程图需要使用此service将流程定义文件的内容部署到计算机。</li>
<li>除了部署流程定义以外还可以：查询引擎中的发布包和流程定义。</li>
<li>暂停或激活发布包，对应全部和特定流程定义。 暂停意味着它们不能再执行任何操作了，激活是对应的反向操作。获得多种资源，像是包含在发布包里的文件， 或引擎自动生成的流程图。</li>
<li>获得流程定义的pojo版本， 可以用来通过java解析流程，而不必通过xml。</li>
</ul>
</li>
<li><p><strong>RuntimeService</strong></p>
<ul>
<li>Activiti的流程运行管理类。可以从这个服务类中获取很多关于流程执行相关的信息</li>
</ul>
</li>
<li><p><strong>TaskService</strong></p>
<ul>
<li>Activiti的任务管理类。可以从这个类中获取任务的信息。</li>
</ul>
</li>
<li><p><strong>HistoryService</strong></p>
<ul>
<li>Flowable的历史管理类，可以查询历史信息，执行流程时，引擎会保存很多数据（根据配置），比如流程实例启动时间，任务的参与者， 完成任务的时间，每个流程实例的执行路径，等等。 这个服务主要通过查询功能来获得这些数据。</li>
</ul>
</li>
<li><p><strong>ManagementService</strong></p>
<ul>
<li>Activiti的引擎管理类，提供了对Flowable流程引擎的管理和维护功能，这些功能不在工作流驱动的应用程序中使用，主要用于 Flowable 系统的日常维护。</li>
</ul>
</li>
</ul>
<h2 id="4-图标介绍"><a href="#4-图标介绍" class="headerlink" title="4.图标介绍"></a>4.图标介绍</h2><p>&amp;emsp;&amp;emsp;BPMN 2.0是业务流程建模符号2.0的缩写。它由Business Process Management Initiative这个非营利协会创建并不断发展。作为一种标识，BPMN 2.0是使用一些<strong>符号</strong>来明确业务流程设计流程图的一整套符号规范，它能增进业务建模时的沟通效率。目前BPMN2.0是最新的版本，它用于在BPM上下文中进行布局和可视化的沟通。接下来我们先来了解在流程设计中常见的 符号。</p>
<p>BPMN2.0的<strong>基本符合</strong>主要包含：</p>
<h3 id="4-1-事件图标"><a href="#4-1-事件图标" class="headerlink" title="4.1 事件图标"></a>4.1 事件图标</h3><p>&amp;emsp;&amp;emsp;在Flowable中的事件图标启动事件，边界事件,中间事件和结束事件.</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306290925220.png"
                      alt="image-20230629092516056"
                ></p>
<h3 id="4-2-活动-任务-图标"><a href="#4-2-活动-任务-图标" class="headerlink" title="4.2 活动(任务)图标"></a>4.2 活动(任务)图标</h3><ul>
<li>活动是工作或任务的一个通用术语。一个活动可以是一个任务，还可以是一个当前流程的子处理流程； 其次，你还可以为活动指定不同的类型。常见活动如下:</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306290925333.png"
                      alt="image-20230629092538186"
                ></p>
<h3 id="4-3-结构图标"><a href="#4-3-结构图标" class="headerlink" title="4.3 结构图标"></a>4.3 结构图标</h3><ul>
<li>结构图标可以看做是整个流程活动的结构，一个流程中可以包括子流程。常见的结构有：</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306290929644.png"
                      alt="image-20230629092912504"
                ></p>
<h3 id="4-4-网关图标"><a href="#4-4-网关图标" class="headerlink" title="4.4 网关图标"></a>4.4 网关图标</h3><ul>
<li>网关用来处理决策，有几种常用网关需要了解：</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306290929483.png"
                      alt="image-20230629092940331"
                ></p>
<h2 id="5-流程部署详解"><a href="#5-流程部署详解" class="headerlink" title="5.流程部署详解"></a>5.流程部署详解</h2><h3 id="5-1-部署实现"><a href="#5-1-部署实现" class="headerlink" title="5.1 部署实现"></a>5.1 部署实现</h3><ul>
<li>我们先来看下流程部署的具体过程。代码实现</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 部署流程</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test3</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">        <span class="type">RepositoryService</span> <span class="variable">repositoryService</span> <span class="operator">=</span> processEngine.getRepositoryService();</span><br><span class="line">        <span class="type">Deployment</span> <span class="variable">deploy</span> <span class="operator">=</span> repositoryService.createDeployment()</span><br><span class="line">                .addClasspathResource(<span class="string">&quot;holiday-request-new.bpmn20.xml&quot;</span>)</span><br><span class="line">                .name(<span class="string">&quot;请假流程...&quot;</span>)</span><br><span class="line">                .category(<span class="string">&quot;请假&quot;</span>) <span class="comment">// 分类</span></span><br><span class="line">                .tenantId(<span class="string">&quot;dpb&quot;</span>) <span class="comment">// 租户id</span></span><br><span class="line">                .deploy();</span><br><span class="line">        System.out.println(<span class="string">&quot;deploy.getId() = &quot;</span> + deploy.getId());</span><br><span class="line">        System.out.println(<span class="string">&quot;deploy.getName() = &quot;</span> + deploy.getName());</span><br><span class="line">        System.out.println(<span class="string">&quot;deploy.getCategory() = &quot;</span> + deploy.getCategory());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-部署涉及表结构"><a href="#5-2-部署涉及表结构" class="headerlink" title="5.2 部署涉及表结构"></a>5.2 部署涉及表结构</h3><ul>
<li>涉及到的三张表：</li>
</ul>
<p>部署资源表：act_ge_bytearray</p>
<table>
<thead>
<tr>
<th align="center">字段</th>
<th align="center">名称</th>
<th align="center">备注</th>
</tr>
</thead>
<tbody><tr>
<td align="center">ID_</td>
<td align="center">主键</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">REV_</td>
<td align="center">版本号</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">NAME_</td>
<td align="center">名称</td>
<td align="center">部署的文件名称，如：holiday-request-new.bpmn20.xml、holiday-request-new.bpmn20.png</td>
</tr>
<tr>
<td align="center">DEPLOYMENT_ID_</td>
<td align="center">部署ID</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">BYTES_</td>
<td align="center">字节（二进制数据）</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">GENERATED_</td>
<td align="center">是否系统生成</td>
<td align="center">0为用户上传，<br/>1为系统自动生成， 比如系统会自动根据xml生 成png</td>
</tr>
</tbody></table>
<p>部署ID表：act_re_deployment</p>
<table>
<thead>
<tr>
<th align="center">字段</th>
<th align="center">名称</th>
<th align="center">备注</th>
</tr>
</thead>
<tbody><tr>
<td align="center">ID_</td>
<td align="center">主键</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">NAME_</td>
<td align="center">名称</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">CATEGORY_</td>
<td align="center">分类</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">TENANT_ID_</td>
<td align="center">租户ID</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">DEPLOY_TIME_</td>
<td align="center">部署时间</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">DERIVED_FROM_</td>
<td align="center">来源于</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">DERIVED_FROM_ROOT_</td>
<td align="center">来源于</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">ENGINE_VERSION_</td>
<td align="center">流程引擎的版本</td>
<td align="center"></td>
</tr>
</tbody></table>
<p>流程表：act_re_procdef</p>
<table>
<thead>
<tr>
<th align="center">字段</th>
<th align="center">名称</th>
<th align="center">备注</th>
</tr>
</thead>
<tbody><tr>
<td align="center">ID_</td>
<td align="center">主键</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">REV_</td>
<td align="center">版本号</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">CATEGORY_</td>
<td align="center">分类</td>
<td align="center">流程定义的Namespace就是类别</td>
</tr>
<tr>
<td align="center">NAME_</td>
<td align="center">名称</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">KEY_</td>
<td align="center">标识</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">VERSION_</td>
<td align="center">版本</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">DEPLOYMENT_ID_</td>
<td align="center">部署ID</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">RESOURCE_NAME_</td>
<td align="center">资源名称</td>
<td align="center">流程bpmn文件名称</td>
</tr>
<tr>
<td align="center">DGRM_RESOURCE_NAME_</td>
<td align="center">图片资源名称</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">DESCRIPTION_</td>
<td align="center">描述</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">HAS_START_FORM_KEY_</td>
<td align="center">拥有开始表单标识</td>
<td align="center">start节点是否存在formKey  0否 1是</td>
</tr>
<tr>
<td align="center">HAS_GRAPHICAL_NOTATION_</td>
<td align="center">拥有图形信息</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">SUSPENSION_STATE_</td>
<td align="center">挂起状态</td>
<td align="center">暂停状态 1激活 2暂停</td>
</tr>
<tr>
<td align="center">TENANT_ID_</td>
<td align="center">租户ID</td>
<td align="center"></td>
</tr>
</tbody></table>
<ul>
<li>注意：<ul>
<li><strong>业务流程定义数据表。此表和ACT_RE_DEPLOYMENT是多对一的关系</strong>，即，一个部署的bar包里可能包含多个流程定义文件，每个流程定义文件都会有一条记录在ACT_RE_PROCDEF表内，每个流程定义的数据，都会对于ACT_GE_BYTEARRAY表内的一个资源文件和PNG图片文件。和ACT_GE_BYTEARRAY的关联是通过程序用ACT_GE_BYTEARRAY.NAME与ACT_RE_PROCDEF.NAME_完成的</li>
</ul>
</li>
</ul>
<h3 id="5-3-挂起和激活"><a href="#5-3-挂起和激活" class="headerlink" title="5.3 挂起和激活"></a>5.3 挂起和激活</h3><ul>
<li>部署的流程默认的状态为激活，如果我们暂时不想使用该定义的流程，那么可以挂起该流程。当然该流程定义下边所有的流程实例全部暂停。</li>
<li>流程定义为挂起状态，该流程定义将不允许启动新的流程实例，同时该流程定义下的所有的流程实例都将全部挂起暂停执行。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test02</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">// 获取流程引擎对象</span></span><br><span class="line">    <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="type">RepositoryService</span> <span class="variable">repositoryService</span> <span class="operator">=</span> processEngine.getRepositoryService();</span><br><span class="line">    <span class="type">ProcessDefinition</span> <span class="variable">processDefinition</span> <span class="operator">=</span> repositoryService.createProcessDefinitionQuery()</span><br><span class="line">            .processDefinitionId(<span class="string">&quot;LeaveApplication:1:4&quot;</span>)</span><br><span class="line">            .singleResult();</span><br><span class="line">    <span class="comment">//获取流程定义的状态</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">suspended</span> <span class="operator">=</span> processDefinition.isSuspended();</span><br><span class="line">    System.out.println(<span class="string">&quot;suspended = &quot;</span> + suspended);</span><br><span class="line">    <span class="keyword">if</span> (suspended)&#123;</span><br><span class="line">        <span class="comment">//表示被挂起</span></span><br><span class="line">        System.out.println(<span class="string">&quot;激活流程定义&quot;</span>);</span><br><span class="line">        repositoryService.activateProcessDefinitionById(<span class="string">&quot;LeaveApplication:1:4&quot;</span>,<span class="literal">true</span>,<span class="literal">null</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//表示激活状态</span></span><br><span class="line">        System.out.println(<span class="string">&quot;挂起流程&quot;</span>);</span><br><span class="line">        repositoryService.suspendProcessDefinitionById(<span class="string">&quot;LeaveApplication:1:4&quot;</span>,<span class="literal">true</span>,<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>具体的实现其实就是更新了流程定义表中的字段</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306291013712.png"
                      alt="image-20230629101309533"
                ></p>
<ul>
<li>而且通过REV_字段来控制数据安全，也是一种乐观锁的体现了，如果要启动一个已经挂起的流程就会出现如下的错误</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306291015778.png"
                      alt="image-20230629101527633"
                ></p>
<h2 id="6-启动流程实例"><a href="#6-启动流程实例" class="headerlink" title="6.启动流程实例"></a>6.启动流程实例</h2><ul>
<li>然后我们来看看启动流程实例的过程。实现代码如下：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 启动流程实例</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testRunProcess</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="comment">//我们需要通过RuntimeService来启动流程实例</span></span><br><span class="line">    <span class="type">RuntimeService</span> <span class="variable">runtimeService</span> <span class="operator">=</span> processEngine.getRuntimeService();</span><br><span class="line">    <span class="comment">// 构建流程变量</span></span><br><span class="line">    Map&lt;String,Object&gt; variables = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    variables.put(<span class="string">&quot;employee&quot;</span>,<span class="string">&quot;张三&quot;</span>) ;<span class="comment">// 谁申请请假</span></span><br><span class="line">    variables.put(<span class="string">&quot;nrOfHolidays&quot;</span>,<span class="number">3</span>); <span class="comment">// 请几天假</span></span><br><span class="line">    variables.put(<span class="string">&quot;description&quot;</span>,<span class="string">&quot;工作累了，想出去玩玩&quot;</span>); <span class="comment">// 请假的原因</span></span><br><span class="line">    <span class="comment">//启动流程实例</span></span><br><span class="line">    <span class="type">ProcessInstance</span> <span class="variable">holidayRequest</span> <span class="operator">=</span> runtimeService.startProcessInstanceByKey(<span class="string">&quot;LeaveApplication&quot;</span>,variables);</span><br><span class="line">    System.out.println(<span class="string">&quot;holidayRequest.getProcessDefinitionId() = &quot;</span> + holidayRequest.getProcessDefinitionId());</span><br><span class="line">    System.out.println(<span class="string">&quot;holidayRequest.getActivityId() = &quot;</span> + holidayRequest.getActivityId());</span><br><span class="line">    System.out.println(<span class="string">&quot;holidayRequest.getId() = &quot;</span> + holidayRequest.getId());</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>当我们启动了一个流程实例后，会在ACT_RU_*对应的表结构中操作,运行时实例涉及的表结构共10张：</p>
<ul>
<li>ACT_RU_DEADLETTER_JOB  正在运行的任务表 </li>
<li>ACT_RU_EVENT_SUBSCR 运行时事件 </li>
<li>ACT_RU_EXECUTION 运行时流程执行实例 </li>
<li>ACT_RU_HISTORY_JOB  历史作业表 </li>
<li>ACT_RU_IDENTITYLINK 运行时用户关系信息 </li>
<li>ACT_RU_JOB 运行时作业表 </li>
<li>ACT_RU_SUSPENDED_JOB 暂停作业表 </li>
<li>ACT_RU_TASK  运行时任务表 </li>
<li>ACT_RU_TIMER_JOB 定时作业表 </li>
<li>ACT_RU_VARIABLE  运行时变量表</li>
</ul>
</li>
<li><p>启动一个流程实例的时候涉及到的表有</p>
<ul>
<li>ACT_RU_EXECUTION 运行时流程执行实例 </li>
<li>ACT_RU_IDENTITYLINK 运行时用户关系信息 </li>
<li>ACT_RU_TASK  运行时任务表 </li>
<li>ACT_RU_VARIABLE  运行时变量表</li>
</ul>
</li>
<li><p>ACT_RU_EXECUTION表结构</p>
</li>
</ul>
<table>
<thead>
<tr>
<th align="center">字段</th>
<th align="center">名称</th>
<th align="center">备注</th>
</tr>
</thead>
<tbody><tr>
<td align="center">ID_</td>
<td align="center">主键</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">REV_</td>
<td align="center">版本号</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">PROC_INST_ID_</td>
<td align="center">流程实例ID</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">BUSINESS_KEY_</td>
<td align="center">业务主键ID</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">PARENT_ID_</td>
<td align="center">父执行流的ID</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">PROC_DEF_ID_</td>
<td align="center">流程定义的数据ID</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">SUPER_EXEC_</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">ROOT_PROC_INST_ID_</td>
<td align="center">流程实例的root流程id</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">ACT_ID_</td>
<td align="center">节点实例ID</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">IS_ACTIVE_</td>
<td align="center">是否存活</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">IS_CONCURRENT_</td>
<td align="center">执行流是否正在并行</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">IS_SCOPE_</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">IS_EVENT_SCOPE_</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">IS_MI_ROOT_</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">SUSPENSION_STATE_</td>
<td align="center">流程终端状态</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">CACHED_ENT_STATE_</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">TENANT_ID_</td>
<td align="center">租户编号</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">NAME_</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">START_TIME_</td>
<td align="center">开始时间</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">START_USER_ID_</td>
<td align="center">开始的用户编号</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">LOCK_TIME_</td>
<td align="center">锁定时间</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">IS_COUNT_ENABLED_</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">EVT_SUBSCR_COUNT_</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">TASK_COUNT_</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">JOB_COUNT_</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">TIMER_JOB_COUNT_</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">SUSP_JOB_COUNT_</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">DEADLETTER_JOB_COUNT_</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">VAR_COUNT_</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">ID_LINK_COUNT_</td>
<td align="center"></td>
<td align="center"></td>
</tr>
</tbody></table>
<ul>
<li>创建流程实例后对应的表结构的数据</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306291050818.png"
                      alt="image-20230629105036589"
                ></p>
<ul>
<li>ACT_RU_TASK  运行时任务表</li>
</ul>
<table>
<thead>
<tr>
<th align="center">字段</th>
<th align="center">名称</th>
<th align="center">备注</th>
</tr>
</thead>
<tbody><tr>
<td align="center">ID_</td>
<td align="center">主键</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">REV_</td>
<td align="center">版本号</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">EXECUTION_ID_</td>
<td align="center">任务所在的执行流ID</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">PROC_INST_ID_</td>
<td align="center">流程实例ID</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">PROC_DEF_ID_</td>
<td align="center">流程定义数据ID</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">NAME_</td>
<td align="center">任务名称</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">PARENT_TASK_ID_</td>
<td align="center">父任务ID</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">DESCRIPTION_</td>
<td align="center">说明</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">TASK_DEF_KEY_</td>
<td align="center">任务定义的ID值</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">OWNER_</td>
<td align="center">任务拥有人</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">ASSIGNEE_</td>
<td align="center">被指派执行该任务的人</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">DELEGATION_</td>
<td align="center">委托人</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">PRIORITY_</td>
<td align="center">优先级</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">CREATE_TIME_</td>
<td align="center">创建时间</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">DUE_DATE_</td>
<td align="center">耗时</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">CATEGORY_</td>
<td align="center">类别</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">SUSPENSION_STATE_</td>
<td align="center">是否挂起</td>
<td align="center">1代表激活 2代表挂起</td>
</tr>
<tr>
<td align="center">TENANT_ID_</td>
<td align="center">租户编号</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">FORM_KEY_</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">CLAIM_TIME_</td>
<td align="center">拾取时间</td>
<td align="center"></td>
</tr>
</tbody></table>
<ul>
<li>创建流程实例后对应的表结构的数据</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306291052854.png"
                      alt="image-20230629105219688"
                ></p>
<ul>
<li>ACT_RU_VARIABLE  运行时变量表</li>
</ul>
<table>
<thead>
<tr>
<th align="center">字段</th>
<th>名称</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td align="center">ID_</td>
<td>主键</td>
<td></td>
</tr>
<tr>
<td align="center">REV_</td>
<td>版本号</td>
<td></td>
</tr>
<tr>
<td align="center">TYPE_</td>
<td>参数类型</td>
<td>可以是基本的类型，也可以用户自行扩展</td>
</tr>
<tr>
<td align="center">NAME_</td>
<td>参数名称</td>
<td></td>
</tr>
<tr>
<td align="center">EXECUTION_ID_</td>
<td>参数执行ID</td>
<td></td>
</tr>
<tr>
<td align="center">PROC_INST_ID_</td>
<td>流程实例ID</td>
<td></td>
</tr>
<tr>
<td align="center">TASK_ID_</td>
<td>任务ID</td>
<td></td>
</tr>
<tr>
<td align="center">BYTEARRAY_ID_</td>
<td>资源ID</td>
<td></td>
</tr>
<tr>
<td align="center">DOUBLE_</td>
<td>参数为double，则保存在该字段中</td>
<td></td>
</tr>
<tr>
<td align="center">LONG_</td>
<td>参数为long，则保存在该字段中</td>
<td></td>
</tr>
<tr>
<td align="center">TEXT_</td>
<td>用户保存文本类型的参数值</td>
<td></td>
</tr>
<tr>
<td align="center">TEXT2_</td>
<td>用户保存文本类型的参数值</td>
<td></td>
</tr>
</tbody></table>
<ul>
<li>创建流程实例后对应的表结构的数据</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306291053859.png"
                      alt="image-20230629105349700"
                ></p>
<ul>
<li>ACT_RU_IDENTITYLINK 运行时用户关系信息</li>
</ul>
<table>
<thead>
<tr>
<th align="center">字段</th>
<th align="center">名称</th>
<th align="center">备注</th>
</tr>
</thead>
<tbody><tr>
<td align="center">ID_</td>
<td align="center">主键</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">REV_</td>
<td align="center">版本号</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">GROUP_ID_</td>
<td align="center">用户组ID</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">TYPE_</td>
<td align="center">关系数据类型</td>
<td align="center">assignee支配人(组)、candidate候选人(组)、owner拥有人,participant参与者</td>
</tr>
<tr>
<td align="center">USER_ID_</td>
<td align="center">用户ID</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">TASK_ID_</td>
<td align="center">任务ID</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">PROC_INST_ID_</td>
<td align="center">流程定义ID</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">PROC_DEF_ID_</td>
<td align="center">属性ID</td>
<td align="center"></td>
</tr>
</tbody></table>
<ul>
<li>创建流程实例后对应的表结构的数据:</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306291054524.png"
                      alt="image-20230629105444395"
                ></p>
<h2 id="7-处理流程"><a href="#7-处理流程" class="headerlink" title="7.处理流程"></a>7.处理流程</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 完成当前任务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCompleteTask</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">// 获取流程引擎对象</span></span><br><span class="line">    <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="type">TaskService</span> <span class="variable">taskService</span> <span class="operator">=</span> processEngine.getTaskService();</span><br><span class="line">    <span class="type">Task</span> <span class="variable">task</span> <span class="operator">=</span> taskService.createTaskQuery()</span><br><span class="line">            .processDefinitionId(<span class="string">&quot;LeaveApplication:1:4&quot;</span>)</span><br><span class="line">            .taskAssignee(<span class="string">&quot;zhangsan&quot;</span>)</span><br><span class="line">            .singleResult();</span><br><span class="line">    <span class="comment">// 添加流程变量</span></span><br><span class="line">    Map&lt;String,Object&gt; variables = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    variables.put(<span class="string">&quot;approved&quot;</span>,<span class="literal">false</span>); <span class="comment">// 拒绝请假</span></span><br><span class="line">    <span class="comment">// 完成任务</span></span><br><span class="line">    taskService.complete(task.getId(),variables);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>在正常处理流程中涉及到的表结构</p>
<ul>
<li>ACT_RU_EXECUTION 运行时流程执行实例 </li>
<li>ACT_RU_IDENTITYLINK 运行时用户关系信息 </li>
<li>ACT_RU_TASK  运行时任务表 </li>
<li>ACT_RU_VARIABLE  运行时变量表</li>
</ul>
</li>
<li><p>ACT_RU_TASK  运行时任务表 :会新生成一条记录</p>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306291120405.png"
                      alt="image-20230629112029179"
                ></p>
<ul>
<li>ACT_RU_VARIABLE  运行时变量表:会记录新的流程变量</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306291122994.png"
                      alt="image-20230629112209834"
                ></p>
<ul>
<li>当然流程实例也可以挂起</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.获取ProcessEngine对象</span></span><br><span class="line"><span class="type">ProcessEngine</span> <span class="variable">engine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line"><span class="comment">// 2.获取RuntimeService</span></span><br><span class="line"><span class="type">RuntimeService</span> <span class="variable">runtimeService</span> <span class="operator">=</span> engine.getRuntimeService();</span><br><span class="line"><span class="comment">// 3.获取流程实例对象</span></span><br><span class="line"><span class="type">ProcessInstance</span> <span class="variable">processInstance</span> <span class="operator">=</span> runtimeService.createProcessInstanceQuery()</span><br><span class="line">    .processInstanceId(<span class="string">&quot;25001&quot;</span>)</span><br><span class="line">    .singleResult();</span><br><span class="line"><span class="comment">// 4.获取相关的状态操作</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">suspended</span> <span class="operator">=</span> processInstance.isSuspended();</span><br><span class="line"><span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> processInstance.getId();</span><br><span class="line"><span class="keyword">if</span>(suspended)&#123;</span><br><span class="line">    <span class="comment">// 挂起--》激活</span></span><br><span class="line">    runtimeService.activateProcessInstanceById(id);</span><br><span class="line">    System.out.println(<span class="string">&quot;流程定义：&quot;</span> + id + <span class="string">&quot;，已激活&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">// 激活--》挂起</span></span><br><span class="line">    runtimeService.suspendProcessInstanceById(id);</span><br><span class="line">    System.out.println(<span class="string">&quot;流程定义：&quot;</span> + id + <span class="string">&quot;，已挂起&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>启动第二个流程实例后再查看相关的表结构时，对他们的关系理解会更加的清楚一些</li>
<li>启动一个新的流程实例对应的就会产生两条记录</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306291123403.png"
                      alt="image-20220322135605252"
                ></p>
<ul>
<li>IDENTITYLINK中会记录每次流程操作的信息</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306291123774.png"
                      alt="image-20220322135636841"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306291124867.png"
                      alt="image-20220322135659671"
                ></p>
<ul>
<li>流程变量数据，即使key 相同，但是属于不同的流程实例相互间也是隔离的</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306291123964.png"
                      alt="image-20220322135719104"
                ></p>
<h2 id="8-完成一个流程"><a href="#8-完成一个流程" class="headerlink" title="8.完成一个流程"></a>8.完成一个流程</h2><ul>
<li>然后我们把第一个流程处理完成</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 完成当前任务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCompleteTask</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">// 获取流程引擎对象</span></span><br><span class="line">    <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="type">TaskService</span> <span class="variable">taskService</span> <span class="operator">=</span> processEngine.getTaskService();</span><br><span class="line">    <span class="type">Task</span> <span class="variable">task</span> <span class="operator">=</span> taskService.createTaskQuery()</span><br><span class="line">            .processDefinitionId(<span class="string">&quot;LeaveApplication:1:4&quot;</span>)</span><br><span class="line">            .taskAssignee(<span class="string">&quot;lisi&quot;</span>)</span><br><span class="line">            .singleResult();</span><br><span class="line">    <span class="comment">// 添加流程变量</span></span><br><span class="line">    Map&lt;String,Object&gt; variables = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    variables.put(<span class="string">&quot;approved&quot;</span>,<span class="literal">false</span>); <span class="comment">// 拒绝请假</span></span><br><span class="line">    <span class="comment">// 完成任务</span></span><br><span class="line">    taskService.complete(task.getId(),variables);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>处理完了一个工作流程后，我们来看看相关的表结构信息</p>
</li>
<li><p>首先我们会发现</p>
<ul>
<li>ACT_RU_EXECUTION 运行时流程执行实例 </li>
<li>ACT_RU_IDENTITYLINK 运行时用户关系信息 </li>
<li>ACT_RU_TASK  运行时任务表 </li>
<li>ACT_RU_VARIABLE  运行时变量表</li>
</ul>
</li>
<li><p>这四张表中对应的数据都没有了，也就是这个流程已经不是运行中的流程了。然后在对应的历史表中我们可以看到相关的信息</p>
<ul>
<li>ACT_HI_ACTINST  历史的流程实例</li>
<li>ACT_HI_ATTACHMENT 历史的流程附件</li>
<li>ACT_HI_COMMENT  历史的说明性信息</li>
<li>ACT_HI_DETAIL 历史的流程运行中的细节信息</li>
<li>ACT_HI_IDENTITYLINK 历史的流程运行过程中用户关系</li>
<li>ACT_HI_PROCINST  历史的流程实例</li>
<li>ACT_HI_TASKINST  历史的任务实例</li>
<li>ACT_HI_VARINST  历史的流程运行中的变量信息</li>
</ul>
</li>
<li><p>在我们上面的处理流程的过程中设计到的历史表有</p>
</li>
</ul>
<p>ACT_HI_ACTINST  历史的流程实例</p>
<table>
<thead>
<tr>
<th align="center">字段</th>
<th align="center">名称</th>
<th align="center">备注</th>
</tr>
</thead>
<tbody><tr>
<td align="center">ID_</td>
<td align="center">主键</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">PROC_DEF_ID_</td>
<td align="center">流程定义ID</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">PROC_INST_ID_</td>
<td align="center">流程实例ID</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">EXECUTION_ID_</td>
<td align="center">执行ID</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">ACT_ID_</td>
<td align="center">节点实例ID</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">TASK_ID_</td>
<td align="center">任务ID</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">CALL_PROC_INST_ID_</td>
<td align="center">调用外部的流程实例ID</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">ACT_NAME_</td>
<td align="center">节点名称</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">ACT_TYPE_</td>
<td align="center">节点类型</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">ASSIGNEE_</td>
<td align="center">处理人</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">START_TIME_</td>
<td align="center">开始时间</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">END_TIME_</td>
<td align="center">结束时间</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">DURATION_</td>
<td align="center">耗时</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">DELETE_REASON_</td>
<td align="center">删除原因</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">TENANT_ID_</td>
<td align="center">租户编号</td>
<td align="center"></td>
</tr>
</tbody></table>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306291210358.png"
                      alt="image-20230629121047217"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306291210852.png"
                      alt="image-20230629121053720"
                ></p>
<p>ACT_HI_IDENTITYLINK 历史的流程运行过程中用户关系</p>
<table>
<thead>
<tr>
<th align="center">字段</th>
<th align="center">名称</th>
<th align="center">备注</th>
</tr>
</thead>
<tbody><tr>
<td align="center">ID_</td>
<td align="center">主键</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">GROUP_ID_</td>
<td align="center">组编号</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">TYPE_</td>
<td align="center">类型</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">USER_ID_</td>
<td align="center">用户编号</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">TASK_ID_</td>
<td align="center">任务编号</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">CREATE_TIME_</td>
<td align="center">创建时间</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">PROC_INST_ID_</td>
<td align="center">流程实例编号</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">SCOPE_ID_</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">SCOPE_TYPE_</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">SCOPE_DEFINITION_ID_</td>
<td align="center"></td>
<td align="center"></td>
</tr>
</tbody></table>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306291211417.png"
                      alt="image-20220322141717826"
                ></p>
<p>ACT_HI_PROCINST  历史的流程实例</p>
<table>
<thead>
<tr>
<th align="center">字段</th>
<th align="center">名称</th>
<th align="center">备注</th>
</tr>
</thead>
<tbody><tr>
<td align="center">ID_</td>
<td align="center">主键</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">PROC_INST_ID_</td>
<td align="center">流程实例ID</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">BUSINESS_KEY_</td>
<td align="center">业务主键</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">PROC_DEF_ID_</td>
<td align="center">属性ID</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">START_TIME_</td>
<td align="center">开始时间</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">END_TIME_</td>
<td align="center">结束时间</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">DURATION_</td>
<td align="center">耗时</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">START_USER_ID_</td>
<td align="center">起始人</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">START_ACT_ID_</td>
<td align="center">起始节点</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">END_ACT_ID_</td>
<td align="center">结束节点</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">SUPER_PROCESS_INSTANCE_ID_</td>
<td align="center">父流程实例ID</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">DELETE_REASON_</td>
<td align="center">删除原因</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">TENANT_ID_</td>
<td align="center">租户编号</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">NAME_</td>
<td align="center">名称</td>
<td align="center"></td>
</tr>
</tbody></table>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306291211525.png"
                      alt="image-20220322141855401"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306291211588.png"
                      alt="image-20220322141912602"
                ></p>
<p>ACT_HI_TASKINST  历史的任务实例</p>
<table>
<thead>
<tr>
<th align="center">字段</th>
<th align="center">名称</th>
<th align="center">备注</th>
</tr>
</thead>
<tbody><tr>
<td align="center">ID_</td>
<td align="center">主键</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">PROC_DEF_ID_</td>
<td align="center">流程定义ID</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">TASK_DEF_KEY_</td>
<td align="center">任务定义的ID值</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">PROC_INST_ID_</td>
<td align="center">流程实例ID</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">EXECUTION_ID_</td>
<td align="center">执行ID</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">PARENT_TASK_ID_</td>
<td align="center">父任务ID</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">NAME_</td>
<td align="center">名称</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">DESCRIPTION_</td>
<td align="center">说明</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">OWNER_</td>
<td align="center">实际签收人 任务的拥有者</td>
<td align="center">签收人（默认为空，只有在委托时才有值）</td>
</tr>
<tr>
<td align="center">ASSIGNEE_</td>
<td align="center">被指派执行该任务的人</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">START_TIME_</td>
<td align="center">开始时间</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">CLAIM_TIME_</td>
<td align="center">任务拾取时间</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">END_TIME_</td>
<td align="center">结束时间</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">DURATION_</td>
<td align="center">耗时</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">DELETE_REASON_</td>
<td align="center">删除原因</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">PRIORITY_</td>
<td align="center">优先级别</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">DUE_DATE_</td>
<td align="center">过期时间</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">FORM_KEY_</td>
<td align="center">节点定义的formkey</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">CATEGORY_</td>
<td align="center">类别</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">TENANT_ID_</td>
<td align="center">租户</td>
<td align="center"></td>
</tr>
</tbody></table>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306291211527.png"
                      alt="image-20220322142609163"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306291212036.png"
                      alt="image-20220322142650699"
                ></p>
<p>ACT_HI_VARINST  历史的流程运行中的变量信息：流程变量虽然在任务完成后在流程实例表中会删除，但是在历史表中还是会记录的</p>
<table>
<thead>
<tr>
<th align="center">字段</th>
<th align="center">名称</th>
<th align="center">备注</th>
</tr>
</thead>
<tbody><tr>
<td align="center">ID_</td>
<td align="center">主键</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">PROC_INST_ID_</td>
<td align="center">流程实例ID</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">EXECUTION_ID_</td>
<td align="center">指定ID</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">TASK_ID_</td>
<td align="center">任务ID</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">NAME_</td>
<td align="center">名称</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">VAR_TYPE_</td>
<td align="center">参数类型</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">REV_</td>
<td align="center">数据版本</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">BYTEARRAY_ID_</td>
<td align="center">字节表ID</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">DOUBLE_</td>
<td align="center">存储double类型数据</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">LONG_</td>
<td align="center">存储long类型数据</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">…..</td>
<td align="center"></td>
<td align="center"></td>
</tr>
</tbody></table>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306291212388.png"
                      alt="image-20220322142756867"
                ></p>
<h1 id="五、任务分配和流程变量"><a href="#五、任务分配和流程变量" class="headerlink" title="五、任务分配和流程变量"></a>五、任务分配和流程变量</h1><h2 id="1-任务分配"><a href="#1-任务分配" class="headerlink" title="1.任务分配"></a>1.任务分配</h2><h3 id="1-1-固定分配"><a href="#1-1-固定分配" class="headerlink" title="1.1 固定分配"></a>1.1 固定分配</h3><ul>
<li>固定分配就是我们前面介绍的，在绘制流程图或者直接在流程文件中通过Assignee来指定的方式</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306291333252.png"
                      alt="image-20230629133329052"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306291334865.png"
                      alt="image-20230629133441716"
                ></p>
<h3 id="1-2-表达式分配"><a href="#1-2-表达式分配" class="headerlink" title="1.2 表达式分配"></a>1.2 表达式分配</h3><ul>
<li>Flowable使用UEL进行表达式解析。UEL代表<em>Unified Expression Language</em>，是EE6规范的一部分.Flowable支持两种UEL表达式： UEL-value 和UEL-method</li>
</ul>
<h4 id="1-2-1-值表达式"><a href="#1-2-1-值表达式" class="headerlink" title="1.2.1 值表达式"></a>1.2.1 值表达式</h4><ul>
<li><strong>值表达式 Value expression</strong>: 解析为一个值。默认情况下，所有流程变量都可以使用。（若使用Spring）所有的Spring bean也可以用在表达式里。例如</li>
</ul>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$&#123;myVar&#125;</span><br><span class="line">$&#123;myBean.myProperty&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>案例讲解：</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306291338599.png"
                      alt="image-20230629133851471"
                ></p>
<ul>
<li>可以看到通过表达式处理的效果</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306291339661.png"
                      alt="image-20230629133936522"
                ></p>
<ul>
<li>先部署流程，然后在启动流程实例的时候绑定表达式对应的值</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 启动流程实例</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testRunProcess</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">ProcessEngine</span> <span class="variable">defaultProcessEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="type">RuntimeService</span> <span class="variable">runtimeService</span> <span class="operator">=</span> defaultProcessEngine.getRuntimeService();</span><br><span class="line">    HashMap&lt;String, Object&gt; variables = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    variables.put(<span class="string">&quot;assignee1&quot;</span>,<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">    variables.put(<span class="string">&quot;assignee2&quot;</span>,<span class="string">&quot;李四&quot;</span>);</span><br><span class="line">    <span class="type">ProcessInstance</span> <span class="variable">processInstance</span> <span class="operator">=</span> runtimeService.startProcessInstanceById(<span class="string">&quot;holiday:1:10004&quot;</span>,variables);</span><br><span class="line">    System.out.println(<span class="string">&quot;流程定义的ID：&quot;</span> + processInstance.getProcessDefinitionId());</span><br><span class="line">    System.out.println(<span class="string">&quot;流程实例的ID：&quot;</span> + processInstance.getId());</span><br><span class="line">    System.out.println(<span class="string">&quot;当前活动的ID：&quot;</span> + processInstance.getActivityId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>在流程变量表中我们可以看到对应的流程变量信息</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306291432563.png"
                      alt="image-20230629143246300"
                ></p>
<ul>
<li>同时在Task表中，可以看到流程当前的分配人是<code>张三</code>，说明UEL表达式被解析了</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306291440464.png"
                      alt="image-20230629144029334"
                ></p>
<h4 id="1-2-2-方法表达式"><a href="#1-2-2-方法表达式" class="headerlink" title="1.2.2 方法表达式"></a>1.2.2 方法表达式</h4><ul>
<li><strong>方法表达式 Method expression</strong>: 调用一个方法，可以带或不带参数。<strong>当调用不带参数的方法时，要确保在方法名后添加空括号（以避免与值表达式混淆）。</strong>传递的参数可以是字面值(literal value)，也可以是表达式，它们会被自动解析。例如：</li>
</ul>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$&#123;printer.print()&#125;</span><br><span class="line">$&#123;myBean.addNewOrder(&#x27;orderName&#x27;)&#125;</span><br><span class="line">$&#123;myBean.doSomething(myVar, execution)&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>myBean是Spring容器中的个Bean对象，表示调用的是bean的addNewOrder方法</li>
</ul>
<h3 id="1-3-监听器分配"><a href="#1-3-监听器分配" class="headerlink" title="1.3 监听器分配"></a>1.3 监听器分配</h3><ul>
<li>可以使用监听器来完成很多Flowable的流程业务。</li>
<li>我们在此处使用监听器来完成负责人的指定，那么我们在流程设计的时候就不需要指定assignee</li>
<li>创建自定义监听器：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.flowable.listener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.flowable.engine.delegate.TaskListener;</span><br><span class="line"><span class="keyword">import</span> org.flowable.task.service.delegate.DelegateTask;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyTaskListener</span> <span class="keyword">implements</span> <span class="title class_">TaskListener</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">notify</span><span class="params">(DelegateTask delegateTask)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;监听器触发了：&quot;</span> + delegateTask.getName());</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;提交请假流程&quot;</span>.equals(delegateTask.getName())&amp;&amp;</span><br><span class="line">            <span class="string">&quot;create&quot;</span>.equals(delegateTask.getEventName()))&#123;</span><br><span class="line">            delegateTask.setAssignee(<span class="string">&quot;小明&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            delegateTask.setAssignee(<span class="string">&quot;小张&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>然后在FlowableUI中关联对应的监听器</li>
</ul>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create:任务创建后触发</span><br><span class="line">assignment:任务分配后触发</span><br><span class="line">Delete:任务完成后触发</span><br><span class="line">All：所有事件都触发</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306291458620.png"
                      alt="image-20230629145835453"
                ></p>
<ul>
<li>然后我们先部署流程，然后执行查看效果：</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306291506545.png"
                      alt="image-20230629150622375"
                ></p>
<ul>
<li>然后在Task表中我们可以看到对应的分配人为<code>小明</code>说明通过监听也完成了任务分配的工作了</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306291508005.png"
                      alt="image-20230629150836870"
                ></p>
<h2 id="2-流程变量"><a href="#2-流程变量" class="headerlink" title="2.流程变量"></a>2.流程变量</h2><ul>
<li>流程实例按步骤执行时，需要使用一些数据。在Flowable中，这些数据称作*变量(variable)*，并会存储在数据库中。变量可以用在表达式中（例如在排他网关中用于选择正确的出口路径），也可以在Java服务任务(service task)中用于调用外部服务（例如为服务调用提供输入或结果存储），等等。</li>
<li>流程实例可以持有变量（称作<em>流程变量 process variables</em>）；用户任务以及<em>执行(executions)<em>——流程当前活动节点的指针——也可以持有变量。流程实例可以持有任意数量的变量，每个变量存储为</em>ACT_RU_VARIABLE</em>数据库表的一行。</li>
<li>所有的<em>startProcessInstanceXXX</em>方法都有一个可选参数，用于在流程实例创建及启动时设置变量。例如，在<em>RuntimeService</em>中：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ProcessInstance <span class="title function_">startProcessInstanceByKey</span><span class="params">(String processDefinitionKey, Map&lt;String, Object&gt; variables)</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>也可以在流程执行中加入变量。例如，(<em>RuntimeService</em>):</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">setVariable</span><span class="params">(String executionId, String variableName, Object value)</span>;</span><br><span class="line"><span class="keyword">void</span> <span class="title function_">setVariableLocal</span><span class="params">(String executionId, String variableName, Object value)</span>;</span><br><span class="line"><span class="keyword">void</span> <span class="title function_">setVariables</span><span class="params">(String executionId, Map&lt;String, ? extends Object&gt; variables)</span>;</span><br><span class="line"><span class="keyword">void</span> <span class="title function_">setVariablesLocal</span><span class="params">(String executionId, Map&lt;String, ? extends Object&gt; variables)</span>;</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306291549022.png"
                      alt="image-20230629154903867"
                ></p>
<h3 id="2-1-全局变量"><a href="#2-1-全局变量" class="headerlink" title="2.1 全局变量"></a>2.1 全局变量</h3><ul>
<li>流程变量的默认作用域是流程实例。当一个流程变量的作用域为流程实例时，可以称为 global 变量</li>
<li>注意：如：    Global变量：userId（变量名）、zhangsan（变量值）</li>
<li>global 变量中变量名不允许重复，设置相同名称的变量，后设置的值会覆盖前设置的变量值。</li>
</ul>
<h3 id="2-2-局部变量"><a href="#2-2-局部变量" class="headerlink" title="2.2 局部变量"></a>2.2 局部变量</h3><ul>
<li>任务和执行实例仅仅是针对一个任务和一个执行实例范围，范围没有流程实例大， 称为 local 变量。</li>
<li>Local 变量由于在不同的任务或不同的执行实例中，作用域互不影响，变量名可以相同没有影响。Local 变量名也可以和 global 变量名相同，没有影响。</li>
</ul>
<h3 id="2-3-案例讲解"><a href="#2-3-案例讲解" class="headerlink" title="2.3 案例讲解"></a>2.3 案例讲解</h3><ul>
<li>需求：员工创建出差申请单，由部门经理审核，部门经理申请通过后3天以下由财务直接申批，3天以上先由总经理审批，总经理审批通过后再由财务审批。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306291600483.png"
                      alt="image-20230629160006329"
                ></p>
<ul>
<li>连接先设置条件</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306291602458.png"
                      alt="image-20230629160254328"
                ></p>
<ul>
<li>部署流程</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deploy</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="type">RepositoryService</span> <span class="variable">repositoryService</span> <span class="operator">=</span> processEngine.getRepositoryService();</span><br><span class="line">    <span class="type">Deployment</span> <span class="variable">deploy</span> <span class="operator">=</span> repositoryService.createDeployment()</span><br><span class="line">            .addClasspathResource(<span class="string">&quot;qingjia.bpmn20.xml&quot;</span>)</span><br><span class="line">            .name(<span class="string">&quot;请假流程...&quot;</span>)</span><br><span class="line">            .category(<span class="string">&quot;请假&quot;</span>) <span class="comment">// 分类</span></span><br><span class="line">            .tenantId(<span class="string">&quot;dpb&quot;</span>) <span class="comment">// 租户id</span></span><br><span class="line">            .deploy();</span><br><span class="line">    System.out.println(<span class="string">&quot;deploy.getId() = &quot;</span> + deploy.getId());</span><br><span class="line">    System.out.println(<span class="string">&quot;deploy.getName() = &quot;</span> + deploy.getName());</span><br><span class="line">    System.out.println(<span class="string">&quot;deploy.getCategory() = &quot;</span> + deploy.getCategory());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>启动流程实例：并且指定全局流程变量</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 在启动流程实例的时候设置流程变量</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">runProcess</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">// 获取流程引擎对象</span></span><br><span class="line">    <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="comment">// 启动流程实例通过 RuntimeService 对象</span></span><br><span class="line">    <span class="type">RuntimeService</span> <span class="variable">runtimeService</span> <span class="operator">=</span> processEngine.getRuntimeService();</span><br><span class="line">    <span class="comment">// 设置流程变量</span></span><br><span class="line">    Map&lt;String,Object&gt; variables = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">// 设置assignee的取值</span></span><br><span class="line">    variables.put(<span class="string">&quot;assigntee0&quot;</span>,<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">    variables.put(<span class="string">&quot;assigntee1&quot;</span>,<span class="string">&quot;李四&quot;</span>);</span><br><span class="line">    variables.put(<span class="string">&quot;assigntee2&quot;</span>,<span class="string">&quot;王五&quot;</span>);</span><br><span class="line">    variables.put(<span class="string">&quot;assigntee3&quot;</span>,<span class="string">&quot;赵财务&quot;</span>);</span><br><span class="line">    <span class="comment">// 启动流程实例，第一个参数是流程定义的id</span></span><br><span class="line">    <span class="type">ProcessInstance</span> <span class="variable">processInstance</span> <span class="operator">=</span> runtimeService</span><br><span class="line">            .startProcessInstanceById(<span class="string">&quot;qingjia:1:25004&quot;</span>,variables);<span class="comment">// 启动流程实例</span></span><br><span class="line">    <span class="comment">// 输出相关的流程实例信息</span></span><br><span class="line">    System.out.println(<span class="string">&quot;流程定义的ID：&quot;</span> + processInstance.getProcessDefinitionId());</span><br><span class="line">    System.out.println(<span class="string">&quot;流程实例的ID：&quot;</span> + processInstance.getId());</span><br><span class="line">    System.out.println(<span class="string">&quot;当前活动的ID：&quot;</span> + processInstance.getActivityId());</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>完成Task任务，同时也可以指定流程变量</li>
</ul>
<p>&#x2F;**<br>     * 完成任务时指定流程变量<br>          *&#x2F;<br>        @Test<br>        public void completeTask(){</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">// 获取流程引擎对象</span></span><br><span class="line">    <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="type">TaskService</span> <span class="variable">taskService</span> <span class="operator">=</span> processEngine.getTaskService();</span><br><span class="line">    <span class="type">Task</span> <span class="variable">task</span> <span class="operator">=</span> taskService.createTaskQuery()</span><br><span class="line">            .processDefinitionId(<span class="string">&quot;evection:1:4&quot;</span>)</span><br><span class="line">            .taskAssignee(<span class="string">&quot;李四&quot;</span>)</span><br><span class="line">            .singleResult();</span><br><span class="line">    <span class="comment">// 添加流程变量</span></span><br><span class="line">    Map&lt;String, Object&gt; map = task.getProcessVariables();</span><br><span class="line">    map.put(<span class="string">&quot;num&quot;</span>,<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 完成任务</span></span><br><span class="line">    taskService.complete(task.getId(),map);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>当然我们也可以在处理流程之外通过Task编号来修改流程变量</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过当前任务设置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">currentTask</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//   当前待办任务id</span></span><br><span class="line">    <span class="comment">//  获取processEngine</span></span><br><span class="line">    <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="type">TaskService</span> <span class="variable">taskService</span> <span class="operator">=</span> processEngine.getTaskService();</span><br><span class="line">    <span class="type">Task</span> <span class="variable">task</span> <span class="operator">=</span> taskService.createTaskQuery()</span><br><span class="line">            .processDefinitionId(<span class="string">&quot;qingjia:1:25004&quot;</span>)</span><br><span class="line">            .taskAssignee(<span class="string">&quot;王五&quot;</span>)</span><br><span class="line">            .singleResult();</span><br><span class="line">    <span class="comment">// 添加流程变量</span></span><br><span class="line">    Map&lt;String, Object&gt; map = task.getProcessVariables();</span><br><span class="line">    map.put(<span class="string">&quot;num&quot;</span>,<span class="number">1</span>);</span><br><span class="line">    <span class="comment">//  一次设置多个值 设置局部变量</span></span><br><span class="line">    taskService.setVariables(task.getId(), map);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="六、候选人和候选人组"><a href="#六、候选人和候选人组" class="headerlink" title="六、候选人和候选人组"></a>六、候选人和候选人组</h1><ul>
<li>在流程定义中在任务结点的 assignee 固定设置任务负责人，在流程定义时将参与者固定设置在.bpmn 文件中，如果临时任务负责人变更则需要修改流程定义，系统可扩展性差。针对这种情况可以给任务设置多个候选人或者候选人组，可以从候选人中选择参与者来完成任务。</li>
</ul>
<h2 id="1-候选人"><a href="#1-候选人" class="headerlink" title="1.候选人"></a>1.候选人</h2><h3 id="1-1-定义流程图"><a href="#1-1-定义流程图" class="headerlink" title="1.1 定义流程图"></a>1.1 定义流程图</h3><ul>
<li>定义流程图，同时指定候选人，多个候选人会通过<code>,</code>连接</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306291727798.png"
                      alt="image-20230629172751630"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306291733599.png"
                      alt="image-20230629173350458"
                ></p>
<h3 id="1-2-部署和启动流程实例"><a href="#1-2-部署和启动流程实例" class="headerlink" title="1.2 部署和启动流程实例"></a>1.2 部署和启动流程实例</h3><ul>
<li>部署流程，并且在启动流程实例的时候对UEL表达式赋值</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 部署流程</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deploy</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="type">RepositoryService</span> <span class="variable">repositoryService</span> <span class="operator">=</span> processEngine.getRepositoryService();</span><br><span class="line"></span><br><span class="line">    <span class="type">Deployment</span> <span class="variable">deploy</span> <span class="operator">=</span> repositoryService.createDeployment()</span><br><span class="line">            .addClasspathResource(<span class="string">&quot;请假流程-候选人.bpmn20.xml&quot;</span>)</span><br><span class="line">            .name(<span class="string">&quot;请求流程-候选人&quot;</span>)</span><br><span class="line">            .deploy();</span><br><span class="line">    System.out.println(<span class="string">&quot;deploy.getId() = &quot;</span> + deploy.getId());</span><br><span class="line">    System.out.println(deploy.getName());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 启动流程实例</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">runProcess</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="type">RuntimeService</span> <span class="variable">runtimeService</span> <span class="operator">=</span> processEngine.getRuntimeService();</span><br><span class="line">    <span class="comment">// 给流程定义中的UEL表达式赋值</span></span><br><span class="line">    Map&lt;String,Object&gt; variables = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    variables.put(<span class="string">&quot;candidate1&quot;</span>,<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">    variables.put(<span class="string">&quot;candidate2&quot;</span>,<span class="string">&quot;李四&quot;</span>);</span><br><span class="line">    variables.put(<span class="string">&quot;candidate3&quot;</span>,<span class="string">&quot;王五&quot;</span>);</span><br><span class="line">    runtimeService.startProcessInstanceById(<span class="string">&quot;qingjia-candidate:1:40004&quot;</span>,variables);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>在对应的表结构中我们可以看到流程变量已经有了，但是对于的Task的Assignee还是为空。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306291741121.png"
                      alt="image-20230629174150956"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306291742705.png"
                      alt="image-20230629174201575"
                ></p>
<h3 id="1-3-任务的查询"><a href="#1-3-任务的查询" class="headerlink" title="1.3 任务的查询"></a>1.3 任务的查询</h3><ul>
<li>根据当前登录的用户，查询对应的候选任务</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据登录的用户查询对应的可以拾取的任务</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">queryTaskCandidate</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="type">TaskService</span> <span class="variable">taskService</span> <span class="operator">=</span> processEngine.getTaskService();</span><br><span class="line">    List&lt;Task&gt; list = taskService.createTaskQuery()</span><br><span class="line">            <span class="comment">//.processInstanceId(&quot;2501&quot;)</span></span><br><span class="line">            .processDefinitionId(<span class="string">&quot;qingjia-candidate:1:40004&quot;</span>)</span><br><span class="line">            .taskCandidateUser(<span class="string">&quot;李四&quot;</span>)</span><br><span class="line">            .list();</span><br><span class="line">    <span class="keyword">for</span> (Task task : list) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;task.getId() = &quot;</span> + task.getId());</span><br><span class="line">        System.out.println(<span class="string">&quot;task.getName() = &quot;</span> + task.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-4-任务的拾取"><a href="#1-4-任务的拾取" class="headerlink" title="1.4 任务的拾取"></a>1.4 任务的拾取</h3><ul>
<li>知道了我有可拾取的任务后，拾取任务。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 拾取任务</span></span><br><span class="line"><span class="comment"> *    一个候选人拾取了这个任务之后其他的用户就没有办法拾取这个任务了</span></span><br><span class="line"><span class="comment"> *    所以如果一个用户拾取了任务之后又不想处理了，那么可以退还</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">claimTaskCandidate</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="type">TaskService</span> <span class="variable">taskService</span> <span class="operator">=</span> processEngine.getTaskService();</span><br><span class="line">    <span class="type">Task</span> <span class="variable">task</span> <span class="operator">=</span> taskService.createTaskQuery()</span><br><span class="line">            <span class="comment">//.processInstanceId(&quot;2501&quot;)</span></span><br><span class="line">            .processDefinitionId(<span class="string">&quot;qingjia-candidate:1:40004&quot;</span>)</span><br><span class="line">            .taskCandidateUser(<span class="string">&quot;李四&quot;</span>)</span><br><span class="line">            .singleResult();</span><br><span class="line">    <span class="keyword">if</span>(task != <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="comment">// 拾取对应的任务</span></span><br><span class="line">        taskService.claim(task.getId(),<span class="string">&quot;李四&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;任务拾取成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306291745169.png"
                      alt="image-20230629174520985"
                ></p>
<h3 id="1-5-任务的归还"><a href="#1-5-任务的归还" class="headerlink" title="1.5 任务的归还"></a>1.5 任务的归还</h3><ul>
<li>拾取任务后不想操作那么就归还任务</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 退还任务</span></span><br><span class="line"><span class="comment"> *    一个候选人拾取了这个任务之后其他的用户就没有办法拾取这个任务了</span></span><br><span class="line"><span class="comment"> *    所以如果一个用户拾取了任务之后又不想处理了，那么可以退还</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">unclaimTaskCandidate</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="type">TaskService</span> <span class="variable">taskService</span> <span class="operator">=</span> processEngine.getTaskService();</span><br><span class="line">    <span class="type">Task</span> <span class="variable">task</span> <span class="operator">=</span> taskService.createTaskQuery()</span><br><span class="line">            <span class="comment">//.processInstanceId(&quot;2501&quot;)</span></span><br><span class="line">            .processDefinitionId(<span class="string">&quot;qingjia-candidate:1:40004&quot;</span>)</span><br><span class="line">            .taskAssignee(<span class="string">&quot;张三&quot;</span>)</span><br><span class="line">            .singleResult();</span><br><span class="line">    <span class="keyword">if</span>(task != <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="comment">// 拾取对应的任务</span></span><br><span class="line">        taskService.unclaim(task.getId());</span><br><span class="line">        System.out.println(<span class="string">&quot;归还拾取成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-6-任务的交接"><a href="#1-6-任务的交接" class="headerlink" title="1.6 任务的交接"></a>1.6 任务的交接</h3><ul>
<li>拾取任务后如果不想操作也不想归还可以直接交接给另外一个人来处理</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 任务的交接</span></span><br><span class="line"><span class="comment"> *    如果我获取了任务，但是不想执行，那么我可以把这个任务交接给其他的用户</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">taskCandidate</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="type">TaskService</span> <span class="variable">taskService</span> <span class="operator">=</span> processEngine.getTaskService();</span><br><span class="line">    <span class="type">Task</span> <span class="variable">task</span> <span class="operator">=</span> taskService.createTaskQuery()</span><br><span class="line">            <span class="comment">//.processInstanceId(&quot;2501&quot;)</span></span><br><span class="line">            .processDefinitionId(<span class="string">&quot;qingjia-candidate:1:40004&quot;</span>)</span><br><span class="line">            .taskAssignee(<span class="string">&quot;李四&quot;</span>)</span><br><span class="line">            .singleResult();</span><br><span class="line">    <span class="keyword">if</span>(task != <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="comment">// 任务的交接</span></span><br><span class="line">        taskService.setAssignee(task.getId(),<span class="string">&quot;王五&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;任务交接给了王五&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-7-任务的完成"><a href="#1-7-任务的完成" class="headerlink" title="1.7 任务的完成"></a>1.7 任务的完成</h3><ul>
<li>正常的任务处理</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 完成任务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">completeTask</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="type">TaskService</span> <span class="variable">taskService</span> <span class="operator">=</span> processEngine.getTaskService();</span><br><span class="line">    <span class="type">Task</span> <span class="variable">task</span> <span class="operator">=</span> taskService.createTaskQuery()</span><br><span class="line">            <span class="comment">//.processInstanceId(&quot;2501&quot;)</span></span><br><span class="line">            .processDefinitionId(<span class="string">&quot;qingjia-candidate:1:40004&quot;</span>)</span><br><span class="line">            .taskAssignee(<span class="string">&quot;王五&quot;</span>)</span><br><span class="line">            .singleResult();</span><br><span class="line">    <span class="keyword">if</span>(task != <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="comment">// 完成任务</span></span><br><span class="line">        taskService.complete(task.getId());</span><br><span class="line">        System.out.println(<span class="string">&quot;完成Task&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-候选人组"><a href="#2-候选人组" class="headerlink" title="2.候选人组"></a>2.候选人组</h2><ul>
<li>当候选人很多的情况下，我们可以分组来处理。先创建组，然后把用户分配到这个组中。</li>
</ul>
<h3 id="2-1-管理用户和组"><a href="#2-1-管理用户和组" class="headerlink" title="2.1 管理用户和组"></a>2.1 管理用户和组</h3><h4 id="2-1-1-用户管理"><a href="#2-1-1-用户管理" class="headerlink" title="2.1.1 用户管理"></a>2.1.1 用户管理</h4><ul>
<li>我们需要先单独维护用户信息。后台对应的表结构是<code>ACT_ID_USER</code>.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 维护用户</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createUser</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="comment">// 通过 IdentityService 完成相关的用户和组的管理</span></span><br><span class="line">    <span class="type">IdentityService</span> <span class="variable">identityService</span> <span class="operator">=</span> processEngine.getIdentityService();</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> identityService.newUser(<span class="string">&quot;田佳&quot;</span>);</span><br><span class="line">    user.setFirstName(<span class="string">&quot;田&quot;</span>);</span><br><span class="line">    user.setLastName(<span class="string">&quot;jia&quot;</span>);</span><br><span class="line">    user.setEmail(<span class="string">&quot;tianjia@qq.com&quot;</span>);</span><br><span class="line">    identityService.saveUser(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306291748515.png"
                      alt="image-20230629174856360"
                ></p>
<h3 id="2-1-2-Group管理"><a href="#2-1-2-Group管理" class="headerlink" title="2.1.2 Group管理"></a>2.1.2 Group管理</h3><ul>
<li>维护对应的Group信息，后台对应的表结构是<code>ACT_ID_GROUP</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 创建用户组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createGroup</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="type">IdentityService</span> <span class="variable">identityService</span> <span class="operator">=</span> processEngine.getIdentityService();</span><br><span class="line">    <span class="comment">// 创建Group对象并指定相关的信息</span></span><br><span class="line">    <span class="type">Group</span> <span class="variable">group</span> <span class="operator">=</span> identityService.newGroup(<span class="string">&quot;group2&quot;</span>);</span><br><span class="line">    group.setName(<span class="string">&quot;开发部&quot;</span>);</span><br><span class="line">    group.setType(<span class="string">&quot;type1&quot;</span>);</span><br><span class="line">    <span class="comment">// 创建Group对应的表结构数据</span></span><br><span class="line">    identityService.saveGroup(group);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306291749828.png"
                      alt="image-20230629174953694"
                ></p>
<h3 id="2-1-3-用户分配组"><a href="#2-1-3-用户分配组" class="headerlink" title="2.1.3 用户分配组"></a>2.1.3 用户分配组</h3><ul>
<li>用户和组是一个多对多的关联关联，我们需要做相关的分配，后台对应的表结构是<code>ACT_ID_MEMBERSHIP</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将用户分配给对应的Group</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">userGroup</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="type">IdentityService</span> <span class="variable">identityService</span> <span class="operator">=</span> processEngine.getIdentityService();</span><br><span class="line">    <span class="comment">// 根据组的编号找到对应的Group对象</span></span><br><span class="line">    <span class="type">Group</span> <span class="variable">group</span> <span class="operator">=</span> identityService.createGroupQuery().groupId(<span class="string">&quot;group1&quot;</span>).singleResult();</span><br><span class="line">    List&lt;User&gt; list = identityService.createUserQuery().list();</span><br><span class="line">    <span class="keyword">for</span> (User user : list) &#123;</span><br><span class="line">        <span class="comment">// 将用户分配给对应的组</span></span><br><span class="line">        identityService.createMembership(user.getId(),group.getId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306291751688.png"
                      alt="image-20230629175110535"
                ></p>
<h3 id="2-2-候选人组应用"><a href="#2-2-候选人组应用" class="headerlink" title="2.2 候选人组应用"></a>2.2 候选人组应用</h3><ul>
<li>2.2.1 创建流程图</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306291751802.png"
                      alt="image-20230629175152608"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306291752382.png"
                      alt="image-20230629175202234"
                ></p>
<h4 id="2-2-2-流程的部署运行"><a href="#2-2-2-流程的部署运行" class="headerlink" title="2.2.2 流程的部署运行"></a>2.2.2 流程的部署运行</h4><ul>
<li>然后我们把流程部署和运行，注意对UEL表达式赋值，关联上Group</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 部署流程</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deploy</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">        <span class="type">RepositoryService</span> <span class="variable">repositoryService</span> <span class="operator">=</span> processEngine.getRepositoryService();</span><br><span class="line"></span><br><span class="line">        <span class="type">Deployment</span> <span class="variable">deploy</span> <span class="operator">=</span> repositoryService.createDeployment()</span><br><span class="line">                .addClasspathResource(<span class="string">&quot;请假流程-候选人组.bpmn20.xml&quot;</span>)</span><br><span class="line">                .name(<span class="string">&quot;请求流程-候选人&quot;</span>)</span><br><span class="line">                .deploy();</span><br><span class="line">        System.out.println(<span class="string">&quot;deploy.getId() = &quot;</span> + deploy.getId());</span><br><span class="line">        System.out.println(deploy.getName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 启动流程实例</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">runProcess</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">        <span class="type">IdentityService</span> <span class="variable">identityService</span> <span class="operator">=</span> processEngine.getIdentityService();</span><br><span class="line">        <span class="type">Group</span> <span class="variable">group</span> <span class="operator">=</span> identityService.createGroupQuery().groupId(<span class="string">&quot;group1&quot;</span>).singleResult();</span><br><span class="line">        <span class="type">RuntimeService</span> <span class="variable">runtimeService</span> <span class="operator">=</span> processEngine.getRuntimeService();</span><br><span class="line">        <span class="comment">// 给流程定义中的UEL表达式赋值</span></span><br><span class="line">        Map&lt;String,Object&gt; variables = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// variables.put(&quot;g1&quot;,&quot;group1&quot;);</span></span><br><span class="line">        variables.put(<span class="string">&quot;g1&quot;</span>,group.getId()); <span class="comment">// 给流程定义中的UEL表达式赋值</span></span><br><span class="line">        runtimeService.startProcessInstanceById(<span class="string">&quot;qingjia-candidate:1:40004&quot;</span>,variables);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>对应表结构中就有对应的体现</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306291753687.png"
                      alt="image-20230629175327490"
                ></p>
<h4 id="2-2-3-任务的拾取和完成"><a href="#2-2-3-任务的拾取和完成" class="headerlink" title="2.2.3 任务的拾取和完成"></a>2.2.3 任务的拾取和完成</h4><ul>
<li>然后完成任务的查询拾取和处理操作</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据登录的用户查询对应的可以拾取的任务</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">queryTaskCandidateGroup</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="comment">// 根据当前登录的用户找到对应的组</span></span><br><span class="line">    <span class="type">IdentityService</span> <span class="variable">identityService</span> <span class="operator">=</span> processEngine.getIdentityService();</span><br><span class="line">    <span class="comment">// 当前用户所在的组</span></span><br><span class="line">    <span class="type">Group</span> <span class="variable">group</span> <span class="operator">=</span> identityService.createGroupQuery().groupMember(<span class="string">&quot;邓彪&quot;</span>).singleResult();</span><br><span class="line"></span><br><span class="line">    <span class="type">TaskService</span> <span class="variable">taskService</span> <span class="operator">=</span> processEngine.getTaskService();</span><br><span class="line">    List&lt;Task&gt; list = taskService.createTaskQuery()</span><br><span class="line">            <span class="comment">//.processInstanceId(&quot;2501&quot;)</span></span><br><span class="line">            .processDefinitionId(<span class="string">&quot;qingjia-candidate:1:40004&quot;</span>)</span><br><span class="line">            .taskCandidateGroup(group.getId())</span><br><span class="line">            .list();</span><br><span class="line">    <span class="keyword">for</span> (Task task : list) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;task.getId() = &quot;</span> + task.getId());</span><br><span class="line">        System.out.println(<span class="string">&quot;task.getName() = &quot;</span> + task.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 拾取任务</span></span><br><span class="line"><span class="comment"> *    一个候选人拾取了这个任务之后其他的用户就没有办法拾取这个任务了</span></span><br><span class="line"><span class="comment"> *    所以如果一个用户拾取了任务之后又不想处理了，那么可以退还</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">claimTaskCandidate</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">userId</span> <span class="operator">=</span> <span class="string">&quot;田佳&quot;</span>;</span><br><span class="line">    <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="comment">// 根据当前登录的用户找到对应的组</span></span><br><span class="line">    <span class="type">IdentityService</span> <span class="variable">identityService</span> <span class="operator">=</span> processEngine.getIdentityService();</span><br><span class="line">    <span class="comment">// 当前用户所在的组</span></span><br><span class="line">    <span class="type">Group</span> <span class="variable">group</span> <span class="operator">=</span> identityService.createGroupQuery().groupMember(userId).singleResult();</span><br><span class="line">    <span class="type">TaskService</span> <span class="variable">taskService</span> <span class="operator">=</span> processEngine.getTaskService();</span><br><span class="line">    <span class="type">Task</span> <span class="variable">task</span> <span class="operator">=</span> taskService.createTaskQuery()</span><br><span class="line">            <span class="comment">//.processInstanceId(&quot;2501&quot;)</span></span><br><span class="line">            .processDefinitionId(<span class="string">&quot;qingjia-candidate:1:40004&quot;</span>)</span><br><span class="line">            .taskCandidateGroup(group.getId())</span><br><span class="line">            .singleResult();</span><br><span class="line">    <span class="keyword">if</span>(task != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// 任务拾取</span></span><br><span class="line">        taskService.claim(task.getId(),userId);</span><br><span class="line">        System.out.println(<span class="string">&quot;任务拾取成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 完成任务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">completeTask</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="type">TaskService</span> <span class="variable">taskService</span> <span class="operator">=</span> processEngine.getTaskService();</span><br><span class="line">    <span class="type">Task</span> <span class="variable">task</span> <span class="operator">=</span> taskService.createTaskQuery()</span><br><span class="line">            <span class="comment">//.processInstanceId(&quot;2501&quot;)</span></span><br><span class="line">            .processDefinitionId(<span class="string">&quot;qingjia-candidate:1:40004&quot;</span>)</span><br><span class="line">            .taskAssignee(<span class="string">&quot;邓彪&quot;</span>)</span><br><span class="line">            .singleResult();</span><br><span class="line">    <span class="keyword">if</span>(task != <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="comment">// 完成任务</span></span><br><span class="line">        taskService.complete(task.getId());</span><br><span class="line">        System.out.println(<span class="string">&quot;完成Task&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="七、网关"><a href="#七、网关" class="headerlink" title="七、网关"></a>七、网关</h1><p>网关用来控制流程的流向</p>
<hr>
<h2 id="1-排他网关"><a href="#1-排他网关" class="headerlink" title="1.排他网关"></a>1.排他网关</h2><ul>
<li>排他网关（exclusive gateway）（也叫<em>异或网关 XOR gateway</em>，或者更专业的，<em>基于数据的排他网关 exclusive data-based gateway</em>），用于对流程中的<strong>决策</strong>建模。当执行到达这个网关时，会按照所有出口顺序流定义的顺序对它们进行计算。选择第一个条件计算为true的顺序流（当没有设置条件时，认为顺序流为<em>true</em>）继续流程。</li>
<li>请注意这里出口顺序流的含义与BPMN 2.0中的一般情况不一样。一般情况下，会选择所有条件计算为true的顺序流，并行执行。而使用排他网关时，只会选择一条顺序流。当多条顺序流的条件都计算为true时，会且仅会选择在XML中最先定义的顺序流继续流程。如果没有可选的顺序流，会抛出异常。</li>
<li>排他网关用内部带有’X’图标的标准网关（菱形）表示，’X’图标代表<em>异或</em>的含义。请注意内部没有图标的网关默认为排他网关。BPMN 2.0规范不允许在同一个流程中混合使用有及没有X的菱形标志。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306300946267.png"
                      alt="image-20230630094629053"
                ></p>
<ul>
<li>案例：</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306300946534.png"
                      alt="image-20230630094655401"
                ></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 部署流程</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="meta">@Test</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deploy</span><span class="params">()</span>&#123;</span><br><span class="line">     <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">     <span class="type">RepositoryService</span> <span class="variable">repositoryService</span> <span class="operator">=</span> processEngine.getRepositoryService();</span><br><span class="line"></span><br><span class="line">     <span class="type">Deployment</span> <span class="variable">deploy</span> <span class="operator">=</span> repositoryService.createDeployment()</span><br><span class="line">             .addClasspathResource(<span class="string">&quot;请假流程-排他网关.bpmn20.xml&quot;</span>)</span><br><span class="line">             .name(<span class="string">&quot;请求流程-排他网关&quot;</span>)</span><br><span class="line">             .deploy();</span><br><span class="line">     System.out.println(<span class="string">&quot;deploy.getId() = &quot;</span> + deploy.getId());</span><br><span class="line">     System.out.println(deploy.getName());</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 启动流程实例</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="meta">@Test</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">runProcess</span><span class="params">()</span>&#123;</span><br><span class="line">     <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">     <span class="type">RuntimeService</span> <span class="variable">runtimeService</span> <span class="operator">=</span> processEngine.getRuntimeService();</span><br><span class="line">     <span class="comment">// 给流程定义中的UEL表达式赋值</span></span><br><span class="line">     Map&lt;String,Object&gt; variables = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">     <span class="comment">// variables.put(&quot;g1&quot;,&quot;group1&quot;);</span></span><br><span class="line">     variables.put(<span class="string">&quot;num&quot;</span>,<span class="number">3</span>); <span class="comment">// 给流程定义中的UEL表达式赋值</span></span><br><span class="line">     runtimeService.startProcessInstanceById(<span class="string">&quot;holiday-exclusive:1:4&quot;</span>,variables);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 启动流程实例</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="meta">@Test</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setVariables</span><span class="params">()</span>&#123;</span><br><span class="line">     <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">     <span class="type">RuntimeService</span> <span class="variable">runtimeService</span> <span class="operator">=</span> processEngine.getRuntimeService();</span><br><span class="line">     <span class="comment">// 给流程定义中的UEL表达式赋值</span></span><br><span class="line">     Map&lt;String,Object&gt; variables = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">     <span class="comment">// variables.put(&quot;g1&quot;,&quot;group1&quot;);</span></span><br><span class="line">     variables.put(<span class="string">&quot;num&quot;</span>,<span class="number">4</span>); <span class="comment">// 给流程定义中的UEL表达式赋值</span></span><br><span class="line">     runtimeService.setVariables(<span class="string">&quot;12503&quot;</span>,variables);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 完成任务</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="meta">@Test</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">completeTask</span><span class="params">()</span>&#123;</span><br><span class="line">     <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">     <span class="type">TaskService</span> <span class="variable">taskService</span> <span class="operator">=</span> processEngine.getTaskService();</span><br><span class="line">     <span class="type">Task</span> <span class="variable">task</span> <span class="operator">=</span> taskService.createTaskQuery()</span><br><span class="line">             <span class="comment">//.processInstanceId(&quot;2501&quot;)</span></span><br><span class="line">             .processDefinitionId(<span class="string">&quot;holiday-exclusive:1:4&quot;</span>)</span><br><span class="line">             .taskAssignee(<span class="string">&quot;zhangsan&quot;</span>)</span><br><span class="line">             .singleResult();</span><br><span class="line">     <span class="keyword">if</span>(task != <span class="literal">null</span>)&#123;</span><br><span class="line">         <span class="comment">// 完成任务</span></span><br><span class="line">         taskService.complete(task.getId());</span><br><span class="line">         System.out.println(<span class="string">&quot;完成Task&quot;</span>);</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>如果从网关出去的线所有条件都不满足的情况下会抛出系统异常，</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306300955165.png"
                      alt="image-20230630095507971"
                ></p>
<ul>
<li>但是要注意任务没有介绍，还是原来的任务，我们可以重置流程变量</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setVariables</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="type">RuntimeService</span> <span class="variable">runtimeService</span> <span class="operator">=</span> processEngine.getRuntimeService();</span><br><span class="line">    <span class="comment">// 给流程定义中的UEL表达式赋值</span></span><br><span class="line">    Map&lt;String,Object&gt; variables = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">// variables.put(&quot;g1&quot;,&quot;group1&quot;);</span></span><br><span class="line">    variables.put(<span class="string">&quot;num&quot;</span>,<span class="number">4</span>); <span class="comment">// 给流程定义中的UEL表达式赋值</span></span><br><span class="line">    runtimeService.setVariables(<span class="string">&quot;12503&quot;</span>,variables);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>前面我们可以直接在连接线上定义条件，那为什么还要有排他网关呢？直接在线上的情况，如果条件都不满足，流程就结束了，是异常结束!!</li>
</ul>
<h2 id="2-并行网关"><a href="#2-并行网关" class="headerlink" title="2.并行网关"></a>2.并行网关</h2><ul>
<li><p>并行网关允许将流程分成多条分支，也可以把多条分支汇聚到一起，并行网关的功能是基于进入和外出顺序流的：</p>
<ul>
<li><p>fork分支：并行后的所有外出顺序流，为每个顺序流都创建一个并发分支。</p>
</li>
<li><p>join汇聚： 所有到达并行网关，在此等待的进入分支， 直到所有进入顺序流的分支都到达以后， 流程就会通过汇聚网关。</p>
</li>
</ul>
</li>
<li><p>注意，如果同一个并行网关有多个进入和多个外出顺序流， 它就同时具有分支和汇聚功能。 这时，网关会先汇聚所有进入的顺序流，然后再切分成多个并行分支。</p>
</li>
<li><p><strong>与其他网关的主要区别是，并行网关不会解析条件。</strong> <strong>即使顺序流中定义了条件，也会被忽略。</strong></p>
</li>
<li><p>案例：</p>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306301000437.png"
                      alt="image-20230630100037290"
                ></p>
<ul>
<li>当我们执行了创建请假单后，到并行网关的位置的时候，在ACT_RU_TASK表中就有两条记录</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306301001882.png"
                      alt="image-20230630100128763"
                ></p>
<ul>
<li>然后同时在ACT_RU_EXECUTION中有三条记录，一个任务对应的有两个执行实例</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306301001324.png"
                      alt="image-20230630100147179"
                ></p>
<h2 id="3-包含网关"><a href="#3-包含网关" class="headerlink" title="3.包含网关"></a>3.包含网关</h2><ul>
<li><p>包含网关可以看做是排他网关和并行网关的结合体。 和排他网关一样，你可以在外出顺序流上定义条件，包含网关会解析它们。 但是主要的区别是包含网关可以选择多于一条顺序流，这和并行网关一样。</p>
</li>
<li><p>包含网关的功能是基于进入和外出顺序流的：</p>
<ul>
<li><p>分支： 所有外出顺序流的条件都会被解析，结果为true的顺序流会以并行方式继续执行， 会为每个顺序流创建一个分支。</p>
</li>
<li><p>汇聚：所有并行分支到达包含网关，会进入等待状态， 直到每个包含流程token的进入顺序流的分支都到达。 这是与并行网关的最大不同。换句话说，包含网关只会等待被选中执行了的进入顺序流。 在汇聚之后，流程会穿过包含网关继续执行。</p>
</li>
</ul>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306301003993.png"
                      alt="image-20230630100354853"
                ></p>
<h2 id="4-事件网关"><a href="#4-事件网关" class="headerlink" title="4.事件网关"></a>4.事件网关</h2><ul>
<li>事件网关允许根据事件判断流向。网关的每个外出顺序流都要连接到一个中间捕获事件。 当流程到达一个基于事件网关，网关会进入等待状态：会暂停执行。与此同时，会为每个外出顺序流创建相对的事件订阅。</li>
<li>事件网关的外出顺序流和普通顺序流不同，这些顺序流不会真的”执行”， 相反它们让流程引擎去决定执行到事件网关的流程需要订阅哪些事件。 要考虑以下条件：<ul>
<li>事件网关必须有两条或以上外出顺序流；</li>
<li>事件网关后，只能使用intermediateCatchEvent类型（activiti不支持基于事件网关后连接ReceiveTask）</li>
<li>连接到事件网关的中间捕获事件必须只有一个入口顺序流。</li>
</ul>
</li>
</ul>
<h1 id="八、SpringBoot整合Flowable"><a href="#八、SpringBoot整合Flowable" class="headerlink" title="八、SpringBoot整合Flowable"></a>八、SpringBoot整合Flowable</h1><h2 id="1-添加相关依赖"><a href="#1-添加相关依赖" class="headerlink" title="1.添加相关依赖"></a>1.添加相关依赖</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.flowable<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flowable-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.6.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.14<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.13.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="2-添加对应的配置"><a href="#2-添加对应的配置" class="headerlink" title="2.添加对应的配置"></a>2.添加对应的配置</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">datasource:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">        <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span> </span><br><span class="line">        <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/flowable1?serverTimezone-UTC&amp;nullCatalogMeansCurrent-true</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">        <span class="attr">hikari:</span></span><br><span class="line">            <span class="attr">minimum-idle:</span> <span class="number">5</span></span><br><span class="line">            <span class="attr">idle-timeout:</span> <span class="number">600000</span></span><br><span class="line">            <span class="attr">maximum-pool-size:</span> <span class="number">10</span></span><br><span class="line">            <span class="attr">auto-commit:</span> <span class="literal">true</span></span><br><span class="line">            <span class="attr">pool-name:</span> <span class="string">MyHikariCP</span></span><br><span class="line">            <span class="attr">max-lifetime:</span> <span class="number">1800000</span></span><br><span class="line">            <span class="attr">connection-timeout:</span> <span class="number">30000</span></span><br><span class="line">            <span class="attr">connection-test-query:</span> <span class="string">SELECT</span> <span class="number">1</span></span><br><span class="line"><span class="attr">flowable:</span></span><br><span class="line">	<span class="attr">async-executor-activate:</span> <span class="literal">false</span> <span class="comment">#关闭定时任务JOB</span></span><br><span class="line"><span class="comment">#将databaseSchemaUpdate设置为true。当Flowable发现库与数据库表结构不一致时，会自动将数据库表结构升级至新版本。</span></span><br><span class="line">	<span class="attr">database-schema-update:</span> <span class="literal">true</span> </span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">	<span class="attr">port:</span> <span class="number">8082</span></span><br></pre></td></tr></table></figure>

<ul>
<li>系统启动的时候检查如果数据库对应的表结构没有创建，会帮助我们先创建对应的表结构</li>
</ul>
<h2 id="3-自动部署"><a href="#3-自动部署" class="headerlink" title="3.自动部署"></a>3.自动部署</h2><ul>
<li>processes目录下的任何BPMN 2.0流程定义都会被自动部署。创建processes目录，并在其中创建示例流程定义（命名为one-task-process.bpmn20.xml）。</li>
<li>forms目录下的任何Form定义都会被自动部署。</li>
<li>cases目录下的任何CMMN 1.1事例都会被自动部署。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202306301137632.png"
                      alt="image-20230630113757401"
                ></p>
<h2 id="4-手动部署"><a href="#4-手动部署" class="headerlink" title="4.手动部署"></a>4.手动部署</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ProcessEngine processEngine;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RepositoryService repositoryService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TaskService taskService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RuntimeService runtimeService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testDeploy</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Deployment</span> <span class="variable">deploy</span> <span class="operator">=</span> repositoryService.createDeployment()</span><br><span class="line">                .addClasspathResource(<span class="string">&quot;请假流程.bpmn20.xml&quot;</span>)</span><br><span class="line">                .name(<span class="string">&quot;holiday&quot;</span>)</span><br><span class="line">                .deploy();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-启动流程"><a href="#5-启动流程" class="headerlink" title="5.启动流程"></a>5.启动流程</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">startFlow</span><span class="params">()</span>&#123;</span><br><span class="line">    Map&lt;String,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    map. put(<span class="string">&quot;assignee0&quot;</span> , <span class="string">&quot;zhangsan&quot;</span> );</span><br><span class="line">    map. put (<span class="string">&quot;assignee1&quot;</span>, <span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line">    runtimeService.startProcessInstanceById(<span class="string">&quot;holiday28:2:3653a34e-ae45-11ec-969d-c03c59ad2248&quot;</span>,map);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-处理流程"><a href="#6-处理流程" class="headerlink" title="6.处理流程"></a>6.处理流程</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">completeTask</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">Task</span> <span class="variable">task</span> <span class="operator">=</span> taskService.createTaskQuery()</span><br><span class="line">            .processDefinitionId(<span class="string">&quot;fb166cd8-ae45-11ec-92c4-c03c59ad2248&quot;</span>)</span><br><span class="line">            .taskAssignee(<span class="string">&quot;zhangsan&quot;</span>)</span><br><span class="line">            .singleResult();</span><br><span class="line">    <span class="keyword">if</span> (task != <span class="literal">null</span>)&#123;</span><br><span class="line">        taskService.complete(task.getId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

        </div>

        
            <div class="post-copyright-info">
                <div class="article-copyright-info-container">
    <ul>
        <li>Post title：【工作流】Flowable</li>
        <li>Post author：Fang</li>
        <li>Create time：2023-06-28 09:13:15</li>
        <li>
            Post link：https://ainianxu.github.io/2023/06/28/【工作流】Flowable/
        </li>
        <li>
            Copyright Notice：All articles in this blog are licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> unless stating additionally.
        </li>
    </ul>
</div>

            </div>
        

        
            <ul class="post-tags-box">
                
                    <li class="tag-item">
                        <a href="/tags/%E5%B7%A5%E4%BD%9C%E6%B5%81/">#工作流</a>&nbsp;
                    </li>
                
            </ul>
        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/2023/07/03/Springboot3-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E6%88%9812306%E9%AB%98%E6%80%A7%E8%83%BD%E5%94%AE%E7%A5%A8%E7%B3%BB%E7%BB%9F/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Springboot3+微服务实战12306高性能售票系统</span>
                                <span class="post-nav-item">Prev posts</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/2023/06/27/%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95%E4%B9%8B%E5%85%AB%E8%82%A1%E6%96%87/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">前端面试之八股文</span>
                                <span class="post-nav-item">Next posts</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
            <div class="comment-container">
                <div class="comments-container">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
        <i class="fas fa-comments">&nbsp;Comments</i>
    </div>
    

        
            
    <div class="valine-container">
        <script data-pjax
                src="//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script>
        <div id="vcomments"></div>
        <script data-pjax>
            function loadValine() {
                new Valine({
                    el: '#vcomments',
                    appId: 'loa9BVbgmyFLwBMHhg1Cycx1-gzGzoHsz',
                    appKey: '47pIz6ewIXRi5251WyfUpQOB',
                    meta: ['nick', 'mail', 'link'],
                    avatar: 'wavatar',
                    enableQQ: true,
                    placeholder: '😜 尽情吐槽吧~',
                    lang: 'en'.toLowerCase()
                });

                function getAuthor(language) {
                    switch (language) {
                        case 'en':
                            return 'Author';
                        case 'zh-CN':
                            return '博主';
                        default:
                            return 'Master';
                    }
                }

                // Add "Author" identify
                const getValineDomTimer = setInterval(() => {
                    const vcards = document.querySelectorAll('#vcomments .vcards .vcard');
                    if (vcards.length > 0) {
                        let author = 'Fang';

                        if (author) {
                            for (let vcard of vcards) {
                                const vnick_dom = vcard.querySelector('.vhead .vnick');
                                const vnick = vnick_dom.innerHTML;
                                if (vnick === author) {
                                    vnick_dom.innerHTML = `${vnick} <span class="author">${getAuthor(KEEP.hexo_config.language)}</span>`
                                }
                            }
                        }
                        clearInterval(getValineDomTimer);
                    } else {
                        clearInterval(getValineDomTimer);
                    }
                }, 2000);
            }

            if ('true') {
                const loadValineTimeout = setTimeout(() => {
                    loadValine();
                    clearTimeout(loadValineTimeout);
                }, 1000);
            } else {
                window.addEventListener('DOMContentLoaded', loadValine);
            }
        </script>
    </div>



        
    
</div>

            </div>
        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2021</span>
              -
            
            2023&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">Fang</a>
        </div>
        
            <script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv">
                        Visitor Count&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                    </span>
                
                
                    <span id="busuanzi_container_site_pv">
                        Totalview&nbsp;<span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            Powered by <a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;|&nbsp;Theme&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.4</a>
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fas fa-comment"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        
            <li class="tools-item rss flex-center">
                <a class="flex-center"
                   href="/atom.xml"
                   target="_blank"
                >
                    <i class="fas fa-rss"></i>
                </a>
            </li>
        

        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%80%E3%80%81Flowable%E4%BB%8B%E7%BB%8D"><span class="nav-number">1.</span> <span class="nav-text">一、Flowable介绍</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%8C%E3%80%81Flowable%E5%9F%BA%E7%A1%80"><span class="nav-number">2.</span> <span class="nav-text">二、Flowable基础</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-Flowable-%E8%8E%B7%E5%8F%96ProcessEngine%E5%AF%BE%E8%B1%A1"><span class="nav-number">2.1.</span> <span class="nav-text">1.Flowable-获取ProcessEngine対象</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-Flowable-%E6%97%A5%E5%BF%97%E5%92%8C%E8%A1%A8%E7%BB%93%E6%9E%84%E4%BB%8B%E7%BB%8D"><span class="nav-number">2.2.</span> <span class="nav-text">2.Flowable-日志和表结构介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B%E5%AE%9A%E4%B9%89"><span class="nav-number">2.3.</span> <span class="nav-text">3.部署流程定义</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-Flowable-%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B-%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%88%A0%E9%99%A4%E6%93%8D%E4%BD%9C"><span class="nav-number">2.4.</span> <span class="nav-text">4.Flowable-部署流程-查询和删除操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E5%AE%9E%E4%BE%8B"><span class="nav-number">2.5.</span> <span class="nav-text">5.启动流程实例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-%E6%9F%A5%E8%AF%A2%E4%BB%BB%E5%8A%A1"><span class="nav-number">2.6.</span> <span class="nav-text">6.查询任务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-%E5%AE%8C%E6%88%90%E4%BB%BB%E5%8A%A1"><span class="nav-number">2.7.</span> <span class="nav-text">7.完成任务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-Flowable-%E5%8E%86%E5%8F%B2%E4%BB%BB%E5%8A%A1%E6%9F%A5%E8%AF%A2"><span class="nav-number">2.8.</span> <span class="nav-text">8.Flowable-历史任务查询</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%89%E3%80%81Flowable%E6%B5%81%E7%A8%8B%E8%AE%BE%E8%AE%A1%E5%99%A8"><span class="nav-number">3.</span> <span class="nav-text">三、Flowable流程设计器</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-Eclipse-Designer"><span class="nav-number">3.1.</span> <span class="nav-text">1.Eclipse Designer</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85Eclipse"><span class="nav-number">3.1.1.</span> <span class="nav-text">1.1 下载安装Eclipse</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-%E5%AE%89%E8%A3%85Flowable%E6%8F%92%E4%BB%B6"><span class="nav-number">3.1.2.</span> <span class="nav-text">1.2 安装Flowable插件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="nav-number">3.1.3.</span> <span class="nav-text">1.3 创建项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-%E5%88%9B%E5%BB%BA%E6%B5%81%E7%A8%8B%E5%9B%BE"><span class="nav-number">3.1.4.</span> <span class="nav-text">1.4 创建流程图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-5-%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B"><span class="nav-number">3.1.5.</span> <span class="nav-text">1.5 部署流程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E6%88%91%E7%9B%B4%E6%8E%A5%E7%94%A8%E7%BD%91%E9%A1%B5%E7%9A%84"><span class="nav-number">3.2.</span> <span class="nav-text">2.我直接用网页的</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Flowable-UI%E5%BA%94%E7%94%A8"><span class="nav-number">3.3.</span> <span class="nav-text">3.Flowable UI应用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2"><span class="nav-number">3.3.1.</span> <span class="nav-text">3.1安装部署</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1"><span class="nav-number">3.3.2.</span> <span class="nav-text">3.2启动服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86"><span class="nav-number">3.3.3.</span> <span class="nav-text">3.3 用户管理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-%E7%BB%98%E5%88%B6%E6%B5%81%E7%A8%8B"><span class="nav-number">3.3.4.</span> <span class="nav-text">3.4 绘制流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B"><span class="nav-number">3.3.5.</span> <span class="nav-text">3.5 部署流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-6-FlowableUI-%E6%BC%94%E7%A4%BA"><span class="nav-number">3.3.6.</span> <span class="nav-text">3.6 FlowableUI 演示</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-6-1-%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B"><span class="nav-number">3.3.6.1.</span> <span class="nav-text">3.6.1 部署流程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-6-2-%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B"><span class="nav-number">3.3.6.2.</span> <span class="nav-text">2.6.2 启动流程</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9B%9B%E3%80%81%E8%A1%A8%E7%BB%93%E6%9E%84%E8%AE%B2%E8%A7%A3"><span class="nav-number">4.</span> <span class="nav-text">四、表结构讲解</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-ProcessEngine%E8%AE%B2%E8%A7%A3"><span class="nav-number">4.1.</span> <span class="nav-text">2.ProcessEngine讲解</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E7%A1%AC%E7%BC%96%E7%A0%81%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="nav-number">4.1.1.</span> <span class="nav-text">2.1 硬编码的方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">4.1.2.</span> <span class="nav-text">2.2 配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-%E8%87%AA%E5%AE%9A%E4%B9%89%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">4.1.3.</span> <span class="nav-text">2.3 自定义配置文件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Servcie%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3"><span class="nav-number">4.2.</span> <span class="nav-text">3. Servcie服务接口</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-Service%E5%88%9B%E5%BB%BA%E6%96%B9%E5%BC%8F"><span class="nav-number">4.2.1.</span> <span class="nav-text">3.1 Service创建方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-Service%E6%80%BB%E8%A7%88"><span class="nav-number">4.2.2.</span> <span class="nav-text">3.2 Service总览</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E5%9B%BE%E6%A0%87%E4%BB%8B%E7%BB%8D"><span class="nav-number">4.3.</span> <span class="nav-text">4.图标介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-%E4%BA%8B%E4%BB%B6%E5%9B%BE%E6%A0%87"><span class="nav-number">4.3.1.</span> <span class="nav-text">4.1 事件图标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-%E6%B4%BB%E5%8A%A8-%E4%BB%BB%E5%8A%A1-%E5%9B%BE%E6%A0%87"><span class="nav-number">4.3.2.</span> <span class="nav-text">4.2 活动(任务)图标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-%E7%BB%93%E6%9E%84%E5%9B%BE%E6%A0%87"><span class="nav-number">4.3.3.</span> <span class="nav-text">4.3 结构图标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-%E7%BD%91%E5%85%B3%E5%9B%BE%E6%A0%87"><span class="nav-number">4.3.4.</span> <span class="nav-text">4.4 网关图标</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E6%B5%81%E7%A8%8B%E9%83%A8%E7%BD%B2%E8%AF%A6%E8%A7%A3"><span class="nav-number">4.4.</span> <span class="nav-text">5.流程部署详解</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-%E9%83%A8%E7%BD%B2%E5%AE%9E%E7%8E%B0"><span class="nav-number">4.4.1.</span> <span class="nav-text">5.1 部署实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-%E9%83%A8%E7%BD%B2%E6%B6%89%E5%8F%8A%E8%A1%A8%E7%BB%93%E6%9E%84"><span class="nav-number">4.4.2.</span> <span class="nav-text">5.2 部署涉及表结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-%E6%8C%82%E8%B5%B7%E5%92%8C%E6%BF%80%E6%B4%BB"><span class="nav-number">4.4.3.</span> <span class="nav-text">5.3 挂起和激活</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E5%AE%9E%E4%BE%8B"><span class="nav-number">4.5.</span> <span class="nav-text">6.启动流程实例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B"><span class="nav-number">4.6.</span> <span class="nav-text">7.处理流程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-%E5%AE%8C%E6%88%90%E4%B8%80%E4%B8%AA%E6%B5%81%E7%A8%8B"><span class="nav-number">4.7.</span> <span class="nav-text">8.完成一个流程</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%94%E3%80%81%E4%BB%BB%E5%8A%A1%E5%88%86%E9%85%8D%E5%92%8C%E6%B5%81%E7%A8%8B%E5%8F%98%E9%87%8F"><span class="nav-number">5.</span> <span class="nav-text">五、任务分配和流程变量</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E4%BB%BB%E5%8A%A1%E5%88%86%E9%85%8D"><span class="nav-number">5.1.</span> <span class="nav-text">1.任务分配</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E5%9B%BA%E5%AE%9A%E5%88%86%E9%85%8D"><span class="nav-number">5.1.1.</span> <span class="nav-text">1.1 固定分配</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%88%86%E9%85%8D"><span class="nav-number">5.1.2.</span> <span class="nav-text">1.2 表达式分配</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-1-%E5%80%BC%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="nav-number">5.1.2.1.</span> <span class="nav-text">1.2.1 值表达式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-2-%E6%96%B9%E6%B3%95%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="nav-number">5.1.2.2.</span> <span class="nav-text">1.2.2 方法表达式</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-%E7%9B%91%E5%90%AC%E5%99%A8%E5%88%86%E9%85%8D"><span class="nav-number">5.1.3.</span> <span class="nav-text">1.3 监听器分配</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E6%B5%81%E7%A8%8B%E5%8F%98%E9%87%8F"><span class="nav-number">5.2.</span> <span class="nav-text">2.流程变量</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F"><span class="nav-number">5.2.1.</span> <span class="nav-text">2.1 全局变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F"><span class="nav-number">5.2.2.</span> <span class="nav-text">2.2 局部变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-%E6%A1%88%E4%BE%8B%E8%AE%B2%E8%A7%A3"><span class="nav-number">5.2.3.</span> <span class="nav-text">2.3 案例讲解</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%85%AD%E3%80%81%E5%80%99%E9%80%89%E4%BA%BA%E5%92%8C%E5%80%99%E9%80%89%E4%BA%BA%E7%BB%84"><span class="nav-number">6.</span> <span class="nav-text">六、候选人和候选人组</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%80%99%E9%80%89%E4%BA%BA"><span class="nav-number">6.1.</span> <span class="nav-text">1.候选人</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E5%AE%9A%E4%B9%89%E6%B5%81%E7%A8%8B%E5%9B%BE"><span class="nav-number">6.1.1.</span> <span class="nav-text">1.1 定义流程图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-%E9%83%A8%E7%BD%B2%E5%92%8C%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E5%AE%9E%E4%BE%8B"><span class="nav-number">6.1.2.</span> <span class="nav-text">1.2 部署和启动流程实例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-%E4%BB%BB%E5%8A%A1%E7%9A%84%E6%9F%A5%E8%AF%A2"><span class="nav-number">6.1.3.</span> <span class="nav-text">1.3 任务的查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-%E4%BB%BB%E5%8A%A1%E7%9A%84%E6%8B%BE%E5%8F%96"><span class="nav-number">6.1.4.</span> <span class="nav-text">1.4 任务的拾取</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-5-%E4%BB%BB%E5%8A%A1%E7%9A%84%E5%BD%92%E8%BF%98"><span class="nav-number">6.1.5.</span> <span class="nav-text">1.5 任务的归还</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-6-%E4%BB%BB%E5%8A%A1%E7%9A%84%E4%BA%A4%E6%8E%A5"><span class="nav-number">6.1.6.</span> <span class="nav-text">1.6 任务的交接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-7-%E4%BB%BB%E5%8A%A1%E7%9A%84%E5%AE%8C%E6%88%90"><span class="nav-number">6.1.7.</span> <span class="nav-text">1.7 任务的完成</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E5%80%99%E9%80%89%E4%BA%BA%E7%BB%84"><span class="nav-number">6.2.</span> <span class="nav-text">2.候选人组</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E7%AE%A1%E7%90%86%E7%94%A8%E6%88%B7%E5%92%8C%E7%BB%84"><span class="nav-number">6.2.1.</span> <span class="nav-text">2.1 管理用户和组</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-1-%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86"><span class="nav-number">6.2.1.1.</span> <span class="nav-text">2.1.1 用户管理</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-2-Group%E7%AE%A1%E7%90%86"><span class="nav-number">6.2.2.</span> <span class="nav-text">2.1.2 Group管理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-3-%E7%94%A8%E6%88%B7%E5%88%86%E9%85%8D%E7%BB%84"><span class="nav-number">6.2.3.</span> <span class="nav-text">2.1.3 用户分配组</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E5%80%99%E9%80%89%E4%BA%BA%E7%BB%84%E5%BA%94%E7%94%A8"><span class="nav-number">6.2.4.</span> <span class="nav-text">2.2 候选人组应用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2-%E6%B5%81%E7%A8%8B%E7%9A%84%E9%83%A8%E7%BD%B2%E8%BF%90%E8%A1%8C"><span class="nav-number">6.2.4.1.</span> <span class="nav-text">2.2.2 流程的部署运行</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-3-%E4%BB%BB%E5%8A%A1%E7%9A%84%E6%8B%BE%E5%8F%96%E5%92%8C%E5%AE%8C%E6%88%90"><span class="nav-number">6.2.4.2.</span> <span class="nav-text">2.2.3 任务的拾取和完成</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%83%E3%80%81%E7%BD%91%E5%85%B3"><span class="nav-number">7.</span> <span class="nav-text">七、网关</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E6%8E%92%E4%BB%96%E7%BD%91%E5%85%B3"><span class="nav-number">7.1.</span> <span class="nav-text">1.排他网关</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E5%B9%B6%E8%A1%8C%E7%BD%91%E5%85%B3"><span class="nav-number">7.2.</span> <span class="nav-text">2.并行网关</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E5%8C%85%E5%90%AB%E7%BD%91%E5%85%B3"><span class="nav-number">7.3.</span> <span class="nav-text">3.包含网关</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E4%BA%8B%E4%BB%B6%E7%BD%91%E5%85%B3"><span class="nav-number">7.4.</span> <span class="nav-text">4.事件网关</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%85%AB%E3%80%81SpringBoot%E6%95%B4%E5%90%88Flowable"><span class="nav-number">8.</span> <span class="nav-text">八、SpringBoot整合Flowable</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E6%B7%BB%E5%8A%A0%E7%9B%B8%E5%85%B3%E4%BE%9D%E8%B5%96"><span class="nav-number">8.1.</span> <span class="nav-text">1.添加相关依赖</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E6%B7%BB%E5%8A%A0%E5%AF%B9%E5%BA%94%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="nav-number">8.2.</span> <span class="nav-text">2.添加对应的配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2"><span class="nav-number">8.3.</span> <span class="nav-text">3.自动部署</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E6%89%8B%E5%8A%A8%E9%83%A8%E7%BD%B2"><span class="nav-number">8.4.</span> <span class="nav-text">4.手动部署</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B"><span class="nav-number">8.5.</span> <span class="nav-text">5.启动流程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B"><span class="nav-number">8.6.</span> <span class="nav-text">6.处理流程</span></a></li></ol></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="Search..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>



<script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.4/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.4/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.4/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.4/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.4/source/js/dark-light-toggle.js"></script>


    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.4/source/js/local-search.js"></script>



    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.4/source/js/code-copy.js"></script>



    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.4/source/js/lazyload.js"></script>


<div class="post-scripts pjax">
    
        <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.4/source/js/left-side-toggle.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.4/source/js/libs/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.4/source/js/toc.js"></script>
    
</div>


    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.4/source/js/libs/pjax.min.js"></script>
<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            KEEP.refresh();
        });
    });
</script>



</body>
</html>
