<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="Fang">
    
    <title>
        
            基于 Vue3 ，打造前台+中台通用提效解决方案 |
        
        念~旭
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/favicon.ico">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.4/source/css/font-awesome.min.css">
    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"example.com","root":"/","language":"en","path":"search.json"};
    KEEP.theme_config = {"toc":{"enable":true,"number":true,"expand_all":true,"init_open":false},"style":{"primary_color":"#0066CC","avatar":"/images/favicon.ico","favicon":"/images/favicon.ico","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":true,"scale":false},"first_screen":{"enable":true,"background_img":"/images/bg.svg","description":"进来就别走了！"},"scroll":{"progress_bar":{"enable":true},"percent":{"enable":true}}},"local_search":{"enable":true,"preload":true},"code_copy":{"enable":true,"style":"default"},"pjax":{"enable":true},"lazyload":{"enable":true},"version":"3.4.4"};
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
  </script>
<meta name="generator" content="Hexo 6.1.0"><link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
</head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <span class="pjax-progress-icon">
            <i class="fas fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                念~旭
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                HOME
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                ARCHIVES
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/links"
                            >
                                LINKS
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/about"
                            >
                                ABOUT
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">HOME</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">ARCHIVES</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/links">LINKS</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/about">ABOUT</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">基于 Vue3 ，打造前台+中台通用提效解决方案</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/favicon.ico">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">Fang</span>
                        
                            <span class="author-label">Lv7</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;
        <span class="pc">2022-09-28 10:14:05</span>
        <span class="mobile">2022-09-28 10:14</span>
    </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/Vue3/">Vue3</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fas fa-file-word"></i>&nbsp;<span>44.1k Words</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fas fa-clock"></i>&nbsp;<span>206 Mins</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <h1 id="1、全新的项目构建方案-——-vite"><a href="#1、全新的项目构建方案-——-vite" class="headerlink" title="1、全新的项目构建方案 —— vite"></a>1、全新的项目构建方案 —— vite</h1><p>vite 作为一面世就备受瞩目的前端构建工具，它究竟有什么神奇的地方？它又凭什么挑战 webpack 老大的地位呢？学习本章带你了解 vite 的“前世今生”</p>
<hr>
<h2 id="1-1-vite-VS-webpack"><a href="#1-1-vite-VS-webpack" class="headerlink" title="1-1 vite VS webpack"></a>1-1 vite VS webpack</h2><ul>
<li>一个字：<strong>快</strong>！</li>
</ul>
<h2 id="1-2-素质三连：vite-为什么快？这种快的机制会不会有什么问题？官方是如何解决的？"><a href="#1-2-素质三连：vite-为什么快？这种快的机制会不会有什么问题？官方是如何解决的？" class="headerlink" title="1-2 素质三连：vite 为什么快？这种快的机制会不会有什么问题？官方是如何解决的？"></a>1-2 素质三连：vite 为什么快？这种快的机制会不会有什么问题？官方是如何解决的？</h2><ol>
<li><ul>
<li><strong>webpack会遇到这种问题</strong>：假设我们的项目有A、B两个页面，其中A页面是项目首页，里面的代码一切正常。B页面是一个需要经过跳转才会进入的页面，里面存在一些错误。比如导入一个不存在的文件a.js，然后打印a；当我们去构建这个项目时，明明没有进入过B页面，但是webpack依旧会抛出错误</li>
<li><strong>而vite</strong>，同样的错误，在没有进入B页面的时候他是不会出现的，只有进入B页面，才会突然出现这样的一个错误（原因：vite不会一开始就构建整个项目，而是将应用区分为<strong>依赖</strong>和<strong>源码</strong>两部分，对于<strong>源码</strong>部分，它会根据<strong>路由来拆分</strong>代码模块，只会去构建一开始就必须要构建的内容，同时vite以原生ESM方式为浏览器提供源码，让浏览器接管了<strong>打包</strong>的部分工作）</li>
</ul>
</li>
<li><p>如果我们项目中存在commonJS的内容怎么办？是不是就意味着不能被解析？<strong>确实如此</strong>，在vite早期版本就因为这个问题导致很多<strong>依赖</strong>无法使用。</p>
</li>
<li><p>因为这个问题非常的严重，所以针对于这个问题，vite 在后期提供了 <strong>依赖预构建</strong>的功能，其中一个非常重要的目的就是为了解决CommonJS 和 UMD 兼容性问题。目前vite会先将<strong>CommonJS 或UMD</strong> 发布的依赖项转换为 ESM 之后，再重新进行编译。这也可以理解为<strong>速度对业务的一个妥协</strong>。</p>
</li>
</ol>
<h2 id="1-3-为什么选择了-vite"><a href="#1-3-为什么选择了-vite" class="headerlink" title="1-3 为什么选择了 vite"></a>1-3 为什么选择了 vite</h2><p>目前最新的vite 版本为2.8.5 的版本，经过了两年多的更新的之后，现在的vite 已经非常成熟，足以满足<strong>企业级开发</strong>的需求，并且经过调研，越来越过得企业开始尝试使用 vite 作为项目的构建工具，根据npm的月下载量可以看出，目前vite 的月下载量已经达到了236万</p>
<p>如果说webpack 代表的是现在，那么vite 极有可能代表了未来。</p>
<p>所以在vite 已经足以支持企业级开发的前提下，我们是时候拥抱vite 了。</p>
<h2 id="1-4-通过-vite-构建《小慕前端》"><a href="#1-4-通过-vite-构建《小慕前端》" class="headerlink" title="1-4 通过 vite 构建《小慕前端》"></a>1-4 通过 vite 构建《小慕前端》</h2><p>我们通过vite去构建《小慕前端》，对应的版本信息如下：</p>
<blockquote>
<p>vite 版本：2.8.0</p>
<p>node 版本： 16.13.1</p>
<p>npm 版本： 8.1.2</p>
</blockquote>
<p>想要使用vite，我们首先需要下载vite：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g vite@<span class="number">2</span>.<span class="number">8</span>.<span class="number">0</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>兼容性注意</p>
<p>Vite需要Node.js版本&gt;&#x3D;12.0.0</p>
</blockquote>
<p>在vite下载完成后，通过以下流程在构建</p>
<ol>
<li>创建一个项目</li>
</ol>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init vite@latest</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>如果没有安装过vite@latest，那么则会提示进行安装，选择y即可</li>
<li>等待依赖安装完成</li>
<li>输入项目名称：imooc-front</li>
<li>选择一个框架就是vue，语言也就是vue</li>
<li>如果想Network也显示地址，我们可以去项目里的package.json的dev中加入对应的–host</li>
</ol>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202209290951271.png"
                      alt="image-20220929095113140"
                ></p>
<h1 id="2、定制化、高可用前台样式处理方案——tailwindcss"><a href="#2、定制化、高可用前台样式处理方案——tailwindcss" class="headerlink" title="2、定制化、高可用前台样式处理方案——tailwindcss"></a>2、定制化、高可用前台样式处理方案——tailwindcss</h1><p>你还在用传统的 css 定义样式吗？你 out 了。学习 tailwind ，不写一行 css 一样实现 《高定制化、高个性化、高交互性，高可用性》 的精美前台项目。</p>
<hr>
<h2 id="2-1-企业级项目下的css处理痛点"><a href="#2-1-企业级项目下的css处理痛点" class="headerlink" title="2-1 企业级项目下的css处理痛点"></a>2-1 企业级项目下的css处理痛点</h2><ul>
<li>统一的维护变得困难</li>
<li>大量的ClassName负担</li>
<li>HTML、CSS分离造成了滚动问题</li>
<li>响应式、主题切换实现复杂</li>
</ul>
<p>难道是因为html、ess 已经足够成熟，不需要再进行改变了吗？应该也不是的，比如针对于css而言，我们在进行企业开发时，就会遇到很多问题，比如：</p>
<ol>
<li>有时我们需要统一设计方案，比如项目中的红色我们需要使用同样的色值，标题的文字大小我们期望在整个项目中进行统一的划分。这样的一套<strong>变量</strong>如果通过css来实现，那么就不得不维护一个庞大的<strong>变量组</strong>，这其实是一个非常大的心智负担。</li>
<li>html结构是一个非常复杂的结构化内容，为了给这些结构指定对应的样式，那么通常我们都是通过clssName来去指定。这就必须要求我们为这套复杂的结构指定各种各样包含语义化的className。比如：container、container-box，container-box-<br>title、container-box-sub-title，container-box-sub-title-left-imag大量的”无意义”命名本身就会增加很多额外的负担。</li>
<li>因为html 和css 是分离的，所以我们通常情况下在开发时，不得不在整个代码文件中，来回的上下翻滚，或者进行分屏操作。无论是哪一种其实都不能给我们带来一个很好地开发体验。</li>
<li>针对于一些”复杂“的功能，比如响应式（媒体查询）、主题定制。如果我们想要通过传统的html+ css的形式来进行实现，无疑是非常复杂的。</li>
</ol>
<h2 id="2-2-安装tailwindcss到你的项目"><a href="#2-2-安装tailwindcss到你的项目" class="headerlink" title="2-2 安装tailwindcss到你的项目"></a>2-2 安装tailwindcss到你的项目</h2><ol>
<li><p>在我们的&#x3D;&#x3D;项目&#x3D;&#x3D;中执行 npm install -D <a class="link"   href="mailto:&#116;&#97;&#x69;&#108;&#119;&#x69;&#x6e;&#100;&#x63;&#115;&#115;&#64;&#51;&#x2e;&#48;&#x2e;&#50;&#51;" >&#116;&#97;&#x69;&#108;&#119;&#x69;&#x6e;&#100;&#x63;&#115;&#115;&#64;&#51;&#x2e;&#48;&#x2e;&#50;&#51;<i class="fas fa-external-link-alt"></i></a> <a class="link"   href="mailto:&#112;&#x6f;&#x73;&#x74;&#x63;&#115;&#115;&#x40;&#56;&#46;&#x34;&#46;&#x38;" >&#112;&#x6f;&#x73;&#x74;&#x63;&#115;&#115;&#x40;&#56;&#46;&#x34;&#46;&#x38;<i class="fas fa-external-link-alt"></i></a> <a class="link"   href="mailto:&#97;&#117;&#116;&#x6f;&#112;&#114;&#x65;&#x66;&#105;&#x78;&#x65;&#x72;&#64;&#x31;&#48;&#46;&#52;&#x2e;&#x32;" >&#97;&#117;&#116;&#x6f;&#112;&#114;&#x65;&#x66;&#105;&#x78;&#x65;&#x72;&#64;&#x31;&#48;&#46;&#52;&#x2e;&#x32;<i class="fas fa-external-link-alt"></i></a>，装 tailwindcss</p>
</li>
<li><p>执行npx tailwindcss init -p 创建 tailwind.config.js 文件，该文件为 tailwindcss 的配置文件，该文件默认内容为：</p>
</li>
</ol>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202209290952236.png"
                      alt="image-20220929095257143"
                ></p>
<ol start="3">
<li><p>接下来我们需要添加<strong>模板路径（tailwind的应用范围）</strong></p>
</li>
<li><p>在tailwind.config.js 文件中的content 选项下，写入如下内容：</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">//Tailwind应用范围</span></span><br><span class="line">  <span class="attr">content</span>: [<span class="string">&#x27;./index.html&#x27;</span>,<span class="string">&#x27;./src/**/*.&#123;vue,js&#125;&#x27;</span>],</span><br><span class="line">···</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li><p>接下来我们需要添加一些tailwind的指令</p>
</li>
<li><p>创建 src&#x2F;styles&#x2F;index.scss文件，并写入如下代码：</p>
</li>
</ol>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//导入tailwind的基础指令组件</span></span><br><span class="line"><span class="keyword">@tailwind</span> base;</span><br><span class="line"><span class="keyword">@tailwind</span> components;</span><br><span class="line"><span class="keyword">@tailwind</span> utilities;</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>然后在src&#x2F;main.js引入该index.scss</li>
<li>因为我们使用了scss，所以我们需要安装<strong>sass</strong>，执行npm i -D <a class="link"   href="mailto:&#x73;&#x61;&#115;&#115;&#x40;&#49;&#x2e;&#x34;&#53;&#46;&#48;" >&#x73;&#x61;&#115;&#115;&#x40;&#49;&#x2e;&#x34;&#53;&#46;&#48;<i class="fas fa-external-link-alt"></i></a>安装 sass</li>
<li>此时tailwind 已经安装到我们的项目中</li>
<li>我们可以在src&#x2F;App.vue 中为img标签增加一个 class&#x3D;”bg-red-900”</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img alt=&quot;Vue logo&quot;  class=&quot;bg-red-900&quot; src=&quot;@/assets/logo.svg&quot; width=&quot;125&quot; height=&quot;125&quot; /&gt;</span><br></pre></td></tr></table></figure>

<h2 id="2-3-tailwindcss初体验"><a href="#2-3-tailwindcss初体验" class="headerlink" title="2-3 tailwindcss初体验"></a>2-3 tailwindcss初体验</h2><p>我们对App.vue进行修改，有一点不好就是IDEA没有对tailwind有代码补充提醒</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line"> &lt;div class=&quot;bg-slate-800 rounded-xl p-8 md:flex md:p-0&quot;&gt;</span><br><span class="line">   &lt;img class=&quot;w-24 h-24 rounded-full mx-auto md:w-48 md: h-auto md: rounded-none&quot;</span><br><span class="line">        src=&quot;https://tailwindcss.com/_next/static/media/sarah-dayan.a8ff3f1095a58085a82e3bb6aab12eb2.jpg&quot;</span><br><span class="line">        /&gt;</span><br><span class="line">   &lt;div class=&quot;pt-6 text-center space-y-4 md:p-8 md: text-lett&quot;&gt;</span><br><span class="line">     &lt;p class=&quot;text-lg font-medium text-zinc-100&quot;&gt;</span><br><span class="line">       “这是使用 tailwindcss</span><br><span class="line">       来实现的一个基础的卡片区域，在实现该卡域的过程中，我们从来没有离开过HTML 区域.”</span><br><span class="line">     &lt;/p&gt;</span><br><span class="line">     &lt;div class=&quot;font-medium&quot;&gt;</span><br><span class="line">       &lt;div class=&quot;text-sky-400&quot;&gt;LGD_Sunday&lt;/div&gt;</span><br><span class="line">       &lt;div class=&quot;text-slate-500&quot;&gt;中前台前端解决方案&lt;/div&gt;</span><br><span class="line">       &lt;/div&gt;</span><br><span class="line">   &lt;/div&gt;</span><br><span class="line"> &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="2-4-tailwindcss设计理念和价值体现"><a href="#2-4-tailwindcss设计理念和价值体现" class="headerlink" title="2-4 tailwindcss设计理念和价值体现"></a>2-4 tailwindcss设计理念和价值体现</h2><p><strong>设计理念</strong></p>
<p>tailwindcss中一个非常核心的内容就是：<strong>每一个类名都代表了一个css属性</strong>，这个样式在 tailwindcss 中被称作为<strong>原子化CSS</strong>，而大家争议的核心其实就在这里。<br>那么想要搞明白这样的一种设计理念，那么我们需要先搞清楚CSS设计史上的一些粒度划分。<br>整个前端历史中，CSS 颗粒度设计主要可以分为4种形式（<strong>颗粒度自上而下逐渐增大，颗粒度越大则约束性越高，可定制性越弱</strong>）：</p>
<ol>
<li>行内样式：样式全部写入行内。自由度最高，可定制化最强。但是不方便样式的复用，每次都要写完整的样式。|</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div style=&quot;background-color：#ffffff；color：#333333；&quot;&gt;</span><br><span class="line">    我是一个div</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>原子化CSS：每一个类名都代表了一个css属性。自度依然很强，可定制化依然很高，也方便复用。但是大量的样式会造成大量的类名。</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;bg-white text-zinc-800&quot;&gt;-   我是一个div&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>传统形式：通过一个或几个具有语义化的class来描述一段css 属性。封装性强，语义化强，自由度和可定制化性一般（比如cart 就标记好了当前为一个卡片，通常边框、弧度、阴影、padding 也都一并规定好了）。但是大量的html需要取大量的语义化class，并且在html 和css中需要来回的切换、查找。</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;container-box desc-container cart&quot;&gt;我是-div&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>组件形式：在组件库中极为常见。封装性极强（不光封装了样式，也封装了功能），语义化强。但是自由度和可定制化性比较差。</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;m-cart&gt;我是-个div&lt;/m-cart&gt;</span><br></pre></td></tr></table></figure>

<p>而tailwindcss 的核心设计理念就是：第二个：<strong>原子化的CSS</strong>。那么根据我们刚才的分析，这种方式惟一的问题就是：<strong>大量的样式会造成大量的类名这样的情况</strong>。而这样的一个问题在她的高自由度、高定制化、高可复用的优势之下，也就变得没有那么重要了。</p>
<p><strong>价值体现</strong></p>
<p>想要明确 tailwindcss 的价值，那么我们需要先来明确一下<strong>现代的前端应用</strong>开发的一些问题。<br>我们以后台前端解决方案这门课中的项目为例。项目中使用了element-plus作为UI 组件库。当我们决定使用<strong>element-plus</strong>的那一刻起，就<strong>决定了整体的项目样式为element设计风格</strong>。如果此时我们想要把项目做出个性化的风格出来，那么”几乎是不可能的”。<br>不过好在后台系统，风格本就干篇一律，这样设计倒也没有问题。但是如果是前台系统呢？<br>前台系统讲究高定制化、高个性化、高交互性，在这样的一个要求下，element，antd，vant 这样的组件库是否还能够满足我们需求呢？</p>
<p>对于<strong>高定制化、高个性化、高交互性</strong>的前台应用而言，通用组件库这种普适的组件系统是很难满足对应需求的。那么这也就意味着我们无法借助现有的样式，而需要手动写入大量的css样式和动画。<br>那么现在再回过头来看我们的4种颗粒度的css形式，你会怎么选择呢？</p>
<ol>
<li>行内样式：无复用性，不合适！</li>
<li>组件形式：通用组件库，经过刚才的分析，不合适！</li>
</ol>
<p>那么剩下的就只有<strong>原子化CSS</strong> 和<strong>传统形式</strong>这两种的。<br>因为我们的项目中，包含<strong>响应式</strong>和<strong>主题更换</strong>，而这两种功能如果想要通过<strong>传统形式</strong>来进行实现的话，是比较复杂的。因为这意味着我们需要定义大量的<strong>媒体查询</strong>和<strong>主题类名</strong>。<br>所以综上所述，在<strong>高定制化、高个性化、高交互性</strong>的前台应用中，<strong>原子化CSS</strong>是最合适的一种形式。而这种形式的具体体现就是tailwindcss</p>
<p><strong>总结</strong></p>
<ol>
<li>如果你想要实现一个<strong>通用</strong>的后台项目，那么推荐使用通用组件库实现</li>
<li>如果你想要实现一个<strong>高定制化、高个性化、高交互性</strong>的前台项目，那么推荐使用tailwindcss 实现</li>
</ol>
<h1 id="3、明星项目架构解决方案——搭建基础项目结构"><a href="#3、明星项目架构解决方案——搭建基础项目结构" class="headerlink" title="3、明星项目架构解决方案——搭建基础项目结构"></a>3、明星项目架构解决方案——搭建基础项目结构</h1><p>一般被人追捧，并具备长期可维护、可扩展的能力的项目，被称为明星项目，那么你知道如何搭建一个明星项目的基础架构吗？</p>
<hr>
<h2 id="3-1-项目开发助手-Prettier-Code-formatter-、-Tailwind-CSS-IntelliSense、Volar"><a href="#3-1-项目开发助手-Prettier-Code-formatter-、-Tailwind-CSS-IntelliSense、Volar" class="headerlink" title="3-1 项目开发助手 Prettier - Code formatter 、 Tailwind CSS IntelliSense、Volar"></a>3-1 项目开发助手 Prettier - Code formatter 、 Tailwind CSS IntelliSense、Volar</h2><p>分别在插件库中进行安装</p>
<p>针对Prettier ，在设置一个文件是.prettierrc，内容如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;semi&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="string">&quot;singleQuote&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;trailingComma&quot;</span>: <span class="string">&quot;none&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-2-项目架构基本结构处理分析"><a href="#3-2-项目架构基本结构处理分析" class="headerlink" title="3-2 项目架构基本结构处理分析"></a>3-2 项目架构基本结构处理分析</h2><p>通过vite 创建出的这个项目，目前来看还是非常简随的，只包含了基础的项目结构，所以我们需要进行较多的一些改造内容。</p>
<p>那么想要明确最终的改造方案，我们就需要先来分析一下我们的项目《小慕前端》</p>
<p>咱们的项目分为移动端和PC端两种显示结果，但是这两种显示结果通过同一套代码进行实现，也就是所谓的响应式构建方案。那么我们在分析的时候就需要分别分析（PS：此处我们只分析大的路由方案，目的是让大家对基本的项目结构有一个初步的认识，以方便我们的项目结构处理，后续具体的细节构建方案不在这次分析行为之内）：</p>
<ol>
<li>移动端结构</li>
<li>PC端结构</li>
</ol>
<p>然后把这两种的分析方案，合并到一起，组成一个最终的架构方案。</p>
<p><strong>移动端结构分析</strong><br>移动端的结构相对比较简单，当我们去进行路由跳转时，它是以整个页面进行的整体路由切换。</p>
<p>那么由此可知，移动端不存在嵌套路由的概念，只需要在APP，vue 中保留一个路由出口即可。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202209301544534.png"
                      alt="image-20220930154414339"
                ></p>
<p><strong>PC端结构分析</strong><br>而PC端的结构相对比较复杂，如下图所示：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202209301545306.png"
                      alt="image-20220930154519166"
                ></p>
<p>我们需要通过两个路由出口进行表示：</p>
<ol>
<li>App.vue：一级路由出口，用作整页路由切换</li>
<li>Main.vue：二级路由出口，用作局部路由切换</li>
</ol>
<p>那么由此我们可知，移动端和PC端两者的路由结构是不同的，所以这就要求我们需要根据 当前用户所在设备的不同，构建不同的<strong>路由表</strong>。<br>那么这一小节我们分析了项目在不同设备中，需要具备不同的路由结构，所以我们就需要生成多个路由表来应对不同的情况。<br>那么接下来我们就根据这一小节的分析，结合我们的项目经验，构建出基本的项目架构。</p>
<h2 id="3-3-构建项目架构"><a href="#3-3-构建项目架构" class="headerlink" title="3-3 构建项目架构"></a>3-3 构建项目架构</h2><p>在这一小节中，我们需要把咱们整个项目的架子搭建起来。因为咱们的项目默认没有安装vue-router 和vuex。所以我们需要先安装这两个插件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i --save vuex@4.0.2 vue-router@4.0.14</span><br></pre></td></tr></table></figure>

<p>然后我们去处理项目基本架构，最终架构如下（部分省略）：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202209301553059.png"
                      alt="image-20220930155333757"
                ></p>
<h1 id="4、企业级vite配置方案——让vite得心应手"><a href="#4、企业级vite配置方案——让vite得心应手" class="headerlink" title="4、企业级vite配置方案——让vite得心应手"></a>4、企业级vite配置方案——让vite得心应手</h1><p>任何一种构建工具都需要根据我们的需求进行对应的配置，那么针对于 vite 而言，在大厂中我们应该如何根据自己的业务进行对应的配置呢？</p>
<hr>
<h2 id="4-1-明确移动端和PC端的构建顺序"><a href="#4-1-明确移动端和PC端的构建顺序" class="headerlink" title="4-1 明确移动端和PC端的构建顺序"></a>4-1 明确移动端和PC端的构建顺序</h2><p>在上一章中（项目架构基本结构处理分析）中，我们明确了项目包含<strong>移动端路由表和PC端路由表</strong>两部分，所以我们在开发的时候就需要分别来去处理<strong>移动端</strong>和<strong>pc端</strong>对应的内容。</p>
<p>那么对于这两部分，我们需要按照什么样的顺序进行构建呢？</p>
<p>因为咱们的项目是使用的tailwindcss作为样式处理的核心库，所以我们的<strong>构建顺序</strong>需要尊重<strong>tailwindcss的构建顺序</strong>的。<br>那么在tailwind中，有这样一段内容：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202209301656800.png"
                      alt="image-20220930165624626"
                ></p>
<p>翻译过来就是<strong>移动优先</strong>的原则。<br>也就是说，使用 tailwind构建响应式系统时，需要先构建移动端，再构建PC端。<br>而这个顺序，同样也是咱们项目的构建顺序。</p>
<h2 id="4-2-构建移动处理工具-MobileTerminal"><a href="#4-2-构建移动处理工具-MobileTerminal" class="headerlink" title="4-2 构建移动处理工具 MobileTerminal"></a>4-2 构建移动处理工具 MobileTerminal</h2><blockquote>
<p>但是我们如何判断当前的设备是移动设备呢？</p>
</blockquote>
<p>为什么达到这个目的，我们就需要先去构建出咱们的第一个工具方法：isMobileTerminal，该方法将返回一个boolean形的数据，如果为true 则表示当前所在为<strong>移动端</strong>，如果为false则表示当前为<strong>PC端</strong></p>
<p>那么根据我们之前的<strong>构建方案</strong>，所有的工具方法需要被放入到utils中，所以下面我们首先需要在utils中创建一个<strong>工具类flexible.js</strong>，在该方法中规定屏幕宽度**&lt;1280则为移动设备<strong>，并且为了保证这个方法的灵活性，我们可以让它称为一个</strong>计算属性**，所以我们得出如下代码</p>
<p>&#x2F;src&#x2F;utils&#x2F;flexible.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 判断当前是否为移动设备，判断依据为屏幕的宽度是否大于指定值（1280）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> &#123; computed &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">PC_DEVICE_WIDTH</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../constants&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> isMobileTerminal = <span class="title function_">computed</span>(<span class="function">() =&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">clientWidth</span> &lt;<span class="variable constant_">PC_DEVICE_WIDTH</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>src&#x2F;constants&#x2F;index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//PC设备指定宽度</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">PC_DEVICE_WIDTH</span> =<span class="number">1000</span></span><br></pre></td></tr></table></figure>

<p>src&#x2F;APP.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;&#123;&#123;isMobileTerminal&#125;&#125;&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123;isMobileTerminal&#125; from &#x27;./utils/flexible&#x27;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>此时当我们切换浏览器设备时，就可以得到对应的判断结果。</p>
<p><strong>注意：</strong>因为我们要在后面进行<strong>响应式的视图处理</strong>所以此处通过<strong>宽度</strong>进行移动端判断！！！！<br>大家在实际开发中更建议通过以下代码来进行是否为移动端的准确判断</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 判断当前是否为移动设备</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> isMobileTerminal = <span class="title function_">computed</span>(<span class="function">()=&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="regexp">/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i</span>.<span class="title function_">test</span>(navigator.<span class="property">userAgent</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="4-3-通过-vueuse-优化处理方案"><a href="#4-3-通过-vueuse-优化处理方案" class="headerlink" title="4-3 通过 vueuse 优化处理方案"></a>4-3 通过 vueuse 优化处理方案</h2><p>通过上面的实验，我们可以看出它并不是响应式的，因为必须通过刷新才能改变值，所以接下来我们使用<strong>vueuse库</strong>，先进行安装</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i @vueuse/core@<span class="number">8</span>.<span class="number">1</span>.<span class="number">2</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 判断当前是否为移动设备，判断依据为屏幕的宽度是否大于指定值（1280）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> &#123; computed &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">PC_DEVICE_WIDTH</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../constants&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;useWindowSize&#125; <span class="keyword">from</span> <span class="string">&#x27;@vueuse/core&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123;width&#125; = <span class="title function_">useWindowSize</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> isMobileTerminal = <span class="title function_">computed</span>(<span class="function">() =&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> width.<span class="property">value</span> &lt;<span class="variable constant_">PC_DEVICE_WIDTH</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="4-3-定义-软链接"><a href="#4-3-定义-软链接" class="headerlink" title="4-3 定义@软链接"></a>4-3 定义@软链接</h2><p>我们知道在webpack 中可以直接通过@符号表示src路径，但是在vite 默认是不可以的。</p>
<p>vite 提供了 <strong>resolve.alias</strong>功能，表示：<strong>通过别名在指向一个具体的路径</strong></p>
<p>那么我们就可以通过此配置来实现@软链接功能在vite.config.js中写入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//新增</span></span><br><span class="line"><span class="keyword">import</span> &#123; fileURLToPath, <span class="variable constant_">URL</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;node:url&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> vue <span class="keyword">from</span> <span class="string">&#x27;@vitejs/plugin-vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// https://vitejs.dev/config/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="title function_">vue</span>()],</span><br><span class="line">  <span class="comment">//软连接</span></span><br><span class="line">  <span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="attr">alias</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;@&#x27;</span>: <span class="title function_">fileURLToPath</span>(<span class="keyword">new</span> <span class="title function_">URL</span>(<span class="string">&#x27;./src&#x27;</span>, <span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">url</span>))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>或者写成这样：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; fileURLToPath, <span class="variable constant_">URL</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;node:url&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> vue <span class="keyword">from</span> <span class="string">&#x27;@vitejs/plugin-vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;join&#125; <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// https://vitejs.dev/config/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="title function_">vue</span>()],</span><br><span class="line">  <span class="comment">//软连接</span></span><br><span class="line">  <span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="attr">alias</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;@&#x27;</span>: <span class="title function_">join</span>(__dirname,<span class="string">&#x27;/src&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="4-4-构建VueRouter移动端路由表"><a href="#4-4-构建VueRouter移动端路由表" class="headerlink" title="4-4 构建VueRouter移动端路由表"></a>4-4 构建VueRouter移动端路由表</h2><p>那么到现在我们已经有了isMobileTerminal方法，那么接下来我们就可以利用这个方法处理移动端路由表，不过在处理该路由表之前我们还需初始化咱们的vue-router</p>
<ol>
<li>在src&#x2F;router&#x2F;index.js 中初始化 VueRouter</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;createRouter,createWebHistory&#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;isMobileTerminal&#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/flexible&#x27;</span></span><br><span class="line"><span class="keyword">import</span> mobileRoutes <span class="keyword">from</span> <span class="string">&#x27;./modules/mobile-router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> pcRoutes <span class="keyword">from</span> <span class="string">&#x27;./modules/pc-router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//创建vueRouter实例</span></span><br><span class="line"><span class="keyword">const</span> router =<span class="title function_">createRouter</span>(&#123;</span><br><span class="line">  <span class="attr">history</span>: <span class="title function_">createWebHistory</span>(),</span><br><span class="line">  <span class="attr">routes</span>: isMobileTerminal.<span class="property">value</span> ? mobileRoutes : pcRoutes</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>创建对应的移动端和pc端路由&#x2F;mobile-router.js和pc-router.js</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> [&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;home&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>: <span class="function">()=&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/main/index.vue&#x27;</span>)</span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> []</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>创建移动端首页@&#x2F;views&#x2F;main&#x2F;index.vue</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div&gt;我是移动端首页&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>在main.js中使用路由</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./styles/index.scss&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(router)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>在App.vue中使用一级路由</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;router-view/&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="4-5-划分移动端首页模块"><a href="#4-5-划分移动端首页模块" class="headerlink" title="4-5 划分移动端首页模块"></a>4-5 划分移动端首页模块</h2><p>移动端首页模块总共可分为三部分：<br>1.顶部的navigationbar</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202210051651788.png"
                      alt="image-20221005165100555"
                ></p>
<p>2.中间的列表内容</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202210051652839.png"
                      alt="image-20221005165206482"
                ></p>
<p>3.底部的tabbar</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202210051652038.png"
                      alt="image-20221005165221913"
                ></p>
<p>那么我们首先要开发的就是<strong>顶部的navigationBar</strong>部分。<br>而对于该部分又可以分为三块内容：</p>
<ol>
<li>navigator 表：</li>
<li>右侧汉堡按钮：</li>
<li>点击汉堡按钮展示的popup弹出层：</li>
</ol>
<p>那么明确好这些内容之后，接下来我们就可以按照这个顺序依次开发。</p>
<p>那么下面首先我们创建移动端的navigation模块：</p>
<ol>
<li>建 src&#x2F;views&#x2F;main&#x2F;components&#x2F;navigation&#x2F;mobile&#x2F;index.vue 组件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;我是移动端首页&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;&lt;/script&gt;</span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>创建 src&#x2F;views&#x2F;main&#x2F;components&#x2F;navigation&#x2F;index.vue 组件，为<strong>控制移动端和PC端的navigation 展示组件</strong></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;mobile-navigation-vue v-if=&quot;isMobileTerminal&quot;/&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123;isMobileTerminal&#125; from &#x27;@/utils/flexible&#x27;</span><br><span class="line">import mobileNavigationVue from &#x27;./mobile/index.vue&#x27;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>3.在src&#x2F;views&#x2F;main&#x2F;index.vue中导入该组件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">  &lt;navigation-vue/&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import navigationVue from &#x27;./components/navigation/index.vue&#x27;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="4-6-导入并配置axios"><a href="#4-6-导入并配置axios" class="headerlink" title="4-6 导入并配置axios"></a>4-6 导入并配置axios</h2><p>在有了 navigation 组件之后，接下来我们就可以尝试<strong>获取数据，渲染数据</strong>了</p>
<p>那么想要获取数据，我们将使用 axios</p>
<ol>
<li>安装 axios 依赖</li>
</ol>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i --save axios@<span class="number">0</span>.<span class="number">26</span>.<span class="number">1</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>创建 src&#x2F;utils&#x2F;request.js</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> service = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">  <span class="attr">baseURL</span>: <span class="string">&#x27;https://api.imooc-front.lgdsunday.club/api&#x27;</span>,</span><br><span class="line">  <span class="attr">timeout</span>: <span class="number">5000</span> <span class="comment">//请求超时时间</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> service</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>创建请求接口 src&#x2F;api&#x2F;category.js</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*获取分类列表</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getCategory</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/category&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>在src&#x2F;views&#x2F;main&#x2F;components&#x2F;navigation&#x2F;mobile&#x2F;index.vue中使用获得分类列表方法</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123;getCategory&#125; from &#x27;@/api/category&#x27;</span><br><span class="line">const getCategoryData = async ()=&gt;&#123;</span><br><span class="line">  const res = await getCategory()</span><br><span class="line">  console.log(res)</span><br><span class="line">&#125;</span><br><span class="line">getCategoryData()</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在vue中，await是等待的意思，await关键字只能放在async函数里，await配合async一起使用，相当于把异步函数变成了同步，await会等待后面表达式的返回结果之后才执行下一步。</p>
<p><a class="link"   target="_blank" rel="noopener" href="https://www.cnblogs.com/zhoujuan/p/11692818.html" >vue中异步函数async和await的用法 - zhouj2019 - 博客园 (cnblogs.com)<i class="fas fa-external-link-alt"></i></a></p>
</blockquote>
<h2 id="4-7-vite处理代理服务器"><a href="#4-7-vite处理代理服务器" class="headerlink" title="4-7 vite处理代理服务器"></a>4-7 vite处理代理服务器</h2><p>我们遇到了一个跨域的问题，这个问题在<strong>前后端分离</strong>的项目开发中是非常常见的。同时对于webpack可以直接通过proxy进行处理，那么vite 中是否也提供了类似的能力呢？</p>
<p>是的，vite同样提供了<strong>proxy</strong>的配置项。</p>
<p>具体使用的方式与webpack 中的proxy 基本没有区别，依然是通过devServer 根据url 进行代理处理。</p>
<p>具体配置方式如下：</p>
<ol>
<li>在src&#x2F;utils&#x2F;request.js 中，修改basURL为api，示当前请求为开发时的api请求</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> service = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">  <span class="attr">baseURL</span>: <span class="string">&#x27;/api&#x27;</span>,</span><br><span class="line">  <span class="attr">timeout</span>:<span class="number">5000</span><span class="comment">//请求超时时间</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> service</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在vite.config.js 中新增 server选项，配置代理</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//代理配置</span></span><br><span class="line"><span class="attr">server</span>:&#123;</span><br><span class="line">  <span class="attr">proxy</span>:&#123;</span><br><span class="line">    <span class="comment">//代理所有/api的请求</span></span><br><span class="line">    <span class="string">&#x27;/api&#x27;</span>:&#123;</span><br><span class="line">      <span class="comment">//代理请求之后的请求地址</span></span><br><span class="line">      <span class="attr">target</span>:<span class="string">&#x27;https://api.imooc-front.lgdsunday.club/&#x27;</span>,</span><br><span class="line">      <span class="comment">//跨域</span></span><br><span class="line">      <span class="attr">changeOrigin</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-8-vite处理环境变量"><a href="#4-8-vite处理环境变量" class="headerlink" title="4-8 vite处理环境变量"></a>4-8 vite处理环境变量</h2><p>到这里咱们已经可以请求到服务端，并且得到对应的数据响应了。</p>
<p>但是如果大家查看咱们的接口文档，那么可以发现baseURL分为两种：</p>
<p>DEV：<a class="link"   target="_blank" rel="noopener" href="https://api.imooc-front.lgdsunday.club/api" >https://api.imooc-front.lgdsunday.club/api<i class="fas fa-external-link-alt"></i></a> </p>
<p>PROD：<a class="link"   target="_blank" rel="noopener" href="https://api,imooc-front.lgdsunday.club/prod-api" >https://api，imooc-front.lgdsunday.club/prod-api<i class="fas fa-external-link-alt"></i></a></p>
<p>在通常咱们的企业级项目开发之中，都会区分<strong>开发时服务</strong>和<strong>生产时服务</strong>。</p>
<p>对于开发时服务而言，它内部的数据是<strong>假数据</strong>，所以我们可以随便修改。</p>
<p>而生产时服务，它内部数据为<strong>真实数据</strong>，所以是不能随意修改的。</p>
<p>那么在我们进行项目开发时，我们需要把服务切换为DEV 模式，而在打包项目时需要切换为PROD模式。</p>
<p>但是如果这个操作全靠人工切换，那么难免会有疏忽，一旦出现问题将会引起巨大的风险，所以我们期望可以<strong>根据项目状态，自动切换请求的服务地址。</strong></p>
<p>那么这样应该怎么做呢？</p>
<p>在vite中提供了**.env文件**，该文件为环境变量文件，默认提供了四种文件格式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.env					#所有情况下都会加载</span><br><span class="line">.env.local.				     #所有情况下都会加载，但会被git 忽略</span><br><span class="line">.env.[mode]				  #只在指定模式下加载</span><br><span class="line">.env.[mode].local		      #只在指定模式下加载，但会被git 忽略</span><br></pre></td></tr></table></figure>

<p>其中有一种.env.[mode]的格式可以在<strong>不同模式下加载不同内容</strong>，这不正是我们想要的吗？</p>
<p>那么明确好之后，下面我们就创建对应的文件：</p>
<ol>
<li>新建.env.development文件，表示<strong>开发时</strong>的.env文件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#只在指定模式(development)下加载</span><br><span class="line">#base api，只有以 VITE_为前缀的变量才会暴露给经过vite处理</span><br><span class="line">VITE_BASE_API =&#x27;/api</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>新建.env.production文件，表示<strong>生产时</strong>的.env文件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#只在指定模式（production）下加载</span><br><span class="line">#base api，只有以 VITE_为前缀的变量才会暴露给经过vite处理</span><br><span class="line">VITE_BASE_API =&#x27;/prod-api&#x27;</span><br></pre></td></tr></table></figure>

<p>3.在src&#x2F;utils&#x2F;request.js 中打印 VITE_BASE_API</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">env</span>.<span class="property">VITE_BASE_API</span>)</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>此时当找们执行 npm run dev时，可以发现浏览器打&#x2F;ap1，表示<strong>开发时</strong>服务地址</li>
<li>执行 npm run build 打包项目后运行（可以通过anywhere运行 dist 目录），浏览器打印为&#x2F;prod-api，表示<strong>发布时</strong>服务地址</li>
<li>表明咱们的环境变量配置成功</li>
<li>那么我们只需要修改 baseURL 为import.meta.env.VITE_BASE_API变量即可</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">baseURL</span>: <span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">env</span>.<span class="property">VITE_BASE_API</span>,</span><br></pre></td></tr></table></figure>

<h1 id="5、构建自己的物料解决方案——构建物料库，实现前端设计"><a href="#5、构建自己的物料解决方案——构建物料库，实现前端设计" class="headerlink" title="5、构建自己的物料解决方案——构建物料库，实现前端设计"></a>5、构建自己的物料解决方案——构建物料库，实现前端设计</h1><h2 id="5-1-为什么不使用组件库，而要自己构建？前台系统与后台系统的根本性区别！"><a href="#5-1-为什么不使用组件库，而要自己构建？前台系统与后台系统的根本性区别！" class="headerlink" title="5-1 为什么不使用组件库，而要自己构建？前台系统与后台系统的根本性区别！"></a>5-1 为什么不使用组件库，而要自己构建？前台系统与后台系统的根本性区别！</h2><p>我们明确了<strong>本项目中，不会使用现有的前端组件库，而是会构建一个咱们自己的物料库（组件库）。</strong>那么为什么要这么做呢？是为了故作高深吗？</p>
<p>不是的！</p>
<p>为了让大家更加明确原因，所以我们专门在抽出来一小节的内容，来明确这一点。</p>
<p>想要明确这一点内容，那么我们首先需要明确<strong>后台系统</strong>和<strong>前台系统</strong>的根本性区别。<br><strong>后台系统</strong></p>
<p>后台系统是大家平时项目开发中非常常见的一种项目形式。</p>
<p>但是后台系统有一个非常好的地方，那就是<strong>样式同质化高</strong></p>
<p>这些系统无论以什么样子的主题构建，他都有非常类似的地方：</p>
<ol>
<li><p>左侧通常为menu菜单</p>
<ol>
<li>菜单一般都是可折叠的</li>
<li>菜单一般都是可分层的</li>
<li>菜单一般都有图片和文字组成</li>
</ol>
</li>
<li><p>右侧通常为内容展示</p>
</li>
</ol>
<p>那么这种就叫做<strong>样式同质化高</strong>。因为它的样式同质化高，所以我们可以总结出一种通用的方式，来处理这种高同质化的<strong>功能</strong>和<strong>样式</strong>。<br>而这种通用的方式就是<strong>通用组件库</strong>，比如 element，antd，vant等等</p>
<p><strong>前台系统</strong><br>前台系统又分为了：</p>
<ol>
<li>pc端前台系统</li>
<li>移动端前台系统</li>
</ol>
<p>这个之外前台系统讲究 <strong>个性化样式</strong></p>
<p><strong>总结</strong></p>
<p>因为<strong>前台系统和后台系统</strong>的这种根本性的设计区别（前台讲究个性化，后台偏同质化），所以这就导致了目前市面上的<strong>通用组件库</strong>更多的是后台PC系统组件库（比如element 或者antd）。<br>这就导致，如果你想要开发一个前台系统，那么就需要拥有你自己的<strong>组件库</strong>！<br>这也是为什么我们必须要开发一个组件库的原因。</p>
<h2 id="5-2-数据拦截简化数据获取流程"><a href="#5-2-数据拦截简化数据获取流程" class="headerlink" title="5-2 数据拦截简化数据获取流程"></a>5-2 数据拦截简化数据获取流程</h2><p>我们在src&#x2F;utils&#x2F;request.js中新增数据拦截器，获取我们需要的东西，过滤不需要的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 响应拦截器：</span></span><br><span class="line"><span class="comment"> * 服务端返回数据之后，前端.then之前被调用</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">service.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(<span class="function">(<span class="params">response</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;success,message,data&#125; =response.<span class="property">data</span></span><br><span class="line">  <span class="keyword">if</span> (success)&#123;</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//<span class="doctag">TODO:</span>业务请求错误</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(message))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="5-3-业务组件：移动端navigationBar"><a href="#5-3-业务组件：移动端navigationBar" class="headerlink" title="5-3 业务组件：移动端navigationBar"></a>5-3 业务组件：移动端navigationBar</h2><ol>
<li>将navigation&#x2F;mobile&#x2F;index.vue中的代码，移植到navigation&#x2F;index.vue，并加以修改</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import &#123;ref&#125; from &#x27;vue&#x27;</span><br><span class="line">const categoryData = ref([])</span><br><span class="line">const getCategoryData = async () =&gt; &#123;</span><br><span class="line">  const &#123;categorys&#125; = await getCategory()</span><br><span class="line">  categoryData.value = categorys</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在子组件navigation&#x2F;mobile&#x2F;index.vue中进行数据接收，并优化数据在web端显示的格式</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;bg-white sticky top-0 left-0 z-10&quot;&gt;</span><br><span class="line">    &lt;ul</span><br><span class="line">      class=&quot; relative flex overflow-x-auto p-1 text-xs text-zinc-600</span><br><span class="line">      overflow-hidden&quot;&gt;</span><br><span class="line">      &lt;li v-for=&quot;item in data&quot; :key=&quot;item.id&quot; class=&quot;shrink-0 px-1.5 py-0.5 z-10 duration-200&quot;&gt;&#123;&#123;item.name&#125;&#125;&lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">//vite 构建的项目中，我们可以直接使用 defineProps方法</span><br><span class="line">defineProps(&#123;</span><br><span class="line">  data:&#123;</span><br><span class="line">    type: Array,</span><br><span class="line">    required:true</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在父组件navigation&#x2F;index.vue中进行数据绑定</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;mobile-navigation-vue v-if=&quot;isMobileTerminal&quot; :data=&quot;categoryData&quot; /&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<h2 id="5-4-动态rem基准-修正tailwind，完善移动端navig"><a href="#5-4-动态rem基准-修正tailwind，完善移动端navig" class="headerlink" title="5-4 动态rem基准+修正tailwind，完善移动端navig"></a>5-4 动态rem基准+修正tailwind，完善移动端navig</h2><ol>
<li>现在src&#x2F;utils&#x2F;flexible.js中写一个方法（调整字体的）</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">useREM</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  <span class="comment">//定义最大的fontSize</span></span><br><span class="line">  <span class="keyword">const</span> <span class="variable constant_">MAX_FONT_SIZE</span> = <span class="number">40</span></span><br><span class="line">  <span class="comment">//监听html文档被解析完成的事件</span></span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;DOMContentLoaded&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//拿到html标签</span></span><br><span class="line">    <span class="keyword">const</span> html =<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;html&#x27;</span>)</span><br><span class="line">    <span class="comment">//计算fontSize，根据屏幕宽度/10</span></span><br><span class="line">    <span class="keyword">let</span> fontSize = <span class="variable language_">window</span>.<span class="property">innerWidth</span>/<span class="number">10</span></span><br><span class="line">    fontSize = fontSize&gt;<span class="variable constant_">MAX_FONT_SIZE</span> ? <span class="variable constant_">MAX_FONT_SIZE</span> : fontSize</span><br><span class="line">    <span class="comment">//赋值给html</span></span><br><span class="line">    html.<span class="property">style</span>.<span class="property">fontSize</span> = fontSize + <span class="string">&#x27;px&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在src&#x2F;main.js中调用方法</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useREM &#125; <span class="keyword">from</span> <span class="string">&#x27;./utils/flexible&#x27;</span></span><br><span class="line"><span class="title function_">useREM</span>()</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>通过观察web页面的字体跟想象中的不一样，那么我们需要调整tailwind中fontsize的大小，在tailwind.config.js中进行修改</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">theme</span>: &#123;</span><br><span class="line">  <span class="attr">extend</span>: &#123;</span><br><span class="line">    <span class="attr">fontsize</span>:&#123;</span><br><span class="line">      <span class="attr">xs</span>:[<span class="string">&#x27;0.25rem&#x27;</span>,<span class="string">&#x27;0.35rem&#x27;</span>],</span><br><span class="line">      <span class="attr">sm</span>:[<span class="string">&#x27;0.35rem&#x27;</span>,<span class="string">&#x27;0.45rem&#x27;</span>],</span><br><span class="line">      <span class="attr">base</span>:[<span class="string">&#x27;0.45rem&#x27;</span>,<span class="string">&#x27;0.55rem&#x27;</span>],</span><br><span class="line">      <span class="attr">lg</span>:[<span class="string">&#x27;0.55rem&#x27;</span>,<span class="string">&#x27;0.65rem&#x27;</span>],</span><br><span class="line">      <span class="attr">xl</span>:[<span class="string">&#x27;0.65rem&#x27;</span>,<span class="string">&#x27;0.75rem&#x27;</span>],</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h2 id="5-5-通用组件：基于vite的统一svg处理svg-icon"><a href="#5-5-通用组件：基于vite的统一svg处理svg-icon" class="headerlink" title="5-5 通用组件：基于vite的统一svg处理svg-icon"></a>5-5 通用组件：基于vite的统一svg处理svg-icon</h2><ol>
<li>我们首先创建一个icon的通用组件src&#x2F;lib&#x2F;svg-icon&#x2F;index.vue</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;!--  把 aria-hidden=&quot;true&quot; 加到元素上会把该元素和它的所有子元素从无障碍树上移除。--&gt;</span><br><span class="line">&lt;svg aria-hidden=&#x27;true&#x27;&gt;</span><br><span class="line">  &lt;use :xlink:href=&#x27;symbolId&#x27; :class =&quot;fillClass&quot; :fill=&#x27;color&#x27;/&gt;</span><br><span class="line">&lt;/svg&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; computed &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">const props = defineProps(&#123;</span><br><span class="line">  //显示的svg</span><br><span class="line">  name:&#123;</span><br><span class="line">    type:String,</span><br><span class="line">    required:true</span><br><span class="line">  &#125;,</span><br><span class="line">  //svg图标的颜色</span><br><span class="line">  color:&#123;</span><br><span class="line">    type:String</span><br><span class="line">  &#125;,</span><br><span class="line">  //tailwind指定svg颜色的类名</span><br><span class="line">  fillClass:&#123;</span><br><span class="line">    type:String</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">//真实显示的svg图标（拼接#icon-）</span><br><span class="line">const symbolId = computed(()=&gt;`#icon-$&#123;props.name&#125;`)</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>然后我们在src&#x2F;lib&#x2F;index.js中进行注册</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> svgIcon <span class="keyword">from</span> <span class="string">&#x27;./svg-icon/index.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">install</span>(<span class="params">app</span>)&#123;</span><br><span class="line">    app.<span class="title function_">component</span>(<span class="string">&#x27;m-svg-icon&#x27;</span>,svgIcon)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3.在main.js中进行使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mLibs <span class="keyword">from</span> <span class="string">&#x27;./lib&#x27;</span></span><br><span class="line">app.<span class="title function_">use</span>(mLibs)</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>我们首先给tailwind增加一个阴影效果，就是横着拉动那些标签时，有隐隐约约的感觉，在tailwind.config.js中</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">theme</span>: &#123;</span><br><span class="line">  <span class="attr">extend</span>: &#123;</span><br><span class="line">    <span class="attr">boxShadow</span>:&#123;</span><br><span class="line">      <span class="string">&#x27;l-white&#x27;</span>: <span class="string">&#x27;-10px 0 10px white&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>我们在src&#x2F;views&#x2F;main&#x2F;components&#x2F;navigation&#x2F;mobile&#x2F;ndex.vue中的ul下使用我们定义的组件，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--汉堡按钮--&gt;</span><br><span class="line">&lt;li class=&quot;fixed top-0 right-[-1px] h-4 px-1 flex items-center bg-white z-20 shadow-l-white&quot;&gt;</span><br><span class="line">  &lt;m-svg-icon class=&quot;w-1.5 h-1.5&quot; name=&quot;hamburger&quot;&gt;&lt;/m-svg-icon&gt;</span><br><span class="line">&lt;/li&gt;</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>另外我们在要使原有标签最后一个距离最右边有一定距离，在原有的基础上，class上加上最后一个样式</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;li v-for=&quot;item in data&quot; :key=&quot;item.id&quot; class=&quot;shrink-0 px-1.5 py-0.5 z-10 duration-200 last:mr-4&quot;&gt;&#123;&#123;item.name&#125;&#125;&lt;/li&gt;</span><br></pre></td></tr></table></figure>

<h2 id="5-6-vite处理svg矢量图"><a href="#5-6-vite处理svg矢量图" class="headerlink" title="5-6 vite处理svg矢量图"></a>5-6 vite处理svg矢量图</h2><p>无论是vue-cli 还是vite 默认他们都不会处理咱们主动导入的svg矢量图标，也就是说<strong>虽然我们把svg图标放入到了项目中，但是vite“无法使用”到它们</strong></p>
<p>那么怎么办呢？</p>
<p>此时我们就需要使用到一个 vite 的 plugin，vite-plugin-svg-icons</p>
<ol>
<li>安装vite-plugin-svg-icons 到项目中</li>
</ol>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm i fast-glob</span><br><span class="line">npm i --save-dev vite-plugin-svg-icons@<span class="number">2</span>.<span class="number">0</span>.<span class="number">1</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在vite.config.js中注册</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> path,&#123;join&#125; <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;createSvgIconsPlugin&#125; <span class="keyword">from</span> <span class="string">&#x27;vite-plugin-svg-icons&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// https://vitejs.dev/config/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="title function_">vue</span>(),</span><br><span class="line">    <span class="title function_">createSvgIconsPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">//指定需要缓存的图标文件夹</span></span><br><span class="line">      <span class="comment">//就是说process.cwd()返回的是当前Node.js进程执行时的工作目录</span></span><br><span class="line">      <span class="attr">iconDirs</span>:[path.<span class="title function_">resolve</span>(process.<span class="title function_">cwd</span>(),<span class="string">&#x27;src/assets/icons&#x27;</span>)],</span><br><span class="line">      <span class="comment">//指定symbolId格式，这的symbolId是与src/lib/svg-icon/index.vue中的symbolId对应const symbolId = computed(()=&gt;`#icon-$&#123;props.name&#125;`)</span></span><br><span class="line">      <span class="attr">symbolId</span>:<span class="string">&#x27;icon-[name]&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ],</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在main.js中注册svg-icons,由于createSvgIconsPlugin给我们生成的是虚拟地址，所以这里就引用一个虚拟地址</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注册svg-icons</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;virtual:svg-icons-register&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="5-7-移动端slider处理"><a href="#5-7-移动端slider处理" class="headerlink" title="5-7 移动端slider处理"></a>5-7 移动端slider处理</h2><p>那么处理好了以上内容之后，接下来我们来处理对应的slider 选中滑块。</p>
<p>对于选中滑块而言，我们想要处理分为两部分</p>
<ol>
<li>slider 滑块的本身样式</li>
<li>滑块切换时逻辑与滚动动画</li>
</ol>
<p><strong>slider 样式处理</strong></p>
<p>在 src&#x2F;views&#x2F;main&#x2F;components&#x2F;navigation&#x2F;mobile&#x2F;index.vue 中新增：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--滑块--&gt;</span><br><span class="line">&lt;li</span><br><span class="line">  ref=&quot;sliderTarget&quot;</span><br><span class="line">  :style=&quot;sliderStyle&quot;</span><br><span class="line">  class=&quot;absolute h-[22px] bg-zinc-900 rounded-lg duration-200&quot;</span><br><span class="line">&gt;</span><br><span class="line">&lt;/li&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">//滑块</span><br><span class="line">const sliderStyle =ref(&#123;</span><br><span class="line">  transform: &#x27;translateX(0px)&#x27;,</span><br><span class="line">  width: &#x27;60px&#x27;</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p><strong>处理切换逻辑</strong></p>
<p>当slider 进行切换时，它的当前位置就是通过translatex进行指定，也就是说我们只需要<strong>计算出当前点击的item位置与宽度即可</strong></p>
<p>那么想要达到这个目的，我们就需要具备以下内容：</p>
<ol>
<li>选中的 item T标：currentCategoryIndex</li>
<li>所有item元素：itemRefs</li>
<li>ul 的横向滚动偏离位置：ulScrollLeft</li>
<li>最后在 currentCategoryIndex 发生改变时，获取 item下标元素的left和width，计算 sliderStyle 即可</li>
</ol>
<hr>
<ol>
<li>首先给li标签增加一个ref</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;li</span><br><span class="line">  v-for=&quot;item in data&quot;</span><br><span class="line">  :key=&quot;item.id&quot;</span><br><span class="line">  class=&quot;shrink-0 px-1.5 py-0.5 z-10 duration-200 last:mr-4&quot;</span><br><span class="line">  :ref=&quot;setItemRef&quot;</span><br><span class="line">&gt;</span><br><span class="line">    &#123;&#123;item.name&#125;&#125;</span><br><span class="line">&lt;/li&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>选中的 item 下标：currentCategoryIndex</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//选中item下标</span></span><br><span class="line"><span class="keyword">const</span> currentCategoryIndex = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>所有item元素：itemRefs；通过1中绑定的函数，我们可以直接获取其中的所有的DOM元素，然后进行判断，如果有值就将他添加到数组里</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取所有的item元素</span></span><br><span class="line"><span class="keyword">let</span> itemRefs = []</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">setItemRef</span> = (<span class="params">el</span>) =&gt;&#123;</span><br><span class="line"><span class="keyword">if</span> (el)&#123;</span><br><span class="line">  itemRefs.<span class="title function_">push</span>(el)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>又因为setItemRef是每次DOM进行变化的时候都会执行一遍，这样的话每次只要改变一次数据，就会重复导入，所以我们新增一个监听函数，让他在每次DOM变化前将数组置空</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//数据改变之后，DOM变化之前</span><br><span class="line">onBeforeUpdate(() =&gt;&#123;</span><br><span class="line">  itemRefs = []</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>我们要拿到ul 的横向滚动偏离位置：ulScrollLeft，首先我们先获取ul元素，然后通过vueuse-&gt;useScroll获取响应式得scroll滚动距离。</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--先绑定一个ref--&gt;</span><br><span class="line">&lt;ul ref=&quot;ulTarget&quot;&gt;</span><br><span class="line">  </span><br><span class="line"> //获取ul元素</span><br><span class="line">const ulTarget = ref(null)</span><br><span class="line">//通过vueuse-&gt;useScroll获取响应式得scroll滚动距离</span><br><span class="line">const &#123;x: ulScrollLeft&#125; =useScroll(ulTarget)</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>最后在 currentCategoryIndex 发生改变时，获取 item下标元素的left和width，计算 sliderStyle</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//增加了一个index，又增加一个onItemClick方法</span><br><span class="line">&lt;li</span><br><span class="line">  v-for=&quot;(item,index) in data&quot;</span><br><span class="line">  :key=&quot;item.id&quot;</span><br><span class="line">  class=&quot;shrink-0 px-1.5 py-0.5 z-10 duration-200 last:mr-4&quot;</span><br><span class="line">  :ref=&quot;setItemRef&quot;</span><br><span class="line">  @click=&quot;onItemClick(index)&quot;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//item点击事件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onItemClick</span> =(<span class="params">index</span>)=&gt;&#123;</span><br><span class="line">  currentCategoryIndex.<span class="property">value</span> =index</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//watch监听</span></span><br><span class="line"><span class="title function_">watch</span>(currentCategoryIndex,<span class="function">(<span class="params">val</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; left,width &#125; = itemRefs[val].<span class="title function_">getBoundingClientRect</span>()</span><br><span class="line">  sliderStyle.<span class="property">value</span> = &#123;</span><br><span class="line">    <span class="comment">//滑块的位置= ul横向滚动的位置+当前元素的left-ul的padding</span></span><br><span class="line">    <span class="attr">transform</span>: <span class="string">`translateX(<span class="subst">$&#123;ulScrollLeft.value+left-<span class="number">10</span>&#125;</span>px)`</span>,</span><br><span class="line">    <span class="attr">width</span>: width+<span class="string">&#x27;px&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>最后给增加一个点击哪个标签哪个标签就显示高亮样式</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//增加一个：class</span><br><span class="line">&lt;li</span><br><span class="line">  v-for=&quot;(item,index) in data&quot;</span><br><span class="line">  :key=&quot;item.id&quot;</span><br><span class="line">  class=&quot;shrink-0 px-1.5 py-0.5 z-10 duration-200 last:mr-4&quot;</span><br><span class="line">  :class=&quot;&#123;</span><br><span class="line">    &#x27;text-zinc-100&#x27;: currentCategoryIndex === index</span><br><span class="line">  &#125;&quot;</span><br><span class="line">  :ref=&quot;setItemRef&quot;</span><br><span class="line">  @click=&quot;onItemClick(index)&quot;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<h2 id="5-8-补全category数据"><a href="#5-8-补全category数据" class="headerlink" title="5-8 补全category数据"></a>5-8 补全category数据</h2><ol>
<li>首先在常量模块src&#x2F;constants&#x2F;index.js中定义category的本地构建数据</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//category的本地构建数据</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">ALL_CATEGORY_ITEM</span> =&#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="string">&#x27;all&#x27;</span>,</span><br><span class="line">  <span class="attr">name</span>:<span class="string">&#x27;全部&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>我们在获取数据源的时候将这个直接插入到头部就可以,在navigation&#x2F;index.vue中</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//增加unshift方法</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getCategoryData</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;categorys&#125; = <span class="keyword">await</span> <span class="title function_">getCategory</span>()</span><br><span class="line">  categoryData.<span class="property">value</span> = categorys</span><br><span class="line">  categoryData.<span class="property">value</span>.<span class="title function_">unshift</span>(<span class="variable constant_">ALL_CATEGORY_ITEM</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>如果发现开始的滑块跟全部标签对不上那么就先修改navigation&#x2F;mobile&#x2F;index.vue的滑块样式</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//滑块</span></span><br><span class="line"><span class="keyword">const</span> sliderStyle =<span class="title function_">ref</span>(&#123;</span><br><span class="line">  <span class="attr">transform</span>: <span class="string">&#x27;translateX(0px)&#x27;</span>,</span><br><span class="line">  <span class="attr">width</span>: <span class="string">&#x27;60px&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="5-9-通用组件：弹出窗口-popup能力分析"><a href="#5-9-通用组件：弹出窗口-popup能力分析" class="headerlink" title="5-9 通用组件：弹出窗口-popup能力分析"></a>5-9 通用组件：弹出窗口-popup能力分析</h2><p>当我们点击<strong>面包屑按钮</strong>时，会有一个弹出窗口 popup 自低而上弹出，那么这样的一个功能，我们一样可以把它处理为项目的<strong>通用组件</strong></p>
<p>那么想要处理popup的话，首先就需要先搞清楚popup的能力。</p>
<ol>
<li>当popup展开时，内容视图应该不属于任何一个<strong>组件内部</strong>，而应该直接被插入到body下面</li>
<li>popup应该包含两部分内容，一部分为背景蒙版，一部分为内容的包裹容器</li>
<li>popup应该通过一个双向绑定进行控制展示和隐藏</li>
<li>popup 展示时，滚动应该被锁定</li>
<li>内容区域应该接收所有的 attrs，并且应该通过插槽让调用方指定其内容</li>
</ol>
<h2 id="5-9-通用组件：弹出窗口-popup-实现"><a href="#5-9-通用组件：弹出窗口-popup-实现" class="headerlink" title="5-9 通用组件：弹出窗口-popup 实现"></a>5-9 通用组件：弹出窗口-popup 实现</h2><ol>
<li>当popup展开时，内容视图应该不属于任何一个<strong>组件内部</strong>，而应该直接被插入到body下面。这里使用的就是vue3中的一个标签</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">  &lt;teleport to=&quot;body&quot;&gt;</span><br><span class="line">    &lt;!-- 蒙版--&gt;</span><br><span class="line">      &lt;div&gt;蒙版&lt;/div&gt;</span><br><span class="line">    &lt;!-- 内容--&gt;</span><br><span class="line">      &lt;div&gt;内容&lt;/div&gt;</span><br><span class="line">  &lt;/teleport&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>我们给蒙版和内容都增加过度和动画</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;teleport to=&quot;body&quot;&gt;</span><br><span class="line">  &lt;!-- 蒙版--&gt;</span><br><span class="line">  &lt;transition name=&quot;fade&quot;&gt;</span><br><span class="line">    &lt;div &gt;蒙版&lt;/div&gt;</span><br><span class="line">  &lt;/transition&gt;</span><br><span class="line">  &lt;!-- 内容--&gt;</span><br><span class="line">  &lt;transition name=&quot;popup-down-up&quot;&gt;</span><br><span class="line">    &lt;div&gt;内容&lt;/div&gt;</span><br><span class="line">  &lt;/transition&gt;</span><br><span class="line"></span><br><span class="line">&lt;/teleport&gt;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>我们定义蒙版和内容的过度和动画样式</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line">//fade动画</span><br><span class="line">.fade-enter-active,</span><br><span class="line">.fade-leave-active&#123;</span><br><span class="line">  transition: all 0.3s;</span><br><span class="line">&#125;</span><br><span class="line">//准备进入，离开完成</span><br><span class="line">.fade-enter-from,</span><br><span class="line">.fade-enter-to&#123;</span><br><span class="line">  opacity: 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.popup-down-up-enter-active,</span><br><span class="line">.popup-down-up-leave-active&#123;</span><br><span class="line">  transition: all 0.3s;</span><br><span class="line">&#125;</span><br><span class="line">.popup-down-up-enter-from,</span><br><span class="line">.popup-down-up-enter-to&#123;</span><br><span class="line">  transform: translateY(100%);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>给蒙版和内容绑定样式</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;teleport to=&quot;body&quot;&gt;</span><br><span class="line">  &lt;!-- 蒙版--&gt;</span><br><span class="line">  &lt;transition name=&quot;fade&quot;&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      class=&#x27;w-screen h-screen bg-zinc-900/80 z-40 fixed top-0 left-0&#x27;</span><br><span class="line">    &gt;&lt;/div&gt;</span><br><span class="line">  &lt;/transition&gt;</span><br><span class="line">  &lt;!-- 内容--&gt;</span><br><span class="line">  &lt;transition name=&quot;popup-down-up&quot;&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      v-bind=&quot;$attrs&quot;</span><br><span class="line">      class=&#x27;w-screen bg-white z-50 fixed bottom-0 &#x27;&gt;</span><br><span class="line">      &lt;slot/&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/transition&gt;</span><br><span class="line"></span><br><span class="line">&lt;/teleport&gt;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>popup通过一个双向绑定进行控制展示和隐藏</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> props = <span class="title function_">defineProps</span>(&#123;</span><br><span class="line">  <span class="attr">modelValue</span>:&#123;</span><br><span class="line">    <span class="attr">required</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">type</span>:<span class="title class_">Boolean</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> emits = <span class="title function_">defineEmits</span>([<span class="string">&#x27;update:modelValue&#x27;</span>])</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;teleport to=&quot;body&quot;&gt;</span><br><span class="line">  &lt;!-- 蒙版--&gt;</span><br><span class="line">  &lt;transition name=&quot;fade&quot;&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      v-if=&#x27;modelValue&#x27;</span><br><span class="line">      class=&#x27;w-screen h-screen bg-zinc-900/80 z-40 fixed top-0 left-0&#x27;</span><br><span class="line">      @click=&quot;emits(&#x27;update:modelValue&#x27;,false)&quot;</span><br><span class="line">    &gt;&lt;/div&gt;</span><br><span class="line">  &lt;/transition&gt;</span><br><span class="line">  &lt;!-- 内容--&gt;</span><br><span class="line">  &lt;transition name=&quot;popup-down-up&quot;&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      v-if=&#x27;modelValue&#x27;</span><br><span class="line">      v-bind=&quot;$attrs&quot;</span><br><span class="line">      class=&#x27;w-screen bg-white z-50 fixed bottom-0 &#x27;&gt;</span><br><span class="line">      &lt;slot/&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/transition&gt;</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>在lib&#x2F;index.js中定义组件，在第一步之后，并且插入到mobile&#x2F;index.vue的ul后面</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> popup <span class="keyword">from</span> <span class="string">&#x27;./popup/index.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">install</span>(<span class="params">app</span>)&#123;</span><br><span class="line">    app.<span class="title function_">component</span>(<span class="string">&#x27;m-popup&#x27;</span>,popup)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;m-popup&gt;&lt;/m-popup&gt;</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>在mobile&#x2F;index.vue中增加</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//控制popup展示</span></span><br><span class="line"><span class="keyword">const</span> isVisable = <span class="title function_">ref</span>(<span class="literal">false</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onShowPopup</span> =(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  isVisable.<span class="property">value</span>=<span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--汉堡按钮增加click--&gt;</span><br><span class="line">&lt;li</span><br><span class="line">  class=&quot;fixed top-0 right-[-1px] h-4 px-1 flex items-center bg-white z-20 shadow-l-white&quot;</span><br><span class="line">  @click=&#x27;onShowPopup&#x27;&gt;</span><br><span class="line">  &lt;m-svg-icon class=&quot;w-1.5 h-1.5&quot; name=&quot;hamburger&quot;&gt;&lt;/m-svg-icon&gt;</span><br><span class="line">&lt;/li&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">组件传值</span><br><span class="line">&lt;m-popup v-model=&#x27;isVisable&#x27;&gt;&lt;/m-popup&gt;</span><br></pre></td></tr></table></figure>

<ol start="8">
<li>popup 展示时，滚动应该被锁定</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useScrollLock&#125; <span class="keyword">from</span> <span class="string">&#x27;@vueuse/core&#x27;</span></span><br><span class="line"><span class="comment">//锁定滚动</span></span><br><span class="line"><span class="keyword">const</span> isLocked =<span class="title function_">useScrollLock</span>(<span class="variable language_">document</span>.<span class="property">body</span>)</span><br><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">  <span class="function">()=&gt;</span>props.<span class="property">modelValue</span>,</span><br><span class="line">  <span class="function">(<span class="params">val</span>)=&gt;</span>&#123;</span><br><span class="line">    isLocked.<span class="property">value</span> =val</span><br><span class="line">  &#125;,&#123;</span><br><span class="line">    <span class="attr">immediate</span>:<span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="5-10-组件间双向数据绑定功能优化"><a href="#5-10-组件间双向数据绑定功能优化" class="headerlink" title="5-10 组件间双向数据绑定功能优化"></a>5-10 组件间双向数据绑定功能优化</h2><p>这里我们使用useVModel，直接完成双向数据绑定。 props + emit -&gt; ref</p>
<ol>
<li>首先我们引入useVModel</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useVModel&#125; <span class="keyword">from</span> <span class="string">&#x27;@vueuse/core&#x27;</span></span><br><span class="line"><span class="comment">//是一个响应式数据，当isVisable值发生变化时，会自动触发emit修改modelValue</span></span><br><span class="line"><span class="keyword">const</span> isVisable = <span class="title function_">useVModel</span>(props)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>我们将使用modelValue全部换掉，蒙版的点击方法也换了</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;teleport to=&quot;body&quot;&gt;</span><br><span class="line">  &lt;!-- 蒙版--&gt;</span><br><span class="line">  &lt;transition name=&quot;fade&quot;&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      v-if=&#x27;isVisable&#x27;</span><br><span class="line">      class=&#x27;w-screen h-screen bg-zinc-900/80 z-40 fixed top-0 left-0&#x27;</span><br><span class="line">      @click=&quot;isVisable = false&quot;</span><br><span class="line">    &gt;&lt;/div&gt;</span><br><span class="line">  &lt;/transition&gt;</span><br><span class="line">  &lt;!-- 内容--&gt;</span><br><span class="line">  &lt;transition name=&quot;popup-down-up&quot;&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      v-if=&#x27;isVisable&#x27;</span><br><span class="line">      v-bind=&quot;$attrs&quot;</span><br><span class="line">      class=&#x27;w-screen bg-white z-50 fixed bottom-0 &#x27;&gt;</span><br><span class="line">      &lt;slot/&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;/transition&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">  isVisable,<span class="comment">//这也换了</span></span><br><span class="line">  <span class="function">(<span class="params">val</span>)=&gt;</span>&#123;</span><br><span class="line">    isLocked.<span class="property">value</span> =val</span><br><span class="line">  &#125;,&#123;</span><br><span class="line">    <span class="attr">immediate</span>:<span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="5-11-vite通用组件自动化注册"><a href="#5-11-vite通用组件自动化注册" class="headerlink" title="5-11 vite通用组件自动化注册"></a>5-11 vite通用组件自动化注册</h2><p>目前我们在项目中已经完成了两个通用组件，将来我们还会完成更多的通用组件开发。</p>
<p>那么如果每次开发完成一个通用组件之后，都去手动进行注册，未免有些过于麻烦了，所以我们期望通过vite 提供的功能，进行通用组件的自动化注册那么，如果想要完成这个功能的话，就需要使用到两个关键的知识点：</p>
<ol>
<li>vite的Glob 导入功能：该功能可以帮助我们在文件系统中导入多个模块</li>
<li>vue defineAsyncCommponent方法：该方法可以创建一个<strong>按需加载的异步组件</strong></li>
</ol>
<p>基于以上两个方法，实现组件<strong>自动注册</strong></p>
<p>在src&#x2F;libs&#x2F;index.js 中：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineAsyncComponent &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">install</span>(<span class="params">app</span>)&#123;</span><br><span class="line">    <span class="comment">//1.获取当前路径下的所有文件夹的index.vue</span></span><br><span class="line">    <span class="keyword">const</span> components = <span class="keyword">import</span>.<span class="property">meta</span>.<span class="title function_">glob</span>(<span class="string">&#x27;./*/index.vue&#x27;</span>)</span><br><span class="line">    <span class="comment">//2.遍历获取到的组件模块</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> [fullPath,fn] <span class="keyword">of</span> <span class="title class_">Object</span>.<span class="title function_">entries</span>(components))&#123;</span><br><span class="line">      <span class="keyword">const</span> componentName = <span class="string">&#x27;m-&#x27;</span>+fullPath.<span class="title function_">replace</span>(<span class="string">&#x27;./&#x27;</span>,<span class="string">&#x27;&#x27;</span>).<span class="title function_">split</span>(<span class="string">&#x27;/&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">      <span class="comment">//3.利用app.component进行注册</span></span><br><span class="line">      app.<span class="title function_">component</span>(componentName,<span class="title function_">defineAsyncComponent</span>(fn))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-12-业务组件：移动端弹层menu"><a href="#5-12-业务组件：移动端弹层menu" class="headerlink" title="5-12 业务组件：移动端弹层menu"></a>5-12 业务组件：移动端弹层menu</h2><ol>
<li>我们先新建&#x2F;views&#x2F;main&#x2F;components&#x2F;menu&#x2F;index.vue</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;div class=&#x27;py-2 h-[80vh] flex flex-col&#x27;&gt;</span><br><span class="line">  &lt;h2 class=&#x27;text-xl text-zinc-900 font-bold mb-2 px-1&#x27;&gt;</span><br><span class="line">    所有分类</span><br><span class="line">  &lt;/h2&gt;</span><br><span class="line">  &lt;ul class=&#x27;overflow-y-scroll&#x27;&gt;</span><br><span class="line">    &lt;li</span><br><span class="line">      v-for=&quot;(item,index)in categorys&quot;</span><br><span class="line">      :key=&quot;item.id&quot;</span><br><span class="line">      class=&quot;text-lg text-zinc-900 px-1 py-1.5</span><br><span class="line">      duration-100 active:bg-zinc-100&quot;</span><br><span class="line">      @click=&quot;$emit(&#x27;onItemClick&#x27;,index)&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &#123;&#123;item.name&#125;&#125;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">  &lt;/ul&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">//需要接收的数据</span><br><span class="line">defineProps(&#123;</span><br><span class="line">  categorys:&#123;</span><br><span class="line">    type:Array,</span><br><span class="line">    required:true</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">//推荐，所有事件都进行一个手动注册</span><br><span class="line">defineEmits([&#x27;onItemClick&#x27;])</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在&#x2F;views&#x2F;main&#x2F;components&#x2F;mobile&#x2F;index.vue中导入组件；然后使用组件（绑定需要传入的数据，并绑定1中的点击事件）</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">MenuVue</span> <span class="keyword">from</span> <span class="string">&#x27;@/views/main/components/menu/index.vue&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;m-popup v-model=&#x27;isVisable&#x27;&gt;</span><br><span class="line">  &lt;menu-vue :categorys=&quot;data&quot; @onItemClick=&quot;onItemClick&quot;&gt;&lt;/menu-vue&gt;</span><br><span class="line">&lt;/m-popup&gt;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>我们想当点击menu中数据的上面导航栏也跳转到相应的位置，并自动退出menu，只需要在点击事件下修改下可见值。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//item点击事件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onItemClick</span> =(<span class="params">index</span>)=&gt;&#123;</span><br><span class="line">  currentCategoryIndex.<span class="property">value</span> =index</span><br><span class="line">  isVisable.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-13-总结"><a href="#5-13-总结" class="headerlink" title="5-13 总结"></a>5-13 总结</h2><p>在本章中我们处理了<strong>移动端的navgationBar模块</strong>，在处理该模块的过程中，我们做了：</p>
<ol>
<li><p>自定义了两个通用组件，这两个组件都是将来可以被大家放入到中台组件库&#x2F;物料库中的：</p>
<ol>
<li>svg-icon</li>
<li>popup</li>
</ol>
</li>
<li><p>修正了rem值，对于移动端的rem处理目前可以根据设备的不同来自动修正</p>
</li>
<li><p>基于vite的svg矢量图导入和自动组件注册</p>
</li>
<li><p>介绍了vueuse中更多的功能方法</p>
</li>
</ol>
<h1 id="6、企业级通用业务Header处理方案——结合中台组件的业务组件处理"><a href="#6、企业级通用业务Header处理方案——结合中台组件的业务组件处理" class="headerlink" title="6、企业级通用业务Header处理方案——结合中台组件的业务组件处理"></a>6、企业级通用业务Header处理方案——结合中台组件的业务组件处理</h1><p>Header 模块是 PC 端业务中的高频功能，通用性极强。那么对于这样的功能大厂通常如何去进行处理呢？当它与中台组件库结合时，又会碰撞出什么样的火花呢？</p>
<hr>
<h2 id="6-1-处理PC端基础架构"><a href="#6-1-处理PC端基础架构" class="headerlink" title="6-1 处理PC端基础架构"></a>6-1 处理PC端基础架构</h2><p>PC端将具备两个路由的出口：</p>
<ol>
<li>一级路由出口：APP.vue中</li>
<li>二级路由出口：Main.vue中</li>
</ol>
<p>那么对于我们当前的代码而言，我们仅存在一个一级路由出口，所以接下来我们就需要处理二级路由出口</p>
<ol>
<li>创建 src&#x2F;views&#x2F;layout&#x2F;index.vue文件，表示一级路由出口对应的组件</li>
<li>在layout&#x2F;components 中分别创建三个业务组件：<ol>
<li>header&#x2F;index.vue：表示PC端头部区域</li>
<li>main.vue：二级路由出口</li>
<li>.floating：右下角悬浮区域</li>
</ol>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div&gt;header&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;main&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div &gt;floating&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在src&#x2F;views&#x2F;layout&#x2F;index.vue文件中，导入这三个组件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div class=&#x27;h-screen&#x27;&gt;</span><br><span class="line">  &lt;header-vue&gt;&lt;/header-vue&gt;</span><br><span class="line">  &lt;main-vue &gt;&lt;/main-vue&gt;</span><br><span class="line">  &lt;floating-vue&gt;&lt;/floating-vue&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import headerVue from &#x27;./components/header/index.vue&#x27;</span><br><span class="line">import mainVue from &#x27;./components/main.vue&#x27;</span><br><span class="line">import floatingVue from &#x27;./components/floating.vue&#x27;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>在router&#x2F;modules&#x2F;mobile-router增加路由</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> [&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;main&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>: <span class="function">()=&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/layout/index.vue&#x27;</span>),</span><br><span class="line">  <span class="attr">children</span>:[]</span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>手动设置页面布局，让头部高为72px，main为整个页面减去头部，悬浮框在右下角。<ol>
<li>首先在tailwind.config.js中增加高的样式</li>
<li>src&#x2F;views&#x2F;layout&#x2F;index.vue文件中使用</li>
<li>悬浮框就在layout&#x2F;components &#x2F;floating中设置</li>
</ol>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">theme</span>: &#123;</span><br><span class="line">  <span class="attr">extend</span>: &#123;</span><br><span class="line">    <span class="attr">height</span>:&#123;</span><br><span class="line">      <span class="attr">header</span>:<span class="string">&#x27;72px&#x27;</span>,</span><br><span class="line">      <span class="attr">main</span>:<span class="string">&#x27;calc(100vh-72px)&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div class=&#x27;h-screen&#x27;&gt;</span><br><span class="line">  &lt;header-vue class=&#x27;h-header&#x27;&gt;&lt;/header-vue&gt;</span><br><span class="line">  &lt;main-vue class=&#x27;h-main&#x27;&gt;&lt;/main-vue&gt;</span><br><span class="line">  &lt;floating-vue&gt;&lt;/floating-vue&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import headerVue from &#x27;./components/header/index.vue&#x27;</span><br><span class="line">import mainVue from &#x27;./components/main.vue&#x27;</span><br><span class="line">import floatingVue from &#x27;./components/floating.vue&#x27;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&#x27;fixed bottom-10 right-2&#x27;&gt;floating&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="6-2-PC端Header模块处理分析与简单实现"><a href="#6-2-PC端Header模块处理分析与简单实现" class="headerlink" title="6-2 PC端Header模块处理分析与简单实现"></a>6-2 PC端Header模块处理分析与简单实现</h2><p>我们在src&#x2F;views&#x2F;layout&#x2F;components&#x2F;header中建立三个模块分别是：</p>
<ol>
<li>header-search&#x2F;index.vue</li>
<li>header-my.vue</li>
<li>header-theme.vue</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;search&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;my&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;theme&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>然后在src&#x2F;views&#x2F;layout&#x2F;components&#x2F;header中进行使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&#x27;w-full bg-white border-b border-b-zinc-200</span><br><span class="line">  px-2 py-1&#x27;&gt;</span><br><span class="line">    &lt;div class=&#x27;flex items-center&#x27;&gt;</span><br><span class="line">      &lt;img</span><br><span class="line">        class=&#x27;h-4 cusor-pointer mr-2&#x27;</span><br><span class="line">        src=&quot;https://m.imooc.com/static/wap/static/common/img/logo-small@2x.png&quot;</span><br><span class="line">        @click=&#x27;onToHome&#x27;</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;header-search-vue class=&#x27;mr-1&#x27;&gt;&lt;/header-search-vue&gt;</span><br><span class="line">      &lt;header-theme-vue class=&#x27;mr-1&#x27;&gt;&lt;/header-theme-vue&gt;</span><br><span class="line">      &lt;header-my-vue&gt;&lt;/header-my-vue&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import headerSearchVue from &#x27;./header-search/index.vue&#x27;</span><br><span class="line">import headerThemeVue from &#x27;./header-theme.vue&#x27;</span><br><span class="line">import headerMyVue from &#x27;./header-my.vue&#x27;</span><br><span class="line">import &#123; useRouter &#125; from &#x27;vue-router&#x27;</span><br><span class="line"></span><br><span class="line">//router===this.$router</span><br><span class="line">const router = useRouter()</span><br><span class="line">const onToHome = () =&gt;&#123;</span><br><span class="line">  router.push(&#x27;/&#x27;)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="6-3-通用组件：search搜索框能力分析"><a href="#6-3-通用组件：search搜索框能力分析" class="headerlink" title="6-3 通用组件：search搜索框能力分析"></a>6-3 通用组件：search搜索框能力分析</h2><p>对于header 中的模块我们依次进行处理</p>
<p>search 部分为搜索框，对于该搜索框而言我们期望把它做成通用组件</p>
<p>那么既然是通用组件，我们就需要分析它的能力，它应该具备什么样的功能：</p>
<ol>
<li>输入内容实现双向数据绑定</li>
<li>鼠标移入与获取焦点时的动画</li>
<li>一键清空文本功能</li>
<li>搜索触发功能</li>
<li>可控制，可填充的下拉展示区</li>
<li>监听到以下事件列表：<ol>
<li>clear：删除所有文本事件</li>
<li>input：输入事件</li>
<li>focus：获取焦点事件</li>
<li>blur：失去焦点事件</li>
<li>search：触发搜索（点击或回车）事件</li>
</ol>
</li>
</ol>
<h2 id="6-4-通用组件：search搜索框样式处理"><a href="#6-4-通用组件：search搜索框样式处理" class="headerlink" title="6-4 通用组件：search搜索框样式处理"></a>6-4 通用组件：search搜索框样式处理</h2><ol>
<li>我们创建通用组件src&#x2F;lib&#x2F;search&#x2F;index.vue</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    class=&#x27;group relative p-0.5 rounded-xl border-white</span><br><span class="line">    duration-500 hover:bg-red-100/40&#x27;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;!--搜索图标--&gt;</span><br><span class="line">      &lt;m-svg-icon</span><br><span class="line">        class=&#x27;w-1.5 h-1.5 absolute translate-y-[-50%] top-[50%] left-2&#x27;</span><br><span class="line">        name=&quot;search&quot;</span><br><span class="line">        color=&quot;#70707&quot;</span><br><span class="line">      &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">      &lt;!--输入框--&gt;</span><br><span class="line">      &lt;input</span><br><span class="line">        class=&#x27;block w-full h-[44px] pl-4 outline-0</span><br><span class="line">        bg-zinc-100 caret-zinc-400 rounded-xl</span><br><span class="line">        text-zinc-900 tracking-wide text-sm font-semibold border</span><br><span class="line">        border-zinc-100 focus:border-red-300 group-hover:bg-white</span><br><span class="line">        group-hover:border-zinc-200&#x27;</span><br><span class="line">        type=&quot;text&quot;</span><br><span class="line">        placeholder=&quot;搜索&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;!--删除按钮--&gt;</span><br><span class="line">      &lt;m-svg-icon</span><br><span class="line">        name = &quot;input-delete&quot;</span><br><span class="line">        class=&#x27;w-1.5 h-1.5 absolute translate-y-[-50%] top-[50%] right-9</span><br><span class="line">        cursor-pointer duration-500&#x27;</span><br><span class="line">      &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">      &lt;!--分割线--&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class=&#x27;opacity-0 h-1.5 w-[1px] absolute translate-y-[-50%] top-[50%]</span><br><span class="line">        right-[62px] duration-500 bg-zinc-200 group-hover:opacity-100&#x27;</span><br><span class="line">      &gt;&lt;/div&gt;</span><br><span class="line">      &lt;!--TODO:搜索按钮（通用组件）--&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!--下拉区--&gt;</span><br><span class="line">    &lt;transition name=&#x27;slide&#x27;&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class=&#x27;max-h-[368px] w-full text-base overflow-auto bg-white</span><br><span class="line">        absolute z-20 left-0 top-[56px] p-2 rounded border border-zinc-200</span><br><span class="line">        duration-200 hover:shadow-2xl&#x27;</span><br><span class="line">      &gt;&lt;/div&gt;</span><br><span class="line">    &lt;/transition&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line">.slide-enter-active,</span><br><span class="line">.slide-leave-active&#123;</span><br><span class="line">  transition:all 0.5s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.slide-enter-from,</span><br><span class="line">.slide-leave-to&#123;</span><br><span class="line">  opacity: 0;</span><br><span class="line">  transform: translateY(40px);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>我们不需要在进行路由注册了，已经自动注册过了，直接使用就行，在views&#x2F;layout&#x2F;components&#x2F;header&#x2F;header-search&#x2F;index.vue</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;m-search&gt;&lt;/m-search&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="6-5-通用组件：button按钮能力分析"><a href="#6-5-通用组件：button按钮能力分析" class="headerlink" title="6-5 通用组件：button按钮能力分析"></a>6-5 通用组件：button按钮能力分析</h2><p>现在咱们的search 通用组件还差最后的一个<strong>按钮显示</strong></p>
<p>因为咱们在课程中会经常使用到各种各样的button按钮组件，所以说我们期望拥有一个button 按钮通用组件</p>
<p>那么对于这个按钮来说，我们期望拥有以下能力：</p>
<ol>
<li>可以显示文字按钮，并提供Loading功能</li>
<li>可以显示 icon按钮，并可以任意指定icon颜色</li>
<li>可开关的点击动画</li>
<li>可以指定各种风格和大小</li>
<li>当指定的风格或大小不符合预设时，需要给开发者以提示消息</li>
</ol>
<h2 id="6-6-通用组件：button按钮功能实现"><a href="#6-6-通用组件：button按钮功能实现" class="headerlink" title="6-6 通用组件：button按钮功能实现-"></a>6-6 通用组件：button按钮功能实现-</h2><ol>
<li>我们创建lib&#x2F;button&#x2F;index.vue</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;button</span><br><span class="line">    class=&#x27;text-xs text-center rounded duration-150 flex justify-center items-center&#x27;</span><br><span class="line">    :class=&quot;[</span><br><span class="line">      typeEnum[type],</span><br><span class="line">      sizeEnum[sizeKey].button,</span><br><span class="line">      &#123;</span><br><span class="line">        &#x27;active:scale-105&#x27;:isActiveAnim</span><br><span class="line">      &#125;</span><br><span class="line">    ]&quot;</span><br><span class="line">    @click.stop=&#x27;onBtnClick&#x27;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;!-- loading--&gt;</span><br><span class="line">    &lt;m-svg-icon</span><br><span class="line">      v-if=&#x27;loading&#x27;</span><br><span class="line">      name=&#x27;loading&#x27;</span><br><span class="line">      class=&#x27;w-2 h-2 animate-spin mr-1&#x27;</span><br><span class="line">    &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">    &lt;!-- icon按钮--&gt;</span><br><span class="line">    &lt;m-svg-icon</span><br><span class="line">      v-if=&#x27;icon&#x27;</span><br><span class="line">      :name=&#x27;icon&#x27;</span><br><span class="line">      class=&#x27;m-auto&#x27;</span><br><span class="line">      :class=&#x27;sizeEnum[sizeKey].icon&#x27;</span><br><span class="line">      :color=&#x27;iconColor&#x27;</span><br><span class="line">      :fillClass=&#x27;iconClass&#x27;</span><br><span class="line">    &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">    &lt;!-- icon按钮--&gt;</span><br><span class="line">    &lt;slot v-else/&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;!--1.构建 type风格可选项和size大小可选项--&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">const EMITS_CLICK=&#x27;click&#x27;</span><br><span class="line">//type可选项：表示按钮风格</span><br><span class="line">const typeEnum = &#123;</span><br><span class="line">  primary:&#x27;text-white bg-zinc-800 hover:bg-zinc-900 active:bg-zinc-800&#x27;,</span><br><span class="line">  main:&#x27;text-white bg-main hover:bg-hover-main active:bg-main&#x27;,</span><br><span class="line">  info:&#x27;text-zinc-800 bg-zinc-200 hover:bg-zinc-300 active:bg-zinc-200&#x27;</span><br><span class="line">&#125;</span><br><span class="line">//size可选项：表示按钮的大小。区分文字按钮和icon按钮</span><br><span class="line">const sizeEnum = &#123;</span><br><span class="line">  //文字按钮</span><br><span class="line">  default:&#123;</span><br><span class="line">    button:&#x27;w-8 h-4 text-sm&#x27;,</span><br><span class="line">    icon:&#x27;&#x27;</span><br><span class="line">  &#125;,</span><br><span class="line">  //icon按钮</span><br><span class="line">  &#x27;icon-default&#x27;:&#123;</span><br><span class="line">    button:&#x27;w-4 h-4&#x27;,</span><br><span class="line">    icon:&#x27;w-1.5 h-1.5&#x27;</span><br><span class="line">  &#125;,</span><br><span class="line">  small:&#123;</span><br><span class="line">    button:&#x27;w-7 h-3 text-base&#x27;,</span><br><span class="line">    icon:&#x27;&#x27;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#x27;icon-small&#x27;:&#123;</span><br><span class="line">    button:&#x27;w-3 h-3&#x27;,</span><br><span class="line">    icon:&#x27;w-1.5 h-1.5&#x27;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">/**</span><br><span class="line"> * 1.构建 type风格可选项和size大小可选项</span><br><span class="line"> 2.通过props让开发者控制按钮3.区分 icon button和 text button</span><br><span class="line"> 4.依据当前的数据，实现视图</span><br><span class="line"> 5.处理点击事件</span><br><span class="line"> */</span><br><span class="line">import &#123; computed &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">const props = defineProps(&#123;</span><br><span class="line">  //icon图标</span><br><span class="line">  icon:String,</span><br><span class="line">  //icon颜色</span><br><span class="line">  iconColor:String,</span><br><span class="line">  //icon图标类名（taliwind）</span><br><span class="line">  iconClass:String,</span><br><span class="line">  //按钮风格</span><br><span class="line">  type: &#123;</span><br><span class="line">    type: String,</span><br><span class="line">    default: &#x27;main&#x27;,</span><br><span class="line">    validator(val) &#123;</span><br><span class="line">      //1.获取所有的可选项</span><br><span class="line">      const keys = Object.keys(typeEnum)</span><br><span class="line">      //2.开发者这顶的风格在可选项中嘛</span><br><span class="line">      const result = keys.includes(val)</span><br><span class="line">      if (!result) &#123;</span><br><span class="line">        throw new Error(`你的type必须是$&#123;keys.join(&#x27;、&#x27;)&#125;中的一个`)</span><br><span class="line">      &#125;</span><br><span class="line">      return result</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">    //大小风格</span><br><span class="line">    size:&#123;</span><br><span class="line">      type:String,</span><br><span class="line">      default:&#x27;default&#x27;,</span><br><span class="line">      validator(val) &#123;</span><br><span class="line">        const keys = Object.keys(sizeEnum).filter((key)=&gt;</span><br><span class="line">        !key.includes(&#x27;icon&#x27;))</span><br><span class="line">        const result = keys.includes(val)</span><br><span class="line">        if (!result)&#123;</span><br><span class="line">          throw new Error(`你的size必须是$&#123;keys.join(&#x27;、&#x27;)&#125;中的一个`)</span><br><span class="line">        &#125;</span><br><span class="line">        return result</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  //按钮点击时，是否需要动画</span><br><span class="line">  isActiveAnim:&#123;</span><br><span class="line">    type:Boolean,</span><br><span class="line">    default:true</span><br><span class="line">  &#125;,</span><br><span class="line">  //加载状态</span><br><span class="line">  loading:&#123;</span><br><span class="line">    type:Boolean,</span><br><span class="line">    default:false</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">const emits = defineEmits([EMITS_CLICK])</span><br><span class="line">//props.size</span><br><span class="line">const sizeKey = computed(()=&gt;&#123;</span><br><span class="line">  return props.icon ? &#x27;icon-&#x27;+props.size :props.size</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 点击事件处理</span><br><span class="line"> */</span><br><span class="line">const onBtnClick=()=&gt;&#123;</span><br><span class="line">  if (props.loading) return</span><br><span class="line">  emits(EMITS_CLICK)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在tailwind.config.js中新增样式</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">colors</span>:&#123;</span><br><span class="line">  <span class="attr">main</span>:<span class="string">&#x27;#f44c58&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;hover-main&#x27;</span>:<span class="string">&#x27;$f32836&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3.在lib&#x2F;search&#x2F;index.vue中使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--TODO:搜索按钮（通用组件）--&gt;</span><br><span class="line">&lt;m-button</span><br><span class="line">  class=&#x27;absolute translate-y-[-50%] top-[50%] right-1 rounded-full&#x27;</span><br><span class="line">  icon=&#x27;search&#x27;</span><br><span class="line">  iconColor=&#x27;#ffffff&#x27;</span><br><span class="line">&gt;&lt;/m-button&gt;</span><br></pre></td></tr></table></figure>

<h2 id="6-7-通用组件：完善search基本能力"><a href="#6-7-通用组件：完善search基本能力" class="headerlink" title="6-7 通用组件：完善search基本能力"></a>6-7 通用组件：完善search基本能力</h2><ol>
<li>输入内容实现双向数据绑定，在lib&#x2F;search&#x2F;index.vue中进行，在输入框处进行绑定</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">EMIT_UPDATE_MODELVALUE</span> = <span class="string">&#x27;update:modelValue&#x27;</span></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">/**</span></span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"><span class="language-xml">   1.输入内容实现双向数据绑定</span></span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"><span class="language-xml">   2.搜索按钮在hover 是展示</span></span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"><span class="language-xml">   3.一键清空文本功能</span></span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"><span class="language-xml">   4.触发搜索</span></span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"><span class="language-xml">   5.控制下拉展示区的展示</span></span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"><span class="language-xml">   6.事件处理</span></span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"><span class="language-xml"> */</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; useVModel &#125; <span class="keyword">from</span> <span class="string">&#x27;@vueuse/core&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> props =<span class="title function_">defineProps</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">modelValue</span>:&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">required</span>:<span class="literal">true</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">type</span>:<span class="title class_">String</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="title function_">defineEmits</span>([<span class="variable constant_">EMIT_UPDATE_MODELVALUE</span>])</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> intputValue = <span class="title function_">useVModel</span>(props)</span></span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--输入框--&gt;</span><br><span class="line">&lt;input</span><br><span class="line">  class=&#x27;block w-full h-[44px] pl-4 outline-0</span><br><span class="line">  bg-zinc-100 caret-zinc-400 rounded-xl</span><br><span class="line">  text-zinc-900 tracking-wide text-sm font-semibold border</span><br><span class="line">  border-zinc-100 focus:border-red-300 group-hover:bg-white</span><br><span class="line">  group-hover:border-zinc-200&#x27;</span><br><span class="line">  type=&quot;text&quot;</span><br><span class="line">  placeholder=&quot;搜索&quot;</span><br><span class="line">  v-model=&#x27;intputValue&#x27;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>搜索按钮在hover 是展示 ，就是增加下搜索按钮的样式</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--TODO:搜索按钮（通用组件）--&gt;</span><br><span class="line">&lt;m-button</span><br><span class="line">  class=&#x27;opacity-0 absolute translate-y-[-50%] top-[50%] right-1 rounded-full duration-500 group-hover:opacity-100&#x27;</span><br><span class="line">  icon=&#x27;search&#x27;</span><br><span class="line">  iconColor=&#x27;#ffffff&#x27;</span><br><span class="line">&gt;&lt;/m-button&gt;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>一键清空文本功能，就是在删除按钮处增加一个显示条件，在绑定一个清空函数</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--删除按钮--&gt;</span><br><span class="line">&lt;m-svg-icon</span><br><span class="line">  v-show=&#x27;intputValue&#x27;</span><br><span class="line">  name = &quot;input-delete&quot;</span><br><span class="line">  class=&#x27;w-1.5 h-1.5 absolute translate-y-[-50%] top-[50%] right-9</span><br><span class="line">  cursor-pointer duration-500&#x27;</span><br><span class="line">  @click=&#x27;onClearClick&#x27;</span><br><span class="line">&gt;&lt;/m-svg-icon&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 删除文本</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onClearClick</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  intputValue.<span class="property">value</span>=<span class="string">&#x27;&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>触发搜索 ，我们首先在搜索按钮增加点击事件，在文本框增加回车事件，然后注册一个emits，最后写一个搜索事件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--TODO:搜索按钮（通用组件）--&gt;</span><br><span class="line">&lt;m-button</span><br><span class="line">  class=&#x27;opacity-0 absolute translate-y-[-50%] top-[50%] right-1 rounded-full duration-500 group-hover:opacity-100&#x27;</span><br><span class="line">  icon=&#x27;search&#x27;</span><br><span class="line">  iconColor=&#x27;#ffffff&#x27;</span><br><span class="line">  @click=&#x27;onSearchHandler&#x27;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--输入框--&gt;</span><br><span class="line">&lt;input</span><br><span class="line">  class=&#x27;block w-full h-[44px] pl-4 outline-0</span><br><span class="line">  bg-zinc-100 caret-zinc-400 rounded-xl</span><br><span class="line">  text-zinc-900 tracking-wide text-sm font-semibold border</span><br><span class="line">  border-zinc-100 focus:border-red-300 group-hover:bg-white</span><br><span class="line">  group-hover:border-zinc-200&#x27;</span><br><span class="line">  type=&quot;text&quot;</span><br><span class="line">  placeholder=&quot;搜索&quot;</span><br><span class="line">  v-model=&#x27;intputValue&#x27;</span><br><span class="line">  @keyup.enter=&#x27;onSearchHandler&#x27;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">EMIT_SEARCH</span> = <span class="string">&#x27;search&#x27;</span></span><br><span class="line"><span class="keyword">const</span> emits = <span class="title function_">defineEmits</span>([<span class="variable constant_">EMIT_UPDATE_MODELVALUE</span>,<span class="variable constant_">EMIT_SEARCH</span>])</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 搜索</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onSearchHandler</span> = (<span class="params"></span>) =&gt;&#123;</span><br><span class="line">  <span class="title function_">emits</span>(<span class="variable constant_">EMIT_SEARCH</span>,intputValue.<span class="property">value</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;search&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>控制下拉展示区的展示</li>
</ol>
<ul>
<li>首先我们先给下拉框设置一个什么时候显示，什么情况下显示</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;transition name=&#x27;slide&#x27;&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    v-if=&#x27;$slots.dropdown&#x27;</span><br><span class="line">    v-show=&#x27;isFocus&#x27;</span><br><span class="line">    class=&#x27;max-h-[368px] w-full text-base overflow-auto bg-white</span><br><span class="line">    absolute z-20 left-0 top-[56px] p-2 rounded border border-zinc-200</span><br><span class="line">    duration-200 hover:shadow-2xl&#x27;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;slot name=&#x27;dropdown&#x27;/&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/transition&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>然后我们在header&#x2F;header-search&#x2F;index.vue中进行使用这个插槽</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;m-search v-model=&#x27;inputValue&#x27;&gt;</span><br><span class="line">      &lt;template #dropdown&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          dropdown</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/m-search&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">const inputValue = ref(&#x27;&#x27;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>其次我们给输入框设置获取焦点的函数</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--输入框--&gt;</span><br><span class="line">&lt;input</span><br><span class="line">  class=&#x27;block w-full h-[44px] pl-4 outline-0</span><br><span class="line">  bg-zinc-100 caret-zinc-400 rounded-xl</span><br><span class="line">  text-zinc-900 tracking-wide text-sm font-semibold border</span><br><span class="line">  border-zinc-100 focus:border-red-300 group-hover:bg-white</span><br><span class="line">  group-hover:border-zinc-200&#x27;</span><br><span class="line">  type=&quot;text&quot;</span><br><span class="line">  placeholder=&quot;搜索&quot;</span><br><span class="line">  v-model=&#x27;intputValue&#x27;</span><br><span class="line">  @keyup.enter=&#x27;onSearchHandler&#x27;</span><br><span class="line">  @focus=&#x27;onFocusHandler&#x27;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>下面对获取焦点函数进行定义</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//input 是否获取焦点</span></span><br><span class="line"><span class="keyword">const</span> isFocus = <span class="title function_">ref</span>(<span class="literal">false</span>)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取到焦点</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onFocusHandler</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  isFocus.<span class="property">value</span> =<span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>然后我们想让下拉框点击外面的时候进行隐藏这时我们使用vue自带的onClickOutside，现在开头进行</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;div</span><br><span class="line">  class=&#x27;group relative p-0.5 rounded-xl border-white</span><br><span class="line">  duration-500 hover:bg-red-100/40&#x27;</span><br><span class="line">  ref=&#x27;containerTarge&#x27;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> containerTarge = <span class="title function_">ref</span>(<span class="literal">null</span>)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 点击containerTarge区域外隐藏dropdown</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">onClickOutside</span>(containerTarge,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  isFocus.<span class="property">value</span>=<span class="literal">false</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>事件处理</li>
</ol>
<ul>
<li>先定义这些事件</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//删除所有文本</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">EMIT_CLEAR</span> = <span class="string">&#x27;clear&#x27;</span></span><br><span class="line"><span class="comment">//输入事件</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">EMIT_INPUT</span> = <span class="string">&#x27;input&#x27;</span></span><br><span class="line"><span class="comment">//获取焦点</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">EMIT_FOCUS</span> = <span class="string">&#x27;focus&#x27;</span></span><br><span class="line"><span class="comment">//失去焦点</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">EMIT_BULR</span> = <span class="string">&#x27;blur&#x27;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>然后将这些事件进行注册</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> emits = <span class="title function_">defineEmits</span>([</span><br><span class="line">  <span class="variable constant_">EMIT_UPDATE_MODELVALUE</span>,</span><br><span class="line">  <span class="variable constant_">EMIT_SEARCH</span>,</span><br><span class="line">  <span class="variable constant_">EMIT_CLEAR</span>,</span><br><span class="line">  <span class="variable constant_">EMIT_INPUT</span>,</span><br><span class="line">  <span class="variable constant_">EMIT_FOCUS</span>,</span><br><span class="line">  <span class="variable constant_">EMIT_BULR</span></span><br><span class="line">])</span><br></pre></td></tr></table></figure>

<ul>
<li>使用这些事件，记得输入框绑定失去焦点事件</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 监听用户输入行为</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">watch</span>(intputValue,<span class="function">(<span class="params">val</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="title function_">emits</span>(<span class="variable constant_">EMIT_INPUT</span>,val)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 删除文本</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onClearClick</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  intputValue.<span class="property">value</span>=<span class="string">&#x27;&#x27;</span></span><br><span class="line">  <span class="title function_">emits</span>(<span class="variable constant_">EMIT_CLEAR</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 搜索</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onSearchHandler</span> = (<span class="params"></span>) =&gt;&#123;</span><br><span class="line">  <span class="title function_">emits</span>(<span class="variable constant_">EMIT_SEARCH</span>,intputValue.<span class="property">value</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> * 获取到焦点</span><br><span class="line"> */</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onFocusHandler</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  isFocus.<span class="property">value</span> =<span class="literal">true</span></span><br><span class="line">  <span class="title function_">emits</span>(<span class="variable constant_">EMIT_FOCUS</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 失去焦点</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onBlurHandler</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  <span class="title function_">emits</span>(<span class="variable constant_">EMIT_BULR</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--输入框--&gt;</span><br><span class="line">&lt;input</span><br><span class="line">  class=&#x27;block w-full h-[44px] pl-4 outline-0</span><br><span class="line">  bg-zinc-100 caret-zinc-400 rounded-xl</span><br><span class="line">  text-zinc-900 tracking-wide text-sm font-semibold border</span><br><span class="line">  border-zinc-100 focus:border-red-300 group-hover:bg-white</span><br><span class="line">  group-hover:border-zinc-200&#x27;</span><br><span class="line">  type=&quot;text&quot;</span><br><span class="line">  placeholder=&quot;搜索&quot;</span><br><span class="line">  v-model=&#x27;intputValue&#x27;</span><br><span class="line">  @keyup.enter=&#x27;onSearchHandler&#x27;</span><br><span class="line">  @focus=&#x27;onFocusHandler&#x27;</span><br><span class="line">  @blur=&#x27;onBlurHandler&#x27;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>

<h2 id="6-8-通用组件：popover气泡卡片能力分析"><a href="#6-8-通用组件：popover气泡卡片能力分析" class="headerlink" title="6-8 通用组件：popover气泡卡片能力分析"></a>6-8 通用组件：popover气泡卡片能力分析</h2><ol>
<li>提供两个插槽</li>
</ol>
<ul>
<li>具名插槽：<strong>触发弹层的视图</strong></li>
<li>匿名插槽：<strong>弹出层视图中展示的内容</strong></li>
</ul>
<ol start="2">
<li>控制弹出层的位置，我们期望可以具备以下位置弹出：<ul>
<li>左上</li>
<li>右上</li>
<li>左下</li>
<li>右下</li>
</ul>
</li>
</ol>
<h2 id="6-9-通用组件：popover气泡卡片基础功能实现"><a href="#6-9-通用组件：popover气泡卡片基础功能实现" class="headerlink" title="6-9 通用组件：popover气泡卡片基础功能实现"></a>6-9 通用组件：popover气泡卡片基础功能实现</h2><ol>
<li>我们在lib中创建组件popover&#x2F;index.vue</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div class=&#x27;relative&#x27; @mouseenter=&#x27;onMouseenter&#x27;</span><br><span class="line">@mouseleave=&#x27;onMouseleave&#x27;&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">&lt;!--    具名插槽：触发弹层的视图--&gt;</span><br><span class="line">    &lt;slot name=&#x27;reference&#x27;/&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;!--  气泡展示--&gt;</span><br><span class="line">  &lt;transition name=&#x27;slide&#x27;&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      v-show=&#x27;isVisable&#x27;</span><br><span class="line">      class=&#x27;absolute p-1 z-20 bg-white border rounded-md&#x27;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;!--    匿名插槽:弹出层视图中展示的内容--&gt;</span><br><span class="line">      &lt;slot/&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/transition&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">const isVisable = ref(false)</span><br><span class="line">/**</span><br><span class="line"> * 鼠标移入触发</span><br><span class="line"> */</span><br><span class="line">const onMouseenter = () =&gt;&#123;</span><br><span class="line">  isVisable.value=true</span><br><span class="line">&#125;</span><br><span class="line">/**</span><br><span class="line"> * 鼠标移出触发</span><br><span class="line"> */</span><br><span class="line">const onMouseleave = () =&gt;&#123;</span><br><span class="line">  isVisable.value=false</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line">.slide-enter-active,</span><br><span class="line">.slide-leave-active&#123;</span><br><span class="line">  transition:opacity 0.3s,transform 0.3s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.slide-enter-from,</span><br><span class="line">.slide-leave-to&#123;</span><br><span class="line">  opacity: 0;</span><br><span class="line">  transform: translateY(20px);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>我们在src&#x2F;constants&#x2F;index.js中定义常量</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//极简白</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">THEME_LIGHT</span> =<span class="string">&#x27;THEME_LIGHT&#x27;</span></span><br><span class="line"><span class="comment">//极夜黑</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">THEME_DARK</span> = <span class="string">&#x27;THEME_DARK&#x27;</span></span><br><span class="line"><span class="comment">//跟随系统</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">THEME_SYSTEM</span> = <span class="string">&#x27;THEME_SYSTEM&#x27;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在views&#x2F;layout&#x2F;components&#x2F;header&#x2F;header-theme.vue中使用</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;m-popover&gt;</span><br><span class="line">    &lt;!--具名插槽：触发弹层的视图--&gt;</span><br><span class="line">    &lt;template #reference&gt;</span><br><span class="line">      &lt;m-svg-icon</span><br><span class="line">        name=&#x27;theme-light&#x27;</span><br><span class="line">        class=&#x27;w-4 h-4 p-1 cursor-pointer rounded-sm duration-200</span><br><span class="line">        outline-none hover:bg-zinc-100/60&#x27;</span><br><span class="line">        fillClass=&#x27;fill-zinc-900&#x27;</span><br><span class="line">      &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">      &lt;!--    匿名插槽:弹出层视图中展示的内容--&gt;</span><br><span class="line">      &lt;div class=&#x27;w-[140px] overflow-hidden&#x27;&gt;</span><br><span class="line">        &lt;div</span><br><span class="line">          class=&#x27;flex item-center p-1 cursor-pointer rounded hover:bg-zinc-100/60&#x27;</span><br><span class="line">          v-for=&#x27;item in themeArr&#x27;</span><br><span class="line">          :key=&#x27;item.id&#x27;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;m-svg-icon</span><br><span class="line">            :name=&#x27;item.icon&#x27;</span><br><span class="line">            class=&#x27;w-1.5 h-1.5 mr-1&#x27;</span><br><span class="line">            fillClass=&#x27;fill-zinc-900&#x27;</span><br><span class="line">          &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">          &lt;span class=&#x27;text-zinc-900 text-sm&#x27;&gt;&#123;&#123; item.name &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/m-popover&gt;</span><br><span class="line"></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123;THEME_LIGHT,THEME_DARK,THEME_SYSTEM&#125; from &#x27;@/constants&#x27;</span><br><span class="line">const themeArr = [</span><br><span class="line">  &#123;</span><br><span class="line">    id:&#x27;0&#x27;,</span><br><span class="line">    type:THEME_LIGHT,</span><br><span class="line">    icon:&#x27;theme-light&#x27;,</span><br><span class="line">    name:&#x27;极简白&#x27;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    id:&#x27;1&#x27;,</span><br><span class="line">    type:THEME_DARK,</span><br><span class="line">    icon:&#x27;theme-dark&#x27;,</span><br><span class="line">    name:&#x27;极夜黑&#x27;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    id:&#x27;2&#x27;,</span><br><span class="line">    type:THEME_SYSTEM,</span><br><span class="line">    icon:&#x27;theme-system&#x27;,</span><br><span class="line">    name:&#x27;跟随系统&#x27;</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="6-10-通用组件：popover功能延伸，控制气泡展示位置"><a href="#6-10-通用组件：popover功能延伸，控制气泡展示位置" class="headerlink" title="6-10 通用组件：popover功能延伸，控制气泡展示位置"></a>6-10 通用组件：popover功能延伸，控制气泡展示位置</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> 1.指定所有可选位置的常量，并生成enum</span><br><span class="line"> 2.通过prop控制指定位置</span><br><span class="line"> 3.获取元素的DOM。创建读取元素尺寸的方法</span><br><span class="line"> 4.生成气泡的样式对象，用来控制每个位置对应的样式</span><br><span class="line"> 5.根据prop，计算样式对象</span><br><span class="line"> */</span><br></pre></td></tr></table></figure>

<ol>
<li>指定所有可选位置的常量，并生成enum,在lib&#x2F;popover&#x2F;index.vue</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="comment">//左上</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PROP_TOP_LEFT</span> = <span class="string">&#x27;top-left&#x27;</span></span><br><span class="line"><span class="comment">//右上</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PROP_TOP_RIGHT</span> = <span class="string">&#x27;top-right&#x27;</span></span><br><span class="line"><span class="comment">//左下</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PROP_BOTTOM_LEFT</span> = <span class="string">&#x27;bottom-left&#x27;</span></span><br><span class="line"><span class="comment">//右下</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PROP_BOTTOM_RIGHT</span> = <span class="string">&#x27;bottom-right&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> placementEnum=[</span><br><span class="line">  <span class="variable constant_">PROP_TOP_LEFT</span>,</span><br><span class="line">  <span class="variable constant_">PROP_TOP_RIGHT</span>,</span><br><span class="line">  <span class="variable constant_">PROP_BOTTOM_LEFT</span>,</span><br><span class="line">  <span class="variable constant_">PROP_BOTTOM_RIGHT</span></span><br><span class="line">  ]</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>通过prop控制指定位置</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">defineProps</span>(&#123;</span><br><span class="line">  <span class="comment">//控制气泡弹出位置，给出开发者错误提示</span></span><br><span class="line">  <span class="attr">placement</span>:&#123;</span><br><span class="line">    <span class="attr">type</span>:<span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">default</span>:<span class="variable constant_">PROP_BOTTOM_LEFT</span>,</span><br><span class="line">    <span class="title function_">validator</span>(<span class="params">val</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> result = placementEnum.<span class="title function_">includes</span>(val)</span><br><span class="line">      <span class="keyword">if</span> (!result)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`你的placement必须是<span class="subst">$&#123;placementEnum.join(<span class="string">&#x27;、&#x27;</span>)&#125;</span>中的一个`</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> result</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>获取元素的DOM。创建读取元素尺寸的方法,获取dom先在两个插槽设置ref</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> &lt;div ref=&#x27;referenceTarget&#x27;&gt;</span><br><span class="line">&lt;!--    具名插槽：触发弹层的视图--&gt;</span><br><span class="line">    &lt;slot name=&#x27;reference&#x27;/&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  </span><br><span class="line">   &lt;div</span><br><span class="line">      ref=&#x27;contentTarget&#x27;</span><br><span class="line">      v-show=&#x27;isVisable&#x27;</span><br><span class="line">      class=&#x27;absolute p-1 z-20 bg-white border rounded-md&#x27;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;!--    匿名插槽:弹出层视图中展示的内容--&gt;</span><br><span class="line">      &lt;slot/&gt;</span><br><span class="line">    &lt;/div&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 计算元素的尺寸</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> referenceTarget = <span class="title function_">ref</span>(<span class="literal">null</span>)</span><br><span class="line"><span class="keyword">const</span> contentTarget = <span class="title function_">ref</span>(<span class="literal">null</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useElementSize</span> = (<span class="params">target</span>) =&gt;&#123;</span><br><span class="line">  <span class="keyword">if</span>(!target) <span class="keyword">return</span> &#123;&#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">width</span>:target.<span class="property">offsetWidth</span>,</span><br><span class="line">    <span class="attr">height</span>:target.<span class="property">offsetHeight</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>生成气泡样式，然后绑定使用</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 气泡样式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> contentStyle = <span class="title function_">ref</span>(&#123;</span><br><span class="line">  <span class="attr">top</span>:<span class="number">0</span>,</span><br><span class="line">  <span class="attr">left</span>:<span class="number">0</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;div</span><br><span class="line">  ref=&#x27;contentTarget&#x27;</span><br><span class="line">  v-show=&#x27;isVisable&#x27;</span><br><span class="line">  class=&#x27;absolute p-1 z-20 bg-white border rounded-md&#x27;</span><br><span class="line">  :style=&#x27;contentStyle&#x27;</span><br><span class="line">&gt;</span><br><span class="line">  &lt;!--    匿名插槽:弹出层视图中展示的内容--&gt;</span><br><span class="line">  &lt;slot/&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>根据prop，计算样式对象，然后在header-theme中组件使用</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//计算：期望气泡展示的时候再进行计算</span></span><br><span class="line"><span class="title function_">watch</span>(isVisable,<span class="function">(<span class="params">val</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!val) <span class="keyword">return</span></span><br><span class="line">  <span class="comment">//等待元素渲染</span></span><br><span class="line">  <span class="comment">//vue在数据改变之后，需要等待一段时间Dom才会变化，所以我们可以通过nextTick函数的参数，来监听DOM变化之后的回调</span></span><br><span class="line">  <span class="title function_">nextTick</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (props.<span class="property">placement</span>)&#123;</span><br><span class="line">      <span class="comment">//左上</span></span><br><span class="line">        <span class="keyword">case</span> <span class="attr">PROP_TOP_LEFT</span>:</span><br><span class="line">          contentStyle.<span class="property">value</span>.<span class="property">top</span> = <span class="number">0</span></span><br><span class="line">          contentStyle.<span class="property">value</span>.<span class="property">left</span> = -<span class="title function_">useElementSize</span>(contentTarget).<span class="property">width</span>+<span class="string">&#x27;px&#x27;</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="comment">//右上</span></span><br><span class="line">      <span class="keyword">case</span> <span class="attr">PROP_TOP_RIGHT</span>:</span><br><span class="line">        contentStyle.<span class="property">value</span>.<span class="property">top</span> = <span class="number">0</span></span><br><span class="line">        contentStyle.<span class="property">value</span>.<span class="property">left</span> = <span class="title function_">useElementSize</span>(referenceTarget).<span class="property">width</span>+<span class="string">&#x27;px&#x27;</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="comment">//左下</span></span><br><span class="line">      <span class="keyword">case</span> <span class="attr">PROP_BOTTOM_LEFT</span>:</span><br><span class="line">        contentStyle.<span class="property">value</span>.<span class="property">top</span> = <span class="title function_">useElementSize</span>(referenceTarget).<span class="property">height</span>+<span class="string">&#x27;px&#x27;</span></span><br><span class="line">        contentStyle.<span class="property">value</span>.<span class="property">left</span> = <span class="title function_">useElementSize</span>(contentTarget).<span class="property">width</span>+<span class="string">&#x27;px&#x27;</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="comment">//右下</span></span><br><span class="line">      <span class="keyword">case</span> <span class="attr">PROP_BOTTOM_RIGHT</span>:</span><br><span class="line">        contentStyle.<span class="property">value</span>.<span class="property">top</span> = <span class="title function_">useElementSize</span>(referenceTarget).<span class="property">height</span>+<span class="string">&#x27;px&#x27;</span></span><br><span class="line">        contentStyle.<span class="property">value</span>.<span class="property">left</span> = <span class="title function_">useElementSize</span>(referenceTarget).<span class="property">width</span>+<span class="string">&#x27;px&#x27;</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;m-popover placement=&#x27;bottom-left&#x27;&gt;&lt;/m-popover&gt;</span><br></pre></td></tr></table></figure>

<h2 id="6-11-通用组件：处理慢速移动时，气泡消失问题"><a href="#6-11-通用组件：处理慢速移动时，气泡消失问题" class="headerlink" title="6-11 通用组件：处理慢速移动时，气泡消失问题"></a>6-11 通用组件：处理慢速移动时，气泡消失问题</h2><p>想要处理这个问题，那么我们首先需要明白，为什么气泡会消失。</p>
<p>其实这个问题非常简单，因为在reference与气泡之间存在间隙，当鼠标移动到这个间隙处时，就会触发mouseleave 鼠标移出事件，那么此时 isVisable 就会变为false。</p>
<p>那么这样的原因分析出来之后，我们又应该如何解决这个问题呢？</p>
<p>想要解决这个问题，我们可以利用类似于防抖（debounce）的概念。</p>
<p>也就是：<strong>鼠标刚离开时，不去立刻修改 isVisable，而是延迟一段时间，如果在这段时间之内，再次触发了鼠标移入时间，则不再修改isViable</strong>以此来解决慢速移动的问题。</p>
<p>那么明确好了处理方案，接下来我们就实现这个功能：修改lib&#x2F;popover&#x2F;index.vue</p>
<ol>
<li>定义延迟关闭时长</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//延迟关闭时间</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">DELAY_TIME</span> = <span class="number">100</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>修改鼠标移入和移出的方法</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> timeout</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 鼠标移入触发</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onMouseenter</span> = (<span class="params"></span>) =&gt;&#123;</span><br><span class="line">  isVisable.<span class="property">value</span>=<span class="literal">true</span></span><br><span class="line">  <span class="keyword">if</span> (timeout)&#123;</span><br><span class="line">    <span class="built_in">clearTimeout</span>(timeout)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 鼠标移出触发</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onMouseleave</span> = (<span class="params"></span>) =&gt;&#123;</span><br><span class="line">timeout = <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  isVisable.<span class="property">value</span>=<span class="literal">false</span></span><br><span class="line">  timeout = <span class="literal">null</span></span><br><span class="line">&#125;,<span class="variable constant_">DELAY_TIME</span>)</span><br></pre></td></tr></table></figure>

<h2 id="6-12-基于popover处理用户模块"><a href="#6-12-基于popover处理用户模块" class="headerlink" title="6-12 基于popover处理用户模块"></a>6-12 基于popover处理用户模块</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;m-popover class=&#x27;flex items-center&#x27; placement=&#x27;bottom-left&#x27;&gt;</span><br><span class="line">    &lt;template #reference&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class=&#x27;relative flex items-center p-0.5 rounded-sm</span><br><span class="line">        cursor-pointer duration-200 outline-none</span><br><span class="line">        hover:bg-zinc-100&#x27;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;!--头像--&gt;</span><br><span class="line">        &lt;img</span><br><span class="line">          class=&#x27;w-3 h-3 rounded-sm&#x27;</span><br><span class="line">          src=&#x27;  https://w.wallhaven.cc/full/rd/wallhaven-rdwjj7.jpg&#x27;</span><br><span class="line">        /&gt;</span><br><span class="line">&lt;!--        下箭头--&gt;</span><br><span class="line">        &lt;m-svg-icon</span><br><span class="line">          class=&#x27;h-1.5 w-1.5 ml-0.5&#x27;</span><br><span class="line">          name=&#x27;down-arrow&#x27;</span><br><span class="line">          fillClass=&#x27;fill-zinc-900&#x27;</span><br><span class="line">        &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">&lt;!--        VIP--&gt;</span><br><span class="line">        &lt;m-svg-icon</span><br><span class="line">          class=&#x27;h-1.5 w-1.5 absolute right-[16px] bottom-0&#x27;</span><br><span class="line">          name = &#x27;vip&#x27;</span><br><span class="line">        &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">&lt;!--气泡--&gt;</span><br><span class="line">    &lt;div class=&#x27;w-[140px] overflow-hidden&#x27;&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class=&#x27;flex items-center p-1 cursor-pointer rounded hover:bg-zinc-100/60&#x27;</span><br><span class="line">        v-for=&#x27;item in menuArr&#x27;</span><br><span class="line">        :key=&#x27;item.id&#x27;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;m-svg-icon</span><br><span class="line">          :name=&#x27;item.icon&#x27;</span><br><span class="line">          class=&#x27;w-1.5 h-1.5 mr-1&#x27;</span><br><span class="line">          fillClass=&#x27;fill-zinc-900&#x27;</span><br><span class="line">        &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">        &lt;span class=&#x27;text-zinc-800 text-sm&#x27; &gt;&#123;&#123;item.title&#125;&#125;&lt;/span&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/m-popover&gt;</span><br><span class="line"></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">//构建数据源</span><br><span class="line">const menuArr =[</span><br><span class="line">  &#123;</span><br><span class="line">    id:0,</span><br><span class="line">    title:&#x27;个人资料&#x27;,</span><br><span class="line">    icon:&#x27;profile&#x27;,</span><br><span class="line">    path:&#x27;/profile&#x27;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    id:1,</span><br><span class="line">    title:&#x27;升级VIP&#x27;,</span><br><span class="line">    icon:&#x27;vip-profile&#x27;,</span><br><span class="line">    path:&#x27;/memeber&#x27;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    id:2,</span><br><span class="line">    title:&#x27;退出登陆&#x27;,</span><br><span class="line">    icon:&#x27;logout&#x27;,</span><br><span class="line">    path:&#x27;&#x27;</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h1 id="7、企业级复杂前中台项目响应式处理方案-——-一套代码多端共用"><a href="#7、企业级复杂前中台项目响应式处理方案-——-一套代码多端共用" class="headerlink" title="7、企业级复杂前中台项目响应式处理方案 —— 一套代码多端共用"></a>7、企业级复杂前中台项目响应式处理方案 —— 一套代码多端共用</h1><p>一种样式可以同时适配移动端和PC端，这样的功能我们通常称之为响应式。但是咱们的项目是一个复杂的前中台系统，在这样的系统中，我们又应该如何应对这种响应式的问题处理呢？在 《样式复用、逻辑复用、可维护性》之间，我们又应该如何进行权衡呢？…</p>
<hr>
<h2 id="7-1-前言"><a href="#7-1-前言" class="headerlink" title="7-1 前言"></a>7-1 前言</h2><p>我们已经完成了<strong>PC端</strong>的Header的处理，那么接下来要处理的就是navigationBar。</p>
<p>但是我们知道，目前我们已经完成过一个移动端的navigationBar 了。</p>
<p>那么对于navigationBar 这个功能，我们还需要在PC端同样进行实现。通常我们把这样的一套功能称之为响应式（<strong>多指响应式布局：一套样式在多端展示</strong>）</p>
<p>但是咱们当前的项目不光是一个简单的响应式布局，而是一个复杂的前中台系统。那么在这样的前中台系统之中，我们又应该如何应对这种响应式的问题处理呢？</p>
<p>在<strong>样式复用、逻辑复用、代码可维护性</strong>之间，我们又应该如何去进行权衡呢？</p>
<h2 id="7-2-响应式下navigationBar实现方案分析"><a href="#7-2-响应式下navigationBar实现方案分析" class="headerlink" title="7-2 响应式下navigationBar实现方案分析"></a>7-2 响应式下navigationBar实现方案分析</h2><p>通常情况下<strong>复杂功能的响应式处理</strong>，一般我们有三种处理方案：</p>
<ol>
<li><p>一套代码处理多端：</p>
<ol>
<li>优势：代码量相对比较少</li>
<li>劣势：耦合性强，不利于后期维护</li>
</ol>
</li>
<li><p>多套代码分别处理各端：</p>
<ol>
<li>优势：逻辑清晰</li>
<li>劣势：可能会产生很多重复的逻辑</li>
</ol>
</li>
<li><p>结合以上两种方案，抽离公用逻辑，封装私有逻辑</p>
<ol>
<li>优势：结合以上两点优势</li>
<li>劣势：需要对业务和逻辑足够清楚</li>
</ol>
</li>
</ol>
<p>那么综合来看，肯定是第三种方式更好，所以咱们的navigationBar就通过第三种方式来去进行实现。</p>
<p>那么具体我们应该怎么去做呢？哪些是公用逻辑？哪些是私有逻辑？</p>
<p>我们知道一个功能由两部分组成：</p>
<ol>
<li>数据</li>
<li>视图</li>
</ol>
<p><strong>数据</strong></p>
<p>那么首先我们先来分析数据，双方（移动端和PC端）的数据是一样的。所以说这一块是完全可以复用的。</p>
<p>那么目前咱们的数据是通过 src&#x2F;views&#x2F;main&#x2F;compones&#x2F;navigation&#x2F;index.vue 进行获取，然后进行传递的。那么我们期望进行数据的复用，如果一直进行数据传递的话，未免有些过于复杂了。</p>
<p>所以说对于数据，我们可以直接通过vuex 来封装这一列的获取、切换行为。</p>
<p><strong>视图</strong><br>双方的视图在展示中的逻辑具备较大差异，所以为了综合可维护性，视图逻辑部分我们期望单独封装到各自的组件来来进行处理。</p>
<p><strong>总结</strong></p>
<p>那么这样我们就分析好了 navigationBar 的公有和私有部分：</p>
<ol>
<li>数据为公有数据，可以在vuex 中进行抽离处理。</li>
<li>视图为私有部分，需要在各自的组件l来进行单独处理。</li>
</ol>
<h2 id="7-3-抽离公用逻辑，封装系列动作"><a href="#7-3-抽离公用逻辑，封装系列动作" class="headerlink" title="7-3 抽离公用逻辑，封装系列动作"></a>7-3 抽离公用逻辑，封装系列动作</h2><ol>
<li>我们现在store&#x2F;index.js中定义createStore方法</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>  &#123;createStore&#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">import</span> getters <span class="keyword">from</span> <span class="string">&#x27;./getters&#x27;</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">createStore</span>(&#123;</span><br><span class="line">  getters</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>然后再store&#x2F;getter.js中导出一个空数组</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>然后在main.js中进行注册</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./store&#x27;</span></span><br><span class="line">app.<span class="title function_">use</span>(store)</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>我们创建store&#x2F;modules&#x2F;category.js模块，使用store方法进行数据的封装</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="variable constant_">ALL_CATEGORY_ITEM</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;@/constants&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;getCategory&#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/category&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 处理navigationBar中的数据categorys</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">//独立作用域</span></span><br><span class="line">  <span class="attr">namespaced</span>:<span class="literal">true</span>,</span><br><span class="line">  <span class="attr">state</span>:<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span>&#123;</span><br><span class="line">      <span class="attr">categorys</span>:[<span class="variable constant_">ALL_CATEGORY_ITEM</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mutations</span>:&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 为categorys赋值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="title function_">setCategorys</span>(<span class="params">state,newCategorys</span>)&#123;</span><br><span class="line">      state.<span class="property">categorys</span> =[<span class="variable constant_">ALL_CATEGORY_ITEM</span>,...newCategorys]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">actions</span>:&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取category数据，并自动保存到vuex中</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">useCategoryData</span>(<span class="params">context</span>)&#123;</span><br><span class="line">      <span class="keyword">const</span> &#123;categorys&#125; = getCategory</span><br><span class="line">      context.<span class="title function_">commit</span>(<span class="string">&#x27;setCategorys&#x27;</span>,categorys)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>最后在store&#x2F;index.js中注册数据模块</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>  &#123;createStore&#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">import</span> getters <span class="keyword">from</span> <span class="string">&#x27;./getters&#x27;</span></span><br><span class="line"><span class="keyword">import</span> category <span class="keyword">from</span> <span class="string">&#x27;./modules/category&#x27;</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">createStore</span>(&#123;</span><br><span class="line">  getters,</span><br><span class="line">  <span class="attr">modules</span>:&#123;</span><br><span class="line">    category</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>接下来我们就可以去触发categorys了，为了使访问变得简单，我们修改store&#x2F;getters.js</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">//简单访问</span></span><br><span class="line">  <span class="attr">categorys</span>:<span class="function">(<span class="params">state</span>)=&gt;</span>state.<span class="property">category</span>.<span class="property">categorys</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>我们对原有的src&#x2F;views&#x2F;main&#x2F;components&#x2F;navigation&#x2F;index. vue进行修改，使用store</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;mobile-navigation-vue v-if=&quot;isMobileTerminal&quot;  /&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; isMobileTerminal &#125; from &#x27;@/utils/flexible&#x27;</span><br><span class="line">import mobileNavigationVue from &#x27;./mobile/index.vue&#x27;</span><br><span class="line">import &#123;useStore&#125; from &#x27;vuex&#x27;</span><br><span class="line">const store = useStore()</span><br><span class="line">//触发category获取数据</span><br><span class="line">store.dispatch(&#x27;category/useCategoryData&#x27;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<ol start="8">
<li>修改src&#x2F;views&#x2F;main&#x2F;components&#x2F;navigation&#x2F;mobile&#x2F;index.vue，这时候defineProps就可以不需要了；data需要换成store方法，直接获取数据；我们观察看出menu-vue的数据绑定也就不需要了，然后menu-vue组件中重复8.中前两个步骤</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">defineProps</span>(&#123;</span><br><span class="line">  <span class="attr">data</span>:&#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">Array</span>,</span><br><span class="line">    <span class="attr">required</span>:<span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;li</span><br><span class="line">  v-for=&quot;(item,index) in $store.getters.categorys&quot;</span><br><span class="line">  :key=&quot;item.id&quot;</span><br><span class="line">  class=&quot;shrink-0 px-1.5 py-0.5 z-10 duration-200 last:mr-4&quot;</span><br><span class="line">  :class=&quot;&#123;</span><br><span class="line">    &#x27;text-zinc-100&#x27;: currentCategoryIndex === index</span><br><span class="line">  &#125;&quot;</span><br><span class="line">  :ref=&quot;setItemRef&quot;</span><br><span class="line">  @click=&quot;onItemClick(index)&quot;</span><br><span class="line">&gt;</span><br><span class="line">  &#123;&#123;item.name&#125;&#125;</span><br><span class="line">&lt;/li&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;m-popup v-model=&#x27;isVisable&#x27;&gt;</span><br><span class="line">  &lt;menu-vue  @onItemClick=&quot;onItemClick&quot;&gt;&lt;/menu-vue&gt;</span><br><span class="line">&lt;/m-popup&gt;</span><br></pre></td></tr></table></figure>

<h2 id="7-4-PC端navigationBar私有视图处理"><a href="#7-4-PC端navigationBar私有视图处理" class="headerlink" title="7-4 PC端navigationBar私有视图处理"></a>7-4 PC端navigationBar私有视图处理</h2><ol>
<li>我们首先创建navigation&#x2F;pc&#x2F;index.vue</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&#x27;bg-white sticky top-0 left-0 w-full z-10&#x27;&gt;</span><br><span class="line">    &lt;ul</span><br><span class="line">      class=&#x27;w-[800px] relative flex flex-wrap justify-center</span><br><span class="line">      overflow-x-auto px-[10px] py-1 text-xs text-zinc-600 duration-300</span><br><span class="line">      overflow-hidden max-auto&#x27;</span><br><span class="line">    &gt;</span><br><span class="line">&lt;!--      展示箭头--&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class=&#x27;absolute right-1 bottom-1 z-20 p-1 rounded cursor-pointer</span><br><span class="line">        duration-200 hover:bg-zinc-200&#x27;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;m-svg-icon</span><br><span class="line">          name=&#x27;unfold&#x27;</span><br><span class="line">          class=&#x27;w-1 h-1&#x27;</span><br><span class="line">          fillClass=&#x27;fill-zinc-900&#x27;</span><br><span class="line">        &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">&lt;!--      item--&gt;</span><br><span class="line">      &lt;li</span><br><span class="line">        v-for=&#x27;item in $store.getters.categorys&#x27;</span><br><span class="line">        :key=&#x27;item.id&#x27;</span><br><span class="line">        class=&#x27;shrink-0 px-1.5 py-0 z-10 duration-200 text-zinc-900</span><br><span class="line">        text-base font-bold h-4 leading-4 cursor-pointer hover:bg-zinc-200</span><br><span class="line">        rounded mr-1 mb-1&#x27;</span><br><span class="line">      &gt;</span><br><span class="line">        &#123;&#123;item.name&#125;&#125;</span><br><span class="line">      &lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在navigation&#x2F;index.vue中进行使用</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;pc-navigation-vue v-else&gt;&lt;/pc-navigation-vue&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">import pcNavigationVue from &#x27;./pc/index.vue&#x27;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>发现还不能使，因为我们没有设置二级路由，我们在views&#x2F;layout&#x2F;components&#x2F;main.vue中使用二级路由</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;router-view&gt;&lt;/router-view&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>我们在router&#x2F;modules&#x2F;pc-router.js中设置，里面的children</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> [&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;main&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>: <span class="function">()=&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/layout/index.vue&#x27;</span>),</span><br><span class="line">  <span class="attr">children</span>:[</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>:<span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>:<span class="string">&#x27;home&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>:<span class="function">()=&gt;</span><span class="title function_">import</span>(<span class="string">&#x27;@/views/main/index.vue&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure>

<h2 id="7-5-PC端navigationBar私有逻辑处理"><a href="#7-5-PC端navigationBar私有逻辑处理" class="headerlink" title="7-5 PC端navigationBar私有逻辑处理"></a>7-5 PC端navigationBar私有逻辑处理</h2><ol>
<li>首先在navigation&#x2F;pc&#x2F;index.vue创建数据源</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;<span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 状态切换处理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isOpenCategory = <span class="title function_">ref</span>(<span class="literal">false</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">triggerState</span> = (<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  isOpenCategory.<span class="property">value</span> = !isOpenCategory.<span class="property">value</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>实现pc端展开和收起导航栏，在ul处以数据源为根据进行处理导航栏的高度；然后设置点击箭头时，数据源进行变化，同时icon也发生相应变化</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul</span><br><span class="line">      class=&#x27;w-[800px] relative flex flex-wrap justify-center</span><br><span class="line">      overflow-x-auto px-[10px] py-1 text-xs text-zinc-600 duration-300</span><br><span class="line">      overflow-hidden max-auto&#x27;</span><br><span class="line">      :class=&quot;[isOpenCategory ? &#x27;h-[206px]&#x27; : &#x27;h-[56px]&#x27;]&quot;</span><br><span class="line">    &gt;</span><br><span class="line">&lt;!--      展示箭头--&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class=&#x27;absolute right-1 bottom-1 z-20 p-1 rounded cursor-pointer</span><br><span class="line">        duration-200 hover:bg-zinc-200&#x27;</span><br><span class="line">        @click=&#x27;triggerState&#x27;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;m-svg-icon</span><br><span class="line">          :name=&quot;isOpenCategory ? &#x27;fold&#x27;:&#x27;unfold&#x27; &quot;</span><br><span class="line">          class=&#x27;w-1 h-1&#x27;</span><br><span class="line">          fillClass=&#x27;fill-zinc-900&#x27;</span><br><span class="line">        &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">      &lt;/div&gt;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>我们给导航栏里的小模块设置高亮，增加选中方法，然后在li标签获取index，并且设置点击方法，根据值再来设置样式</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 选中状态处理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> currentCategoryIndex = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onItemClick</span> = (<span class="params">index</span>) =&gt;&#123;</span><br><span class="line">  currentCategoryIndex.<span class="property">value</span> = index</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--      item--&gt;</span><br><span class="line">      &lt;li</span><br><span class="line">        v-for=&#x27;(item,index) in $store.getters.categorys&#x27;</span><br><span class="line">        :key=&#x27;item.id&#x27;</span><br><span class="line">        class=&#x27;shrink-0 px-1.5 py-0 z-10 duration-200 text-zinc-900</span><br><span class="line">        text-base font-bold h-4 leading-4 cursor-pointer hover:bg-zinc-200</span><br><span class="line">        rounded mr-1 mb-1&#x27;</span><br><span class="line">        :class=&quot;&#123;</span><br><span class="line">          &#x27;text-zinc-900 bg-zinc-200&#x27; :currentCategoryIndex === index</span><br><span class="line">        &#125;&quot;</span><br><span class="line">        @click=&quot;onItemClick(index)&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &#123;&#123;item.name&#125;&#125;</span><br><span class="line">      &lt;/li&gt;</span><br></pre></td></tr></table></figure>

<h2 id="7-6-分析navigationBar闪烁问题"><a href="#7-6-分析navigationBar闪烁问题" class="headerlink" title="7-6 分析navigationBar闪烁问题"></a>7-6 分析navigationBar闪烁问题</h2><p>分析：</p>
<ul>
<li>出现闪烁的问题是因为网页先加载初始数据，后续的从后端调用的数据没有瞬间传过来</li>
</ul>
<p>解决方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//1.让categorys 具备一个初始化数据</span><br><span class="line">//2.从服务端获取数据，替换初始化数据（之前就已经完成了）</span><br><span class="line">//3.为了防止初始化数据太老，我们把每次获取到的新数据，都作为下一次的初始化数据</span><br></pre></td></tr></table></figure>

<h2 id="7-7-处理navigationBar闪烁问题"><a href="#7-7-处理navigationBar闪烁问题" class="headerlink" title="7-7 处理navigationBar闪烁问题"></a>7-7 处理navigationBar闪烁问题</h2><ol>
<li>让categorys 具备一个初始化数据,对constants&#x2F;index.vue进行新增</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//category的初始化数据</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">CATEGORY_NOMAR_DATA</span> = [</span><br><span class="line">  <span class="variable constant_">ALL_CATEGORY_ITEM</span>,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="string">&#x27;web_app_icon&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;UI/UX&#x27;</span>, <span class="attr">col</span>: <span class="number">1</span>, <span class="attr">urlname</span>: <span class="string">&#x27;web_app_icon&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="string">&#x27;design&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;平面&#x27;</span>, <span class="attr">col</span>: <span class="number">1</span>, <span class="attr">urlname</span>: <span class="string">&#x27;design&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="string">&#x27;illustration&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;插画/漫画&#x27;</span>, <span class="attr">col</span>: <span class="number">1</span>, <span class="attr">urlname</span>: <span class="string">&#x27;illustration&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="string">&#x27;photography&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;摄影&#x27;</span>, <span class="attr">col</span>: <span class="number">2</span>, <span class="attr">urlname</span>: <span class="string">&#x27;photography&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="string">&#x27;games&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;游戏&#x27;</span>, <span class="attr">urlname</span>: <span class="string">&#x27;games&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="string">&#x27;anime&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;动漫&#x27;</span>, <span class="attr">urlname</span>: <span class="string">&#x27;anime&#x27;</span> &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="string">&#x27;industrial_design&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;工业设计&#x27;</span>,</span><br><span class="line">    <span class="attr">col</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">urlname</span>: <span class="string">&#x27;industrial_design&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="string">&#x27;architecture&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;建筑设计&#x27;</span>, <span class="attr">urlname</span>: <span class="string">&#x27;architecture&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="string">&#x27;art&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;人文艺术&#x27;</span>, <span class="attr">urlname</span>: <span class="string">&#x27;art&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="string">&#x27;home&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;家居/家装&#x27;</span>, <span class="attr">col</span>: <span class="number">1</span>, <span class="attr">urlname</span>: <span class="string">&#x27;home&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="string">&#x27;apparel&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;女装/搭配&#x27;</span>, <span class="attr">col</span>: <span class="number">1</span>, <span class="attr">urlname</span>: <span class="string">&#x27;apparel&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="string">&#x27;men&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;男士/风尚&#x27;</span>, <span class="attr">col</span>: <span class="number">2</span>, <span class="attr">urlname</span>: <span class="string">&#x27;men&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="string">&#x27;modeling_hair&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;造型/美妆&#x27;</span>, <span class="attr">urlname</span>: <span class="string">&#x27;modeling_hair&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="string">&#x27;diy_crafts&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;手工/布艺&#x27;</span>, <span class="attr">urlname</span>: <span class="string">&#x27;diy_crafts&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="string">&#x27;food_drink&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;美食&#x27;</span>, <span class="attr">urlname</span>: <span class="string">&#x27;food_drink&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="string">&#x27;travel_places&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;旅行&#x27;</span>, <span class="attr">urlname</span>: <span class="string">&#x27;travel_places&#x27;</span> &#125;</span><br><span class="line">  <span class="comment">// &#123; id: &#x27;wedding_events&#x27;, name: &#x27;婚礼&#x27;, col: 2, urlname: &#x27;wedding_events&#x27; &#125;,</span></span><br><span class="line">  <span class="comment">// &#123; id: &#x27;kids&#x27;, name: &#x27;儿童&#x27;, urlname: &#x27;kids&#x27; &#125;,</span></span><br><span class="line">  <span class="comment">// &#123; id: &#x27;pets&#x27;, name: &#x27;宠物&#x27;, urlname: &#x27;pets&#x27; &#125;,</span></span><br><span class="line">  <span class="comment">// &#123; id: &#x27;quotes&#x27;, name: &#x27;美图&#x27;, urlname: &#x27;quotes&#x27; &#125;,</span></span><br><span class="line">  <span class="comment">// &#123; id: &#x27;people&#x27;, name: &#x27;明星&#x27;, urlname: &#x27;people&#x27; &#125;,</span></span><br><span class="line">  <span class="comment">// &#123; id: &#x27;beauty&#x27;, name: &#x27;美女&#x27;, urlname: &#x27;beauty&#x27; &#125;,</span></span><br><span class="line">  <span class="comment">// &#123; id: &#x27;desire&#x27;, name: &#x27;礼物&#x27;, urlname: &#x27;desire&#x27; &#125;,</span></span><br><span class="line">  <span class="comment">// &#123; id: &#x27;geek&#x27;, name: &#x27;极客&#x27;, urlname: &#x27;geek&#x27; &#125;,</span></span><br><span class="line">  <span class="comment">// &#123; id: &#x27;data_presentation&#x27;, name: &#x27;数据图&#x27;, urlname: &#x27;data_presentation&#x27; &#125;,</span></span><br><span class="line">  <span class="comment">// &#123; id: &#x27;cars_motorcycles&#x27;, name: &#x27;汽车/摩托&#x27;, urlname: &#x27;cars_motorcycles&#x27; &#125;,</span></span><br><span class="line">  <span class="comment">// &#123; id: &#x27;film_music_books&#x27;, name: &#x27;电影/图书&#x27;, urlname: &#x27;film_music_books&#x27; &#125;,</span></span><br><span class="line">  <span class="comment">// &#123; id: &#x27;tips&#x27;, name: &#x27;生活百科&#x27;, urlname: &#x27;tips&#x27; &#125;,</span></span><br><span class="line">  <span class="comment">// &#123; id: &#x27;education&#x27;, name: &#x27;教育&#x27;, urlname: &#x27;education&#x27; &#125;,</span></span><br><span class="line">  <span class="comment">// &#123; id: &#x27;sports&#x27;, name: &#x27;运动&#x27;, urlname: &#x27;sports&#x27; &#125;,</span></span><br><span class="line">  <span class="comment">// &#123; id: &#x27;funny&#x27;, name: &#x27;搞笑&#x27;, urlname: &#x27;funny&#x27; &#125;</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在store&#x2F;modules&#x2F;category.js进行数据导入</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="variable constant_">ALL_CATEGORY_ITEM</span>,<span class="variable constant_">CATEGORY_NOMAR_DATA</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;@/constants&#x27;</span></span><br><span class="line"><span class="attr">state</span>:<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span>&#123;</span><br><span class="line">      <span class="comment">//1.让categorys 具备一个初始化数据</span></span><br><span class="line">      <span class="comment">//2.从服务端获取数据，替换初始化数据</span></span><br><span class="line">      <span class="comment">//3.为了防止初始化数据太老，我们把每次获取到的新数据，都作为下一次的初始化数据</span></span><br><span class="line">      <span class="attr">categorys</span>:<span class="variable constant_">CATEGORY_NOMAR_DATA</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<h2 id="7-8-category数据缓存，覆盖初始数据"><a href="#7-8-category数据缓存，覆盖初始数据" class="headerlink" title="7-8 category数据缓存，覆盖初始数据"></a>7-8 category数据缓存，覆盖初始数据</h2><p>那么在处理好了闪烁的问题之后，接下来我们要完成之前明确的第三步，也就是<strong>缓存请求得来的vuex 中的数据</strong>，<strong>并且在下次运行时把缓存的数据作为初始值。</strong></p>
<p>那么想要实现这一步的功能，我们可以利用<strong>vuex-persistedstate</strong></p>
<p>vuex-persistedstate：可以自动保存 vuex 中的数据到 localStorage，并且在下次开始的时候自动读取这个数据到对应的state中</p>
<p>那么，接下来就利用这个库来实现我们的功能：</p>
<ol>
<li>安装vuex-persistedstate</li>
</ol>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i --save vuex-persistedstate@<span class="number">4</span>.<span class="number">1</span>.<span class="number">0</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>我们在store&#x2F;index.js中使用这个库</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> createPersistedState <span class="keyword">from</span> <span class="string">&#x27;vuex-persistedstate&#x27;</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">createStore</span>(&#123;</span><br><span class="line">  getters,</span><br><span class="line">  <span class="attr">modules</span>:&#123;</span><br><span class="line">    category</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>:[</span><br><span class="line">   <span class="title function_">createPersistedState</span>(&#123;</span><br><span class="line">     <span class="comment">//指定保存到localStorage中的key</span></span><br><span class="line">     <span class="attr">key</span>:<span class="string">&#x27;imooc-front&#x27;</span>,</span><br><span class="line">     <span class="comment">//需要保存的模块</span></span><br><span class="line">     <span class="attr">paths</span>:[<span class="string">&#x27;category&#x27;</span>]</span><br><span class="line">   &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>

<h1 id="8、-主题替换解决方案-——-打造完善多主题系统"><a href="#8、-主题替换解决方案-——-打造完善多主题系统" class="headerlink" title="8、 主题替换解决方案 —— 打造完善多主题系统"></a>8、 主题替换解决方案 —— 打造完善多主题系统</h1><p>市面上很多的组件库都存在主题替换的功能，但是如果脱离了组件库你还知道如何实现主题替换吗？整个主题替换方案背后的原理是什么？如果我们想要跟随系统主题发生变化，那么又应该怎么做呢？</p>
<hr>
<h2 id="8-1-主题替换原理分析"><a href="#8-1-主题替换原理分析" class="headerlink" title="8-1 主题替换原理分析"></a>8-1 主题替换原理分析</h2><p>就是一句话：</p>
<ul>
<li>通过类名的控制对应的样式（主题），当类名发生变化时，即完成了主题替换</li>
</ul>
<h2 id="8-2-ailwindDarkMode原理"><a href="#8-2-ailwindDarkMode原理" class="headerlink" title="8-2 ailwindDarkMode原理"></a>8-2 ailwindDarkMode原理</h2><ol>
<li>首先在tailwind.config.js下设置手动切换暗黑模式</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//手动切换暗黑模式</span></span><br><span class="line"><span class="attr">darkMode</span>:<span class="string">&#x27;class&#x27;</span>,</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>然后我们在header&#x2F;index.vue中的div标签加上dark样式</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&#x27;w-full bg-white dark:bg-zinc-800 border-b border-b-zinc-200</span><br><span class="line">px-2 py-1&#x27;&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>去浏览器按住F12，然后修改元素的html标签增加class&#x3D;’dark’就可以看到效果</li>
</ol>
<h2 id="8-3-为组件增加dark适配"><a href="#8-3-为组件增加dark适配" class="headerlink" title="8-3 为组件增加dark适配"></a>8-3 为组件增加dark适配</h2><p>下面就是修改各个页面的样式：</p>
<ol>
<li>首先修改header&#x2F;header-my.vue</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;m-popover class=&#x27;flex items-center&#x27; placement=&#x27;bottom-left&#x27;&gt;</span><br><span class="line">    &lt;template #reference&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class=&#x27;relative flex items-center p-0.5 rounded-sm</span><br><span class="line">        cursor-pointer duration-200 outline-none</span><br><span class="line">        hover:bg-zinc-100 dark:hover:bg-zinc-900&#x27;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;!--头像--&gt;</span><br><span class="line">        &lt;img</span><br><span class="line">          class=&#x27;w-3 h-3 rounded-sm&#x27;</span><br><span class="line">          src=&#x27;  https://w.wallhaven.cc/full/rd/wallhaven-rdwjj7.jpg&#x27;</span><br><span class="line">        /&gt;</span><br><span class="line">&lt;!--        下箭头--&gt;</span><br><span class="line">        &lt;m-svg-icon</span><br><span class="line">          class=&#x27;h-1.5 w-1.5 ml-0.5&#x27;</span><br><span class="line">          name=&#x27;down-arrow&#x27;</span><br><span class="line">          fillClass=&#x27;fill-zinc-900 dark:fill-zinc-300&#x27;</span><br><span class="line">        &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">&lt;!--        VIP--&gt;</span><br><span class="line">        &lt;m-svg-icon</span><br><span class="line">          class=&#x27;h-1.5 w-1.5 absolute right-[16px] bottom-0&#x27;</span><br><span class="line">          name = &#x27;vip&#x27;</span><br><span class="line">        &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">&lt;!--气泡--&gt;</span><br><span class="line">    &lt;div class=&#x27;w-[140px] overflow-hidden&#x27;&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class=&#x27;flex items-center p-1 cursor-pointer rounded</span><br><span class="line">        hover:bg-zinc-100/60 dark:hover:bg-zinc-800&#x27;</span><br><span class="line">        v-for=&#x27;item in menuArr&#x27;</span><br><span class="line">        :key=&#x27;item.id&#x27;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;m-svg-icon</span><br><span class="line">          :name=&#x27;item.icon&#x27;</span><br><span class="line">          class=&#x27;w-1.5 h-1.5 mr-1&#x27;</span><br><span class="line">          fillClass=&#x27;fill-zinc-900 dark:fill-zinc-300&#x27;</span><br><span class="line">        &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">        &lt;span class=&#x27;text-zinc-800 text-sm dark:text-zinc-300&#x27; &gt;&#123;&#123;item.title&#125;&#125;&lt;/span&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/m-popover&gt;</span><br><span class="line"></span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>修改header&#x2F;header-theme.vue</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;m-popover placement=&#x27;bottom-left&#x27;&gt;</span><br><span class="line">    &lt;!--具名插槽：触发弹层的视图--&gt;</span><br><span class="line">    &lt;template #reference&gt;</span><br><span class="line">      &lt;m-svg-icon</span><br><span class="line">        name=&#x27;theme-light&#x27;</span><br><span class="line">        class=&#x27;w-4 h-4 p-1 cursor-pointer rounded-sm duration-200</span><br><span class="line">        outline-none hover:bg-zinc-100/60 dark:hover:bg-zinc-900&#x27;</span><br><span class="line">        fillClass=&#x27;fill-zinc-900 dark:fill-zinc-300&#x27;</span><br><span class="line">      &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">      &lt;!--    匿名插槽:弹出层视图中展示的内容--&gt;</span><br><span class="line">      &lt;div class=&#x27;w-[140px] overflow-hidden&#x27;&gt;</span><br><span class="line">        &lt;div</span><br><span class="line">          class=&#x27;flex item-center p-1 cursor-pointer rounded</span><br><span class="line">          hover:bg-zinc-100/60 dark:hover:bg-zinc-800&#x27;</span><br><span class="line">          v-for=&#x27;item in themeArr&#x27;</span><br><span class="line">          :key=&#x27;item.id&#x27;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;m-svg-icon</span><br><span class="line">            :name=&#x27;item.icon&#x27;</span><br><span class="line">            class=&#x27;w-1.5 h-1.5 mr-1&#x27;</span><br><span class="line">            fillClass=&#x27;fill-zinc-900 dark:fill-zinc-300&#x27;</span><br><span class="line">          &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">          &lt;span class=&#x27;text-zinc-900 text-sm dark:text-zinc-300&#x27;&gt;&#123;&#123; item.name &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/m-popover&gt;</span><br><span class="line"></span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>修改view&#x2F;main&#x2F;components&#x2F;menu&#x2F;index.vue</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;div class=&#x27;py-2 h-[80vh] flex flex-col&#x27;&gt;</span><br><span class="line">  &lt;h2 class=&#x27;text-xl text-zinc-900 dark:text-zinc-200 font-bold mb-2 px-1&#x27;&gt;</span><br><span class="line">    所有分类</span><br><span class="line">  &lt;/h2&gt;</span><br><span class="line">  &lt;ul class=&#x27;overflow-y-scroll&#x27;&gt;</span><br><span class="line">    &lt;li</span><br><span class="line">      v-for=&quot;(item,index)in $store.getters.categorys&quot;</span><br><span class="line">      :key=&quot;item.id&quot;</span><br><span class="line">      class=&quot;text-lg text-zinc-900 dark:text-zinc-300 px-1 py-1.5</span><br><span class="line">      duration-100 active:bg-zinc-100 dark:active:bg-zinc-900&quot;</span><br><span class="line">      @click=&quot;$emit(&#x27;onItemClick&#x27;,index)&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &#123;&#123;item.name&#125;&#125;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">  &lt;/ul&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>修改view&#x2F;main&#x2F;components&#x2F;navigation&#x2F;mobile&#x2F;index.vue</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;bg-white dark :bg-zinc-900 sticky top-0 left-0 z-10&quot;&gt;</span><br><span class="line">    &lt;ul</span><br><span class="line">      ref=&quot;ulTarget&quot;</span><br><span class="line">      class=&quot; relative flex overflow-x-auto p-1 text-xs text-zinc-600</span><br><span class="line">      overflow-hidden&quot;&gt;</span><br><span class="line">      &lt;!--滑块--&gt;</span><br><span class="line">      &lt;li</span><br><span class="line">        ref=&quot;sliderTarget&quot;</span><br><span class="line">        :style=&quot;sliderStyle&quot;</span><br><span class="line">        class=&quot;absolute h-[22px] bg-zinc-900 dark:bg-zinc-800 rounded-lg duration-200&quot;</span><br><span class="line">      &gt;</span><br><span class="line">      &lt;/li&gt;</span><br><span class="line">      &lt;!--汉堡按钮--&gt;</span><br><span class="line">      &lt;li</span><br><span class="line">        class=&quot;fixed top-0 right-[-1px] h-4 px-1 flex items-center bg-white</span><br><span class="line">        dark:bg-zinc-900 z-20 shadow-l-white dark:shadow-l-zinc&quot;</span><br><span class="line">        @click=&#x27;onShowPopup&#x27;&gt;</span><br><span class="line">        &lt;m-svg-icon class=&quot;w-1.5 h-1.5&quot; name=&quot;hamburger&quot;&gt;&lt;/m-svg-icon&gt;</span><br><span class="line">      &lt;/li&gt;</span><br><span class="line">      &lt;li</span><br><span class="line">        v-for=&quot;(item,index) in $store.getters.categorys&quot;</span><br><span class="line">        :key=&quot;item.id&quot;</span><br><span class="line">        class=&quot;shrink-0 px-1.5 py-0.5 z-10 duration-200 last:mr-4&quot;</span><br><span class="line">        :class=&quot;&#123;</span><br><span class="line">          &#x27;text-zinc-100&#x27;: currentCategoryIndex === index</span><br><span class="line">        &#125;&quot;</span><br><span class="line">        :ref=&quot;setItemRef&quot;</span><br><span class="line">        @click=&quot;onItemClick(index)&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &#123;&#123;item.name&#125;&#125;</span><br><span class="line">      &lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">    &lt;m-popup v-model=&#x27;isVisable&#x27;&gt;</span><br><span class="line">      &lt;menu-vue  @onItemClick=&quot;onItemClick&quot;&gt;&lt;/menu-vue&gt;</span><br><span class="line">    &lt;/m-popup&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>修改view&#x2F;main&#x2F;components&#x2F;navigation&#x2F;pc&#x2F;index.vue</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&#x27;bg-white dark:bg-zinc-800 sticky top-0 left-0 w-full z-10&#x27;&gt;</span><br><span class="line">    &lt;ul</span><br><span class="line">      class=&#x27;w-[800px] relative flex flex-wrap justify-center</span><br><span class="line">      overflow-x-auto px-[10px] py-1 text-xs text-zinc-600 duration-300</span><br><span class="line">      overflow-hidden max-auto&#x27;</span><br><span class="line">      :class=&quot;[isOpenCategory ? &#x27;h-[206px]&#x27; : &#x27;h-[56px]&#x27;]&quot;</span><br><span class="line">    &gt;</span><br><span class="line">&lt;!--      展示箭头--&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class=&#x27;absolute right-1 bottom-1 z-20 p-1 rounded cursor-pointer</span><br><span class="line">        duration-200 hover:bg-zinc-200 dark:hover:bg-zinc-900&#x27;</span><br><span class="line">        @click=&#x27;triggerState&#x27;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;m-svg-icon</span><br><span class="line">          :name=&quot;isOpenCategory ? &#x27;fold&#x27;:&#x27;unfold&#x27; &quot;</span><br><span class="line">          class=&#x27;w-1 h-1&#x27;</span><br><span class="line">          fillClass=&#x27;fill-zinc-900 dark:fill-zinc-300&#x27;</span><br><span class="line">        &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">&lt;!--      item--&gt;</span><br><span class="line">      &lt;li</span><br><span class="line">        v-for=&#x27;(item,index) in $store.getters.categorys&#x27;</span><br><span class="line">        :key=&#x27;item.id&#x27;</span><br><span class="line">        class=&#x27;shrink-0 px-1.5 py-0 z-10 duration-200 text-zinc-900</span><br><span class="line">        dark:text-zinc-500 dark:hover:text-zinc-300 text-base font-bold</span><br><span class="line">        h-4 leading-4 cursor-pointer hover:bg-zinc-200 dark:hover:bg-zinc-900</span><br><span class="line">        rounded mr-1 mb-1&#x27;</span><br><span class="line">        :class=&quot;&#123;</span><br><span class="line">          &#x27;text-zinc-900 dark:text-zinc-300 bg-zinc-200 dark:bg-zinc-900&#x27; :currentCategoryIndex === index</span><br><span class="line">        &#125;&quot;</span><br><span class="line">        @click=&quot;onItemClick(index)&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &#123;&#123;item.name&#125;&#125;</span><br><span class="line">      &lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>修改lib&#x2F;button&#x2F;index.vue</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;button</span><br><span class="line">    class=&#x27;text-xs text-center rounded duration-150 flex justify-center items-center&#x27;</span><br><span class="line">    :class=&quot;[</span><br><span class="line">      typeEnum[type],</span><br><span class="line">      sizeEnum[sizeKey].button,</span><br><span class="line">      &#123;</span><br><span class="line">        &#x27;active:scale-105&#x27;:isActiveAnim</span><br><span class="line">      &#125;</span><br><span class="line">    ]&quot;</span><br><span class="line">    @click.stop=&#x27;onBtnClick&#x27;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;!-- loading--&gt;</span><br><span class="line">    &lt;m-svg-icon</span><br><span class="line">      v-if=&#x27;loading&#x27;</span><br><span class="line">      name=&#x27;loading&#x27;</span><br><span class="line">      class=&#x27;w-2 h-2 animate-spin mr-1&#x27;</span><br><span class="line">    &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">    &lt;!-- icon按钮--&gt;</span><br><span class="line">    &lt;m-svg-icon</span><br><span class="line">      v-if=&#x27;icon&#x27;</span><br><span class="line">      :name=&#x27;icon&#x27;</span><br><span class="line">      class=&#x27;m-auto&#x27;</span><br><span class="line">      :class=&#x27;sizeEnum[sizeKey].icon&#x27;</span><br><span class="line">      :color=&#x27;iconColor&#x27;</span><br><span class="line">      :fillClass=&#x27;iconClass&#x27;</span><br><span class="line">    &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">    &lt;!-- icon按钮--&gt;</span><br><span class="line">    &lt;slot v-else/&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>修改lib&#x2F;popover&#x2F;index.vue</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div class=&#x27;relative&#x27; @mouseenter=&#x27;onMouseenter&#x27;</span><br><span class="line">@mouseleave=&#x27;onMouseleave&#x27;&gt;</span><br><span class="line">  &lt;div ref=&#x27;referenceTarget&#x27;&gt;</span><br><span class="line">&lt;!--    具名插槽：触发弹层的视图--&gt;</span><br><span class="line">    &lt;slot name=&#x27;reference&#x27;/&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;!--  气泡展示--&gt;</span><br><span class="line">  &lt;transition name=&#x27;slide&#x27;&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      ref=&#x27;contentTarget&#x27;</span><br><span class="line">      v-show=&#x27;isVisable&#x27;</span><br><span class="line">      class=&#x27;absolute p-1 z-20 bg-white dark:bg-zinc-900 border</span><br><span class="line">      dark:border-zinc-700 rounded-md&#x27;</span><br><span class="line">      :style=&#x27;contentStyle&#x27;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;!--    匿名插槽:弹出层视图中展示的内容--&gt;</span><br><span class="line">      &lt;slot/&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/transition&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<ol start="8">
<li>修改lib&#x2F;popup&#x2F;index.vue</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">  &lt;teleport to=&quot;body&quot;&gt;</span><br><span class="line">    &lt;!-- 蒙版--&gt;</span><br><span class="line">    &lt;transition name=&quot;fade&quot;&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        v-if=&#x27;isVisable&#x27;</span><br><span class="line">        class=&#x27;w-screen h-screen bg-zinc-900/80 z-40 fixed top-0 left-0&#x27;</span><br><span class="line">        @click=&quot;isVisable = false&quot;</span><br><span class="line">      &gt;&lt;/div&gt;</span><br><span class="line">    &lt;/transition&gt;</span><br><span class="line">    &lt;!-- 内容--&gt;</span><br><span class="line">    &lt;transition name=&quot;popup-down-up&quot;&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        v-if=&#x27;isVisable&#x27;</span><br><span class="line">        v-bind=&quot;$attrs&quot;</span><br><span class="line">        class=&#x27;w-screen bg-white dark:bg-zinc-800 z-50 fixed bottom-0 &#x27;&gt;</span><br><span class="line">        &lt;slot/&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/transition&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/teleport&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<ol start="9">
<li>修改lib&#x2F;search&#x2F;index.vue</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    class=&#x27;group relative p-0.5 rounded-xl border-white dark:border-zinc-200</span><br><span class="line">    duration-500 hover:bg-red-100/40&#x27;</span><br><span class="line">    ref=&#x27;containerTarge&#x27;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;!--搜索图标--&gt;</span><br><span class="line">      &lt;m-svg-icon</span><br><span class="line">        class=&#x27;w-1.5 h-1.5 absolute translate-y-[-50%] top-[50%] left-2&#x27;</span><br><span class="line">        name=&quot;search&quot;</span><br><span class="line">        color=&quot;#70707&quot;</span><br><span class="line">      &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">      &lt;!--输入框--&gt;</span><br><span class="line">      &lt;input</span><br><span class="line">        class=&#x27;block w-full h-[44px] pl-4 outline-0 bg-zinc-100</span><br><span class="line">        dark:bg-zinc-800  caret-zinc-400 rounded-xl text-zinc-900</span><br><span class="line">        dark:text-zinc-200 tracking-wide text-sm font-semibold border</span><br><span class="line">        border-zinc-100 dark:border-zinc-700 duration-500</span><br><span class="line">        focus:border-red-300 group-hover:bg-white</span><br><span class="line">        dark:group-hover:bg-zinc-900 group-hover:border-zinc-200</span><br><span class="line">        dark:group-hover:bg-zinc-700&#x27;</span><br><span class="line">        type=&quot;text&quot;</span><br><span class="line">        placeholder=&quot;搜索&quot;</span><br><span class="line">        v-model=&#x27;intputValue&#x27;</span><br><span class="line">        @keyup.enter=&#x27;onSearchHandler&#x27;</span><br><span class="line">        @focus=&#x27;onFocusHandler&#x27;</span><br><span class="line">        @blur=&#x27;onBlurHandler&#x27;</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;!--删除按钮--&gt;</span><br><span class="line">      &lt;m-svg-icon</span><br><span class="line">        v-show=&#x27;intputValue&#x27;</span><br><span class="line">        name = &quot;input-delete&quot;</span><br><span class="line">        class=&#x27;w-1.5 h-1.5 absolute translate-y-[-50%] top-[50%] right-9</span><br><span class="line">        cursor-pointer duration-500&#x27;</span><br><span class="line">        @click=&#x27;onClearClick&#x27;</span><br><span class="line">      &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">      &lt;!--分割线--&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class=&#x27;opacity-0 h-1.5 w-[1px] absolute translate-y-[-50%] top-[50%]</span><br><span class="line">        right-[62px] duration-500 bg-zinc-200 group-hover:opacity-100&#x27;</span><br><span class="line">      &gt;&lt;/div&gt;</span><br><span class="line">      &lt;!--TODO:搜索按钮（通用组件）--&gt;</span><br><span class="line">      &lt;m-button</span><br><span class="line">        class=&#x27;opacity-0 absolute translate-y-[-50%] top-[50%] right-1 rounded-full duration-500 group-hover:opacity-100&#x27;</span><br><span class="line">        icon=&#x27;search&#x27;</span><br><span class="line">        iconColor=&#x27;#ffffff&#x27;</span><br><span class="line">        @click=&#x27;onSearchHandler&#x27;</span><br><span class="line">      &gt;&lt;/m-button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!--下拉区--&gt;</span><br><span class="line">    &lt;transition name=&#x27;slide&#x27;&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        v-if=&#x27;$slots.dropdown&#x27;</span><br><span class="line">        v-show=&#x27;isFocus&#x27;</span><br><span class="line">        class=&#x27;max-h-[368px] w-full text-base overflow-auto bg-white</span><br><span class="line">        dark:bg-zinc-800 absolute z-20 left-0 top-[56px] p-2 rounded border</span><br><span class="line">        border-zinc-200 dark:border-zinc-600 duration-200 hover:shadow-2xl&#x27;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;slot name=&#x27;dropdown&#x27;/&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/transition&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<ol start="10">
<li>最后就是个tailwind.config.js增加一个新的阴影特效</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">boxShadow</span>:&#123;</span><br><span class="line">  <span class="string">&#x27;l-white&#x27;</span>: <span class="string">&#x27;-10px 0 10px white&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;l-zinc&#x27;</span>: <span class="string">&#x27;-10px 0 10px #18181b&#x27;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h2 id="8-4-DarkMode在复杂应用中的实现逻辑分析"><a href="#8-4-DarkMode在复杂应用中的实现逻辑分析" class="headerlink" title="8-4 DarkMode在复杂应用中的实现逻辑分析"></a>8-4 DarkMode在复杂应用中的实现逻辑分析</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//1.监听主题的切换行为</span><br><span class="line">//2.根据行为保存当前需要展示的主题到vuex中</span><br><span class="line">//3.根据vuex中保存的当前主题，展示header-theme下的显示图标</span><br><span class="line">//4.根据vuex中保存的当前主题，修改html的class</span><br></pre></td></tr></table></figure>

<h2 id="8-5-DarkMode在复杂应用中的实现"><a href="#8-5-DarkMode在复杂应用中的实现" class="headerlink" title="8-5 DarkMode在复杂应用中的实现"></a>8-5 DarkMode在复杂应用中的实现</h2><ol>
<li>首先创建store&#x2F;modules&#x2F;theme.js</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>&#123;<span class="variable constant_">THEME_LIGHT</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;@/constants&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">namespaced</span>:<span class="literal">true</span>,</span><br><span class="line">  <span class="attr">state</span>:<span class="function">()=&gt;</span>(&#123;</span><br><span class="line">    <span class="comment">//当前主题模式</span></span><br><span class="line">    <span class="attr">themeType</span>:<span class="variable constant_">THEME_LIGHT</span></span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="attr">mutations</span>:&#123;</span><br><span class="line">    <span class="title function_">changeThemeType</span>(<span class="params">state,newTheme</span>)&#123;</span><br><span class="line">      state.<span class="property">themeType</span> = newTheme</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>将该模块进行注册在store&#x2F;index.js</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> theme <span class="keyword">from</span> <span class="string">&#x27;./modules/theme&#x27;</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">createStore</span>(&#123;</span><br><span class="line">  getters,</span><br><span class="line">  <span class="attr">modules</span>:&#123;</span><br><span class="line">    category,</span><br><span class="line">    theme</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>:[</span><br><span class="line">   <span class="title function_">createPersistedState</span>(&#123;</span><br><span class="line">     <span class="comment">//指定保存到localStorage中的key</span></span><br><span class="line">     <span class="attr">key</span>:<span class="string">&#x27;imooc-front&#x27;</span>,</span><br><span class="line">     <span class="comment">//需要保存的模块</span></span><br><span class="line">     <span class="attr">paths</span>:[<span class="string">&#x27;category&#x27;</span>,<span class="string">&#x27;theme&#x27;</span>]</span><br><span class="line">   &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在store&#x2F;getter.js中创建新的访问</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">//当前主题</span></span><br><span class="line">  <span class="attr">themeType</span>:<span class="function">(<span class="params">state</span>)=&gt;</span> state.<span class="property">theme</span>.<span class="property">themeType</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面这些步骤是创建vuex</p>
<hr>
<p>以下内容全是基于header&#x2F;header-theme.vue</p>
<ol start="4">
<li>监听主题的切换行为并根据行为保存当前需要展示的主题到vuex中，首先在匿名插槽设置点击事件，然后使用store进行传输</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--    匿名插槽:弹出层视图中展示的内容--&gt;</span><br><span class="line">&lt;div class=&#x27;w-[140px] overflow-hidden&#x27;&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    class=&#x27;flex item-center p-1 cursor-pointer rounded</span><br><span class="line">    hover:bg-zinc-100/60 dark:hover:bg-zinc-800&#x27;</span><br><span class="line">    v-for=&#x27;item in themeArr&#x27;</span><br><span class="line">    :key=&#x27;item.id&#x27;</span><br><span class="line">    @click=&#x27;onItemClick(item)&#x27;</span><br><span class="line">  &gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useStore &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">useStore</span>()</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * menu切换事件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onItemClick</span> =(<span class="params">themeItem</span>) =&gt;&#123;</span><br><span class="line">  store.<span class="title function_">commit</span>(<span class="string">&#x27;theme/changeThemeType&#x27;</span>,themeItem.<span class="property">type</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>根据vuex中保存的当前主题，展示header-theme下的显示图标，在具名插槽中设置name</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 展示图标</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> svgIconName =<span class="title function_">computed</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> findTheme =themeArr.<span class="title function_">find</span>(<span class="function">(<span class="params">item</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> item.<span class="property">type</span>===store.<span class="property">getters</span>.<span class="property">themeType</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> findTheme?.<span class="property">icon</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;m-svg-icon</span><br><span class="line">  :name=&#x27;svgIconName&#x27;</span><br><span class="line">  class=&#x27;w-4 h-4 p-1 cursor-pointer rounded-sm duration-200</span><br><span class="line">  outline-none hover:bg-zinc-100/60 dark:hover:bg-zinc-900&#x27;</span><br><span class="line">  fillClass=&#x27;fill-zinc-900 dark:fill-zinc-300&#x27;</span><br><span class="line">&gt;&lt;/m-svg-icon&gt;</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>根据vuex中保存的当前主题，修改html的class，我们先创建工具类utils&#x2F;theme.js，这样的方法我们在main.js中触发一次就可以了，如果觉得切换过于生硬那么就添加过度动画</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="variable constant_">THEME_LIGHT</span>,<span class="variable constant_">THEME_DARK</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;@/constants&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;watch&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;../store&#x27;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 初始化主题</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> ()=&gt;&#123;</span><br><span class="line">  <span class="comment">//1.当主题发生改变时，或者当进入系统时，可以进行html class的配置</span></span><br><span class="line">  <span class="title function_">watch</span>(</span><br><span class="line">    <span class="function">()=&gt;</span>store.<span class="property">getters</span>.<span class="property">themeType</span>,</span><br><span class="line">    <span class="function">(<span class="params">val</span>)=&gt;</span>&#123;</span><br><span class="line">      <span class="comment">//html的class</span></span><br><span class="line">      <span class="keyword">let</span> themeClassName = <span class="string">&#x27;&#x27;</span></span><br><span class="line">      <span class="keyword">switch</span> (val)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="attr">THEME_LIGHT</span>:</span><br><span class="line">          themeClassName=<span class="string">&#x27;light&#x27;</span></span><br><span class="line">          <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">case</span> <span class="attr">THEME_DARK</span>:</span><br><span class="line">          themeClassName=<span class="string">&#x27;dark&#x27;</span></span><br><span class="line">          <span class="keyword">break</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//修改html的class</span></span><br><span class="line">      <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;html&#x27;</span>).<span class="property">className</span> = themeClassName</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">//初始执行一次</span></span><br><span class="line">      <span class="attr">immediate</span>:<span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> useTheme <span class="keyword">from</span> <span class="string">&#x27;./utils/theme&#x27;</span></span><br><span class="line"><span class="title function_">useREM</span>()</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">duration-<span class="number">500</span></span><br></pre></td></tr></table></figure>

<h2 id="8-6-跟随系统的主题变更"><a href="#8-6-跟随系统的主题变更" class="headerlink" title="8-6 跟随系统的主题变更"></a>8-6 跟随系统的主题变更</h2><p>想要生成跟随系统的主题变更，那么我们就需要<strong>监听系统的主题变化</strong></p>
<p>想要做到这一点，可以利用<strong>Window.matchMedia（）</strong>方法，该方法接收一个 mediaQueryString（媒体查询解析的字符串）<br>该字符串我们可以传递 <strong>prefers-color-scheme</strong>，即window.matchMedia（’（prefers-color-scheme：dark）’）方法</p>
<p>该方法可以返回一个<strong>MediaQueryList</strong>对象：</p>
<p>1.该对象存在一个<strong>change</strong>事件，可以监听<strong>主题发生变更</strong>的行为。<br>2.同时存在一个<strong>matches</strong>属性，该属性为boolean性的值：</p>
<ol>
<li>true：深色主题</li>
<li>false：浅色主题</li>
</ol>
<p>那么据此，可生成以下代码。在src&#x2F;utils&#x2F;theme.js中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="variable constant_">THEME_LIGHT</span>,<span class="variable constant_">THEME_DARK</span>,<span class="variable constant_">THEME_SYSTEM</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;@/constants&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;watch&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;../store&#x27;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 监听系统主题变更</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">let</span> matchMedia</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">watchSystemThemeChange</span> =(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  <span class="comment">//仅需一次初始化</span></span><br><span class="line">  <span class="keyword">if</span> (matchMedia) <span class="keyword">return</span></span><br><span class="line">  matchMedia =<span class="variable language_">window</span>.<span class="title function_">matchMedia</span>(<span class="string">&#x27;(prefers-color-scheme:dark)&#x27;</span>)</span><br><span class="line">  <span class="comment">//监听主题变化</span></span><br><span class="line">  matchMedia.<span class="property">onchange</span>=<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="title function_">changeTheme</span>(<span class="variable constant_">THEME_SYSTEM</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 变更主题</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> theme主题的标记</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">changeTheme</span>=(<span class="params">theme</span>)=&gt;&#123;</span><br><span class="line">  <span class="comment">//html的class</span></span><br><span class="line">  <span class="keyword">let</span> themeClassName = <span class="string">&#x27;&#x27;</span></span><br><span class="line">  <span class="keyword">switch</span> (theme)&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="attr">THEME_LIGHT</span>:</span><br><span class="line">      themeClassName=<span class="string">&#x27;light&#x27;</span></span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">case</span> <span class="attr">THEME_DARK</span>:</span><br><span class="line">      themeClassName=<span class="string">&#x27;dark&#x27;</span></span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">case</span> <span class="attr">THEME_SYSTEM</span>:</span><br><span class="line">      <span class="comment">//调用方法，监听系统主题变化</span></span><br><span class="line">      <span class="title function_">watchSystemThemeChange</span>()</span><br><span class="line">      themeClassName=matchMedia.<span class="property">matches</span>?<span class="string">&#x27;dark&#x27;</span>:<span class="string">&#x27;light&#x27;</span></span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//修改html的class</span></span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;html&#x27;</span>).<span class="property">className</span> = themeClassName</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 初始化主题</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> ()=&gt;&#123;</span><br><span class="line">  <span class="comment">//1.当主题发生改变时，或者当进入系统时，可以进行html class的配置</span></span><br><span class="line">  <span class="title function_">watch</span>(<span class="function">() =&gt;</span>store.<span class="property">getters</span>.<span class="property">themeType</span>,changeTheme, &#123;</span><br><span class="line">      <span class="comment">//初始执行一次</span></span><br><span class="line">      <span class="attr">immediate</span>:<span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="9、瀑布流-长列表-懒加载处理方案-——-打造企业级高性能通用模块"><a href="#9、瀑布流-长列表-懒加载处理方案-——-打造企业级高性能通用模块" class="headerlink" title="9、瀑布流+长列表+懒加载处理方案 —— 打造企业级高性能通用模块"></a>9、瀑布流+长列表+懒加载处理方案 —— 打造企业级高性能通用模块</h1><p>为什么大厂的应用使用起来总是那么的丝滑？他们到底给应用施加了什么样的“魔法”？我能开发出媲美大厂团队的精美前台应用吗？应该怎么做？本章把这些“咒语”统统告诉你！</p>
<hr>
<h2 id="9-1-业务组件：构建基础列表展示"><a href="#9-1-业务组件：构建基础列表展示" class="headerlink" title="9-1 业务组件：构建基础列表展示"></a>9-1 业务组件：构建基础列表展示</h2><ol>
<li>首先创建api&#x2F;pexeis.js来获取图片数据</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取图片数据列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getPexlesList</span> = (<span class="params">data</span>) =&gt;&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>:<span class="string">&#x27;/pexels/list&#x27;</span>,</span><br><span class="line">    <span class="attr">params</span>:data</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>其次在main&#x2F;components&#x2F;下创建list目录，list目录包括index.vue（本身）及item.vue（每个小图片），并在main&#x2F;components&#x2F;index.vue导入组件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&#x27;h-full overflow-auto bg-white dark:bg-zinc-800 duration-500&#x27;&gt;</span><br><span class="line">  &lt;navigation-vue/&gt;</span><br><span class="line">  &lt;div class=&#x27;max-w-screen-xl mx-auto relative m-1 xl:mt-4&#x27;&gt;</span><br><span class="line">    &lt;list-vue&gt;&lt;/list-vue&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import navigationVue from &#x27;./components/navigation/index.vue&#x27;</span><br><span class="line">import listVue from &#x27;./components/list/index.vue&#x27;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在main&#x2F;components&#x2F;list&#x2F;index.vue中获取图片那些数据</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123;getPexlesList&#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/pexeis&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">/**</span></span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"><span class="language-xml"> * 构建数据请求</span></span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"><span class="language-xml"> */</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">let</span> query=&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">page</span>:<span class="number">1</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">size</span>:<span class="number">20</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> <span class="title function_">getPexlesData</span> = <span class="keyword">async</span>(<span class="params"></span>)=&gt;&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">getPexlesList</span>(query)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="title function_">getPexlesData</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&#x27;scss&#x27;</span> <span class="attr">scoped</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>在main&#x2F;components&#x2F;list&#x2F;index.vue中加载数据源</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">  &lt;item-vue v-for=&#x27;item in pexelsList&#x27; :key=&#x27;item.id&#x27; :data=&#x27;item&#x27;&gt;&lt;/item-vue&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123;getPexlesList&#125; from &#x27;@/api/pexeis&#x27;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">import itemVue from &#x27;./item.vue&#x27;</span><br><span class="line">/**</span><br><span class="line"> * 构建数据请求</span><br><span class="line"> */</span><br><span class="line">let query=&#123;</span><br><span class="line">  page:1,</span><br><span class="line">  size:20</span><br><span class="line">&#125;</span><br><span class="line">const pexelsList = ref([])</span><br><span class="line">const getPexlesData = async()=&gt;&#123;</span><br><span class="line">  const res = await getPexlesList(query)</span><br><span class="line">  pexelsList.value=res.list</span><br><span class="line">&#125;</span><br><span class="line">getPexlesData()</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>设置main&#x2F;components&#x2F;list&#x2F;item.vue的内容</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div class=&#x27;bg-white dark:bg-zinc-900 xl:dark:bg-zinc-800 rounded pb-1 h-[280px] w-[230px]&#x27;&gt;</span><br><span class="line">  &lt;div class=&#x27;relative w-full rounded cursor-zoom-in group&#x27;&gt;</span><br><span class="line">&lt;!--    图片--&gt;</span><br><span class="line">    &lt;img class=&#x27;w-full rounded bg-transparent&#x27; :src=&#x27;data.photo&#x27;/&gt;</span><br><span class="line">&lt;!--    遮罩层--&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      class=&#x27;hidden opacity-0 w-full h-full bg-zinc-900/50 absolute top-0</span><br><span class="line">      left-0 rounded duration-300 group-hover:opacity-100 xl:block&#x27;&gt;</span><br><span class="line">&lt;!--      分享--&gt;</span><br><span class="line">      &lt;m-button class=&#x27;absolute top-1.5 left-1.5&#x27;&gt;分享&lt;/m-button&gt;</span><br><span class="line">&lt;!--      点赞--&gt;</span><br><span class="line">      &lt;m-button</span><br><span class="line">        class=&#x27;absolute top-1.5 right-1.5&#x27;</span><br><span class="line">        type=&#x27;info&#x27;</span><br><span class="line">        icon=&#x27;heart&#x27;</span><br><span class="line">        iconClass=&#x27;fill-zinc-900 dark:fill-zinc-200&#x27;</span><br><span class="line">      &gt;&lt;/m-button&gt;</span><br><span class="line">&lt;!--      下载--&gt;</span><br><span class="line">      &lt;m-button</span><br><span class="line">        class=&#x27;absolute bottom-1.5 left-1.5 bg-zinc-100/70&#x27;</span><br><span class="line">        type=&#x27;info&#x27;</span><br><span class="line">        size=&#x27;small&#x27;</span><br><span class="line">        icon=&#x27;download&#x27;</span><br><span class="line">        iconClass=&#x27;fill-zinc-900 dark:fill-zinc-200&#x27;</span><br><span class="line">      &gt;&lt;/m-button&gt;</span><br><span class="line">&lt;!--      全屏--&gt;</span><br><span class="line">      &lt;m-button</span><br><span class="line">        class=&#x27;absolute bottom-1.5 right-1.5 bg-zinc-100/70&#x27;</span><br><span class="line">        type=&#x27;info&#x27;</span><br><span class="line">        size=&#x27;small&#x27;</span><br><span class="line">        icon=&#x27;full&#x27;</span><br><span class="line">        iconClass=&#x27;fill-zinc-900 dark:fill-zinc-200&#x27;</span><br><span class="line">      &gt;&lt;/m-button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;!--  标题--&gt;</span><br><span class="line">  &lt;p class=&#x27;text-sm mt-1 font-bold text-zinc-900 dark:text-zinc-300 px-1&#x27;&gt;</span><br><span class="line">    &#123;&#123;data.title&#125;&#125;</span><br><span class="line">  &lt;/p&gt;</span><br><span class="line">&lt;!--  作者--&gt;</span><br><span class="line">  &lt;div class=&#x27;flex items-center mt-1 px-1&#x27;&gt;</span><br><span class="line">    &lt;img class=&quot;h-2 w-2 rounded-full&quot; :src=&quot;data.avatar&quot; alt=&#x27;&#x27;/&gt;</span><br><span class="line">    &lt;span class=&#x27;text-sm text-zinc-500 ml-1&#x27;&gt;&#123;&#123;data.author&#125;&#125;&lt;/span&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="9-2-通用组件：瀑布流组件构建分析"><a href="#9-2-通用组件：瀑布流组件构建分析" class="headerlink" title="9-2 通用组件：瀑布流组件构建分析"></a>9-2 通用组件：瀑布流组件构建分析</h2><p>目前咱们的列表组件已经可以展示了，只不过是展示的样式还存在一些问题。</p>
<p>那么这样的一个样式处理的过程就是<strong>瀑布流组件的构建过程</strong></p>
<p>所以说我们想要搞清楚，这个瀑布流如何构建，那么就需要搞明白，现在的样式中，还存在的问题是什么？</p>
<p>存在的问题就是<strong>：每个item应该横向排列，第二行的item顺序连接到当前最短的列中</strong>，而这个也就是构建瀑布流的核心逻辑。</p>
<p>那么想要实现这个核心逻辑，我们的每个item肯定就不可以使用正常的布局方式，而必须使用 absolute 绝对布局，通过top 和left 来手动控制位置。</p>
<p>那么明确好了这个核心逻辑之后，接下来如何进行构建呢？</p>
<p>想要搞明白一个复杂组件的构建机制，那么最好的方式是想象一下：<strong>当你去使用这个组件时，你希望如何进行使用。</strong></p>
<p>按照你期望的使用方式来反向思考构建过程，这样在主要的思路上就不会出现大的偏差。<br>那么我们期望，将来这个通用组件可以这样使用：在main&#x2F;components&#x2F;list&#x2F;index.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">  &lt;m-waterfall :data=&quot;&quot; :nodeKey=&quot;&quot; :column=&quot;&quot; :picturePreReading=&quot;&quot;&gt;</span><br><span class="line">    &lt;template v-slot=&#x27;&#123;item,width&#125;&#x27;&gt;</span><br><span class="line">      &lt;item-vue :data=&#x27;item&#x27;&gt;&lt;/item-vue&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">  &lt;/m-waterfall&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<p>那么综合起来来看，整个的一个瀑布流组件的构建我们需要分成几分：</p>
<ol>
<li><p>通过props传递关键数据（部分）:</p>
<ol>
<li>data：数据源</li>
<li>nodeKey：唯一标识</li>
<li>column：宣染的列数</li>
<li>picturePreReading：是否需要图片预宣染</li>
</ol>
</li>
<li><p>瀑布流宣染机制：通过absolute 配合 relative完成布局，布局逻辑为：<strong>每个item应该横向排列，第二行的item顺序连接到当前最短的列中</strong></p>
</li>
<li><p>通过<strong>作用域插槽</strong>将每个item中涉及到的关键数据，传递到item视图中</p>
</li>
</ol>
<h2 id="9-3-通用组件-瀑布流：构建瀑布流布局，获取容器宽度与列宽"><a href="#9-3-通用组件-瀑布流：构建瀑布流布局，获取容器宽度与列宽" class="headerlink" title="9-3 通用组件-瀑布流：构建瀑布流布局，获取容器宽度与列宽"></a>9-3 通用组件-瀑布流：构建瀑布流布局，获取容器宽度与列宽</h2><ol>
<li>创建 src&#x2F;libs&#x2F;waterfall&#x2F;index.vue组件，并创建如下 props：</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> props = <span class="title function_">defineProps</span>(&#123;</span><br><span class="line">  <span class="comment">//数据源</span></span><br><span class="line">  <span class="attr">data</span>:&#123;</span><br><span class="line">    <span class="attr">type</span>:<span class="title class_">Array</span>,</span><br><span class="line">    <span class="attr">require</span>:<span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//唯一标识</span></span><br><span class="line">  <span class="attr">nodeKey</span>:&#123;</span><br><span class="line">    <span class="attr">type</span>:<span class="title class_">String</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//列数</span></span><br><span class="line">  <span class="attr">colunm</span>:&#123;</span><br><span class="line">    <span class="attr">default</span>:<span class="number">2</span>,</span><br><span class="line">    <span class="attr">type</span>:<span class="title class_">Number</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//列间距</span></span><br><span class="line">  <span class="attr">colunmSpacing</span>:&#123;</span><br><span class="line">    <span class="attr">default</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="attr">type</span>:<span class="title class_">Number</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//行间距</span></span><br><span class="line">  <span class="attr">rowSpacing</span>:&#123;</span><br><span class="line">    <span class="attr">default</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="attr">type</span>:<span class="title class_">Number</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//是否需要进行图片预读取</span></span><br><span class="line">  <span class="attr">picturePreReading</span>:&#123;</span><br><span class="line">    <span class="attr">type</span>:<span class="title class_">Boolean</span>,</span><br><span class="line">    <span class="attr">default</span>:<span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>构建对应的基础视图</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    class=&#x27;relative&#x27;</span><br><span class="line">    ref=&#x27;containerTarget&#x27;</span><br><span class="line">    :style=&quot;&#123;</span><br><span class="line">      height:containerHeight+&#x27;px&#x27; //因为当前为relative布局，所以需要主动指定高度</span><br><span class="line">    &#125;&quot;</span><br><span class="line">  &gt;</span><br><span class="line">&lt;!--因为列数不确定，所以需要根据列数计算每列的宽度，所以等待列宽计算完成，并且有了数据源后进行渲染--&gt;</span><br><span class="line">    &lt;template v-if=&#x27;columnWidth &amp;&amp; data.length&#x27;&gt;</span><br><span class="line">&lt;!--      通过动态的style来计算对应的列宽、left、top--&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        v-for=&quot;&#123;item,index&#125; in data&quot;</span><br><span class="line">        :key=&quot;nodeKey ?item[nodeKey] :index&quot;</span><br><span class="line">        class=&#x27;m-waterfall-item absolute duration-300&#x27;</span><br><span class="line">        :style=&quot;&#123;</span><br><span class="line">          width:columnWidth+&#x27;px&#x27;,</span><br><span class="line">          left:item._style?.left+&#x27;px&#x27;,</span><br><span class="line">          top:item._style?.top+&#x27;px&#x27;</span><br><span class="line">        &#125;&quot;</span><br><span class="line">&gt;</span><br><span class="line">        &lt;slot :item=&#x27;item&#x27; :width=&#x27;columnWidth&#x27; :index=&#x27;index&#x27;/&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">&lt;!--    加载中--&gt;</span><br><span class="line">    &lt;div v-else&gt;加载中...&lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>根据以上基础视图，我们需要生成对应的：</p>
<ol>
<li>containerHeight：总高度</li>
<li>columnWidth：列宽</li>
<li>item.<em>style.left：每个item对应的left</em></li>
<li>_item._style.right：每个item对应的right</li>
</ol>
</li>
<li><p>想要计算<strong>总高度</strong>，那么需要计算出<strong>每一列的高度</strong>，最高的一列为<strong>总高度</strong></p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//容器的总高度 = 最高的这一列的高度</span></span><br><span class="line"><span class="keyword">const</span> containerHeight = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line"><span class="comment">//记录每列高度的容器key:所在列 val：列高</span></span><br><span class="line"><span class="keyword">const</span> columnHeightObj = <span class="title function_">ref</span>(&#123;&#125;)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 构建记录每列高度的对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useColumnHeightObj</span> =(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  columnHeightObj.<span class="property">value</span>=&#123;&#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; props.<span class="property">colunm</span>; i++) &#123;</span><br><span class="line">    columnHeightObj.<span class="property">value</span>[i]= <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>想要计算列宽，那么首先需要有容器的总宽度：</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//容器实例</span></span><br><span class="line"><span class="keyword">const</span> containerTarget = <span class="title function_">ref</span>(<span class="literal">null</span>)</span><br><span class="line"><span class="comment">//容器总宽度（不包括padding、margin、border）</span></span><br><span class="line"><span class="keyword">const</span> containerWidth = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line"><span class="comment">//容器左边距、计算item left 时，需要定位</span></span><br><span class="line"><span class="keyword">const</span> containerLeft = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 计算容器宽度</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useContainerWidth</span> = (<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;paddingLeft,paddingRight&#125;=<span class="title function_">getComputedStyle</span>(</span><br><span class="line">    containerTarget.<span class="property">value</span>,</span><br><span class="line">    <span class="literal">null</span></span><br><span class="line">  )</span><br><span class="line">  <span class="comment">//容器左边距</span></span><br><span class="line">  containerLeft.<span class="property">value</span>=<span class="built_in">parseFloat</span>(paddingLeft)</span><br><span class="line">  <span class="comment">//容器宽度</span></span><br><span class="line">  containerWidth.<span class="property">value</span> =</span><br><span class="line">    containerTarget.<span class="property">value</span>.<span class="property">offsetWidth</span>-</span><br><span class="line">    <span class="built_in">parseFloat</span>(paddingLeft)-</span><br><span class="line">    <span class="built_in">parseFloat</span>(paddingRight)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>计算列宽</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//列宽</span></span><br><span class="line"><span class="keyword">const</span> columnWidth = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line"><span class="comment">//列间距合计</span></span><br><span class="line"><span class="keyword">const</span> columnSpacingTotal = <span class="title function_">computed</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">//如果是五列，则存在4个列间距</span></span><br><span class="line">  <span class="keyword">return</span>(props.<span class="property">colunm</span>-<span class="number">1</span>)*props.<span class="property">colunmSpacing</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 开始计算</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useColumnWidth</span> =(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  <span class="comment">//获取容器宽度</span></span><br><span class="line">  <span class="title function_">useContainerWidth</span>()</span><br><span class="line">  <span class="comment">//计算列宽</span></span><br><span class="line">  columnWidth.<span class="property">value</span> = (containerWidth.<span class="property">value</span>-columnSpacingTotal)/props.<span class="property">colunm</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">onMounted</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">//计算列宽</span></span><br><span class="line">  <span class="title function_">useColumnWidth</span>()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>此时，在src&#x2F;views&#x2F;main&#x2F;components&#x2F;list&#x2F;index，vue 中使用该组件，可以打印出计算的值</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">  &lt;m-waterfall :data=&quot;pexelsList&quot; :nodeKey=&quot;id&quot; :column=&quot;5&quot; :picturePreReading=&quot;true&quot;&gt;</span><br><span class="line">    &lt;template v-slot=&#x27;&#123;item,width&#125;&#x27;&gt;</span><br><span class="line">      &lt;item-vue :data=&#x27;item&#x27;&gt;&lt;/item-vue&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">  &lt;/m-waterfall&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<h2 id="9-4-布流：区分图片预加载，获取元素关键属性"><a href="#9-4-布流：区分图片预加载，获取元素关键属性" class="headerlink" title="9-4 布流：区分图片预加载，获取元素关键属性"></a>9-4 布流：区分图片预加载，获取元素关键属性</h2><p>想要计算每列的left，right，那么需要拿到每个 item的高度，因为只有有了每个item高，才可以判断下一列的第一个item的位置。</p>
<p>同时我们根据<strong>picturePreReading</strong>又可以分为两种情况：</p>
<ol>
<li>需要图片预加载时：图片高度未知</li>
<li>不需要图片预加载时：图片高度已知</li>
</ol>
<p>根据以上分析可得出以下代码:</p>
<ol>
<li>根据两种不同的情况，我们需要有两个不同的方法来进行计算：</li>
</ol>
<p><strong>需要图片预加载时</strong></p>
<ol>
<li>图片高度未知</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//item高度集合</span></span><br><span class="line"><span class="keyword">let</span> itemHeights=[]</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 监听图片加载完成(需要图片加载)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">waitImgComplate</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  itemHeights = []</span><br><span class="line">  <span class="comment">//拿到所有的元素</span></span><br><span class="line">  <span class="keyword">let</span> itemElements = [...<span class="variable language_">document</span>.<span class="title function_">getElementsByClassName</span>(<span class="string">&#x27;m-waterfall-item&#x27;</span>)]</span><br><span class="line">  <span class="comment">//获取到元素的img标签</span></span><br><span class="line">  <span class="keyword">const</span> imgElements = <span class="title function_">getImgElements</span>(itemElements)</span><br><span class="line">  <span class="comment">//获取所有img标签的图片</span></span><br><span class="line">  <span class="keyword">const</span> allImgs = <span class="title function_">getAllImg</span>(imgElements)</span><br><span class="line">  <span class="comment">//等待图片加载完成</span></span><br><span class="line">  <span class="title function_">onComplateImgs</span>(allImgs).<span class="title function_">then</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//图片加载完成</span></span><br><span class="line">    imgElements.<span class="title function_">forEach</span>(<span class="function">(<span class="params">el</span>)=&gt;</span>&#123;</span><br><span class="line">      itemHeights.<span class="title function_">push</span>(el.<span class="property">offsetHeight</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">//渲染位置</span></span><br><span class="line">    <span class="title function_">useItemLocation</span>()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>以上使用到了多个工具方法，可以创建src&#x2F;libs&#x2F;waterfall&#x2F;utils.js 模块进行处理：</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 从itemElement中抽离出所有的imgElements</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getImgElements</span> = (<span class="params">itemElements</span>)=&gt;&#123;</span><br><span class="line">  <span class="keyword">const</span> imgElements = []</span><br><span class="line">  itemElements.<span class="title function_">forEach</span>(<span class="function">(<span class="params">el</span>)=&gt;</span>&#123;</span><br><span class="line">    imgElements.<span class="title function_">push</span>(...el.<span class="title function_">getElementsByTagName</span>(<span class="string">&#x27;img&#x27;</span>))</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> imgElements</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 生成所有的图片连接数组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getAllImg</span> = (<span class="params">imgElements</span>)=&gt;&#123;</span><br><span class="line">  <span class="keyword">return</span> imgElements.<span class="title function_">map</span>(<span class="function">(<span class="params">imgElements</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> imgElements.<span class="property">src</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 监听图片数组加载完成（promise）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">onComplateImgs</span> = (<span class="params">imgs</span>) =&gt;&#123;</span><br><span class="line">  <span class="comment">//promise集合</span></span><br><span class="line">  <span class="keyword">const</span> promiseAll = []</span><br><span class="line">  <span class="comment">//循环imgs,构建promiseAll</span></span><br><span class="line">  imgs.<span class="title function_">forEach</span>(<span class="function">(<span class="params">img,index</span>)=&gt;</span>&#123;</span><br><span class="line">    promiseAll[index] = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resole,reject</span>)=&gt;</span>&#123;</span><br><span class="line">      <span class="comment">//处理img的加载情况</span></span><br><span class="line">      <span class="keyword">const</span> imageObj = <span class="keyword">new</span> <span class="title class_">Image</span>()</span><br><span class="line">      imageObj.<span class="property">src</span> = img</span><br><span class="line">      imageObj.<span class="property">onload</span> = <span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="title function_">resolve</span>(&#123;</span><br><span class="line">          img,</span><br><span class="line">          index</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>(promiseAll)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>不需要图片预加载时</strong></p>
<ol>
<li>图片高度已知</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 不需要图片预加载</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useItemHeight</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  itemHeights = []</span><br><span class="line">  <span class="comment">//拿到所有的元素</span></span><br><span class="line">  <span class="keyword">let</span> itemElements = [...<span class="variable language_">document</span>.<span class="title function_">getElementsByClassName</span>(<span class="string">&#x27;m-waterfall-item&#x27;</span>)]</span><br><span class="line">  <span class="comment">//计算item高度</span></span><br><span class="line">  itemElements.<span class="title function_">forEach</span>(<span class="function">(<span class="params">el</span>)=&gt;</span>&#123;</span><br><span class="line">    itemHeights.<span class="title function_">push</span>(el.<span class="property">offsetHeight</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">//渲染位置</span></span><br><span class="line">  <span class="title function_">useItemLocation</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>渲染位置</strong></p>
<p>在useItemLocation方法中，打印所有的图片高度：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 渲染位置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useItemLocation</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(itemHeights)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>监听数据获取时，触发对应的计算：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 触发计算</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">  <span class="function">()=&gt;</span>props.<span class="property">data</span>,</span><br><span class="line">  <span class="function">(<span class="params">newVal</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="title function_">nextTick</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (props.<span class="property">picturePreReading</span>)&#123;</span><br><span class="line">        <span class="title function_">waitImgComplate</span>()</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="title function_">useItemHeight</span>()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">deep</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">immediate</span>:<span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="9-5-通用组件-瀑布流：触发计算，定位item位置"><a href="#9-5-通用组件-瀑布流：触发计算，定位item位置" class="headerlink" title="9-5 通用组件-瀑布流：触发计算，定位item位置"></a>9-5 通用组件-瀑布流：触发计算，定位item位置</h2><ol>
<li>在useItemLocation方法中为每个item定位位置：</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 为每个item生成位置属性</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useItemLocation</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  <span class="comment">//遍历数据源</span></span><br><span class="line">  props.<span class="property">data</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item,index</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//避免重复计算</span></span><br><span class="line">    <span class="keyword">if</span> (item.<span class="property">_style</span>)&#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//生成style属性</span></span><br><span class="line">    item.<span class="property">_style</span>=&#123;&#125;</span><br><span class="line">    <span class="comment">//left</span></span><br><span class="line">    item.<span class="property">_style</span>.<span class="property">left</span> = <span class="title function_">getItemLeft</span>()</span><br><span class="line">    <span class="comment">//top</span></span><br><span class="line">    item.<span class="property">_style</span>.<span class="property">top</span> = <span class="title function_">getItemTop</span>()</span><br><span class="line">    <span class="comment">//指定的列高度的自增</span></span><br><span class="line">    <span class="title function_">increasingHeight</span>(index)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">//指定容器高度</span></span><br><span class="line">  containerHeight.<span class="property">value</span>=<span class="title function_">getMaxHeight</span>(columnHeightObj.<span class="property">value</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>创建getItemLeft 方法</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 返回下一个item的left</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getItemLeft</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  <span class="comment">//拿到最小宽度的列</span></span><br><span class="line">  <span class="keyword">const</span> column = <span class="title function_">getMinHeightColumn</span>(columnHeightObj.<span class="property">value</span>)</span><br><span class="line">  <span class="keyword">return</span> column*(columnWidth.<span class="property">value</span>+props.<span class="property">colunmSpacing</span>)+containerLeft.<span class="property">value</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在utils中创建getMinHeightColumn方法</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 返回列高对象中最小高度所在的列</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getMinHeightColumn</span> = (<span class="params">columnHeightObj</span>)=&gt;&#123;</span><br><span class="line">  <span class="comment">//拿到最小高度</span></span><br><span class="line">  <span class="keyword">const</span> minHeight = <span class="title function_">getMinHeight</span>(columnHeightObj)</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">keys</span>(columnHeightObj).<span class="title function_">find</span>(<span class="function">(<span class="params">key</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> columnHeightObj[key] === minHeight</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>创建 getItemTop方法：</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 返回下一个item的Top</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getItemTop</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line"> <span class="keyword">return</span> <span class="title function_">getMinHeight</span>(columnHeightObj.<span class="property">value</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>在utils中创建 getMinHeight方法</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 返回列高对象中最小的高度</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getMinHeight</span>=(<span class="params">columnHeightObj</span>)=&gt;&#123;</span><br><span class="line">  <span class="keyword">const</span> columnHeightArr = <span class="title class_">Object</span>.<span class="title function_">values</span>(columnHeightObj)</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">min</span>(...columnHeightArr)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>创建 increasingHeight 方法：</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 指定列高度自增</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">increasingHeight</span> =(<span class="params">index</span>)=&gt;&#123;</span><br><span class="line">  <span class="comment">//最小高度所在列</span></span><br><span class="line">  <span class="keyword">const</span> minHeightColumn=<span class="title function_">getMinHeightColumn</span>(columnHeightObj.<span class="property">value</span>)</span><br><span class="line">  <span class="comment">//使该列自增</span></span><br><span class="line">  columnHeightObj.<span class="property">value</span>[minHeightColumn] += itemHeights[index]+props.<span class="property">rowSpacing</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>在utils中创建getMaxHeight方法作为容器高度</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 返回列高对象中最大的高度</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getMaxHeight</span>=(<span class="params">columnHeightObj</span>)=&gt;&#123;</span><br><span class="line">  <span class="keyword">const</span> columnHeightArr = <span class="title class_">Object</span>.<span class="title function_">values</span>(columnHeightObj)</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">max</span>(...columnHeightArr)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="8">
<li>在组件销毁时，清除所有的_style</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 在组件销毁的时候，清除所有的_style</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">onUnmounted</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  props.<span class="property">data</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">delete</span> item.<span class="property">_style</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="9">
<li>最后我们修改触发计算，构建高度记录容器</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 触发计算</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">  <span class="function">()=&gt;</span>props.<span class="property">data</span>,</span><br><span class="line">  <span class="function">(<span class="params">newVal</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="title function_">nextTick</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">      <span class="comment">//第一次获取数据时，构建高度记录容器</span></span><br><span class="line">      <span class="keyword">const</span> resetColumnHeight = newVal.<span class="title function_">every</span>(<span class="function">(<span class="params">item</span>)=&gt;</span>!item.<span class="property">_style</span>)</span><br><span class="line">      <span class="keyword">if</span> (resetColumnHeight)&#123;</span><br><span class="line">        <span class="comment">//构建高度记录容器</span></span><br><span class="line">        <span class="title function_">useColumnHeightObj</span>()</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (props.<span class="property">picturePreReading</span>)&#123;</span><br><span class="line">        <span class="title function_">waitImgComplate</span>()</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="title function_">useItemHeight</span>()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">deep</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">immediate</span>:<span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="9-6-通用组件-瀑布流：解决瀑布流展示不全的问题"><a href="#9-6-通用组件-瀑布流：解决瀑布流展示不全的问题" class="headerlink" title="9-6 通用组件-瀑布流：解决瀑布流展示不全的问题"></a>9-6 通用组件-瀑布流：解决瀑布流展示不全的问题</h2><p>现在我们运行项目可以发现最底部的瀑布流元素无法展示完全。</p>
<p>出现这个问题的原因是因为在src&#x2F;views&#x2F;layout&#x2F;index.vue中的h-main的高度，被子组件内部的h-full的class给冲掉了。</p>
<p>为了防止以后还出现这样的情况，所以我们只要在src&#x2F;views&#x2F;layout&#x2F;index.vue 中为main-vue 外层包一个 div即可：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&#x27;h-main&#x27;&gt;</span><br><span class="line">  &lt;main-vue&gt;&lt;/main-vue&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<h2 id="9-7-通用组件-瀑布流：适配移动端，动态列"><a href="#9-7-通用组件-瀑布流：适配移动端，动态列" class="headerlink" title="9-7 通用组件-瀑布流：适配移动端，动态列"></a>9-7 通用组件-瀑布流：适配移动端，动态列</h2><p>目前，我们的瀑布流组件可以适配PC端，但是移动端，还存在一些问题，所以说，我们需要让我们的<strong>瀑布流</strong>组件可以适配移动端场景。</p>
<p>那么想要适配移动端，关键在于三点：</p>
<p><strong>列数变化</strong></p>
<p>列数的变化想要处理比较简单，我们只需要利用isMobileTerminal方法来去判断即可。</p>
<p>在 src&#x2F;views&#x2F;main&#x2F;components&#x2F;list&#x2F;index.vue中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:column=<span class="string">&quot;isMobileTerminal?2:5&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>列宽和定位</strong></p>
<p>比较麻烦的地方在于<strong>列宽和定位</strong>如何进行重新计算，即：重新计算的时机是什么？</p>
<p>我们期望当<strong>列数发生变化时</strong>，重新执行计算：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 监听列数变化，重新构建瀑布流</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">reset</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  <span class="comment">//延迟100毫秒，否则会导致宽度计算不正确</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//重新计算列宽</span></span><br><span class="line">    <span class="title function_">useColumnWidth</span>()</span><br><span class="line">    <span class="comment">//重置所有的定位数据，因为data中进行了深度监听，所以该操作会触发data的watch</span></span><br><span class="line">    props.<span class="property">data</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>)=&gt;</span>&#123;</span><br><span class="line">      item.<span class="property">_style</span> = <span class="literal">null</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,<span class="number">100</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 监听列数变化</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">  <span class="function">()=&gt;</span>props.<span class="property">colunm</span>,</span><br><span class="line">  <span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//在picturePreReading为true的前提下，需要首先为列宽滞空，列宽滞空之后，会取消瀑布流渲染</span></span><br><span class="line">    columnWidth.<span class="property">value</span>=<span class="number">0</span></span><br><span class="line">    <span class="title function_">reset</span>()</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>此时，在 src&#x2F;views&#x2F;main&#x2F;components&#x2F;list&#x2F;index.vue 中修改 picturePreReading 为true，表示等待图片预加载。</p>
<p>则双端切换可以正常实现。</p>
<p>处理两个小的样式问题：</p>
<ol>
<li>移动端下navigationBar 定位，在src&#x2F;App.vue中：</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--  一级路由出口--&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&#x27;h-screen w-screen fixed top-0 left-0&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">router-view</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>移动端下列表的横向 padding，在 src&#x2F;views&#x2F;main&#x2F;components&#x2F;list&#x2F;index.vue：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;m-waterfall</span><br><span class="line">  class=&quot;px-1 w-full&quot;&gt;</span><br><span class="line">&lt;/m-waterfall&gt;</span><br></pre></td></tr></table></figure>

<h2 id="9-8-通用组件-瀑布流：无需图片预加载时，优化功能处理"><a href="#9-8-通用组件-瀑布流：无需图片预加载时，优化功能处理" class="headerlink" title="9-8 通用组件-瀑布流：无需图片预加载时，优化功能处理"></a>9-8 通用组件-瀑布流：无需图片预加载时，优化功能处理</h2><ol>
<li>我们修改src&#x2F;views&#x2F;main&#x2F;components&#x2F;list&#x2F;index.vue的picturePreReading为false，会出现的是切换pc和手机端时刷新后页面图片显示不全</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;m-waterfall</span><br><span class="line">  :picturePreReading=&quot;false&quot;&gt;</span><br><span class="line">&lt;/m-waterfall&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>此时我们需要利用服务器所返回的宽高主动为item指定一个高度，我们将插槽中的width传到item组件中</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;m-waterfall&gt;</span><br><span class="line">  &lt;template v-slot=&#x27;&#123;item,width&#125;&#x27;&gt;</span><br><span class="line">    &lt;item-vue :data=&#x27;item&#x27; :width=&#x27;width&#x27;&gt;&lt;/item-vue&gt;</span><br><span class="line">  &lt;/template&gt;</span><br><span class="line">&lt;/m-waterfall&gt;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>然后我们在main&#x2F;componnets&#x2F;list&#x2F;item.vue中引入width，并在图片中样式进行显示</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">defineProps</span>(&#123;</span><br><span class="line">  <span class="attr">width</span>:&#123;</span><br><span class="line">    <span class="attr">type</span>:<span class="title class_">Number</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">&lt;!--    图片--&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&#x27;w-full rounded bg-transparent&#x27;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">         <span class="attr">:src</span>=<span class="string">&#x27;data.photo&#x27;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">         <span class="attr">:style</span>=<span class="string">&quot;&#123;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">           height:(width/data.photoWidth)*data.photoWidth+&#x27;px&#x27;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">         &#125;&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    /&gt;</span></span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>我们修改libs&#x2F;waterfall&#x2F;index.vue</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 监听列数变化</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">  <span class="function">()=&gt;</span>props.<span class="property">colunm</span>,</span><br><span class="line">  <span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (props.<span class="property">picturePreReading</span>)&#123;</span><br><span class="line">      columnWidth.<span class="property">value</span>=<span class="number">0</span></span><br><span class="line">      <span class="comment">//数据改变之后，视图改变之后的回调</span></span><br><span class="line">      <span class="title function_">reset</span>()</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">reset</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="9-9-通用组件-瀑布流：总结"><a href="#9-9-通用组件-瀑布流：总结" class="headerlink" title="9-9 通用组件-瀑布流：总结"></a>9-9 通用组件-瀑布流：总结</h2><p>瀑布流是一个比较复杂的通用组件，因为我们要尽量做到<strong>普适</strong>，所以就需要考虑到各种场景下的处理方案，尽量可以满足日常开发的场景。所以这就在原本就复杂的前提下，让这个功能变得更加复杂了。</p>
<p>下面我们就再来梳理一下整个瀑布流的构建过程：</p>
<ol>
<li><p>瀑布流的核心就是：<strong>通过relative和absolute定位的方式，来控制每个item的位置</strong></p>
</li>
<li><p>影响瀑布流高度的主要元素，通常都是<strong>img</strong>标签</p>
</li>
<li><p>有些服务端会返回<strong>关键img的高度</strong>，有些不会，所以我们需要分别处理：</p>
<ol>
<li>当服务端<strong>不返回</strong>高度时：我们需要等待img加载完成之后，再来计算高度，然后通过得到的高度计算定位。否则则会出现高度计算不准确导致定位计算不准确的问题。</li>
<li>当服务端<strong>返回</strong>高度时：开发者则必须利用此高度为item进行高度设定。一旦item具备指定高度，那么我们就不需要等待img加载的过程，这样效率更高，并且可以业务的逻辑会变得更加简单。</li>
</ol>
</li>
<li><p>当进行响应式切换时，同样需要区分对应场景：</p>
<ol>
<li>当服务端<strong>不返回</strong>高度时：我们需要重<strong>新执行整个宣染流程</strong>，虽然会耗费一些性能，但是这样可以最大可能的避免出现逻辑错误。让组件拥有更强的普适性。</li>
<li>当服务端<strong>返回</strong>高度时：我们同样需要重新计算<strong>列宽和定位</strong>，但是因为item具备明确的高度，所以我们可以直接拿到具体的高度，而无需重复整个渲染流程，从而可以实现更多的交互逻辑。比如：位移动画、将来的图片懒加载占位.</li>
</ol>
</li>
</ol>
<h2 id="9-10-通用组件：长列表infinite构建分析"><a href="#9-10-通用组件：长列表infinite构建分析" class="headerlink" title="9-10 通用组件：长列表infinite构建分析"></a>9-10 通用组件：长列表infinite构建分析</h2><p>处理好瀑布流之后，接下来我们就需要来处理对应的长列表功能。</p>
<p>我们知道对于对于首页中的瀑布流而言，是需要进行长列表展示的，也就说它是一个分页的数据。</p>
<p>那么对于这种分页功能而言，我们又应该如何进行实现呢？</p>
<p>想要搞明白这个问题，那么同样我们需要分成两个方面来去看：</p>
<ol>
<li>长列表的实现原理是什么？</li>
<li>我们使用长列表时，希望如何进行使用？</li>
</ol>
<p><strong>长列表的实现原理</strong></p>
<p>所谓长列表分页加载，其实指的就是：<strong>当滚动到列表底部时，加载数据</strong></p>
<p>那么我们想要实现咱们的长列表组件，围绕着的依然是这句话。</p>
<p>那么想要实现这个功能，我们需要做的核心的一点就是能够<strong>监听到列表滚动到底部</strong></p>
<p>那么想要监听到列表滚动到底部的话，可以利用<strong>IntersectionObserver</strong>，该接口可以判断：<strong>目标元素与其祖先元素或顶级文档视窗（viewport）的交叉状态（是否可见）</strong></p>
<p>那么我们就可以利用这个特性，把一个元素<strong>置于列表底部</strong>，当这个元素可见时则表示<strong>列表滚动到了底部</strong>。</p>
<p>那么原生的IntersectionObserver 使用起来比较复杂，所以<strong>vueuse提供了uselntersectionObserver方法。</strong></p>
<p><strong>我们使用长列表时，希望如何进行使用</strong></p>
<p>这个的判断和瀑布流时的判断逻辑一样，通过这样的逻辑，可以让我们知道这个组件的prop应该如何构建。</p>
<p>那么我们期望使用它时是这样的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;m-infinite-list</span><br><span class="line">    v-model=&quot;&quot;//当前是否处于加载状态</span><br><span class="line">    :isFinished=&quot;&quot;//数据是否全部加载完成</span><br><span class="line">    @onLoad=&quot;&quot;//加载下一页数据的触发事件</span><br><span class="line">&gt;</span><br><span class="line">    列表</span><br><span class="line">&lt;/m-infinite-list&gt;</span><br></pre></td></tr></table></figure>

<h2 id="9-11-通用组件：构建长列表infinite组件"><a href="#9-11-通用组件：构建长列表infinite组件" class="headerlink" title="9-11 通用组件：构建长列表infinite组件"></a>9-11 通用组件：构建长列表infinite组件</h2><ol>
<li>创建 src&#x2F;libs&#x2F;infinite-list&#x2F;index.vue 组件</li>
<li>构建props与emits，并处理双向数据绑定逻辑</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useVModel &#125; <span class="keyword">from</span> <span class="string">&#x27;@vueuse/core&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> props = <span class="title function_">defineProps</span>(&#123;</span><br><span class="line">  <span class="comment">//是否处于加载状态</span></span><br><span class="line">  <span class="attr">modelValue</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">Boolean</span>,</span><br><span class="line">    <span class="attr">required</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//数据是否全部加载完成</span></span><br><span class="line">  <span class="attr">isFinished</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">Boolean</span>,</span><br><span class="line">    <span class="attr">default</span>: <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> emits = <span class="title function_">defineEmits</span>([<span class="string">&#x27;onLoad&#x27;</span>, <span class="string">&#x27;update:modelValue&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">//处理loading状态</span></span><br><span class="line"><span class="keyword">const</span> loading = <span class="title function_">useVModel</span>(props)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>构建对应视图与插槽逻辑</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;!--内容--&gt;</span><br><span class="line">    &lt;slot /&gt;</span><br><span class="line">    &lt;div ref=&quot;loadingTarget&quot; class=&quot;h-6 py-4&quot;&gt;</span><br><span class="line">      &lt;!--加载更多--&gt;</span><br><span class="line">      &lt;m-svg-icon</span><br><span class="line">        v-show=&#x27;loading&#x27;</span><br><span class="line">        class=&#x27;w-4 h-4 mx-auto animate-spin&#x27;</span><br><span class="line">        name=&#x27;infinite-load&#x27;</span><br><span class="line">      &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">      &lt;!--没有更多数据--&gt;</span><br><span class="line">      &lt;p v-if=&#x27;isFinished&#x27; class=&#x27;text-center text-base text-zinc-400&#x27;&gt;</span><br><span class="line">        已经没有更多数据了</span><br><span class="line">      &lt;/p&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>利用 uselntersectionObserver方法，监听元素可见行为，用于判断列表滚动到底部：</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//滚动的元素</span></span><br><span class="line"><span class="keyword">const</span> loadingTarget= <span class="title function_">ref</span>(<span class="literal">null</span>)</span><br><span class="line"><span class="title function_">useIntersectionObserver</span>(loadingTarget,<span class="function">(<span class="params">[&#123;isIntersecting&#125;]</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">//当加载更多的视图可见时，同时loading为false，同时数据尚未全部加载完</span></span><br><span class="line">  <span class="comment">//处理加载更多逻辑</span></span><br><span class="line">  <span class="keyword">if</span>(isIntersecting &amp;&amp; !loading.<span class="property">value</span> &amp;&amp; !props.<span class="property">isFinished</span>)&#123;</span><br><span class="line">    <span class="comment">//修改加载数据标记</span></span><br><span class="line">    loading.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">    <span class="comment">//触发加载更多的行为</span></span><br><span class="line">    <span class="title function_">emits</span>(<span class="string">&#x27;onLoad&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="9-12-通用组件：应用-infinite-结合-waterfall-实现长列表瀑布流效果"><a href="#9-12-通用组件：应用-infinite-结合-waterfall-实现长列表瀑布流效果" class="headerlink" title="9-12 通用组件：应用 infinite 结合 waterfall 实现长列表瀑布流效果"></a>9-12 通用组件：应用 infinite 结合 waterfall 实现长列表瀑布流效果</h2><p>那么现在我们已经有了长列表组件 infinite 也有了瀑布流组件 waterfall，接下来就可以结合这两个通用组件，构建咱们的长列表瀑布流效果了</p>
<ol>
<li>src&#x2F;views&#x2F;main&#x2F;components&#x2F;list&#x2F;index.vue：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;m-infinite</span><br><span class="line">      v-model=&quot;loading&quot;</span><br><span class="line">      :isFinished=&quot;isFinished&quot;</span><br><span class="line">      @onLoad=&quot;getPexlesData&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;m-waterfall&gt;</span><br><span class="line">      .......</span><br><span class="line">      &lt;/m-waterfall&gt;</span><br><span class="line">    &lt;/m-infinite&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; getPexlesList &#125; from &#x27;@/api/pexeis&#x27;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">import itemVue from &#x27;./item.vue&#x27;</span><br><span class="line">import &#123; isMobileTerminal &#125; from &#x27;@/utils/flexible&#x27;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 构建数据请求</span><br><span class="line"> */</span><br><span class="line">let query = &#123;</span><br><span class="line">  page: 1,</span><br><span class="line">  size: 20</span><br><span class="line">&#125;</span><br><span class="line">//数据是否在加载中</span><br><span class="line">const loading = ref(false)</span><br><span class="line">//数据是否全部加载完成</span><br><span class="line">const isFinished = ref(false)</span><br><span class="line">//数据源</span><br><span class="line">const pexelsList = ref([])</span><br><span class="line">/**</span><br><span class="line"> * 加载数据的方法</span><br><span class="line"> * @returns &#123;Promise&lt;void&gt;&#125;</span><br><span class="line"> */</span><br><span class="line">const getPexlesData = async () =&gt; &#123;</span><br><span class="line">  //数据全部加载完成return</span><br><span class="line">  if (isFinished.value)&#123;</span><br><span class="line">    return</span><br><span class="line">  &#125;</span><br><span class="line">  //完成了第一次请求之后，后续的请求让page自增</span><br><span class="line">  if (pexelsList.value.length)&#123;</span><br><span class="line">    query.page+=1</span><br><span class="line">  &#125;</span><br><span class="line">  //触发接口</span><br><span class="line">  const res = await getPexlesList(query)</span><br><span class="line">  if (query.page === 1)&#123;</span><br><span class="line">    pexelsList.value = res.list</span><br><span class="line">  &#125;else&#123;</span><br><span class="line">    pexelsList.value.push(...res.list)</span><br><span class="line">  &#125;</span><br><span class="line">  //判断数据是否全部加载完成</span><br><span class="line">  if (pexelsList.value.length === res.total)&#123;</span><br><span class="line">    isFinished.value = true</span><br><span class="line">  &#125;</span><br><span class="line">  //修改loading标记</span><br><span class="line">  loading.value = false</span><br><span class="line">&#125;</span><br><span class="line">getPexlesData()</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="9-13-通用组件：解决首次数据无法铺满全屏时，数据无法继续加载"><a href="#9-13-通用组件：解决首次数据无法铺满全屏时，数据无法继续加载" class="headerlink" title="9-13 通用组件：解决首次数据无法铺满全屏时，数据无法继续加载"></a>9-13 通用组件：解决首次数据无法铺满全屏时，数据无法继续加载</h2><p>现在对于咱们当前的功能而言，还存在一个小的bug，那就是<strong>假如：首次加载的数据无法铺满全屏时，数据无法继续加载</strong></p>
<hr>
<p>其实出现这个问题的原因非常简单，我们在infinite 组件中，监听 laodingTarget元素是否可见，依次来判断是否需要进行下次的load，但是当首次加载数据无法铺满全屏时，isIntersecting虽然为true，但是它只会被触发一次，并不会再次触发，所以，我们就不再次触发oad。从而出现此bug。</p>
<p>那么明确好了原因只会，接下来想要解决这个问题就非常简单了，我们只需要：让load 可以在loading状态发生变化后，重新判断是否需要再次触发即可。</p>
<ol>
<li>我们修改lib&#x2F;infinite&#x2F;index.vue</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//滚动的元素</span></span><br><span class="line"><span class="keyword">const</span> loadingTarget= <span class="title function_">ref</span>(<span class="literal">null</span>)</span><br><span class="line"><span class="comment">//记录当前是否在底部</span></span><br><span class="line"><span class="keyword">const</span> targetIsIntersecting = <span class="title function_">ref</span>(<span class="literal">false</span>)</span><br><span class="line"><span class="title function_">useIntersectionObserver</span>(loadingTarget,<span class="function">(<span class="params">[&#123;isIntersecting&#125;]</span>)=&gt;</span>&#123;</span><br><span class="line">  targetIsIntersecting.<span class="property">value</span> = isIntersecting</span><br><span class="line">  <span class="title function_">emitLoad</span>()</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *触发load事件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">emitLoad</span> =(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//当加载更多的视图可见时，同时loading为false，同时数据尚未全部加载完</span></span><br><span class="line">    <span class="comment">//处理加载更多逻辑</span></span><br><span class="line">    <span class="keyword">if</span>(targetIsIntersecting &amp;&amp; !loading.<span class="property">value</span> &amp;&amp; !props.<span class="property">isFinished</span>)&#123;</span><br><span class="line">      <span class="comment">//修改加载数据标记</span></span><br><span class="line">      loading.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">      <span class="comment">//触发加载更多的行为</span></span><br><span class="line">      <span class="title function_">emits</span>(<span class="string">&#x27;onLoad&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 监听loading的变化，解决数据加载完成之后，首屏未铺满的问题</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">watch</span>(loading,emitLoad)</span><br></pre></td></tr></table></figure>

<h2 id="9-14-图片懒加载构建原因-实现原理"><a href="#9-14-图片懒加载构建原因-实现原理" class="headerlink" title="9-14 图片懒加载构建原因+实现原理"></a>9-14 图片懒加载构建原因+实现原理</h2><p><strong>为什么需要图片懒加载</strong></p>
<p>此时如果我们把src&#x2F;views&#x2F;main&#x2F;components&#x2F;list&#x2F;index.vue的query.size 修改为 100，然后切换到浏览器的network-&gt; img 可以发现此时的图片请求高达575次</p>
<p>但是我们现在显示的图片，明显是远远少于575这个数字的。</p>
<p>那么多余的这些请求是不是就会很“浪费”啊。</p>
<p>所以我们不想有这种浪费，就可以利用图片懒加载功能进行实现。</p>
<p><strong>图片懒加载实现原理</strong></p>
<p>那么图片懒加载如何进行实现呢？想要搞明日这个，我们就需要先明白图片懒加载的原理是什么。</p>
<p>所谓图片懒加载指的是：<strong>当图片不可见时，不加载图片。当图片可见时，才去加载图片。</strong></p>
<p>大家看见这个“不可见&amp;&amp;可见”是不是觉得很眼熟。是啊，这不就是实现长列表时用过的套路吗？</p>
<p>所以据此，咱们的实现方案是不是就呼之欲出了。</p>
<p>我们可以<strong>监听所有图片是否被可见，如果图片处于不可见状态，那么就不加载图片，如果图片处于可见状态，那么开始加载图片。</strong><br>而这个功能的实现关键就是<strong>IntersectionObserver。</strong></p>
<h2 id="9-15-通用指令：实现图片懒加载"><a href="#9-15-通用指令：实现图片懒加载" class="headerlink" title="9-15 通用指令：实现图片懒加载"></a>9-15 通用指令：实现图片懒加载</h2><p>我们知道了图片懒加载的实现原理。</p>
<p>但是到这里，那么多的img标签咱们怎么一个个监听到呢？</p>
<p>那么想要监听到所有img标签，我们可以利用指令来进行实现。</p>
<p>比如我们可以给所有的img增加一个v-lazy指令，在这个指令中可以拿到el也就是img标签本身，这样我们就可以监听到所有的img标签状态了。</p>
<p>所以据上所述，我们可以直接创建出对应的指</p>
<ol>
<li>我们首先创建文件src&#x2F;directives&#x2F;modules&#x2F;lazy.js</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useIntersectionObserver &#125; <span class="keyword">from</span> <span class="string">&#x27;@vueuse/core&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">//图片懒加载：在用户无法看到图片时，不加载图片，在用户可以看到图片后加载图片</span></span><br><span class="line">  <span class="comment">//如何判断用户是否看到了图片：useIntersectionObserver</span></span><br><span class="line">  <span class="comment">//如何做到不加载图片（网络）：img标签宣染图片，指的是img的src属性，src 属性是网络地址时，则会从网络中获取该图片资源。那么如果img标签不是网络地址呢？把该网络地址默认替换为非网络地址，然后当用户可见时，在替换成网络地址。</span></span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params">el</span>) &#123;</span><br><span class="line">    <span class="comment">//1.拿到当前的src</span></span><br><span class="line">    <span class="keyword">const</span> imgSrc = el.<span class="property">src</span></span><br><span class="line">    <span class="comment">//2. 把src变为空</span></span><br><span class="line">    el.<span class="property">src</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">const</span> &#123; stop &#125; = <span class="title function_">useIntersectionObserver</span>(el, <span class="function">(<span class="params">[&#123; isIntersecting &#125;]</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (isIntersecting) &#123;</span><br><span class="line">        <span class="comment">//3.当图片可见时，加载图片</span></span><br><span class="line">        el.<span class="property">src</span> = imgSrc</span><br><span class="line">        <span class="comment">//4.停止监听</span></span><br><span class="line">        <span class="title function_">stop</span>()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>然后我们在src&#x2F;directives&#x2F;index.js完成基本注册</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lazy <span class="keyword">from</span> <span class="string">&#x27;./modules/lazy&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 全局注册指令</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">install</span>(<span class="params">app</span>)&#123;</span><br><span class="line">    app.<span class="title function_">directive</span>(<span class="string">&#x27;lazy&#x27;</span>,lazy)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>紧接着在main.js中完成注册</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mDirectives <span class="keyword">from</span> <span class="string">&#x27;./directives&#x27;</span></span><br><span class="line">app.<span class="title function_">use</span>(mDirectives)</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>在item.vue和header-my.vue和header&#x2F;index.vue中在img标签添加v-lazy</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img v-lazy/&gt;</span><br></pre></td></tr></table></figure>

<h2 id="9-16-深入vite：指令的自动注册"><a href="#9-16-深入vite：指令的自动注册" class="headerlink" title="9-16 深入vite：指令的自动注册"></a>9-16 深入vite：指令的自动注册</h2><p>此时在src&#x2F;directives&#x2F;index.js 中，我们面临了一个和注册组件时的同样问题，那就是：<strong>如果指令过多，那么一个一个注册未免过于麻烦了</strong>。所以我们最好有一种方式完成指令的自动注册</p>
<p>那么想要完成这个功能我们依然要利用 Glob导入（import.meta.globEager）_和Object.entries功能：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lazy <span class="keyword">from</span> <span class="string">&#x27;./modules/lazy&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 全局注册指令</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">install</span>(<span class="params">app</span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> directives = <span class="keyword">import</span>.<span class="property">meta</span>.<span class="title function_">globEager</span>(<span class="string">&#x27;./modules/*.js&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> [key , value] <span class="keyword">of</span> <span class="title class_">Object</span>.<span class="title function_">entries</span>(directives))&#123;</span><br><span class="line">      <span class="keyword">const</span> arr = key.<span class="title function_">split</span>(<span class="string">&#x27;./&#x27;</span>)</span><br><span class="line">      <span class="keyword">const</span> name = arr[arr.<span class="property">length</span>-<span class="number">1</span>].<span class="title function_">replace</span>(<span class="string">&#x27;.js&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">      app.<span class="title function_">directive</span>(name,value.<span class="property">default</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="9-17-指定彩色占位图"><a href="#9-17-指定彩色占位图" class="headerlink" title="9-17 指定彩色占位图"></a>9-17 指定彩色占位图</h2><ol>
<li>我们现在utils&#x2F;color.js中写导出随机rgb方法</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 生成随机色值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span>  <span class="keyword">const</span> <span class="title function_">randomRGB</span> =(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  <span class="keyword">const</span> r = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>()*<span class="number">255</span>)</span><br><span class="line">  <span class="keyword">const</span> g = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>()*<span class="number">255</span>)</span><br><span class="line">  <span class="keyword">const</span> b = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>()*<span class="number">255</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`rgb(<span class="subst">$&#123;r&#125;</span>,<span class="subst">$&#123;g&#125;</span>,<span class="subst">$&#123;b&#125;</span>)`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>我们在item.vue中使用该方法</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; randomRGB &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/color&#x27;</span></span><br><span class="line"></span><br><span class="line">  &lt;div <span class="keyword">class</span>=<span class="string">&quot;relative w-full rounded cursor-zoom-in group&quot;</span></span><br><span class="line">         :style=<span class="string">&quot;&#123;</span></span><br><span class="line"><span class="string">            backgroundColor:randomRGB()</span></span><br><span class="line"><span class="string">         &#125;&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<h2 id="9-18-总结"><a href="#9-18-总结" class="headerlink" title="9-18 总结"></a>9-18 总结</h2><p>我们借用首页list模块业务，实现了：</p>
<ol>
<li>瀑布流</li>
<li>长列表</li>
<li>懒加载</li>
<li>指令自动注册</li>
<li>….</li>
</ol>
<p>等通用组件或指令。</p>
<p>这些内容都是咱们日常开发中非常常见的功能，那么在我们把他们抽离了之后，日后的开发中就可以直接拿过来使用了。</p>
<p>但是现在对于首页而言，我们所欠缺的内容还是比较多的，比如：</p>
<ol>
<li>search 模块到首页的联动</li>
<li>item 上的点击处理</li>
</ol>
<h1 id="10、多组件联动与高阶组件方案——list联动search和navigationBar"><a href="#10、多组件联动与高阶组件方案——list联动search和navigationBar" class="headerlink" title="10、多组件联动与高阶组件方案——list联动search和navigationBar"></a>10、多组件联动与高阶组件方案——list联动search和navigationBar</h1><p>多组件联动是日常工作中的常见业务。高阶通用组件是构建中台组件库的难点。</p>
<h2 id="10-1-前言"><a href="#10-1-前言" class="headerlink" title="10-1 前言"></a>10-1 前言</h2><p>到目前为止我们已经实现了首页的search、navigationBar、list 模块。只不过目前三个模块完全是独立的，没有任何的关联性。</p>
<p>所以我们接下来要处理的就是让它们三个可以联动起来。也就是我们标题所说的：list联动search和navigationBar</p>
<p>那么在这样的联动之中，我们应该注意哪些事情，联动的数据又应该如何进行处理？如果可以让我们的逻辑更加清晰？</p>
<h2 id="10-2-多组件联动注意事项与整体逻辑分析"><a href="#10-2-多组件联动注意事项与整体逻辑分析" class="headerlink" title="10-2 多组件联动注意事项与整体逻辑分析"></a>10-2 多组件联动注意事项与整体逻辑分析</h2><p>在我们的实际开发中，我们经常会遇到多个组件之间互相进行联动的场景。那么这样的场景我们通常应该怎么去进行处理呢？下面让我们来说一下：</p>
<p>所谓的多组件联动，其实更准确一点来说，通常指的是：多个组件之间，存在一个或多个共享的数据。当数据发生改变时，执行对应的逻辑。</p>
<p>那么把这一句话拆分开来看，就是两部分：</p>
<ol>
<li>多组件之间需要共享数据</li>
<li>监听数据变化，并执行对应逻辑</li>
</ol>
<p><strong>多组件之间需要共享数据</strong></p>
<p>多组件之间共享数据，通常有三种方式：</p>
<ol>
<li><p>组件之间的数据传递–常见于层级关系比较清晰的多组件之中</p>
<ol>
<li>父传子</li>
<li>子传父</li>
<li>….</li>
</ol>
</li>
<li><p>依赖注入：<strong>Provide&#x2F;Inject</strong>–嵌套层级比较深，并且子组件只需要父组件的部分内容</p>
</li>
<li><p>全局状态管理工具：<strong>vuex</strong>-以上两种情况都不适用的情况下</p>
</li>
</ol>
<p>那么针对于我们这里的场景，层级关系比较复杂，并且需要进行复杂的逻辑操作，那么此时，我们此时多组件之间共享数据的策略就需要通过vuex 来实现。</p>
<p><strong>监听数据变化的方式</strong></p>
<p>当组件之间共享的数据发生变化时，我们需要执行对应的逻辑操作。所以首当其冲我们就需要监听到数据的变化。</p>
<p>那么在vue中监听数据变化的方式，首推就是watch。</p>
<p>并且在刚才我们已经确定了共享的数据需要被保存到vuex 中，所以我们就需要通过watch监听到vuex 中共享数据的变化，然后在监听到变化时，执行对应的业务逻辑。</p>
<p><strong>整体逻辑分析</strong></p>
<p>那么依据我们以上所说的内容，我们的整体实现逻辑应该为：</p>
<ol>
<li>创建共享数据对应的vuex模块</li>
<li>在getters中建立对应的快捷访问计算属性</li>
<li>在对应的业务组件中，监听getters，并执行对应逻辑</li>
</ol>
<h2 id="10-3-简单联动处理：navigationBar对应list"><a href="#10-3-简单联动处理：navigationBar对应list" class="headerlink" title="10-3 简单联动处理：navigationBar对应list"></a>10-3 简单联动处理：navigationBar对应list</h2><p>我们期望当 navigationBar 中的 item发生切换时，切换对应的list中的展示数据，那么根据我们刚才的分析，切换的关键就在于：<strong>共享数据的变化，引起的逻辑变化</strong></p>
<p>那么在这样的场景中，共享数据指的就是<strong>被选中项</strong>。</p>
<p>目前无论是PC端 下还是移动端下，被选中项都是在组件内部进行处理的，这肯定不符合我们的最初逻辑。我们期望共享的数据可以在vuex 中被维护。</p>
<p>所以我们将产生如下代码：</p>
<p>1.创建 src&#x2F;store&#x2F;modules&#x2F;app.js，该模块下的数据不会被缓存：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="variable constant_">ALL_CATEGORY_ITEM</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;@/constants&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * app模块中的数据不会被缓存</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">//独立作用域</span></span><br><span class="line">  <span class="attr">namespaced</span>:<span class="literal">true</span>,</span><br><span class="line">  <span class="attr">state</span>:<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span>&#123;</span><br><span class="line">      <span class="comment">//当前选中的分类</span></span><br><span class="line">      <span class="attr">currentCategory</span>:<span class="variable constant_">ALL_CATEGORY_ITEM</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mutations</span>:&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 切换选中分类</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="title function_">changeCurrentCategory</span>(<span class="params">state,newCategory</span>)&#123;</span><br><span class="line">      state.<span class="property">currentCategory</span>=newCategory</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">actions</span>:&#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在 src&#x2F;store&#x2F;index.js中对app进行注册，因为我们不希望app缓存，所以只在modules中注册，不在paths中写入</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> app <span class="keyword">from</span> <span class="string">&#x27;./modules/app&#x27;</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">createStore</span>(&#123;</span><br><span class="line">  getters,</span><br><span class="line">  <span class="attr">modules</span>:&#123;</span><br><span class="line">    category,</span><br><span class="line">    theme,</span><br><span class="line">    app</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>:[</span><br><span class="line">   <span class="title function_">createPersistedState</span>(&#123;</span><br><span class="line">     <span class="comment">//指定保存到localStorage中的key</span></span><br><span class="line">     <span class="attr">key</span>:<span class="string">&#x27;imooc-front&#x27;</span>,</span><br><span class="line">     <span class="comment">//需要保存的模块</span></span><br><span class="line">     <span class="attr">paths</span>:[<span class="string">&#x27;category&#x27;</span>,<span class="string">&#x27;theme&#x27;</span>]</span><br><span class="line">   &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>完成注册后就要处理对应的getters，在 src&#x2F;store&#x2F;getter.js中增加</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * category选中项</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="attr">currentCategory</span>:<span class="function">(<span class="params">state</span>)=&gt;</span>state.<span class="property">app</span>.<span class="property">currentCategory</span>,</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * category选中项下标</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="attr">currentCategoryIndex</span>:<span class="function">(<span class="params">state,getter</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> getter.<span class="property">categorys</span>.<span class="title function_">findIndex</span>(<span class="function">(<span class="params">item</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> item.<span class="property">id</span> === getter.<span class="property">currentCategory</span>.<span class="property">id</span></span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>修改pc端的代码，src&#x2F;views&#x2F;main&#x2F;components&#x2F;navigation &#x2F;pc&#x2F;index.vue</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--      item--&gt;</span><br><span class="line">   &lt;li</span><br><span class="line">     v-for=&quot;(item, index) in $store.getters.categorys&quot;</span><br><span class="line">     :key=&quot;item.id&quot;</span><br><span class="line">     class=&quot;shrink-0 px-1.5 py-0 z-10 duration-200 text-zinc-900 dark:text-zinc-500 dark:hover:text-zinc-300 text-base font-bold h-4 leading-4 cursor-pointer hover:bg-zinc-200 dark:hover:bg-zinc-900 rounded mr-1 mb-1&quot;</span><br><span class="line">     :class=&quot;&#123;</span><br><span class="line">       &#x27;text-zinc-900 dark:text-zinc-300 bg-zinc-200 dark:bg-zinc-900&#x27;:</span><br><span class="line">         $store.getters.currentCategoryIndex === index</span><br><span class="line">     &#125;&quot;</span><br><span class="line">     @click=&quot;onItemClick(item)&quot;</span><br><span class="line">   &gt;</span><br><span class="line">     &#123;&#123; item.name &#125;&#125;</span><br><span class="line">   &lt;/li&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> store = <span class="title function_">useStore</span>()</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 选中状态处理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onItemClick</span> = (<span class="params">item</span>) =&gt; &#123;</span><br><span class="line">  store.<span class="title function_">commit</span>(<span class="string">&#x27;app/changeCurrentCategory&#x27;</span>,item)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>修改pc端的代码，src&#x2F;views&#x2F;main&#x2F;components&#x2F;navigation &#x2F;mobile&#x2F;index.vue</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--      items--&gt;</span><br><span class="line">&lt;li</span><br><span class="line">  v-for=&quot;(item, index) in $store.getters.categorys&quot;</span><br><span class="line">  :key=&quot;item.id&quot;</span><br><span class="line">  class=&quot;shrink-0 px-1.5 py-0.5 z-10 duration-200 last:mr-4&quot;</span><br><span class="line">  :class=&quot;&#123;</span><br><span class="line">    &#x27;text-zinc-100&#x27;: $store.getters.currentCategoryIndex === index</span><br><span class="line">  &#125;&quot;</span><br><span class="line">  :ref=&quot;setItemRef&quot;</span><br><span class="line">  @click=&quot;onItemClick(item)&quot;</span><br><span class="line">&gt;</span><br><span class="line">  &#123;&#123; item.name &#125;&#125;</span><br><span class="line">&lt;/li&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> store = <span class="title function_">useStore</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">//watch监听getters 的时候，我们需要传递一个函数</span></span><br><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">  <span class="function">() =&gt;</span> store.<span class="property">getters</span>.<span class="property">currentCategoryIndex</span>,</span><br><span class="line">  <span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; left, width &#125; = itemRefs[val].<span class="title function_">getBoundingClientRect</span>()</span><br><span class="line">    sliderStyle.<span class="property">value</span> = &#123;</span><br><span class="line">      <span class="comment">//滑块的位置= ul横向滚动的位置+当前元素的left-ul的padding</span></span><br><span class="line">      <span class="attr">transform</span>: <span class="string">`translateX(<span class="subst">$&#123;ulScrollLeft.value + left - <span class="number">10</span>&#125;</span>px)`</span>,</span><br><span class="line">      <span class="attr">width</span>: width + <span class="string">&#x27;px&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//item点击事件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onItemClick</span> = (<span class="params">item</span>) =&gt; &#123;</span><br><span class="line">  store.<span class="title function_">commit</span>(<span class="string">&#x27;app/changeCurrentCategory&#x27;</span>, item)</span><br><span class="line">  isVisable.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>增加views&#x2F;main&#x2F;components&#x2F;list&#x2F;index.vue代码</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过此方法修改query，重新发起请求</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">resetQuery</span> = (<span class="params">newQuery</span>)=&gt;&#123;</span><br><span class="line">  query=&#123;...query,...newQuery&#125;</span><br><span class="line">  <span class="comment">//重置状态</span></span><br><span class="line">  isFinished.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">  pexelsList.<span class="property">value</span> = []</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 监听currentCategory的变化</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">  <span class="function">()=&gt;</span>store.<span class="property">getters</span>.<span class="property">currentCategory</span>,</span><br><span class="line">  <span class="function">(<span class="params">currentCategory</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="title function_">resetQuery</span>(&#123;</span><br><span class="line">      <span class="attr">page</span>:<span class="number">1</span>,</span><br><span class="line">      <span class="attr">categoryId</span>:currentCategory.<span class="property">id</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="10-4-明确searchBar对应list处理流程"><a href="#10-4-明确searchBar对应list处理流程" class="headerlink" title="10-4 明确searchBar对应list处理流程"></a>10-4 明确searchBar对应list处理流程</h2><p>接下来我们需要处理 searchBar 区域对应list区域的联动效果。</p>
<p>但是对于 searchBar 区域而言，目前我们还没有处理完成，所以我们需要先把 searchBar 区域的处理流程将清楚，然后再处理对应的联动。</p>
<p>那么对于searchBar 区域我们目前还缺少三部分的内容处理：</p>
<ol>
<li>搜索提示</li>
<li>搜索历史</li>
<li>推荐主题</li>
</ol>
<p>所以我们接下来的处理顺序为</p>
<ol>
<li>搜索提示</li>
<li>搜索历史</li>
<li>推荐主题</li>
<li>search触发时的list 联动</li>
</ol>
<h2 id="10-5-searchBar：搜索提示初步实现"><a href="#10-5-searchBar：搜索提示初步实现" class="headerlink" title="10-5 searchBar：搜索提示初步实现"></a>10-5 searchBar：搜索提示初步实现</h2><ol>
<li>我们在src&#x2F;api&#x2F;pexeis.js中注册获取搜索提示接口</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取搜索提示</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getHint</span> = (<span class="params">q</span>) =&gt;&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>:<span class="string">&#x27;/pexels/hint&#x27;</span>,</span><br><span class="line">    <span class="attr">params</span>: &#123; </span><br><span class="line">      q</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>创建组件src&#x2F;views&#x2F;layout&#x2F;components&#x2F;header&#x2F;header-search&#x2F;hint.vue</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      v-for=&#x27;(item,index) in hintData&#x27;</span><br><span class="line">      :key=&#x27;index&#x27;</span><br><span class="line">      class=&#x27;py-1 pl-1 text-base font-bold text-zinc-500 rounded</span><br><span class="line">      cursor-pointer duration-300 hover:bg-zinc-200 dark:hover:bg-zinc-900&#x27;</span><br><span class="line">      @click=&#x27;onItemClick(item)&#x27;</span><br><span class="line">    &gt;</span><br><span class="line">      &#123;&#123;item&#125;&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">const EMINTS_ITEM_CLICK=&#x27;itemClick&#x27;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">import &#123; getHint &#125; from &#x27;@/api/pexeis&#x27;</span><br><span class="line">import &#123;watch&#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">const props = defineProps(&#123;</span><br><span class="line">  /**</span><br><span class="line">   * 搜索文本</span><br><span class="line">   */</span><br><span class="line">  searchText:&#123;</span><br><span class="line">    type:String,</span><br><span class="line">    required:true</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">const emits=defineEmits(EMINTS_ITEM_CLICK)</span><br><span class="line">/**</span><br><span class="line"> * 处理搜索提示数据获取</span><br><span class="line"> */</span><br><span class="line">const hintData = ref([])</span><br><span class="line">const getHintData = async()=&gt;&#123;</span><br><span class="line">  if (!props.searchText) return</span><br><span class="line">  const &#123;result&#125; = await getHint(props.searchText)</span><br><span class="line">  hintData.value = result</span><br><span class="line">&#125;</span><br><span class="line">/**</span><br><span class="line"> * watch可以监听一个ref响应式数据，或者一个包含getter的函数</span><br><span class="line"> */</span><br><span class="line">watch(()=&gt;props.searchText,getHintData,&#123;</span><br><span class="line">  immediate:true</span><br><span class="line">&#125;)</span><br><span class="line">/**</span><br><span class="line"> * item点击事件处理</span><br><span class="line"> */</span><br><span class="line">const onItemClick=(item)=&gt;&#123;</span><br><span class="line">  emits((EMINTS_ITEM_CLICK,item))</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>我们在父组件src&#x2F;views&#x2F;layout&#x2F;components&#x2F;header&#x2F;header-search&#x2F;index.vue中使用子组件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;m-search v-model=&quot;inputValue&quot;&gt;</span><br><span class="line">      &lt;template #dropdown&gt;</span><br><span class="line">        &lt;!--        搜索提示--&gt;</span><br><span class="line">        &lt;hint-vue</span><br><span class="line">          :searchText=&quot;inputValue&quot;</span><br><span class="line">          v-show=&quot;inputValue&quot;</span><br><span class="line">          @itemClick=&#x27;onSearchHandler&#x27;</span><br><span class="line">        &gt;&lt;/hint-vue&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/m-search&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">import hintVue from &#x27;./hint.vue&#x27;</span><br><span class="line"></span><br><span class="line">const inputValue = ref(&#x27;&#x27;)</span><br><span class="line">/**</span><br><span class="line"> * 搜索回调</span><br><span class="line"> */</span><br><span class="line">const onSearchHandler =(val)=&gt;&#123;</span><br><span class="line">  inputValue.value=val</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="10-6-searchBar：处理防抖功能"><a href="#10-6-searchBar：处理防抖功能" class="headerlink" title="10-6 searchBar：处理防抖功能"></a>10-6 searchBar：处理防抖功能</h2><p>目前的searchBar 中，当我输入内容时，会触发搜索提示功能。但是我们发现，加入我们想要搜索一个单词，比如：mac，却进行了三次的搜索。这明显是不合理的。</p>
<p>所以如果想要让这个搜索变得更加合理，那么我们就需要使用到防抖这样的功能。</p>
<p>所谓防抖指的就是：<strong>当触发一个事件时，不去立刻执行，而是延迟一段时间，该事件变为等待执行事件。如果在这段时间之内，该事件被再次触发，则上次等待执行的事件取消，本次触发的事件变为等待执行事件。循环往复，直到某一个等待事件被执行为止</strong></p>
<p>那么这样的防抖，通常我们称为：debounce</p>
<p>那么目前在 src&#x2F;views&#x2F;layout&#x2F;components&#x2F;header&#x2F;header-search&#x2F;hint.vue 中，我们通过watch 监听输入内容的变化，所以当输入内容发生过一次变化时，则会立刻触发 getHintData事件。</p>
<p>那么我们所需要做的防抖处理，就需要在watch中进行。</p>
<p>不过这样的防抖watch 我们不需要自己进行实现，vueuse中提供了对应的<strong>watchDebounced</strong>，我们可以直接利用这个API直接实现防抖的watch</p>
<p>修改src&#x2F;views&#x2F;layout&#x2F;components&#x2F;header&#x2F;header-search&#x2F;hint.vue的watch</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * watch可以监听一个ref响应式数据，或者一个包含getter的函数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">watchDebounced</span>(<span class="function">()=&gt;</span>props.<span class="property">searchText</span>,getHintData,&#123;</span><br><span class="line">  <span class="attr">immediate</span>:<span class="literal">true</span>,</span><br><span class="line">  <span class="comment">//每次事件触发时，延迟的事件</span></span><br><span class="line">  <span class="attr">debounce</span>:<span class="number">500</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">/**</span></span><br></pre></td></tr></table></figure>

<h2 id="10-7-searchBar：提示关键字高亮处理"><a href="#10-7-searchBar：提示关键字高亮处理" class="headerlink" title="10-7 searchBar：提示关键字高亮处理"></a>10-7 searchBar：提示关键字高亮处理</h2><ol>
<li>在src&#x2F;views&#x2F;layout&#x2F;components&#x2F;header&#x2F;header-search&#x2F;hint.vue添加方法，增加一个正则替换，最后进行一个富文本替换</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 处理关键字高亮</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">highlightText</span> = (<span class="params">text</span>)=&gt;&#123;</span><br><span class="line">  <span class="comment">//生成高亮标签</span></span><br><span class="line">  <span class="keyword">const</span> highlightSte = <span class="string">`&lt;span class=&quot;text-zinc-900 dark:text-zinc-200&quot;&gt;</span></span><br><span class="line"><span class="string">  <span class="subst">$&#123;props.searchText&#125;</span>&lt;/span&gt;`</span></span><br><span class="line">  <span class="comment">//正则表达式：从《显示文本中》找出与《用户输入文本相同的内容》，使用《高亮标签》进行替换</span></span><br><span class="line">  <span class="keyword">const</span> reg = <span class="keyword">new</span> <span class="title class_">RegExp</span>(props.<span class="property">searchText</span>,<span class="string">&#x27;gi&#x27;</span>)</span><br><span class="line">  <span class="comment">//替换</span></span><br><span class="line">  <span class="keyword">return</span> text.<span class="title function_">replace</span>(reg,highlightSte)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;div</span><br><span class="line">  v-for=&#x27;(item,index) in hintData&#x27;</span><br><span class="line">  :key=&#x27;index&#x27;</span><br><span class="line">  class=&#x27;py-1 pl-1 text-base font-bold text-zinc-500 rounded</span><br><span class="line">  cursor-pointer duration-300 hover:bg-zinc-200 dark:hover:bg-zinc-900&#x27;</span><br><span class="line">  v-html=&#x27;highlightText(item)&#x27;</span><br><span class="line">  @click=&#x27;onItemClick(item)&#x27;</span><br><span class="line">&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<h2 id="10-8-searchBar：搜索历史处理"><a href="#10-8-searchBar：搜索历史处理" class="headerlink" title="10-8 searchBar：搜索历史处理"></a>10-8 searchBar：搜索历史处理</h2><ol>
<li>创建模块store&#x2F;modules&#x2F;search.js</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 搜索</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">//独立作用域</span></span><br><span class="line">  <span class="attr">namespaced</span>:<span class="literal">true</span>,</span><br><span class="line">  <span class="attr">state</span>:<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span>&#123;</span><br><span class="line">      <span class="attr">historys</span>:[]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mutations</span>:&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新增</span></span><br><span class="line"><span class="comment">     * 1.新增的历史记录位于头部</span></span><br><span class="line"><span class="comment">     * 2.不可出现重复的记录</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="title function_">addHistory</span>(<span class="params">state,newHistory</span>)&#123;</span><br><span class="line">      <span class="keyword">const</span> isFindIndex = state.<span class="property">historys</span>.<span class="title function_">findIndex</span>(</span><br><span class="line">        <span class="function">(<span class="params">item</span>)=&gt;</span>item === newHistory</span><br><span class="line">      )</span><br><span class="line">      <span class="comment">//提出旧数据</span></span><br><span class="line">      <span class="keyword">if</span> (isFindIndex !==-<span class="number">1</span>)&#123;</span><br><span class="line">        state.<span class="property">historys</span>.<span class="title function_">splice</span>(isFindIndex,<span class="number">1</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//新增记录</span></span><br><span class="line">      state.<span class="property">historys</span>.<span class="title function_">unshift</span>(newHistory)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 单个删除</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="title function_">deleteHistory</span>(<span class="params">state,index</span>)&#123;</span><br><span class="line">      state.<span class="property">historys</span>.<span class="title function_">splice</span>(index,<span class="number">1</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 全部删除</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="title function_">deleteAllHistory</span>(<span class="params">state</span>)&#123;</span><br><span class="line">      state.<span class="property">historys</span>=[]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">actions</span>:&#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在store&#x2F;index.js中注册</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> search <span class="keyword">from</span> <span class="string">&#x27;./modules/search&#x27;</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">createStore</span>(&#123;</span><br><span class="line">  getters,</span><br><span class="line">  <span class="attr">modules</span>:&#123;</span><br><span class="line">    category,</span><br><span class="line">    theme,</span><br><span class="line">    app,</span><br><span class="line">    search</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>:[</span><br><span class="line">   <span class="title function_">createPersistedState</span>(&#123;</span><br><span class="line">     <span class="comment">//指定保存到localStorage中的key</span></span><br><span class="line">     <span class="attr">key</span>:<span class="string">&#x27;imooc-front&#x27;</span>,</span><br><span class="line">     <span class="comment">//需要保存的模块</span></span><br><span class="line">     <span class="attr">paths</span>:[<span class="string">&#x27;category&#x27;</span>,<span class="string">&#x27;theme&#x27;</span>,<span class="string">&#x27;search&#x27;</span>]</span><br><span class="line">   &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>所有的store的访问都应该有一个getters</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 搜索历史</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="attr">historys</span>:<span class="function">(<span class="params">state</span>)=&gt;</span>state.<span class="property">search</span>.<span class="property">historys</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>至此vuex的所有操作都完成了</li>
</ol>
<hr>
<ol start="5">
<li>我们创建组件views&#x2F;layout&#x2F;components&#x2F;header&#x2F;header-search&#x2F;history.vue</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;div class=&#x27;flex items-center text-xs mb-1 text-zinc-400&#x27;&gt;</span><br><span class="line">      &lt;span&gt;最新搜索&lt;/span&gt;</span><br><span class="line">      &lt;m-svg-icon</span><br><span class="line">        name=&#x27;delete&#x27;</span><br><span class="line">        class=&#x27;w-2.5 h-2.5 ml-1 p-0.5 cursor-pointer duration-300 rounded-sm hover:bg-zinc-100&#x27;</span><br><span class="line">        fillClass=&#x27;fill-zinc-400&#x27;</span><br><span class="line">        @click=&#x27;onDeleteAllClick&#x27;</span><br><span class="line">      &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div class=&#x27;flex flex-wrap&#x27;&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        v-for=&#x27;(item,index) in $store.getter.historys()&#x27;</span><br><span class="line">        :key=&#x27;index&#x27;</span><br><span class="line">        class=&#x27;mr-2 mb-1.5 flex items-center cursor-pointer bg-zinc-100 px-1.5</span><br><span class="line">        py-0.5 text-zinc-900 text-sm font-bold rounded-sm dutation-300</span><br><span class="line">        hover:bg-zinc-200&#x27;</span><br><span class="line">        @click=&#x27;onItemClick(item)&#x27;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;span&gt;&#123;&#123;item&#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;m-svg-icon</span><br><span class="line">          name=&#x27;input-deldete&#x27;</span><br><span class="line">          class=&#x27;w-2.5 h-2.5 p-0.5 ml-1 duration-300 rounded-sm</span><br><span class="line">          hover:bg-zinc-100&#x27;</span><br><span class="line">          @click.stop=&#x27;onDeleteClick(index)&#x27;</span><br><span class="line">        &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">const EMITS_ITEM_CLICK=&#x27;itemClick&#x27;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; useStore &#125; from &#x27;vuex&#x27;</span><br><span class="line">const emits = defineEmits([EMITS_ITEM_CLICK])</span><br><span class="line">const store = useStore()</span><br><span class="line">/**</span><br><span class="line"> * 删除全部</span><br><span class="line"> */</span><br><span class="line">const onDeleteAllClick =()=&gt;&#123;</span><br><span class="line">  store.commit(&#x27;search/deleteAllHistory&#x27;)</span><br><span class="line">&#125;</span><br><span class="line">/**</span><br><span class="line"> * 单个删除</span><br><span class="line"> */</span><br><span class="line">const onDeleteClick=(index)=&gt;&#123;</span><br><span class="line">  store.commit(&#x27;search/deleteHistory&#x27;,index)</span><br><span class="line">&#125;</span><br><span class="line">/**</span><br><span class="line"> * 触发搜索</span><br><span class="line"> */</span><br><span class="line">const onItemClick=(item)=&gt;&#123;</span><br><span class="line">  emits(EMITS_ITEM_CLICK,item)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>我们在views&#x2F;layout&#x2F;components&#x2F;header&#x2F;header-search&#x2F;index.vue中使用history组件；另外当我们回车的时候也调用搜索回调方法</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--最近搜索--&gt;</span><br><span class="line">&lt;history-vue</span><br><span class="line">  v-show=&quot;!inputValue&quot;</span><br><span class="line">  @itemClick=&quot;onSearchHandler&quot;</span><br><span class="line">&gt;&lt;/history-vue&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> historyVue <span class="keyword">from</span> <span class="string">&#x27;./history.vue&#x27;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 搜索回调</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onSearchHandler</span> = (<span class="params">val</span>) =&gt; &#123;</span><br><span class="line">  inputValue.<span class="property">value</span> = val</span><br><span class="line">  <span class="keyword">if</span> (val) &#123;</span><br><span class="line">    store.<span class="title function_">commit</span>(<span class="string">&#x27;search/addHistory&#x27;</span>, val)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;m-search v-model=&quot;inputValue&quot; @search=&quot;onSearchHandler&quot;&gt;</span><br><span class="line">&lt;/m-search&gt;</span><br></pre></td></tr></table></figure>

<h2 id="10-9-通用组件：confirm应用场景"><a href="#10-9-通用组件：confirm应用场景" class="headerlink" title="10-9 通用组件：confirm应用场景"></a>10-9 通用组件：confirm应用场景</h2><p>目前当我们点击<strong>删除全部</strong>历史记录时，会直接删除，这样体验并不好，我们期望的是能够给用户一个提示，也就是confirm</p>
<p>所以我们就期望能够构建出一个对应的confirm组件。</p>
<p>但是对于confirm这种组件而言，我们不希望它通过标签的形式进行使用，而是期望可以像element-plus中的<strong>confirm</strong>-样，可以直接通过方法的形式进行调用，这样就太爽了</p>
<p>那么如果我们想要通过一个方法来进行一个组件的展示，并与其进行交互的话，那么应该怎么做呢？</p>
<h2 id="10-10-通用组件：vnode-h函数-render函数-明确-confirm-构建思路"><a href="#10-10-通用组件：vnode-h函数-render函数-明确-confirm-构建思路" class="headerlink" title="10-10 通用组件：vnode + h函数 + render函数 明确 confirm 构建思路"></a>10-10 通用组件：vnode + h函数 + render函数 明确 confirm 构建思路</h2><p>那么想要搞明白这一点，我们就需要了解一些比较冷僻的知识点，那就是<strong>渲染函数</strong>，在渲染函数中，我们需要了解如下概念：</p>
<ol>
<li>虚拟dom：通过js来描述dom</li>
<li>vnode 虚拟节点：告诉vue 页面上需要渲染什么样子的节点</li>
<li>h函数：用来创建vnode 的函数，接受三个参数（要渲染的dom，attrs 对象，子元素）</li>
<li>render 函数：可以根据vnode 来染dom</li>
</ol>
<p>根据以上所说我们知道：<strong>通过h函数可以生成一个vnode，vnode 可以通过render 函数被宣染</strong></p>
<p>所以据此我们就可以得出confirm组件的实现思路：</p>
<ol>
<li>创建一个confirm组件</li>
<li>创建一个confir.js模块，在该模块中返回一个promise</li>
<li>同时利用h函数生成confirm.vue的vnode</li>
<li>最后利用 render函数，宣染vnode到body中</li>
</ol>
<h2 id="10-11-通用组件：构建confirm组件"><a href="#10-11-通用组件：构建confirm组件" class="headerlink" title="10-11 通用组件：构建confirm组件"></a>10-11 通用组件：构建confirm组件</h2><p>根据以上分析:</p>
<ol>
<li>创建 src&#x2F;libs&#x2F;confirm&#x2F;index.vue组件，并创建对应的props：</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> props = <span class="title function_">defineProps</span>(&#123;</span><br><span class="line">  <span class="comment">//标题</span></span><br><span class="line">  <span class="attr">title</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">String</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//描述</span></span><br><span class="line">  <span class="attr">content</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">required</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//取消按钮文本</span></span><br><span class="line">  <span class="attr">cancelText</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">default</span>: <span class="string">&#x27;取消&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//确定按钮文本</span></span><br><span class="line">  <span class="attr">confirmText</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">default</span>: <span class="string">&#x27;确定&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//取消按钮事件</span></span><br><span class="line">  <span class="attr">cancelHandler</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">Function</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//确定按钮事件</span></span><br><span class="line">  <span class="attr">confirmHandler</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">Function</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//关闭confirm的回调</span></span><br><span class="line">  <span class="attr">close</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">Function</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>因为我们最终期望通过方法进行调用，这会导致<strong>自动导入的组件无法使用</strong>，所以我们需要手动导入需要使用到的通用组件：</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//因为将来 confirm组件会以方法调用的形式展示，需要主动导入组件</span></span><br><span class="line"><span class="keyword">import</span> mButton <span class="keyword">from</span> <span class="string">&#x27;../button/index.vue&#x27;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>创建对应样式</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;!--  蒙版--&gt;</span><br><span class="line">    &lt;transition name=&quot;fade&quot;&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        v-else-if=&quot;isVisable&quot;</span><br><span class="line">        class=&quot;w-screen h-screen bg-zinc-900/80 z-40 fixed top-0 left-0&quot;</span><br><span class="line">        @click=&quot;close&quot;</span><br><span class="line">      &gt;&lt;/div&gt;</span><br><span class="line">    &lt;/transition&gt;</span><br><span class="line">    &lt;!--  内容--&gt;</span><br><span class="line">    &lt;transition name=&quot;up&quot;&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        v-if=&quot;isVisable&quot;</span><br><span class="line">        class=&quot;w-[80%] fixed top-1/3 left-[50%] translate-x-[-50%] z-50 px-2 py-1.5 rounded-sm border dark:border-zinc-600 cursor-pointer bg-white dark:bg-zinc-800 xl:w-[35%]&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;!--      标题--&gt;</span><br><span class="line">        &lt;div class=&quot;text-lg font-bold text-zinc-900 dark:text-zinc-200 mb-2&quot;&gt;</span><br><span class="line">          &#123;&#123; title &#125;&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">&lt;!--        文本--&gt;</span><br><span class="line">        &lt;div class=&#x27;text-base text-zinc-900 dark:text-zinc-200 mb-2&#x27;&gt;</span><br><span class="line">          &#123;&#123;content&#125;&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">&lt;!--        按钮--&gt;</span><br><span class="line">        &lt;div class=&#x27;flex justify-end&#x27;&gt;</span><br><span class="line">          &lt;m-button type=&#x27;info&#x27; class=&#x27;mr-2&#x27; @click=&#x27;onCancelClick&#x27;&gt;</span><br><span class="line">            &#123;&#123;cancelText&#125;&#125;</span><br><span class="line">          &lt;/m-button&gt;</span><br><span class="line">          &lt;m-button type=&#x27;primary&#x27; @click=&#x27;onConfirmClick&#x27;&gt;</span><br><span class="line">            &#123;&#123;confirmText&#125;&#125;</span><br><span class="line">          &lt;/m-button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/transition&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class="line">//fade动画</span><br><span class="line">.fade-enter-active,</span><br><span class="line">.fade-leave-active &#123;</span><br><span class="line">  transition: all 0.5s;</span><br><span class="line">&#125;</span><br><span class="line">//准备进入，离开完成</span><br><span class="line">.fade-enter-from,</span><br><span class="line">.fade-enter-to &#123;</span><br><span class="line">  opacity: 0;</span><br><span class="line">&#125;</span><br><span class="line">//up动画</span><br><span class="line">.up-enter-active,</span><br><span class="line">.up-leave-active &#123;</span><br><span class="line">  transition: all 0.5s;</span><br><span class="line">&#125;</span><br><span class="line">//准备进入，离开完成</span><br><span class="line">.up-enter-from,</span><br><span class="line">.up-enter-to &#123;</span><br><span class="line">  opacity: 0;</span><br><span class="line">  transform: translate3d(-50%, 100px, 0);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>创建展示控制方法，因为需要保留执行动画，所以我们在mounted时，让内容展示：</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//控制显示处理</span></span><br><span class="line"><span class="keyword">const</span> isVisable = <span class="title function_">ref</span>(<span class="literal">false</span>)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * confirm展示</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">show</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  isVisable.<span class="property">value</span>=<span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 处理动画（render 函数的宣染，会直接进行）页面构建完成之后，执行。保留动画</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">onMounted</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="title function_">show</span>()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>处理关闭控制方法，同样因为动画需要展示，所以我们需要预留动画执行时间：</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//关闭动画执行时间</span></span><br><span class="line"><span class="keyword">const</span> duration = <span class="string">&#x27;0.5s&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 关闭事件，保留动画执行时长</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">close</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  isVisable.<span class="property">value</span>=<span class="literal">false</span></span><br><span class="line">  <span class="comment">//延迟一段时间进行关闭，等待动画完全关闭之后，再去触发props.close()</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (props.<span class="property">close</span>)&#123;</span><br><span class="line">      props.<span class="title function_">close</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,<span class="built_in">parseInt</span>(duration.<span class="title function_">replace</span>(<span class="string">&#x27;0.&#x27;</span>,<span class="string">&#x27;&#x27;</span>).<span class="title function_">replace</span>(<span class="string">&#x27;s&#x27;</span>,<span class="string">&#x27;&#x27;</span>)*<span class="number">100</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>利用<strong>状态驱动css概念</strong>绑定响应式数据到css中：</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;style lang=<span class="string">&quot;scss&quot;</span> scoped&gt;</span><br><span class="line"><span class="comment">//fade动画</span></span><br><span class="line">.<span class="property">fade</span>-enter-active,</span><br><span class="line">.<span class="property">fade</span>-leave-active &#123;</span><br><span class="line">  <span class="attr">transition</span>: all v-<span class="title function_">bind</span>(duration);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//准备进入，离开完成</span></span><br><span class="line">.<span class="property">fade</span>-enter-<span class="keyword">from</span>,</span><br><span class="line">.<span class="property">fade</span>-enter-to &#123;</span><br><span class="line">  <span class="attr">opacity</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//up动画</span></span><br><span class="line">.<span class="property">up</span>-enter-active,</span><br><span class="line">.<span class="property">up</span>-leave-active &#123;</span><br><span class="line">  <span class="attr">transition</span>: all v-<span class="title function_">bind</span>(duration);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//准备进入，离开完成</span></span><br><span class="line">.<span class="property">up</span>-enter-<span class="keyword">from</span>,</span><br><span class="line">.<span class="property">up</span>-enter-to &#123;</span><br><span class="line">  <span class="attr">opacity</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attr">transform</span>: <span class="title function_">translate3d</span>(-<span class="number">50</span>%, 100px, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>取消和点击事件</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 取消按钮点击事件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onCancelClick</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  <span class="keyword">if</span> (props.<span class="property">cancelHandler</span>)&#123;</span><br><span class="line">    props.<span class="title function_">cancelHandler</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">close</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 确定按钮点击事件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onConfirmClick</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  <span class="keyword">if</span> (props.<span class="property">confirmHandler</span>)&#123;</span><br><span class="line">    props.<span class="title function_">confirmHandler</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">close</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="10-12-通用组件：函数调用confirm组件"><a href="#10-12-通用组件：函数调用confirm组件" class="headerlink" title="10-12 通用组件：函数调用confirm组件"></a>10-12 通用组件：函数调用confirm组件</h2><ol>
<li>我们创建一个函数，通过这个函数来调用confirm进行展示，创建lib&#x2F;confirm&#x2F;index.js</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> confirmComponent <span class="keyword">from</span> <span class="string">&#x27;./index.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; h &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 展示confirm，用户只传递一个参数，那么这个参数为content</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> title 标题（如果用户没有传递内容，那么标题被作为内容）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> content 内容（如果没有 title，那么content会被作为第一个参数传入）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> cancelText 取消按钮文本</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> confirmText 确定按钮的文本</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">confirm</span>=(<span class="params">title,content,cancelText,</span></span><br><span class="line"><span class="params">confirmText</span>)=&gt;&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (title&amp;&amp;content)&#123;</span><br><span class="line">      content = title</span><br><span class="line">      title = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 关闭回调</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">close</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">      <span class="comment">//3.把渲染的vnode去掉</span></span><br><span class="line">      <span class="title function_">render</span>(<span class="literal">null</span>,<span class="variable language_">document</span>.<span class="property">body</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 取消按钮的回调</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">cancelHandler</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">      <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;取消按钮点击&#x27;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 确定按钮的回调</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">confirmHandler</span> =(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">      <span class="title function_">resolve</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1.生成vnode</span></span><br><span class="line">    <span class="keyword">const</span> vnode = <span class="title function_">h</span>(confirmComponent,&#123;</span><br><span class="line">      title,</span><br><span class="line">      content,</span><br><span class="line">      cancelText,</span><br><span class="line">      confirmText,</span><br><span class="line">      cancelHandler,</span><br><span class="line">      confirmHandler,</span><br><span class="line">      close</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">//2.render渲染</span></span><br><span class="line">    <span class="title function_">render</span>(vnode,<span class="variable language_">document</span>.<span class="property">body</span>)</span><br><span class="line"></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>我们在lib&#x2F;index.js中导入并导出</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> &#123;confirm&#125; <span class="keyword">from</span> <span class="string">&#x27;./confirm/index&#x27;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>然后我们在header&#x2F;header-search&#x2F;history.vue中触发confirm</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;confirm&#125; <span class="keyword">from</span> <span class="string">&#x27;@/lib&#x27;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 删除全部</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onDeleteAllClick</span> =(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  <span class="title function_">confirm</span>(<span class="string">&#x27;标题&#x27;</span>,<span class="string">&#x27;你要删除所有记录吗？&#x27;</span>,<span class="string">&#x27;不删了&#x27;</span>,<span class="string">&#x27;删了&#x27;</span>)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">      store.<span class="title function_">commit</span>(<span class="string">&#x27;search/deleteAllHistory&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;点击了取消&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>因为我们是方法导出，所以在lib&#x2F;button&#x2F;index.vue中我们需要引入组件</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mSvgIcon <span class="keyword">from</span> <span class="string">&#x27;../svg-icon/index.vue&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="10-13-searchBar：热门精选模块构建"><a href="#10-13-searchBar：热门精选模块构建" class="headerlink" title="10-13 searchBar：热门精选模块构建"></a>10-13 searchBar：热门精选模块构建</h2><ol>
<li>我们先在api&#x2F;pexeis.js中定义获取主题接口</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取推荐主题</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getThemes</span> = (<span class="params"></span>) =&gt;&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>:<span class="string">&#x27;/pexels/themes&#x27;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>创建对应组件header&#x2F;header-search&#x2F;theme.vue</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;div class=&quot;text-xs mb-1 text-zinc-400&quot;&gt;热门精选&lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;flex h-[140px]&quot; v-if=&quot;themeData.list.length&quot;&gt;</span><br><span class="line">      &lt;!--大图--&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class=&quot;relative rounded w-[260px] cursor-pointer&quot;</span><br><span class="line">        :style=&quot;&#123;</span><br><span class="line">          backgroundColor: randomRGB()</span><br><span class="line">        &#125;&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;img</span><br><span class="line">          v-lazy</span><br><span class="line">          class=&quot;h-full w-full object-cover rounded&quot;</span><br><span class="line">          src=&quot;themeData.big.photo&quot;</span><br><span class="line">          alt=&quot;&quot;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;p</span><br><span class="line">          class=&quot;absolute bottom-0 left-0 w-full h-[45%] flex items-center backdrop-blur rounded px-1 text-white text-xs duration-300 hover:backdrop-blur-none&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          #&#123;&#123; themeData.big.title &#125;&#125;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;!--小图--&gt;</span><br><span class="line">      &lt;div class=&quot;flex flex-wrap flex-1 max-w-[860px]&quot;&gt;</span><br><span class="line">        &lt;div</span><br><span class="line">          v-for=&quot;item in themeData.list&quot;</span><br><span class="line">          :key=&quot;item.id&quot;</span><br><span class="line">          class=&quot;h-[45%] w-[260px] text-white text-xs relative ml-1.5 mb-1.5 rounded&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;img</span><br><span class="line">            v-lazy</span><br><span class="line">            class=&quot;w-full h-full object-cover rounded&quot;</span><br><span class="line">            :src=&quot;item.photo&quot;</span><br><span class="line">            alt=&quot;&quot;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;p</span><br><span class="line">            class=&quot;backdrop-blur absolute top-0 left-0 w-full h-full flex items-center px-1 rounded cursor-pointer duration-300 hover:backdrop-blur-none&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            #&#123;&#123; item.title &#125;&#125;</span><br><span class="line">          &lt;/p&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; getThemes &#125; from &#x27;@/api/pexeis&#x27;</span><br><span class="line">import &#123; randomRGB &#125; from &#x27;@/utils/color&#x27;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">const themeData = ref(&#123;</span><br><span class="line">  big: &#123;&#125;,</span><br><span class="line">  list: []</span><br><span class="line">&#125;)</span><br><span class="line">const getThemeDate = async () =&gt; &#123;</span><br><span class="line">  const &#123; themes &#125; = await getThemes()</span><br><span class="line">  themeData.value = &#123;</span><br><span class="line">    big: themes[0],</span><br><span class="line">    list: themes.splice(1, themes.length)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">getThemeDate()</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>将上面的组件渲染到header&#x2F;header-search&#x2F;index.vue里，在最近搜索后使用</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> themeVue <span class="keyword">from</span> <span class="string">&#x27;./theme.vue&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--最近搜索--&gt;</span><br><span class="line">        &lt;history-vue</span><br><span class="line">          v-show=&quot;!inputValue&quot;</span><br><span class="line">          @itemClick=&quot;onSearchHandler&quot;</span><br><span class="line">        &gt;&lt;/history-vue&gt;</span><br><span class="line">        &lt;!--推荐主题--&gt;</span><br><span class="line">        &lt;theme-vue v-show=&#x27;!inputValue&#x27;&gt;&lt;/theme-vue&gt;</span><br></pre></td></tr></table></figure>

<h2 id="10-14-searchBar-联动-list"><a href="#10-14-searchBar-联动-list" class="headerlink" title="10-14 searchBar 联动 list-"></a>10-14 searchBar 联动 list-</h2><ol>
<li>首先在store&#x2F;modules&#x2F;app.js中增加代码</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * app模块中的数据不会被缓存</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">//独立作用域</span></span><br><span class="line">  <span class="attr">namespaced</span>:<span class="literal">true</span>,</span><br><span class="line">  <span class="attr">state</span>:<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span>&#123;</span><br><span class="line">      <span class="comment">//搜索的文本</span></span><br><span class="line">      <span class="attr">searchText</span>:<span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mutations</span>:&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改searchText</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="title function_">changeSearchText</span>(<span class="params">state,newSearchText</span>)&#123;</span><br><span class="line">      state.<span class="property">searchText</span>=newSearchText</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">actions</span>:&#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在store&#x2F;getters.js增加直接访问代码</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 搜索文本</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="attr">searchText</span>:<span class="function">(<span class="params">state</span>)=&gt;</span>state.<span class="property">app</span>.<span class="property">searchText</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在layout&#x2F;components&#x2F;header&#x2F;header-search&#x2F;index.vue中搜索回调时调用changeSearchText</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 搜索回调</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onSearchHandler</span> = (<span class="params">val</span>) =&gt; &#123;</span><br><span class="line">  inputValue.<span class="property">value</span> = val</span><br><span class="line">  <span class="keyword">if</span> (val) &#123;</span><br><span class="line">    store.<span class="title function_">commit</span>(<span class="string">&#x27;search/addHistory&#x27;</span>, val)</span><br><span class="line">      <span class="comment">//以下新增</span></span><br><span class="line">    store.<span class="title function_">commit</span>(<span class="string">&#x27;search/changeSearchText&#x27;</span>, val)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>最后在main&#x2F;components&#x2F;index.vue中监听searchText的变化</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 监听searchText的变化</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">  <span class="function">()=&gt;</span>store.<span class="property">getters</span>.<span class="property">searchText</span>,</span><br><span class="line">  <span class="function">(<span class="params">val</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="title function_">resetQuery</span>(&#123;</span><br><span class="line">      <span class="attr">page</span>:<span class="number">1</span>,</span><br><span class="line">      <span class="attr">searchText</span>:val</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="10-15-总结"><a href="#10-15-总结" class="headerlink" title="10-15 总结"></a>10-15 总结</h2><p>那么本章节我们的核心实际上包含了两部分内容：</p>
<ol>
<li>多组件联动逻辑</li>
<li>confirm通用组件<ol>
<li>vnode</li>
<li>h函数</li>
<li>render 函数</li>
</ol>
</li>
</ol>
<h1 id="11-、前台常见功能解决方案：下载-全屏-引导"><a href="#11-、前台常见功能解决方案：下载-全屏-引导" class="headerlink" title="11 、前台常见功能解决方案：下载+全屏+引导"></a>11 、前台常见功能解决方案：下载+全屏+引导</h1><p>在前台项目中，我们会存在很多的常见功能，这些功能通常情况下是偏通用的，比如：文件下载、全屏处理、功能引导 等等… 那么这些功能如何进行实现呢？</p>
<hr>
<h2 id="11-1-文件下载解决方案"><a href="#11-1-文件下载解决方案" class="headerlink" title="11-1 文件下载解决方案"></a>11-1 文件下载解决方案</h2><p>当我们点击 item中的下载按钮时，我们期望可以下载当前的图片。</p>
<p>那么想要实现该功能，则需要使用到专门的下载包。</p>
<p>目前常用的支持下载功能包有两个：</p>
<ol>
<li>小文件下载：file-saver</li>
<li>大文件下载：streamsaver</li>
</ol>
<p>咱们的图片下载属于小文件的下载，所以我们可以直接使用file-saver</p>
<ol>
<li>安装 file-saver</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i --save file-saver@2.0.5</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在src&#x2F;views&#x2F;main&#x2F;components&#x2F;list&#x2F;item.vue中，增加下载功能： 下载处增加一个点击事件，然后使用saveAs</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--      下载--&gt;</span><br><span class="line">&lt;m-button</span><br><span class="line">  @click=&#x27;onDownload&#x27;</span><br><span class="line">&gt;&lt;/m-button&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;saveAs&#125; <span class="keyword">from</span> <span class="string">&#x27;file-saver&#x27;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 下载按钮点击事件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onDownload</span> =(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 1.下载的图片连接</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">saveAs</span>(props.<span class="property">data</span>.<span class="property">photoDownLink</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="11-2-通用组件：方法触发的message构建分析"><a href="#11-2-通用组件：方法触发的message构建分析" class="headerlink" title="11-2 通用组件：方法触发的message构建分析"></a>11-2 通用组件：方法触发的message构建分析</h2><p>在之前的时候，我们构建过一个confirm的通用组件，该组件我们可以直接通过 方法进行调用展示</p>
<p>那么对于咱们接下来打算构建的 message 组件，同样如此，我们依然希望可以通过方法的调用直接展示对应的组件。</p>
<p>那么根据我们之前的经验，我们知道：</p>
<ol>
<li>首先我们需要先构建出一个对应的 message.vue</li>
<li>然后构建出对应的message.js模块</li>
<li>在模块中，通过：<ol>
<li>‘h函数’构建vnode</li>
<li>render 函数，进行渲染</li>
</ol>
</li>
</ol>
<p>进行处理</p>
<p>那么以上方式，就是是咱们message的构建过程。</p>
<h2 id="11-3-通用组件：构建message组件基本能力"><a href="#11-3-通用组件：构建message组件基本能力" class="headerlink" title="11-3 通用组件：构建message组件基本能力"></a>11-3 通用组件：构建message组件基本能力</h2><ol>
<li>创建 src&#x2F;libs&#x2F;message&#x2F;index.vue 组件：</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">SUCCESS</span> = <span class="string">&#x27;success&#x27;</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">WARN</span> = <span class="string">&#x27;warn&#x27;</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">ERROR</span> = <span class="string">&#x27;error&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> typeEnum = [<span class="variable constant_">SUCCESS</span>,<span class="variable constant_">WARN</span>,<span class="variable constant_">ERROR</span>]</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"><span class="keyword">const</span> props =<span class="title function_">defineProps</span>(&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * message的消息类型</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">type</span>:&#123;</span><br><span class="line">    <span class="attr">type</span>:<span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">required</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="title function_">validator</span>(<span class="params">val</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> result = typeEnum.<span class="title function_">includes</span>(val)</span><br><span class="line">      <span class="keyword">if</span> (!result)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`你的type必须是<span class="subst">$&#123;typeEnum.join(<span class="string">&#x27;、&#x27;</span>)&#125;</span>中的一个`</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> result</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 描述文本</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">content</span>:&#123;</span><br><span class="line">    <span class="attr">type</span>:<span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">required</span>:<span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 展示时长</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">duration</span>:&#123;</span><br><span class="line">    <span class="attr">type</span>:<span class="title class_">Number</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 关闭时的回调</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">destroy</span>:&#123;</span><br><span class="line">    <span class="attr">type</span>:<span class="title class_">Function</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>构建各种状态下的样式表：</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//样式表数据</span></span><br><span class="line"><span class="keyword">const</span> styles=&#123;</span><br><span class="line">  <span class="comment">//警告</span></span><br><span class="line">  <span class="attr">warn</span>:&#123;</span><br><span class="line">    <span class="attr">icon</span>:<span class="string">&#x27;warn&#x27;</span>,</span><br><span class="line">    <span class="attr">fillClass</span>:<span class="string">&#x27;fill-warn-300&#x27;</span>,</span><br><span class="line">    <span class="attr">textClass</span>:<span class="string">&#x27;text-warn-300&#x27;</span>,</span><br><span class="line">    <span class="attr">containerClass</span>:</span><br><span class="line">      <span class="string">&#x27;bg-warn-100 border-warn-200 hover:shadow-lg hover:shadow-warn-100&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//错误</span></span><br><span class="line">  <span class="attr">error</span>:&#123;</span><br><span class="line">    <span class="attr">icon</span>:<span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">    <span class="attr">fillClass</span>:<span class="string">&#x27;fill-error-300&#x27;</span>,</span><br><span class="line">    <span class="attr">textClass</span>:<span class="string">&#x27;text-error-300&#x27;</span>,</span><br><span class="line">    <span class="attr">containerClass</span>:</span><br><span class="line">      <span class="string">&#x27;bg-error-100 border-error-200 hover:shadow-lg hover:shadow-error-100&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//成功</span></span><br><span class="line">  <span class="attr">success</span>:&#123;</span><br><span class="line">    <span class="attr">icon</span>:<span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">    <span class="attr">fillClass</span>:<span class="string">&#x27;fill-success-300&#x27;</span>,</span><br><span class="line">    <span class="attr">textClass</span>:<span class="string">&#x27;text-success-300&#x27;</span>,</span><br><span class="line">    <span class="attr">containerClass</span>:</span><br><span class="line">      <span class="string">&#x27;bg-success-100 border-success-200 hover:shadow-lg hover:shadow-success-100&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>配合样式表，构建template</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;transition name=&#x27;down&#x27; @after-leave=&#x27;destroy&#x27;&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      v-show=&#x27;isVisable&#x27;</span><br><span class="line">      class=&#x27;min-w-[420px] fixed top-[20px] left-[50%] translate-x-[-50%] z-50</span><br><span class="line">      flex items-center px-3 py-1.5 rounded-sm border cursor-pointer&#x27;</span><br><span class="line">      :class=&#x27;styles[type].containerClass&#x27;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;m-svg-icon</span><br><span class="line">        :name=&#x27;styles[type].icon&#x27;</span><br><span class="line">        :fillClass=&#x27;styles[type].fillClass&#x27;</span><br><span class="line">        class=&#x27;h-1.5 w-1.5 mr-1.5&#x27;</span><br><span class="line">      &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">      &lt;span class=&#x27;text-sm&#x27; :class=&#x27;styles[type].textClass&#x27;&gt;</span><br><span class="line">        &#123;&#123;content&#125;&#125;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/transition&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import mSvgIcon from &#x27;../svg-icon/index.vue&#x27;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line">.down-enter-active,</span><br><span class="line">.down-leave-active&#123;</span><br><span class="line">  transition: all 0.5s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.down-enter-from,</span><br><span class="line">.down-leave-to&#123;</span><br><span class="line">  opacity: 0;</span><br><span class="line">  transform: translate3d(-50%,-100px,0);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>处理展示逻辑</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isVisable = <span class="title function_">ref</span>(<span class="literal">false</span>)</span><br><span class="line"><span class="keyword">const</span> animDuration = <span class="string">&#x27;0.5s&#x27;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 保证动画展示，需要在mounted 之后进行展示</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">onMounted</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  isVisable.<span class="property">value</span>=<span class="literal">true</span></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 延迟时间关闭</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    isVisable.<span class="property">value</span>=<span class="literal">false</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (props.<span class="property">destroy</span>)&#123;</span><br><span class="line">        props.<span class="title function_">destroy</span>()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,<span class="built_in">parseInt</span>(animDuration.<span class="title function_">replace</span>(<span class="string">&#x27;0.&#x27;</span>,<span class="string">&#x27;&#x27;</span>).<span class="title function_">replace</span>(<span class="string">&#x27;s&#x27;</span>,<span class="string">&#x27;&#x27;</span>)*<span class="number">100</span>))</span><br><span class="line">  &#125;,props.<span class="property">duration</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>新增tailwind的自定义样式</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">colors</span>:&#123;</span><br><span class="line">  <span class="string">&#x27;success-100&#x27;</span>:<span class="string">&#x27;#F2F9EC&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;success-200&#x27;</span>:<span class="string">&#x27;#E4F2DB&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;success-300&#x27;</span>:<span class="string">&#x27;#7EC050&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;warn-100&#x27;</span>:<span class="string">&#x27;#FCF6ED&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;warn-200&#x27;</span>:<span class="string">&#x27;#F8ECDA&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;warn-300&#x27;</span>:<span class="string">&#x27;#DCA550&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;error-100&#x27;</span>:<span class="string">&#x27;#ED7456&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;error-200&#x27;</span>:<span class="string">&#x27;#f3471c&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;error-300&#x27;</span>:<span class="string">&#x27;#ffffff&#x27;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="11-4-通用组件：方法触发-message-展示"><a href="#11-4-通用组件：方法触发-message-展示" class="headerlink" title="11-4 通用组件：方法触发 message 展示"></a>11-4 通用组件：方法触发 message 展示</h2><ol>
<li>创建 src&#x2F;libs&#x2F;message&#x2F;index.js方法：</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;h , render&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> messageComponent <span class="keyword">from</span> <span class="string">&#x27;./index.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> type 类型:success、warn、error</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> content 描述文本</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> duration 展示时间（毫秒），默认3000</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">message</span> = (<span class="params">type,content,duration = <span class="number">3000</span></span>)=&gt;&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 动画结束时的回调</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">onDestory</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">    <span class="comment">//3.删除render</span></span><br><span class="line">    <span class="title function_">render</span>(<span class="literal">null</span>,<span class="variable language_">document</span>.<span class="property">body</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//1.拿到vnode</span></span><br><span class="line">  <span class="keyword">const</span> vnode = <span class="title function_">h</span>(messageComponent,&#123;</span><br><span class="line">    type,</span><br><span class="line">    content,</span><br><span class="line">    duration,</span><br><span class="line">    <span class="attr">destory</span>:<span class="title function_">onDestory</span>()</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">//2.render vonde</span></span><br><span class="line">  <span class="title function_">render</span>(vnode,<span class="variable language_">document</span>.<span class="property">body</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>紧接着我们再lib&#x2F;index.js中将message方法导出</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> &#123;message&#125; <span class="keyword">from</span> <span class="string">&#x27;./message/index&#x27;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>我们再main&#x2F;components&#x2F;list&#x2F;item.vue中使用该方法</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;message&#125; <span class="keyword">from</span> <span class="string">&#x27;@/lib&#x27;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 下载按钮点击事件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onDownload</span> =(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  <span class="title function_">message</span>(<span class="string">&#x27;success&#x27;</span>,<span class="string">&#x27;图片开始下载&#x27;</span>)</span><br><span class="line">  <span class="comment">//延迟一段时间执行，可以得到更好的体验</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 1.下载的图片连接</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="title function_">saveAs</span>(props.<span class="property">data</span>.<span class="property">photoDownLink</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="11-5-模块全屏解决方案"><a href="#11-5-模块全屏解决方案" class="headerlink" title="11-5 模块全屏解决方案"></a>11-5 模块全屏解决方案</h2><p>让页面中的指定区域进行全屏展示也是非常常见的一个功能。</p>
<p>想要让页面的指定区域进行全屏展示，我们通常可以使用全屏API，该API中提供了两个方法：</p>
<p>1.<strong>Element，requestFullscreen（）</strong>：让指定元素进行全屏</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;app&#x27;</span>).<span class="title function_">requestFullscreen</span>()</span><br></pre></td></tr></table></figure>

<p>2.<strong>Document.exitFullscreen（）</strong>：退出全屏</p>
<p>但是这个API 比较原始，使用起来没有那么方便，所以我们可以使用一个vueuse 中的更加简便的API：<strong>useFullScreen</strong></p>
<ol>
<li>利用useFullScreen生成img图片的全屏方法：</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 生成全屏的方法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> imgTarget = <span class="title function_">ref</span>(<span class="literal">null</span>)</span><br><span class="line"><span class="keyword">const</span> &#123;<span class="attr">enter</span>:onImgFullScreen&#125; = <span class="title function_">useFullscreen</span>(imgTarget)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>将图片绑上标签，并onImgFullScreen绑定至全屏按钮点击事件：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> &lt;!--    图片--&gt;</span><br><span class="line">      &lt;img</span><br><span class="line">        ref=&#x27;imgTarget&#x27;</span><br><span class="line">      /&gt;</span><br><span class="line">&lt;!--      全屏--&gt;</span><br><span class="line">&lt;m-button</span><br><span class="line">  @click=&#x27;onImgFullScreen&#x27;</span><br><span class="line">&gt;&lt;/m-button&gt;</span><br></pre></td></tr></table></figure>

<h2 id="11-6-构建floating基础布局"><a href="#11-6-构建floating基础布局" class="headerlink" title="11-6 构建floating基础布局"></a>11-6 构建floating基础布局</h2><ol>
<li>增加floating，修改layout&#x2F;components&#x2F;floating.vue</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&#x27;fixed bottom-10 right-2&#x27;&gt;</span><br><span class="line">&lt;!--    引导页--&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      class=&#x27;w-4 h-4 mb-1 bg-white dark:bg-zinc-900 border dark:border-0</span><br><span class="line">      border-zinc-200 rounded-full flex justify-center items-center</span><br><span class="line">      cursor-pointer duration-200 group hover:shadow-lg&#x27;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;m-svg-icon</span><br><span class="line">        name=&#x27;guide&#x27;</span><br><span class="line">        class=&#x27;w-2 h-2&#x27;</span><br><span class="line">        fillClass=&#x27;fill-zinc-900 dark:fill-zinc-200 group-hover:fill-main&#x27;</span><br><span class="line">      &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;!--    反馈--&gt;</span><br><span class="line">    &lt;m-popover class=&#x27;flex items-center&#x27; placement=&#x27;top-left&#x27;&gt;</span><br><span class="line">      &lt;template #reference&gt;</span><br><span class="line">        &lt;div</span><br><span class="line">          class=&#x27;w-4 h-4 mb-1 bg-white dark:bg-zinc-900 border dark:border-0</span><br><span class="line">      border-zinc-200 rounded-full flex justify-center items-center</span><br><span class="line">      cursor-pointer duration-200 group hover:shadow-lg&#x27;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;m-svg-icon</span><br><span class="line">            name=&#x27;feedback&#x27;</span><br><span class="line">            class=&#x27;w-2 h-2&#x27;</span><br><span class="line">            fillClass=&#x27;fill-zinc-900 dark:fill-zinc-200 group-hover:fill-main&#x27;</span><br><span class="line">          &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line"></span><br><span class="line">      &lt;div class=&#x27;w-[140px] overflow-hidden&#x27;&gt;</span><br><span class="line">        &lt;div</span><br><span class="line">          class=&#x27;flex items-center p-1 cursor-pointer rounded</span><br><span class="line">          hover:bg-zinc-100/60 dark:hover:bg-zinc-800&#x27;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;m-svg-icon</span><br><span class="line">            name=&#x27;feedback&#x27;</span><br><span class="line">            class=&#x27;w-1.5 h-1.5 mr-1&#x27;</span><br><span class="line">            fillClass=&#x27;fill-zinc-900 dark:fill-zinc-300&#x27;</span><br><span class="line">          &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">          &lt;span class=&#x27;text-zinc-800 dark:text-zinc-300 text-sm&#x27;&gt;立即吐槽&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/m-popover&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="11-7-样式修正：处理难看的scrollBar"><a href="#11-7-样式修正：处理难看的scrollBar" class="headerlink" title="11-7 样式修正：处理难看的scrollBar"></a>11-7 样式修正：处理难看的scrollBar</h2><p>目前咱们的floating的样式已经构建完成了。只不过旁边的scrollBar 看着是在是有点难看。</p>
<p>所以咱们接下来就需要修正下这个scrollBar的样式。</p>
<p>对于tailwind而言，默认并没有提供scrollBar的样式类名，想要处理scrollBar的样式，那么需要安装单独的插件：tailwind-scrollbar</p>
<ol>
<li>安装插件</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev tailwind-scrollbar</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在tailwind.config.js中注册该插件：</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">plugins</span>: [<span class="built_in">require</span>(<span class="string">&#x27;tailwind-scrollbar&#x27;</span>)],</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在tailwind.config.js 中，让 scrollBar 支持 dark 模式：</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">theme</span>: &#123;</span><br><span class="line">  <span class="attr">extend</span>: &#123;</span><br><span class="line">   ........</span><br><span class="line">    <span class="attr">variants</span>:&#123;</span><br><span class="line">      <span class="attr">scrollbars</span>:[<span class="string">&#x27;dark&#x27;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>我们再main&#x2F;index.vue中进行使用</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div </span><br><span class="line">    class=&#x27;h-full overflow-auto bg-white dark:bg-zinc-800 duration-500</span><br><span class="line">    scrollbar-thin scrollbar-thumb-transparent xl:scrollbar-thumb-zinc-200</span><br><span class="line">    xl:dark:scrollbar-thumb-zinc-900 scrollbar-track-transparent&#x27;&gt;</span><br><span class="line">  &lt;navigation-vue/&gt;</span><br><span class="line">  &lt;div class=&#x27;max-w-screen-xl mx-auto relative m-1 xl:mt-4&#x27;&gt;</span><br><span class="line">    &lt;list-vue&gt;&lt;/list-vue&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>如果我们想让右边的scrollBar有圆弧，那么我们再styles&#x2F;index.scss中新增</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">::-webkit-scrollbar-thumb&#123;</span><br><span class="line">  border-<span class="attr">radius</span>: 10px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>同样的搜索记录那里也要处理，修改lib&#x2F;search&#x2F;index.vue里面的下拉区部分</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--下拉区--&gt;</span><br><span class="line">&lt;transition name=&#x27;slide&#x27;&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    class=&#x27;max-h-[368px] w-full text-base overflow-auto bg-white</span><br><span class="line">    dark:bg-zinc-800 absolute z-20 left-0 top-[56px] p-2 rounded border</span><br><span class="line">    border-zinc-200 dark:border-zinc-600 duration-200 hover:shadow-2xl</span><br><span class="line">    scrollbar-thin scrollbar-thumb-transparent xl:scrollbar-thumb-zinc-200</span><br><span class="line">    xl:dark:scrollbar-thumb-zinc-900 scrollbar-track-transparent&#x27;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;slot name=&#x27;dropdown&#x27;/&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/transition&gt;</span><br></pre></td></tr></table></figure>

<h2 id="11-8-功能引导解决方案"><a href="#11-8-功能引导解决方案" class="headerlink" title="11-8 功能引导解决方案"></a>11-8 功能引导解决方案</h2><ol>
<li>在这里我们使用driver.js</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install driver. js</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在floating.vue中初始化Driver</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="comment">//1.导入</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Driver</span> <span class="keyword">from</span> <span class="string">&#x27;driver.js&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;driver.js/dist/driver.min.css&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;onMounted&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="comment">//2.初始化</span></span><br><span class="line"><span class="keyword">let</span> driver =<span class="literal">null</span></span><br><span class="line"><span class="title function_">onMounted</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  driver = <span class="keyword">new</span> <span class="title class_">Driver</span>(&#123;</span><br><span class="line">    <span class="attr">allowClose</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="attr">closeBtnText</span>:<span class="string">&#x27;关闭&#x27;</span>,</span><br><span class="line">    <span class="attr">nextBtnText</span>:<span class="string">&#x27;下一步&#x27;</span>,</span><br><span class="line">    <span class="attr">prevBtnText</span>:<span class="string">&#x27;上一步&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>我们在layout&#x2F;components&#x2F;steps.js中创建自己的步骤</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//在哪个元素中高亮</span></span><br><span class="line">    <span class="attr">element</span>: <span class="string">&#x27;.guide-home&#x27;</span>,</span><br><span class="line">    <span class="comment">//配置对象</span></span><br><span class="line">    <span class="attr">popover</span>: &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;logo&#x27;</span>,</span><br><span class="line">      <span class="attr">description</span>: <span class="string">&#x27;点击可以返回首页&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//在哪个元素中高亮</span></span><br><span class="line">    <span class="attr">element</span>:<span class="string">&#x27;.guide-search&#x27;</span>,</span><br><span class="line">    <span class="comment">//配置对象</span></span><br><span class="line">    <span class="attr">popover</span>:&#123;</span><br><span class="line">      <span class="attr">title</span>:<span class="string">&#x27;搜索&#x27;</span>,</span><br><span class="line">      <span class="attr">description</span>:<span class="string">&#x27;搜索你期望的图片&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//在哪个元素中高亮</span></span><br><span class="line">    <span class="attr">element</span>:<span class="string">&#x27;.guide-theme&#x27;</span>,</span><br><span class="line">    <span class="comment">//配置对象</span></span><br><span class="line">    <span class="attr">popover</span>:&#123;</span><br><span class="line">      <span class="attr">title</span>:<span class="string">&#x27;风格&#x27;</span>,</span><br><span class="line">      <span class="attr">description</span>:<span class="string">&#x27;选择一个您喜欢的风格&#x27;</span>,</span><br><span class="line">      <span class="attr">position</span>:<span class="string">&#x27;left&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//在哪个元素中高亮</span></span><br><span class="line">    <span class="attr">element</span>:<span class="string">&#x27;.guide-my&#x27;</span>,</span><br><span class="line">    <span class="comment">//配置对象</span></span><br><span class="line">    <span class="attr">popover</span>:&#123;</span><br><span class="line">      <span class="attr">title</span>:<span class="string">&#x27;账户&#x27;</span>,</span><br><span class="line">      <span class="attr">description</span>:<span class="string">&#x27;这里标记了您的账户信息&#x27;</span>,</span><br><span class="line">      <span class="attr">position</span>:<span class="string">&#x27;left&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//在哪个元素中高亮</span></span><br><span class="line">    <span class="attr">element</span>:<span class="string">&#x27;.guide-start&#x27;</span>,</span><br><span class="line">    <span class="comment">//配置对象</span></span><br><span class="line">    <span class="attr">popover</span>:&#123;</span><br><span class="line">      <span class="attr">title</span>:<span class="string">&#x27;引导&#x27;</span>,</span><br><span class="line">      <span class="attr">description</span>:<span class="string">&#x27;这里可以再次查看引导信息&#x27;</span>,</span><br><span class="line">      <span class="attr">position</span>:<span class="string">&#x27;left&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//在哪个元素中高亮</span></span><br><span class="line">    <span class="attr">element</span>:<span class="string">&#x27;.guide-feedback&#x27;</span>,</span><br><span class="line">    <span class="comment">//配置对象</span></span><br><span class="line">    <span class="attr">popover</span>:&#123;</span><br><span class="line">      <span class="attr">title</span>:<span class="string">&#x27;反馈&#x27;</span>,</span><br><span class="line">      <span class="attr">description</span>:<span class="string">&#x27;您的任何不满都可以在这里告诉我们&#x27;</span>,</span><br><span class="line">      <span class="attr">position</span>:<span class="string">&#x27;left&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>我们在floating.vue中导入该步骤，并在引导页增加点击事件</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> steps <span class="keyword">from</span> <span class="string">&#x27;./steps.js&#x27;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 开始引导</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onGuideClick</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  <span class="comment">//指定引导步骤</span></span><br><span class="line">  driver.<span class="title function_">defineSteps</span>(steps)</span><br><span class="line">  <span class="comment">//开始</span></span><br><span class="line">  driver.<span class="title function_">start</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--    引导页--&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      @click=&#x27;onGuideClick&#x27;</span><br><span class="line">    &gt;</span><br><span class="line">    &lt;/div&gt;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>我们需要给需要引导的元素添加标签，就是步骤里面的element，layout&#x2F;components&#x2F;header&#x2F;index.vue、layout&#x2F;components&#x2F;header&#x2F;header-search&#x2F;index.vue等等</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;img</span><br><span class="line">  v-lazy</span><br><span class="line">  class=&#x27;guide-home h-4 cusor-pointer mr-2&#x27;</span><br><span class="line">  src=&quot;https://m.imooc.com/static/wap/static/common/img/logo-small@2x.png&quot;</span><br><span class="line">  @click=&#x27;onToHome&#x27;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&#x27;w-full guide-search&#x27;&gt;</span><br><span class="line">  &lt;m-search v-model=&quot;inputValue&quot; &gt;</span><br><span class="line">  &lt;/m-search&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<h2 id="11-9-解决功能引导图标不显示的问题"><a href="#11-9-解决功能引导图标不显示的问题" class="headerlink" title="11-9 解决功能引导图标不显示的问题"></a>11-9 解决功能引导图标不显示的问题</h2><ol>
<li>首先解决图标被挡住的问题，在styles&#x2F;index.scss中新增样式</li>
</ol>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.driver-fix-stacking</span>&#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>其次解决关闭、下一步、上一步对不齐问题，同样在styles&#x2F;index.scss中新增样式</li>
</ol>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.driver-navigation-btns</span>&#123;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>最后解决一个floating两个图标跑偏问题，在floating.vue中增加样式</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;style lang=<span class="string">&#x27;scss&#x27;</span> scoped&gt;</span><br><span class="line">.<span class="property">driver</span>-fix-stacking&#123;</span><br><span class="line">  <span class="attr">position</span>: fixed;</span><br><span class="line">  z-<span class="attr">index</span>:<span class="number">100004</span>!important;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="11-10-总结"><a href="#11-10-总结" class="headerlink" title="11-10 总结"></a>11-10 总结</h2><p>我们处理了4个核心功能：</p>
<ol>
<li>文件下载</li>
<li>通用组件：message构建</li>
<li>全屏处理</li>
<li>引导处理</li>
</ol>
<p>那么到目前为止，咱们的首页功能就已经处理的差不多了。</p>
<p>那么接下来我们就需要处理，item点击的详情页面展示。</p>
<h1 id="12、高阶路由过渡处理方案-——-浏览器堆栈主动介入"><a href="#12、高阶路由过渡处理方案-——-浏览器堆栈主动介入" class="headerlink" title="12、高阶路由过渡处理方案 —— 浏览器堆栈主动介入"></a>12、高阶路由过渡处理方案 —— 浏览器堆栈主动介入</h1><p>路由过渡动效并没有什么稀奇的，但是如果想要构建一个高交互性的前台系统，仅依靠路由过渡动效就可以实现吗？</p>
<hr>
<h2 id="12-1-前言"><a href="#12-1-前言" class="headerlink" title="12-1 前言"></a>12-1 前言</h2><p>在vue中，两个路由进行跳转的时候，我们有时候会为其增加一些跳转的过渡动画，这是一个非常常见的需求。</p>
<p>通常情况下，这种过渡动画，我们可以直接使vue-router的过渡动效来进行实现。</p>
<p>那么对于目前咱们的项目而言，当我们item中击进入详情页的时候，我们也希望可以有一个对应的过渡动效，从而提升用户体验。</p>
<p>我们期望这个过渡动效可以：</p>
<ol>
<li>同时在PC端和移动端生效</li>
<li>进入新页面时：在点击的具体item中呈现由小到大的缩放动画</li>
<li>退出新页面时：呈现由大到小的缩放动画缩回至点击的具体item中</li>
</ol>
<p>那么这样的一个过渡动效我们应该如何进行实现呢？</p>
<p>直接通过vue-router的过渡动效可以实现吗？如果不行的话，那么我们又应该如何去做呢？</p>
<h2 id="12-2-VueRouter过渡动效可行性分析"><a href="#12-2-VueRouter过渡动效可行性分析" class="headerlink" title="12-2 VueRouter过渡动效可行性分析"></a>12-2 VueRouter过渡动效可行性分析</h2><p>我们知道接下来我们要实现的是：<strong>item到详情页的路由过渡动效</strong></p>
<p>那么这样的一个过渡动效，我们如何去做呢？</p>
<p>通常针对这种功能，我们首先都会想到vue-router 提供的过渡动效。那么我们本小节就要来看一下，这个过渡动效功能能不能满足咱们的业务需求呢？</p>
<p>想要判断这个问题，我们首先就需要搞明白vue-router 的过渡动效的过渡机制是什么？然后再根据这个机制来分析可行性。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;router-view v-slot=&quot;&#123; Component &#125;&quot;&gt;</span><br><span class="line">  &lt;transition name=&quot;fade&quot;&gt;</span><br><span class="line">    &lt;component :is=&quot;Component&quot; /&gt;</span><br><span class="line">  &lt;/transition&gt;</span><br><span class="line">&lt;/router-view&gt;</span><br></pre></td></tr></table></figure>

<p>以上这段代码是实现过渡动效的关键代码。</p>
<p>其中涉及到了三个组件：</p>
<ol>
<li>router-view：路由出口</li>
<li>transition：动画组件</li>
<li>component：动态组件</li>
</ol>
<p>那么据此可以得知，vue-router过渡动效产生的关键就是transition动画组件。</p>
<p>那么同时我们知道对于<strong>transition</strong>而言，它能够产生动画的关键，其实是其内部元素component的动态组件切换。</p>
<p>但是这样的切换他一定是基于整个页面组件的。也就是说如果我们利用这种过渡动效，那么一定是：<strong>从home页面到detail 页面的整体页面组件的切换。</strong></p>
<p>所以是<strong>无法</strong>实现咱们期望的这种路由过渡效果的。</p>
<h2 id="12-3-主动介入浏览器堆栈管理，分析可行性方案"><a href="#12-3-主动介入浏览器堆栈管理，分析可行性方案" class="headerlink" title="12-3 主动介入浏览器堆栈管理，分析可行性方案"></a>12-3 主动介入浏览器堆栈管理，分析可行性方案</h2><p><strong>什么是路由的跳转？</strong></p>
<p>所谓路由的跳转无非指的是两个部分：</p>
<ol>
<li>浏览器的url发生了变化</li>
<li>浏览器中展示的页面组件发生了变化</li>
</ol>
<p>那么只要满足这两点，我们就认为<strong>路径进行了跳转</strong></p>
<p>所以说，我们是不是可以换个思路，我们<strong>不去进行真实的路由跳转，而是先修改浏览器的URL，再切换展示的页面</strong><br><strong>（以组件的形式覆盖整个浏览器可视区域）</strong>。这样对于用户而言，是不是就完成了整个的路由跳转工作。</p>
<p>所以说我们的具体问题就变成了：</p>
<ol>
<li>如何让浏览器的url发生变化，但是不跳转页面</li>
<li>如何让一个新的组件以包含动画的形式进行展示</li>
</ol>
<p>那么想要完成第一个功能我们可以使用：<strong>History.pushState（）</strong>方法。</p>
<p>而第二个功能我们可以使用<strong>GSAP</strong>这个动画库来进行实现。</p>
<h2 id="12-4-主动介入浏览器堆栈管理"><a href="#12-4-主动介入浏览器堆栈管理" class="headerlink" title="12-4 主动介入浏览器堆栈管理"></a>12-4 主动介入浏览器堆栈管理</h2><ol>
<li>我们先给item.vue增加一个点击事件,下面增加一个点击事件，点击方法后将数据传递到同级的index.vue中</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;div</span><br><span class="line">  class=&quot;relative w-full rounded cursor-zoom-in group&quot;</span><br><span class="line">  :style=&quot;&#123;</span><br><span class="line">    backgroundColor:randomRGB()</span><br><span class="line">  &#125;&quot;</span><br><span class="line">  @click=&#x27;onToPinsClick&#x27;</span><br><span class="line">&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> emits = <span class="title function_">defineEmits</span>([<span class="string">&#x27;click&#x27;</span>])</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 进入详情点击事件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onToPinsClick</span> = (<span class="params"></span>) =&gt;&#123;</span><br><span class="line">  <span class="title function_">emits</span>(<span class="string">&#x27;click&#x27;</span>,&#123;</span><br><span class="line">    <span class="attr">id</span>:props.<span class="property">data</span>.<span class="property">id</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>我们在list&#x2F;index.vue中监听点击事件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;item-vue :data=&quot;item&quot; :width=&quot;width&quot; @click=&#x27;onToPins&#x27;&gt;&lt;/item-vue&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 进入pins</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onToPins</span> = (<span class="params">item</span>) =&gt;&#123;</span><br><span class="line">  <span class="comment">//修改浏览器的url</span></span><br><span class="line">  history.<span class="title function_">pushState</span>(<span class="literal">null</span>,<span class="literal">null</span>,<span class="string">`/pins/<span class="subst">$&#123;item.id&#125;</span>`</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="12-5-基于GSAP实现高阶路由过渡动画分析"><a href="#12-5-基于GSAP实现高阶路由过渡动画分析" class="headerlink" title="12-5 基于GSAP实现高阶路由过渡动画分析"></a>12-5 基于GSAP实现高阶路由过渡动画分析</h2><p>当url发生变化之后，我们接下来就只需要处理对应的动画就可以了。</p>
<p>动画的处理我们依赖于GSAP进行实现。对于GSAP而言，主要依赖两个方法：</p>
<ol>
<li>gsap.set（）：这个方法通常使用在动画开始之前，表示设置动画开始前的元素属性</li>
<li>gsap.to（）：这个方法表示<strong>最终元素展示的状态</strong></li>
</ol>
<p>GSAP 会基于set 和to的状态，来自动执行中间的补间动画。</p>
<p>所以我们只需要：</p>
<ol>
<li>创建一个对应的组件，使用 transition进行包裹</li>
<li>计算出set时，组件元素对应的样式属性</li>
<li>计算出to时，组件元素对应的样式属性</li>
</ol>
<p>然后就可以由GSAP自动实现对应的补间动画了。</p>
<h2 id="12-6-基于GSAP实现高阶路由过渡动画处理"><a href="#12-6-基于GSAP实现高阶路由过渡动画处理" class="headerlink" title="12-6 基于GSAP实现高阶路由过渡动画处理"></a>12-6 基于GSAP实现高阶路由过渡动画处理</h2><ol>
<li>创建 src&#x2F;views&#x2F;pins&#x2F;index.vue 组件，该组件的作用之后再说</li>
<li>src&#x2F;views&#x2F;pins&#x2F;components&#x2F;pins.vue 组件，该组件即为详情组件，在该组件中写入一些初始内容</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&#x27;fixed top-0 left-0 w-screen h-screen text-xl</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">  bg-slate-200 z-20&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &#123;&#123;id&#125;&#125;</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="title function_">defineProps</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">id</span>:&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">type</span>:<span class="title class_">String</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">required</span>:<span class="literal">true</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在 src&#x2F;views&#x2F;main&#x2F;components&#x2F;list&#x2F;index.vue中使用 pins 组件，并使用 transition 进行包裹，并利用JavaScript钩子绑定对应的三个状态，并添加 css&#x3D;false</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--    响应内容展示--&gt;</span><br><span class="line">    &lt;transition</span><br><span class="line">      :css=&#x27;false&#x27;</span><br><span class="line">      @before-enter=&#x27;beforeEnter&#x27;</span><br><span class="line">      @enter=&#x27;enter&#x27;</span><br><span class="line">      @leaver=&#x27;leave&#x27;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;pins-vue v-if=&#x27;isVisablePins&#x27; :id=&#x27;currentPins.id&#x27;&gt;&lt;/pins-vue&gt;</span><br><span class="line">    &lt;/transition&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//控制pins展示</span></span><br><span class="line"><span class="keyword">const</span> isVisiblePins = <span class="title function_">ref</span>(<span class="literal">false</span>)</span><br><span class="line"><span class="comment">//当前选中的pins属性</span></span><br><span class="line"><span class="keyword">const</span> currentPins = <span class="title function_">ref</span>(&#123;&#125;)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 进入pins</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onToPins</span> = (<span class="params">item</span>) =&gt;&#123;</span><br><span class="line">  <span class="comment">//修改浏览器的url</span></span><br><span class="line">  history.<span class="title function_">pushState</span>(<span class="literal">null</span>,<span class="literal">null</span>,<span class="string">`/pins/<span class="subst">$&#123;item.id&#125;</span>`</span>)</span><br><span class="line">  isVisiblePins.<span class="property">value</span> =<span class="literal">true</span></span><br><span class="line">  currentPins.<span class="property">value</span>=item</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>那么此时点击即可展示出对应的pins组件</li>
</ol>
<p>接下来我们缺少的就是对应的动画内容了。</p>
<ol>
<li>在 src&#x2F;views&#x2F;main&#x2F;components&#x2F;list&#x2F;item.vue中，记录点击时当前 item图片的中心位置，该位置即为动画的起点，此处将使用到useElementBounding方法：</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * pins跳转记录,记录图片的中心点(X或Y的位置 + 宽或高一半)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">  <span class="attr">x</span>: imgContainerX,</span><br><span class="line">  <span class="attr">y</span>: imgContainerY,</span><br><span class="line">  <span class="attr">width</span>: imgContainerWidth,</span><br><span class="line">  <span class="attr">height</span>: imgContainerHeight,</span><br><span class="line">&#125; = <span class="title function_">useElementBounding</span>(imgTarget)</span><br><span class="line"><span class="keyword">const</span> imgContainerCenter = <span class="title function_">computed</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">return</span>&#123;</span><br><span class="line">    <span class="attr">translateX</span>:<span class="built_in">parseInt</span>(imgContainerX.<span class="property">value</span>+imgContainerWidth.<span class="property">value</span>/<span class="number">2</span>),</span><br><span class="line">    <span class="attr">translateY</span>:<span class="built_in">parseInt</span>(imgContainerY.<span class="property">value</span>+imgContainerHeight.<span class="property">value</span>/<span class="number">2</span>),</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在onToPinsClick 中，传递计算出的值：</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">onToPinsClick</span> = (<span class="params"></span>) =&gt;&#123;</span><br><span class="line">  <span class="title function_">emits</span>(<span class="string">&#x27;click&#x27;</span>,&#123;</span><br><span class="line">    <span class="attr">id</span>:props.<span class="property">data</span>.<span class="property">id</span>,</span><br><span class="line">    <span class="attr">location</span>:imgContainerCenter.<span class="property">value</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>安装GSAP</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i --save gsap@3.9.1</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>在 src&#x2F;views&#x2F;main&#x2F;components&#x2F;list&#x2F;index.vue 中，填充三 transition 子：</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">beforeEnter</span> = (<span class="params">el</span>) =&gt;&#123;</span><br><span class="line">  gsap.<span class="title function_">set</span>(el,&#123;</span><br><span class="line">    <span class="attr">scaleX</span>:<span class="number">0</span>,</span><br><span class="line">    <span class="attr">scaleY</span>:<span class="number">0</span>,</span><br><span class="line">    <span class="attr">transformOrigin</span>:<span class="string">&#x27;0 0&#x27;</span>,</span><br><span class="line">    <span class="attr">translateX</span>:currentPins.<span class="property">value</span>.<span class="property">location</span>?.<span class="property">translateX</span>,</span><br><span class="line">    <span class="attr">translateY</span>:currentPins.<span class="property">value</span>.<span class="property">location</span>?.<span class="property">translateY</span>,</span><br><span class="line">    <span class="attr">opacity</span>:<span class="number">0</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">enter</span> =(<span class="params">el,done</span>)=&gt;&#123;</span><br><span class="line">  gsap.<span class="title function_">to</span>(el,&#123;</span><br><span class="line">    <span class="attr">duration</span>:<span class="number">0.3</span>,</span><br><span class="line">    <span class="attr">scaleX</span>:<span class="number">1</span>,</span><br><span class="line">    <span class="attr">scaleY</span>:<span class="number">1</span>,</span><br><span class="line">    <span class="attr">transformOrigin</span>:<span class="string">&#x27;0 0&#x27;</span>,</span><br><span class="line">    <span class="attr">translateX</span>:currentPins.<span class="property">value</span>.<span class="property">location</span>?.<span class="property">translateX</span>,</span><br><span class="line">    <span class="attr">translateY</span>:currentPins.<span class="property">value</span>.<span class="property">location</span>?.<span class="property">translateY</span>,</span><br><span class="line">    <span class="attr">opacity</span>:<span class="number">1</span>,</span><br><span class="line">    <span class="attr">onComplete</span>:done</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">leave</span> =(<span class="params">el,done</span>)=&gt;&#123;</span><br><span class="line">  gsap.<span class="title function_">to</span>(el,&#123;</span><br><span class="line">    <span class="attr">duration</span>:<span class="number">0.3</span>,</span><br><span class="line">    <span class="attr">scaleX</span>:<span class="number">0</span>,</span><br><span class="line">    <span class="attr">scaleY</span>:<span class="number">0</span>,</span><br><span class="line">    <span class="attr">transformOrigin</span>:<span class="string">&#x27;0 0&#x27;</span>,</span><br><span class="line">    <span class="attr">translateX</span>:<span class="number">0</span>,</span><br><span class="line">    <span class="attr">translateY</span>:<span class="number">0</span>,</span><br><span class="line">    <span class="attr">opacity</span>:<span class="number">0</span>,</span><br><span class="line">    <span class="attr">onComplete</span>:done</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>这个时候leave的状态还看不了，我们再从这里添加一个监听浏览器后退的事件，就可以了</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 监听浏览器后退按钮事件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">useEventListener</span>(<span class="variable language_">window</span>,<span class="string">&#x27;popstate&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  isVisiblePins.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="12-7-通用组件：navbar构建方案分析"><a href="#12-7-通用组件：navbar构建方案分析" class="headerlink" title="12-7 通用组件：navbar构建方案分析"></a>12-7 通用组件：navbar构建方案分析</h2><p>那么接下来我们就需要处理pins中对应的页面样式了。</p>
<p>pins的页面样式同时可以应用到PC端 和移动端。而在移动端中，则会展示对应的navbar 的内容，所以我们首先先构建出 navbar 通用组件，然后在基于navbar 构建对应的pins样式。</p>
<p>那么对于navbar而言：</p>
<ol>
<li>它分为左、中、右三个大的部分，三个部分都可以通过插槽进行指定</li>
<li>左、右两边的插槽可以自定义点击事件</li>
<li>同时navbar 有时候会存在吸顶的效果，所以我们最好还可以通过一个prop指定对应的吸顶展示</li>
</ol>
<h2 id="12-8-通用组件：构建navbar"><a href="#12-8-通用组件：构建navbar" class="headerlink" title="12-8 通用组件：构建navbar"></a>12-8 通用组件：构建navbar</h2><ol>
<li>创建组件lib&#x2F;navbar&#x2F;index.vue</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    class=&#x27;w-full h-5 border-b flex items-center z-10 bg-white</span><br><span class="line">    dark:bg-zinc-800 border-b-zinc-200 dark:border-b-zinc-700&#x27;</span><br><span class="line">    :class=&quot;[sticky?&#x27;sticky top-0 left-0&#x27;:&#x27;relative&#x27;]&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;!--左--&gt;</span><br><span class="line">    &lt;div class=&#x27;h-full w-5 absolute left-0 flex items-center justify-center&#x27;</span><br><span class="line">    @click=&#x27;onClickLeft&#x27;&gt;</span><br><span class="line">      &lt;slot name=&#x27;left&#x27;&gt;</span><br><span class="line">        &lt;m-svg-icon</span><br><span class="line">          name=&#x27;back&#x27;</span><br><span class="line">          class=&#x27;w-2 h-2&#x27;</span><br><span class="line">          fillClass=&#x27;fill-zinc-900 dark:fill-zinc-200&#x27;</span><br><span class="line">        &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">      &lt;/slot&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!--中--&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      class=&#x27;h-full flex items-center justify-center m-auto font-bold</span><br><span class="line">      text-base text-zinc-900 dark:text-zinc-200&#x27;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;slot/&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!--右--&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      class=&#x27;h-full w-5 absolute right-0 flex items-center justify-center&#x27;</span><br><span class="line">      @click=&#x27;onClickRight&#x27;&gt;</span><br><span class="line">      &lt;slot name=&#x27;right&#x27;/&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; useRouter &#125; from &#x27;vue-router&#x27;</span><br><span class="line"></span><br><span class="line">const props = defineProps(&#123;</span><br><span class="line">  //左边按钮的点击</span><br><span class="line">  clickLeft:Function,</span><br><span class="line">  //右边按钮的点击</span><br><span class="line">  clickRight:Function,</span><br><span class="line">  //是否吸顶</span><br><span class="line">  sticky:Boolean</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">const router = useRouter()</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 左侧按钮点击时间</span><br><span class="line"> */</span><br><span class="line">const onClickLeft = ()=&gt;&#123;</span><br><span class="line">  if (props.clickLeft)&#123;</span><br><span class="line">    props.clickLeft()</span><br><span class="line">    return</span><br><span class="line">  &#125;</span><br><span class="line">  router.back()</span><br><span class="line">&#125;</span><br><span class="line">/**</span><br><span class="line"> * 右侧按钮点击时间</span><br><span class="line"> */</span><br><span class="line">const onClickRight = ()=&gt;&#123;</span><br><span class="line">  if (props.clickRight)&#123;</span><br><span class="line">    props.clickRight()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在views&#x2F;pins&#x2F;components&#x2F;pins.vue中使用</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&#x27;fixed top-0 left-0 w-screen h-screen text-xl</span><br><span class="line">  bg-slate-200 z-20&#x27;&gt;</span><br><span class="line">    &#123;&#123;id&#125;&#125;</span><br><span class="line">    &lt;m-navbar&gt;测试&lt;/m-navbar&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<h2 id="12-9-基于navbar处理响应式的pins页面"><a href="#12-9-基于navbar处理响应式的pins页面" class="headerlink" title="12-9 基于navbar处理响应式的pins页面"></a>12-9 基于navbar处理响应式的pins页面</h2><ol>
<li>我们创建接口方法api&#x2F;pexels.js</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取指定图片数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getPexelsFromId</span> = (<span class="params">id</span>) =&gt;&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>:<span class="string">`/pexels/<span class="subst">$&#123;id&#125;</span>`</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>其次在views&#x2F;pins&#x2F;components&#x2F;pins.vue中获取数据</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pexelData = <span class="title function_">ref</span>(&#123;&#125;)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getPexlesData</span> = <span class="keyword">async</span> (<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">getPexelsFromId</span>(props.<span class="property">id</span>)</span><br><span class="line">  pexelData.<span class="property">value</span>=data</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">getPexlesData</span>()</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在tailwind.config.js中添加阴影样式</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">backdropBlur</span>:&#123;</span><br><span class="line">  <span class="string">&#x27;4xl&#x27;</span>:<span class="string">&#x27;240px&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>在views&#x2F;pins&#x2F;components&#x2F;pins.vue中写</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&#x27;fixed top-0 left-0 w-screen h-screen text-xl z-20</span><br><span class="line">  backdrop-blur-4xl bg-transparent pb-2 overflow-y-auto xl:p-2&#x27;&gt;</span><br><span class="line">    &lt;!--移动端下的navbar--&gt;</span><br><span class="line">    &lt;m-navbar v-if=&#x27;isMobileTerminal&#x27; sticky&gt;</span><br><span class="line">      &#123;&#123;pexelData.title&#125;&#125;</span><br><span class="line">      &lt;template #right&gt;</span><br><span class="line">        &lt;m-svg-icon</span><br><span class="line">          name=&#x27;share&#x27;</span><br><span class="line">          class=&#x27;w-3 h-3&#x27;</span><br><span class="line">          fillClass=&#x27;fill-zinc-900 dark:fill-zinc-200 rounded-sm&#x27;</span><br><span class="line">        &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/m-navbar&gt;</span><br><span class="line">    &lt;!--PC端--&gt;</span><br><span class="line">    &lt;m-svg-icon</span><br><span class="line">      v-else</span><br><span class="line">      name=&#x27;close&#x27;</span><br><span class="line">      class=&#x27;w-3 h-3 ml-1 p-0.5 cursor-pointer duration-200 rounded-sm</span><br><span class="line">      hover:bg-zinc-100 absolute right-2 top-2&#x27;</span><br><span class="line">      fillClass=&#x27;fill-zinc-400&#x27;</span><br><span class="line">      @click=&#x27;onPop&#x27;</span><br><span class="line">    &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">    &lt;!--内容区--&gt;</span><br><span class="line">    &lt;div </span><br><span class="line">         v-if=&#x27;pexelData.title&#x27;</span><br><span class="line">         class=&#x27;xl:w-[80%] xl:h-full xl:mx-auto xl:rounded-lg xl:flex&#x27;&gt;</span><br><span class="line">      &lt;img</span><br><span class="line">        class=&#x27;w-screen mb-2 xl:w-3/5 xl:h-full xl:rounded-tl-lg</span><br><span class="line">        xl:rounded-bl-lg&#x27;</span><br><span class="line">        :src=&#x27;pexelData.photo&#x27;</span><br><span class="line">        alt=&#x27;&#x27;</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class=&#x27;xl:w-2/5 xl:h-full xl:bg-whiter xl:dark:bg-zinc-900</span><br><span class="line">        xl:rounded-tr-lg xl:rounded-tb-lg xl:p-3&#x27;</span><br><span class="line">      &gt;</span><br><span class="line">&lt;!--        PC下：收藏、分享--&gt;</span><br><span class="line">        &lt;div v-if=&#x27;!isMobileTerminal&#x27; class=&#x27;flex justify-between mb-2&#x27;&gt;</span><br><span class="line">&lt;!--          分享--&gt;</span><br><span class="line">          &lt;m-svg-icon</span><br><span class="line">            name=&#x27;share&#x27;</span><br><span class="line">            class=&#x27;w-4 h-4 p-1 cursor-pointer hover:bg-zinc-200</span><br><span class="line">            dark:hover-zinc-800 duration-300 rounded&#x27;</span><br><span class="line">          &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">&lt;!--          收藏--&gt;</span><br><span class="line">          &lt;m-button</span><br><span class="line">            type=&#x27;info&#x27;</span><br><span class="line">            icon=&#x27;heart&#x27;</span><br><span class="line">            iconClass=&#x27;fill-zinc-900 dark:fill-zinc-200&#x27;</span><br><span class="line">          &gt;&lt;/m-button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">&lt;!--        标题--&gt;</span><br><span class="line">        &lt;p</span><br><span class="line">          class=&#x27;text-base text-zinc-900 dark:text-zinc-200 ml-1 font-bold</span><br><span class="line">          xl:text-xl xl:mb-5&#x27;</span><br><span class="line">        &gt;</span><br><span class="line">          &#123;&#123;pexelData.title&#125;&#125;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">&lt;!--        作者--&gt;</span><br><span class="line">        &lt;div class=&#x27;flex items-center mt-1 px-1&#x27;&gt;</span><br><span class="line">          &lt;img</span><br><span class="line">            v-lazy</span><br><span class="line">            class=&#x27;h-3 w-3 rounded-full&#x27;</span><br><span class="line">            :src=&#x27;pexelData.avatar&#x27;</span><br><span class="line">            alt=&#x27;&#x27;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;span class=&#x27;text-base text-zinc-900 dark:text-zinc-200 ml-1&#x27;&gt;</span><br><span class="line">            &#123;&#123;pexelData.author&#125;&#125;</span><br><span class="line">          &lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getPexelsFromId &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/pexeis&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;isMobileTerminal&#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/flexible&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useRouter &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> props = <span class="title function_">defineProps</span>(&#123;</span><br><span class="line">  <span class="attr">id</span>:&#123;</span><br><span class="line">    <span class="attr">type</span>:<span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">required</span>:<span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">useRouter</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 关闭</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onPop</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  router.<span class="title function_">back</span>()</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="12-10-处理刷新空白问题"><a href="#12-10-处理刷新空白问题" class="headerlink" title="12-10 处理刷新空白问题"></a>12-10 处理刷新空白问题</h2><ol>
<li>我们需要解决的就是一刷新上面的url就发生了变化，接下来进行处理，首先新增view&#x2F;pins&#x2F;index.vue</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&#x27;w-full h-full bg-zinc-200 dark:bg-zinc-800&#x27;&gt;</span><br><span class="line">    &lt;pins-vue :id=&#x27;$router.params.id&#x27;/&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import pinsVue from &#x27;./components/pins.vue&#x27;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>其次在router&#x2F;modules&#x2F;pc-router.js和mobile-router.js增加同级路由</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;/pins/:id&#x27;</span>,</span><br><span class="line">  <span class="attr">name</span>:<span class="string">&#x27;pins&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>:<span class="function">()=&gt;</span><span class="title function_">import</span>(<span class="string">&#x27;@/view/pins/index.vue&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="13、人类行为验证处理方案-——-脱离UI组件库实现登录、注册-表单校验"><a href="#13、人类行为验证处理方案-——-脱离UI组件库实现登录、注册-表单校验" class="headerlink" title="13、人类行为验证处理方案 —— 脱离UI组件库实现登录、注册+表单校验"></a>13、人类行为验证处理方案 —— 脱离UI组件库实现登录、注册+表单校验</h1><p>难道你的登录注册只能依靠 UI 组件库实现吗？你的登录安全吗？如果有机器进行登录验证怎么办？进入本章带你脱离组件库，实现包含人类行为认证的登录、注册、表单校验功能。</p>
<hr>
<h2 id="13-1-前言"><a href="#13-1-前言" class="headerlink" title="13-1 前言"></a>13-1 前言</h2><p>说起登录、注册 模块，相信对于大家而言，肯定都是不阳生的。看定有很多同学一看这标题就说，这个有啥可讲的，不就是一个：</p>
<ol>
<li>调接口</li>
<li>拿token</li>
<li>存 token的过程吗？</li>
</ol>
<p>是的！</p>
<h2 id="13-2-构建登录模块基础UI结构"><a href="#13-2-构建登录模块基础UI结构" class="headerlink" title="13-2 构建登录模块基础UI结构"></a>13-2 构建登录模块基础UI结构</h2><p>本小节我们先去构建login登录业务的基础UI结构</p>
<ol>
<li>在src&#x2F;views&#x2F;layout&#x2F;components&#x2F;header&#x2F;header-my，vue 中新增-个 登录按钮</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">  &lt;template #reference&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        v-if=&#x27;false&#x27;</span><br><span class="line">     ...</span><br><span class="line">      &gt;</span><br><span class="line">    ...</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div v-else&gt;</span><br><span class="line">        &lt;m-button</span><br><span class="line">          class=&#x27;guide-my&#x27;</span><br><span class="line">          icon=&#x27;profile&#x27;</span><br><span class="line">          iconColor=&#x27;#fff&#x27;</span><br><span class="line">          @click=&#x27;onToLogin&#x27;</span><br><span class="line">        &gt;&lt;/m-button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">&lt;!--气泡--&gt;</span><br><span class="line">    &lt;div v-if=&#x27;false&#x27; &gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; useRouter &#125; from &#x27;vue-router&#x27;</span><br><span class="line"></span><br><span class="line">const router = useRouter()</span><br><span class="line">/**</span><br><span class="line"> * 登陆按钮点击事件</span><br><span class="line"> */</span><br><span class="line">const onToLogin = ()=&gt;&#123;</span><br><span class="line">  router.push(&#x27;/login&#x27;)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>分别构建PC端下和移动端下对应的路由：</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;/login&#x27;</span>,</span><br><span class="line">  <span class="attr">name</span>:<span class="string">&#x27;login&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>:<span class="function">()=&gt;</span><span class="title function_">import</span>(<span class="string">&#x27;@/view/login-register/login/index.vue&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>创建 src&#x2F;views&#x2F;login-register&#x2F;login&#x2F;index.vue组件为登录组件</p>
</li>
<li><p>构建对应基础样式</p>
</li>
</ol>

        </div>

        
            <div class="post-copyright-info">
                <div class="article-copyright-info-container">
    <ul>
        <li>Post title：基于 Vue3 ，打造前台+中台通用提效解决方案</li>
        <li>Post author：Fang</li>
        <li>Create time：2022-09-28 10:14:05</li>
        <li>
            Post link：https://ainianxu.github.io/2022/09/28/基于-Vue3-，打造前台-中台通用提效解决方案/
        </li>
        <li>
            Copyright Notice：All articles in this blog are licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> unless stating additionally.
        </li>
    </ul>
</div>

            </div>
        

        
            <ul class="post-tags-box">
                
                    <li class="tag-item">
                        <a href="/tags/Vue3/">#Vue3</a>&nbsp;
                    </li>
                
            </ul>
        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/2022/10/13/Anylogic%E4%B9%8B%E9%A1%B9%E7%9B%AE/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Anylogic之项目</span>
                                <span class="post-nav-item">Prev posts</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/2022/09/26/MyBatis-%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B9%8B-%E5%92%8C-%E7%9A%84%E5%8C%BA%E5%88%AB%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">MyBatis 面试题之#{}和$ {}的区别是什么？</span>
                                <span class="post-nav-item">Next posts</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
            <div class="comment-container">
                <div class="comments-container">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
        <i class="fas fa-comments">&nbsp;Comments</i>
    </div>
    

        
            
    <div class="valine-container">
        <script data-pjax
                src="//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script>
        <div id="vcomments"></div>
        <script data-pjax>
            function loadValine() {
                new Valine({
                    el: '#vcomments',
                    appId: 'loa9BVbgmyFLwBMHhg1Cycx1-gzGzoHsz',
                    appKey: '47pIz6ewIXRi5251WyfUpQOB',
                    meta: ['nick', 'mail', 'link'],
                    avatar: 'wavatar',
                    enableQQ: true,
                    placeholder: '😜 尽情吐槽吧~',
                    lang: 'en'.toLowerCase()
                });

                function getAuthor(language) {
                    switch (language) {
                        case 'en':
                            return 'Author';
                        case 'zh-CN':
                            return '博主';
                        default:
                            return 'Master';
                    }
                }

                // Add "Author" identify
                const getValineDomTimer = setInterval(() => {
                    const vcards = document.querySelectorAll('#vcomments .vcards .vcard');
                    if (vcards.length > 0) {
                        let author = 'Fang';

                        if (author) {
                            for (let vcard of vcards) {
                                const vnick_dom = vcard.querySelector('.vhead .vnick');
                                const vnick = vnick_dom.innerHTML;
                                if (vnick === author) {
                                    vnick_dom.innerHTML = `${vnick} <span class="author">${getAuthor(KEEP.hexo_config.language)}</span>`
                                }
                            }
                        }
                        clearInterval(getValineDomTimer);
                    } else {
                        clearInterval(getValineDomTimer);
                    }
                }, 2000);
            }

            if ('true') {
                const loadValineTimeout = setTimeout(() => {
                    loadValine();
                    clearTimeout(loadValineTimeout);
                }, 1000);
            } else {
                window.addEventListener('DOMContentLoaded', loadValine);
            }
        </script>
    </div>



        
    
</div>

            </div>
        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2021</span>
              -
            
            2023&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">Fang</a>
        </div>
        
            <script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv">
                        Visitor Count&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                    </span>
                
                
                    <span id="busuanzi_container_site_pv">
                        Totalview&nbsp;<span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            Powered by <a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;|&nbsp;Theme&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.4</a>
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fas fa-comment"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        
            <li class="tools-item rss flex-center">
                <a class="flex-center"
                   href="/atom.xml"
                   target="_blank"
                >
                    <i class="fas fa-rss"></i>
                </a>
            </li>
        

        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1%E3%80%81%E5%85%A8%E6%96%B0%E7%9A%84%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BA%E6%96%B9%E6%A1%88-%E2%80%94%E2%80%94-vite"><span class="nav-number">1.</span> <span class="nav-text">1、全新的项目构建方案 —— vite</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-vite-VS-webpack"><span class="nav-number">1.1.</span> <span class="nav-text">1-1 vite VS webpack</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-%E7%B4%A0%E8%B4%A8%E4%B8%89%E8%BF%9E%EF%BC%9Avite-%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BF%AB%EF%BC%9F%E8%BF%99%E7%A7%8D%E5%BF%AB%E7%9A%84%E6%9C%BA%E5%88%B6%E4%BC%9A%E4%B8%8D%E4%BC%9A%E6%9C%89%E4%BB%80%E4%B9%88%E9%97%AE%E9%A2%98%EF%BC%9F%E5%AE%98%E6%96%B9%E6%98%AF%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E7%9A%84%EF%BC%9F"><span class="nav-number">1.2.</span> <span class="nav-text">1-2 素质三连：vite 为什么快？这种快的机制会不会有什么问题？官方是如何解决的？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9%E4%BA%86-vite"><span class="nav-number">1.3.</span> <span class="nav-text">1-3 为什么选择了 vite</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-4-%E9%80%9A%E8%BF%87-vite-%E6%9E%84%E5%BB%BA%E3%80%8A%E5%B0%8F%E6%85%95%E5%89%8D%E7%AB%AF%E3%80%8B"><span class="nav-number">1.4.</span> <span class="nav-text">1-4 通过 vite 构建《小慕前端》</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2%E3%80%81%E5%AE%9A%E5%88%B6%E5%8C%96%E3%80%81%E9%AB%98%E5%8F%AF%E7%94%A8%E5%89%8D%E5%8F%B0%E6%A0%B7%E5%BC%8F%E5%A4%84%E7%90%86%E6%96%B9%E6%A1%88%E2%80%94%E2%80%94tailwindcss"><span class="nav-number">2.</span> <span class="nav-text">2、定制化、高可用前台样式处理方案——tailwindcss</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-%E4%BC%81%E4%B8%9A%E7%BA%A7%E9%A1%B9%E7%9B%AE%E4%B8%8B%E7%9A%84css%E5%A4%84%E7%90%86%E7%97%9B%E7%82%B9"><span class="nav-number">2.1.</span> <span class="nav-text">2-1 企业级项目下的css处理痛点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-%E5%AE%89%E8%A3%85tailwindcss%E5%88%B0%E4%BD%A0%E7%9A%84%E9%A1%B9%E7%9B%AE"><span class="nav-number">2.2.</span> <span class="nav-text">2-2 安装tailwindcss到你的项目</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3-tailwindcss%E5%88%9D%E4%BD%93%E9%AA%8C"><span class="nav-number">2.3.</span> <span class="nav-text">2-3 tailwindcss初体验</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-4-tailwindcss%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5%E5%92%8C%E4%BB%B7%E5%80%BC%E4%BD%93%E7%8E%B0"><span class="nav-number">2.4.</span> <span class="nav-text">2-4 tailwindcss设计理念和价值体现</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3%E3%80%81%E6%98%8E%E6%98%9F%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E2%80%94%E2%80%94%E6%90%AD%E5%BB%BA%E5%9F%BA%E7%A1%80%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"><span class="nav-number">3.</span> <span class="nav-text">3、明星项目架构解决方案——搭建基础项目结构</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%E5%8A%A9%E6%89%8B-Prettier-Code-formatter-%E3%80%81-Tailwind-CSS-IntelliSense%E3%80%81Volar"><span class="nav-number">3.1.</span> <span class="nav-text">3-1 项目开发助手 Prettier - Code formatter 、 Tailwind CSS IntelliSense、Volar</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84%E5%A4%84%E7%90%86%E5%88%86%E6%9E%90"><span class="nav-number">3.2.</span> <span class="nav-text">3-2 项目架构基本结构处理分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3-%E6%9E%84%E5%BB%BA%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84"><span class="nav-number">3.3.</span> <span class="nav-text">3-3 构建项目架构</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4%E3%80%81%E4%BC%81%E4%B8%9A%E7%BA%A7vite%E9%85%8D%E7%BD%AE%E6%96%B9%E6%A1%88%E2%80%94%E2%80%94%E8%AE%A9vite%E5%BE%97%E5%BF%83%E5%BA%94%E6%89%8B"><span class="nav-number">4.</span> <span class="nav-text">4、企业级vite配置方案——让vite得心应手</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-%E6%98%8E%E7%A1%AE%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%92%8CPC%E7%AB%AF%E7%9A%84%E6%9E%84%E5%BB%BA%E9%A1%BA%E5%BA%8F"><span class="nav-number">4.1.</span> <span class="nav-text">4-1 明确移动端和PC端的构建顺序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-%E6%9E%84%E5%BB%BA%E7%A7%BB%E5%8A%A8%E5%A4%84%E7%90%86%E5%B7%A5%E5%85%B7-MobileTerminal"><span class="nav-number">4.2.</span> <span class="nav-text">4-2 构建移动处理工具 MobileTerminal</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-3-%E9%80%9A%E8%BF%87-vueuse-%E4%BC%98%E5%8C%96%E5%A4%84%E7%90%86%E6%96%B9%E6%A1%88"><span class="nav-number">4.3.</span> <span class="nav-text">4-3 通过 vueuse 优化处理方案</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-3-%E5%AE%9A%E4%B9%89-%E8%BD%AF%E9%93%BE%E6%8E%A5"><span class="nav-number">4.4.</span> <span class="nav-text">4-3 定义@软链接</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-4-%E6%9E%84%E5%BB%BAVueRouter%E7%A7%BB%E5%8A%A8%E7%AB%AF%E8%B7%AF%E7%94%B1%E8%A1%A8"><span class="nav-number">4.5.</span> <span class="nav-text">4-4 构建VueRouter移动端路由表</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-5-%E5%88%92%E5%88%86%E7%A7%BB%E5%8A%A8%E7%AB%AF%E9%A6%96%E9%A1%B5%E6%A8%A1%E5%9D%97"><span class="nav-number">4.6.</span> <span class="nav-text">4-5 划分移动端首页模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-6-%E5%AF%BC%E5%85%A5%E5%B9%B6%E9%85%8D%E7%BD%AEaxios"><span class="nav-number">4.7.</span> <span class="nav-text">4-6 导入并配置axios</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-7-vite%E5%A4%84%E7%90%86%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">4.8.</span> <span class="nav-text">4-7 vite处理代理服务器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-8-vite%E5%A4%84%E7%90%86%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="nav-number">4.9.</span> <span class="nav-text">4-8 vite处理环境变量</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5%E3%80%81%E6%9E%84%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E7%89%A9%E6%96%99%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E2%80%94%E2%80%94%E6%9E%84%E5%BB%BA%E7%89%A9%E6%96%99%E5%BA%93%EF%BC%8C%E5%AE%9E%E7%8E%B0%E5%89%8D%E7%AB%AF%E8%AE%BE%E8%AE%A1"><span class="nav-number">5.</span> <span class="nav-text">5、构建自己的物料解决方案——构建物料库，实现前端设计</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#5-1-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E4%BD%BF%E7%94%A8%E7%BB%84%E4%BB%B6%E5%BA%93%EF%BC%8C%E8%80%8C%E8%A6%81%E8%87%AA%E5%B7%B1%E6%9E%84%E5%BB%BA%EF%BC%9F%E5%89%8D%E5%8F%B0%E7%B3%BB%E7%BB%9F%E4%B8%8E%E5%90%8E%E5%8F%B0%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%A0%B9%E6%9C%AC%E6%80%A7%E5%8C%BA%E5%88%AB%EF%BC%81"><span class="nav-number">5.1.</span> <span class="nav-text">5-1 为什么不使用组件库，而要自己构建？前台系统与后台系统的根本性区别！</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-2-%E6%95%B0%E6%8D%AE%E6%8B%A6%E6%88%AA%E7%AE%80%E5%8C%96%E6%95%B0%E6%8D%AE%E8%8E%B7%E5%8F%96%E6%B5%81%E7%A8%8B"><span class="nav-number">5.2.</span> <span class="nav-text">5-2 数据拦截简化数据获取流程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-3-%E4%B8%9A%E5%8A%A1%E7%BB%84%E4%BB%B6%EF%BC%9A%E7%A7%BB%E5%8A%A8%E7%AB%AFnavigationBar"><span class="nav-number">5.3.</span> <span class="nav-text">5-3 业务组件：移动端navigationBar</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-4-%E5%8A%A8%E6%80%81rem%E5%9F%BA%E5%87%86-%E4%BF%AE%E6%AD%A3tailwind%EF%BC%8C%E5%AE%8C%E5%96%84%E7%A7%BB%E5%8A%A8%E7%AB%AFnavig"><span class="nav-number">5.4.</span> <span class="nav-text">5-4 动态rem基准+修正tailwind，完善移动端navig</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-5-%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6%EF%BC%9A%E5%9F%BA%E4%BA%8Evite%E7%9A%84%E7%BB%9F%E4%B8%80svg%E5%A4%84%E7%90%86svg-icon"><span class="nav-number">5.5.</span> <span class="nav-text">5-5 通用组件：基于vite的统一svg处理svg-icon</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-6-vite%E5%A4%84%E7%90%86svg%E7%9F%A2%E9%87%8F%E5%9B%BE"><span class="nav-number">5.6.</span> <span class="nav-text">5-6 vite处理svg矢量图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-7-%E7%A7%BB%E5%8A%A8%E7%AB%AFslider%E5%A4%84%E7%90%86"><span class="nav-number">5.7.</span> <span class="nav-text">5-7 移动端slider处理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-8-%E8%A1%A5%E5%85%A8category%E6%95%B0%E6%8D%AE"><span class="nav-number">5.8.</span> <span class="nav-text">5-8 补全category数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-9-%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6%EF%BC%9A%E5%BC%B9%E5%87%BA%E7%AA%97%E5%8F%A3-popup%E8%83%BD%E5%8A%9B%E5%88%86%E6%9E%90"><span class="nav-number">5.9.</span> <span class="nav-text">5-9 通用组件：弹出窗口-popup能力分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-9-%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6%EF%BC%9A%E5%BC%B9%E5%87%BA%E7%AA%97%E5%8F%A3-popup-%E5%AE%9E%E7%8E%B0"><span class="nav-number">5.10.</span> <span class="nav-text">5-9 通用组件：弹出窗口-popup 实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-10-%E7%BB%84%E4%BB%B6%E9%97%B4%E5%8F%8C%E5%90%91%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9A%E5%8A%9F%E8%83%BD%E4%BC%98%E5%8C%96"><span class="nav-number">5.11.</span> <span class="nav-text">5-10 组件间双向数据绑定功能优化</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-11-vite%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B3%A8%E5%86%8C"><span class="nav-number">5.12.</span> <span class="nav-text">5-11 vite通用组件自动化注册</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-12-%E4%B8%9A%E5%8A%A1%E7%BB%84%E4%BB%B6%EF%BC%9A%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%BC%B9%E5%B1%82menu"><span class="nav-number">5.13.</span> <span class="nav-text">5-12 业务组件：移动端弹层menu</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-13-%E6%80%BB%E7%BB%93"><span class="nav-number">5.14.</span> <span class="nav-text">5-13 总结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6%E3%80%81%E4%BC%81%E4%B8%9A%E7%BA%A7%E9%80%9A%E7%94%A8%E4%B8%9A%E5%8A%A1Header%E5%A4%84%E7%90%86%E6%96%B9%E6%A1%88%E2%80%94%E2%80%94%E7%BB%93%E5%90%88%E4%B8%AD%E5%8F%B0%E7%BB%84%E4%BB%B6%E7%9A%84%E4%B8%9A%E5%8A%A1%E7%BB%84%E4%BB%B6%E5%A4%84%E7%90%86"><span class="nav-number">6.</span> <span class="nav-text">6、企业级通用业务Header处理方案——结合中台组件的业务组件处理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#6-1-%E5%A4%84%E7%90%86PC%E7%AB%AF%E5%9F%BA%E7%A1%80%E6%9E%B6%E6%9E%84"><span class="nav-number">6.1.</span> <span class="nav-text">6-1 处理PC端基础架构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-2-PC%E7%AB%AFHeader%E6%A8%A1%E5%9D%97%E5%A4%84%E7%90%86%E5%88%86%E6%9E%90%E4%B8%8E%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0"><span class="nav-number">6.2.</span> <span class="nav-text">6-2 PC端Header模块处理分析与简单实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-3-%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6%EF%BC%9Asearch%E6%90%9C%E7%B4%A2%E6%A1%86%E8%83%BD%E5%8A%9B%E5%88%86%E6%9E%90"><span class="nav-number">6.3.</span> <span class="nav-text">6-3 通用组件：search搜索框能力分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-4-%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6%EF%BC%9Asearch%E6%90%9C%E7%B4%A2%E6%A1%86%E6%A0%B7%E5%BC%8F%E5%A4%84%E7%90%86"><span class="nav-number">6.4.</span> <span class="nav-text">6-4 通用组件：search搜索框样式处理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-5-%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6%EF%BC%9Abutton%E6%8C%89%E9%92%AE%E8%83%BD%E5%8A%9B%E5%88%86%E6%9E%90"><span class="nav-number">6.5.</span> <span class="nav-text">6-5 通用组件：button按钮能力分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-6-%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6%EF%BC%9Abutton%E6%8C%89%E9%92%AE%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="nav-number">6.6.</span> <span class="nav-text">6-6 通用组件：button按钮功能实现-</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-7-%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6%EF%BC%9A%E5%AE%8C%E5%96%84search%E5%9F%BA%E6%9C%AC%E8%83%BD%E5%8A%9B"><span class="nav-number">6.7.</span> <span class="nav-text">6-7 通用组件：完善search基本能力</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-8-%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6%EF%BC%9Apopover%E6%B0%94%E6%B3%A1%E5%8D%A1%E7%89%87%E8%83%BD%E5%8A%9B%E5%88%86%E6%9E%90"><span class="nav-number">6.8.</span> <span class="nav-text">6-8 通用组件：popover气泡卡片能力分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-9-%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6%EF%BC%9Apopover%E6%B0%94%E6%B3%A1%E5%8D%A1%E7%89%87%E5%9F%BA%E7%A1%80%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="nav-number">6.9.</span> <span class="nav-text">6-9 通用组件：popover气泡卡片基础功能实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-10-%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6%EF%BC%9Apopover%E5%8A%9F%E8%83%BD%E5%BB%B6%E4%BC%B8%EF%BC%8C%E6%8E%A7%E5%88%B6%E6%B0%94%E6%B3%A1%E5%B1%95%E7%A4%BA%E4%BD%8D%E7%BD%AE"><span class="nav-number">6.10.</span> <span class="nav-text">6-10 通用组件：popover功能延伸，控制气泡展示位置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-11-%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6%EF%BC%9A%E5%A4%84%E7%90%86%E6%85%A2%E9%80%9F%E7%A7%BB%E5%8A%A8%E6%97%B6%EF%BC%8C%E6%B0%94%E6%B3%A1%E6%B6%88%E5%A4%B1%E9%97%AE%E9%A2%98"><span class="nav-number">6.11.</span> <span class="nav-text">6-11 通用组件：处理慢速移动时，气泡消失问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-12-%E5%9F%BA%E4%BA%8Epopover%E5%A4%84%E7%90%86%E7%94%A8%E6%88%B7%E6%A8%A1%E5%9D%97"><span class="nav-number">6.12.</span> <span class="nav-text">6-12 基于popover处理用户模块</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#7%E3%80%81%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%A4%8D%E6%9D%82%E5%89%8D%E4%B8%AD%E5%8F%B0%E9%A1%B9%E7%9B%AE%E5%93%8D%E5%BA%94%E5%BC%8F%E5%A4%84%E7%90%86%E6%96%B9%E6%A1%88-%E2%80%94%E2%80%94-%E4%B8%80%E5%A5%97%E4%BB%A3%E7%A0%81%E5%A4%9A%E7%AB%AF%E5%85%B1%E7%94%A8"><span class="nav-number">7.</span> <span class="nav-text">7、企业级复杂前中台项目响应式处理方案 —— 一套代码多端共用</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#7-1-%E5%89%8D%E8%A8%80"><span class="nav-number">7.1.</span> <span class="nav-text">7-1 前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-2-%E5%93%8D%E5%BA%94%E5%BC%8F%E4%B8%8BnavigationBar%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88%E5%88%86%E6%9E%90"><span class="nav-number">7.2.</span> <span class="nav-text">7-2 响应式下navigationBar实现方案分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-3-%E6%8A%BD%E7%A6%BB%E5%85%AC%E7%94%A8%E9%80%BB%E8%BE%91%EF%BC%8C%E5%B0%81%E8%A3%85%E7%B3%BB%E5%88%97%E5%8A%A8%E4%BD%9C"><span class="nav-number">7.3.</span> <span class="nav-text">7-3 抽离公用逻辑，封装系列动作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-4-PC%E7%AB%AFnavigationBar%E7%A7%81%E6%9C%89%E8%A7%86%E5%9B%BE%E5%A4%84%E7%90%86"><span class="nav-number">7.4.</span> <span class="nav-text">7-4 PC端navigationBar私有视图处理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-5-PC%E7%AB%AFnavigationBar%E7%A7%81%E6%9C%89%E9%80%BB%E8%BE%91%E5%A4%84%E7%90%86"><span class="nav-number">7.5.</span> <span class="nav-text">7-5 PC端navigationBar私有逻辑处理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-6-%E5%88%86%E6%9E%90navigationBar%E9%97%AA%E7%83%81%E9%97%AE%E9%A2%98"><span class="nav-number">7.6.</span> <span class="nav-text">7-6 分析navigationBar闪烁问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-7-%E5%A4%84%E7%90%86navigationBar%E9%97%AA%E7%83%81%E9%97%AE%E9%A2%98"><span class="nav-number">7.7.</span> <span class="nav-text">7-7 处理navigationBar闪烁问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-8-category%E6%95%B0%E6%8D%AE%E7%BC%93%E5%AD%98%EF%BC%8C%E8%A6%86%E7%9B%96%E5%88%9D%E5%A7%8B%E6%95%B0%E6%8D%AE"><span class="nav-number">7.8.</span> <span class="nav-text">7-8 category数据缓存，覆盖初始数据</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#8%E3%80%81-%E4%B8%BB%E9%A2%98%E6%9B%BF%E6%8D%A2%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-%E2%80%94%E2%80%94-%E6%89%93%E9%80%A0%E5%AE%8C%E5%96%84%E5%A4%9A%E4%B8%BB%E9%A2%98%E7%B3%BB%E7%BB%9F"><span class="nav-number">8.</span> <span class="nav-text">8、 主题替换解决方案 —— 打造完善多主题系统</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#8-1-%E4%B8%BB%E9%A2%98%E6%9B%BF%E6%8D%A2%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90"><span class="nav-number">8.1.</span> <span class="nav-text">8-1 主题替换原理分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-2-ailwindDarkMode%E5%8E%9F%E7%90%86"><span class="nav-number">8.2.</span> <span class="nav-text">8-2 ailwindDarkMode原理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-3-%E4%B8%BA%E7%BB%84%E4%BB%B6%E5%A2%9E%E5%8A%A0dark%E9%80%82%E9%85%8D"><span class="nav-number">8.3.</span> <span class="nav-text">8-3 为组件增加dark适配</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-4-DarkMode%E5%9C%A8%E5%A4%8D%E6%9D%82%E5%BA%94%E7%94%A8%E4%B8%AD%E7%9A%84%E5%AE%9E%E7%8E%B0%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90"><span class="nav-number">8.4.</span> <span class="nav-text">8-4 DarkMode在复杂应用中的实现逻辑分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-5-DarkMode%E5%9C%A8%E5%A4%8D%E6%9D%82%E5%BA%94%E7%94%A8%E4%B8%AD%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="nav-number">8.5.</span> <span class="nav-text">8-5 DarkMode在复杂应用中的实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-6-%E8%B7%9F%E9%9A%8F%E7%B3%BB%E7%BB%9F%E7%9A%84%E4%B8%BB%E9%A2%98%E5%8F%98%E6%9B%B4"><span class="nav-number">8.6.</span> <span class="nav-text">8-6 跟随系统的主题变更</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#9%E3%80%81%E7%80%91%E5%B8%83%E6%B5%81-%E9%95%BF%E5%88%97%E8%A1%A8-%E6%87%92%E5%8A%A0%E8%BD%BD%E5%A4%84%E7%90%86%E6%96%B9%E6%A1%88-%E2%80%94%E2%80%94-%E6%89%93%E9%80%A0%E4%BC%81%E4%B8%9A%E7%BA%A7%E9%AB%98%E6%80%A7%E8%83%BD%E9%80%9A%E7%94%A8%E6%A8%A1%E5%9D%97"><span class="nav-number">9.</span> <span class="nav-text">9、瀑布流+长列表+懒加载处理方案 —— 打造企业级高性能通用模块</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#9-1-%E4%B8%9A%E5%8A%A1%E7%BB%84%E4%BB%B6%EF%BC%9A%E6%9E%84%E5%BB%BA%E5%9F%BA%E7%A1%80%E5%88%97%E8%A1%A8%E5%B1%95%E7%A4%BA"><span class="nav-number">9.1.</span> <span class="nav-text">9-1 业务组件：构建基础列表展示</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-2-%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6%EF%BC%9A%E7%80%91%E5%B8%83%E6%B5%81%E7%BB%84%E4%BB%B6%E6%9E%84%E5%BB%BA%E5%88%86%E6%9E%90"><span class="nav-number">9.2.</span> <span class="nav-text">9-2 通用组件：瀑布流组件构建分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-3-%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6-%E7%80%91%E5%B8%83%E6%B5%81%EF%BC%9A%E6%9E%84%E5%BB%BA%E7%80%91%E5%B8%83%E6%B5%81%E5%B8%83%E5%B1%80%EF%BC%8C%E8%8E%B7%E5%8F%96%E5%AE%B9%E5%99%A8%E5%AE%BD%E5%BA%A6%E4%B8%8E%E5%88%97%E5%AE%BD"><span class="nav-number">9.3.</span> <span class="nav-text">9-3 通用组件-瀑布流：构建瀑布流布局，获取容器宽度与列宽</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-4-%E5%B8%83%E6%B5%81%EF%BC%9A%E5%8C%BA%E5%88%86%E5%9B%BE%E7%89%87%E9%A2%84%E5%8A%A0%E8%BD%BD%EF%BC%8C%E8%8E%B7%E5%8F%96%E5%85%83%E7%B4%A0%E5%85%B3%E9%94%AE%E5%B1%9E%E6%80%A7"><span class="nav-number">9.4.</span> <span class="nav-text">9-4 布流：区分图片预加载，获取元素关键属性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-5-%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6-%E7%80%91%E5%B8%83%E6%B5%81%EF%BC%9A%E8%A7%A6%E5%8F%91%E8%AE%A1%E7%AE%97%EF%BC%8C%E5%AE%9A%E4%BD%8Ditem%E4%BD%8D%E7%BD%AE"><span class="nav-number">9.5.</span> <span class="nav-text">9-5 通用组件-瀑布流：触发计算，定位item位置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-6-%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6-%E7%80%91%E5%B8%83%E6%B5%81%EF%BC%9A%E8%A7%A3%E5%86%B3%E7%80%91%E5%B8%83%E6%B5%81%E5%B1%95%E7%A4%BA%E4%B8%8D%E5%85%A8%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">9.6.</span> <span class="nav-text">9-6 通用组件-瀑布流：解决瀑布流展示不全的问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-7-%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6-%E7%80%91%E5%B8%83%E6%B5%81%EF%BC%9A%E9%80%82%E9%85%8D%E7%A7%BB%E5%8A%A8%E7%AB%AF%EF%BC%8C%E5%8A%A8%E6%80%81%E5%88%97"><span class="nav-number">9.7.</span> <span class="nav-text">9-7 通用组件-瀑布流：适配移动端，动态列</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-8-%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6-%E7%80%91%E5%B8%83%E6%B5%81%EF%BC%9A%E6%97%A0%E9%9C%80%E5%9B%BE%E7%89%87%E9%A2%84%E5%8A%A0%E8%BD%BD%E6%97%B6%EF%BC%8C%E4%BC%98%E5%8C%96%E5%8A%9F%E8%83%BD%E5%A4%84%E7%90%86"><span class="nav-number">9.8.</span> <span class="nav-text">9-8 通用组件-瀑布流：无需图片预加载时，优化功能处理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-9-%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6-%E7%80%91%E5%B8%83%E6%B5%81%EF%BC%9A%E6%80%BB%E7%BB%93"><span class="nav-number">9.9.</span> <span class="nav-text">9-9 通用组件-瀑布流：总结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-10-%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6%EF%BC%9A%E9%95%BF%E5%88%97%E8%A1%A8infinite%E6%9E%84%E5%BB%BA%E5%88%86%E6%9E%90"><span class="nav-number">9.10.</span> <span class="nav-text">9-10 通用组件：长列表infinite构建分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-11-%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6%EF%BC%9A%E6%9E%84%E5%BB%BA%E9%95%BF%E5%88%97%E8%A1%A8infinite%E7%BB%84%E4%BB%B6"><span class="nav-number">9.11.</span> <span class="nav-text">9-11 通用组件：构建长列表infinite组件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-12-%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6%EF%BC%9A%E5%BA%94%E7%94%A8-infinite-%E7%BB%93%E5%90%88-waterfall-%E5%AE%9E%E7%8E%B0%E9%95%BF%E5%88%97%E8%A1%A8%E7%80%91%E5%B8%83%E6%B5%81%E6%95%88%E6%9E%9C"><span class="nav-number">9.12.</span> <span class="nav-text">9-12 通用组件：应用 infinite 结合 waterfall 实现长列表瀑布流效果</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-13-%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6%EF%BC%9A%E8%A7%A3%E5%86%B3%E9%A6%96%E6%AC%A1%E6%95%B0%E6%8D%AE%E6%97%A0%E6%B3%95%E9%93%BA%E6%BB%A1%E5%85%A8%E5%B1%8F%E6%97%B6%EF%BC%8C%E6%95%B0%E6%8D%AE%E6%97%A0%E6%B3%95%E7%BB%A7%E7%BB%AD%E5%8A%A0%E8%BD%BD"><span class="nav-number">9.13.</span> <span class="nav-text">9-13 通用组件：解决首次数据无法铺满全屏时，数据无法继续加载</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-14-%E5%9B%BE%E7%89%87%E6%87%92%E5%8A%A0%E8%BD%BD%E6%9E%84%E5%BB%BA%E5%8E%9F%E5%9B%A0-%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="nav-number">9.14.</span> <span class="nav-text">9-14 图片懒加载构建原因+实现原理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-15-%E9%80%9A%E7%94%A8%E6%8C%87%E4%BB%A4%EF%BC%9A%E5%AE%9E%E7%8E%B0%E5%9B%BE%E7%89%87%E6%87%92%E5%8A%A0%E8%BD%BD"><span class="nav-number">9.15.</span> <span class="nav-text">9-15 通用指令：实现图片懒加载</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-16-%E6%B7%B1%E5%85%A5vite%EF%BC%9A%E6%8C%87%E4%BB%A4%E7%9A%84%E8%87%AA%E5%8A%A8%E6%B3%A8%E5%86%8C"><span class="nav-number">9.16.</span> <span class="nav-text">9-16 深入vite：指令的自动注册</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-17-%E6%8C%87%E5%AE%9A%E5%BD%A9%E8%89%B2%E5%8D%A0%E4%BD%8D%E5%9B%BE"><span class="nav-number">9.17.</span> <span class="nav-text">9-17 指定彩色占位图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-18-%E6%80%BB%E7%BB%93"><span class="nav-number">9.18.</span> <span class="nav-text">9-18 总结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#10%E3%80%81%E5%A4%9A%E7%BB%84%E4%BB%B6%E8%81%94%E5%8A%A8%E4%B8%8E%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6%E6%96%B9%E6%A1%88%E2%80%94%E2%80%94list%E8%81%94%E5%8A%A8search%E5%92%8CnavigationBar"><span class="nav-number">10.</span> <span class="nav-text">10、多组件联动与高阶组件方案——list联动search和navigationBar</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#10-1-%E5%89%8D%E8%A8%80"><span class="nav-number">10.1.</span> <span class="nav-text">10-1 前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-2-%E5%A4%9A%E7%BB%84%E4%BB%B6%E8%81%94%E5%8A%A8%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%E4%B8%8E%E6%95%B4%E4%BD%93%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90"><span class="nav-number">10.2.</span> <span class="nav-text">10-2 多组件联动注意事项与整体逻辑分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-3-%E7%AE%80%E5%8D%95%E8%81%94%E5%8A%A8%E5%A4%84%E7%90%86%EF%BC%9AnavigationBar%E5%AF%B9%E5%BA%94list"><span class="nav-number">10.3.</span> <span class="nav-text">10-3 简单联动处理：navigationBar对应list</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-4-%E6%98%8E%E7%A1%AEsearchBar%E5%AF%B9%E5%BA%94list%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B"><span class="nav-number">10.4.</span> <span class="nav-text">10-4 明确searchBar对应list处理流程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-5-searchBar%EF%BC%9A%E6%90%9C%E7%B4%A2%E6%8F%90%E7%A4%BA%E5%88%9D%E6%AD%A5%E5%AE%9E%E7%8E%B0"><span class="nav-number">10.5.</span> <span class="nav-text">10-5 searchBar：搜索提示初步实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-6-searchBar%EF%BC%9A%E5%A4%84%E7%90%86%E9%98%B2%E6%8A%96%E5%8A%9F%E8%83%BD"><span class="nav-number">10.6.</span> <span class="nav-text">10-6 searchBar：处理防抖功能</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-7-searchBar%EF%BC%9A%E6%8F%90%E7%A4%BA%E5%85%B3%E9%94%AE%E5%AD%97%E9%AB%98%E4%BA%AE%E5%A4%84%E7%90%86"><span class="nav-number">10.7.</span> <span class="nav-text">10-7 searchBar：提示关键字高亮处理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-8-searchBar%EF%BC%9A%E6%90%9C%E7%B4%A2%E5%8E%86%E5%8F%B2%E5%A4%84%E7%90%86"><span class="nav-number">10.8.</span> <span class="nav-text">10-8 searchBar：搜索历史处理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-9-%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6%EF%BC%9Aconfirm%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-number">10.9.</span> <span class="nav-text">10-9 通用组件：confirm应用场景</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-10-%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6%EF%BC%9Avnode-h%E5%87%BD%E6%95%B0-render%E5%87%BD%E6%95%B0-%E6%98%8E%E7%A1%AE-confirm-%E6%9E%84%E5%BB%BA%E6%80%9D%E8%B7%AF"><span class="nav-number">10.10.</span> <span class="nav-text">10-10 通用组件：vnode + h函数 + render函数 明确 confirm 构建思路</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-11-%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6%EF%BC%9A%E6%9E%84%E5%BB%BAconfirm%E7%BB%84%E4%BB%B6"><span class="nav-number">10.11.</span> <span class="nav-text">10-11 通用组件：构建confirm组件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-12-%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6%EF%BC%9A%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8confirm%E7%BB%84%E4%BB%B6"><span class="nav-number">10.12.</span> <span class="nav-text">10-12 通用组件：函数调用confirm组件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-13-searchBar%EF%BC%9A%E7%83%AD%E9%97%A8%E7%B2%BE%E9%80%89%E6%A8%A1%E5%9D%97%E6%9E%84%E5%BB%BA"><span class="nav-number">10.13.</span> <span class="nav-text">10-13 searchBar：热门精选模块构建</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-14-searchBar-%E8%81%94%E5%8A%A8-list"><span class="nav-number">10.14.</span> <span class="nav-text">10-14 searchBar 联动 list-</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-15-%E6%80%BB%E7%BB%93"><span class="nav-number">10.15.</span> <span class="nav-text">10-15 总结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#11-%E3%80%81%E5%89%8D%E5%8F%B0%E5%B8%B8%E8%A7%81%E5%8A%9F%E8%83%BD%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%EF%BC%9A%E4%B8%8B%E8%BD%BD-%E5%85%A8%E5%B1%8F-%E5%BC%95%E5%AF%BC"><span class="nav-number">11.</span> <span class="nav-text">11 、前台常见功能解决方案：下载+全屏+引导</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#11-1-%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-number">11.1.</span> <span class="nav-text">11-1 文件下载解决方案</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-2-%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6%EF%BC%9A%E6%96%B9%E6%B3%95%E8%A7%A6%E5%8F%91%E7%9A%84message%E6%9E%84%E5%BB%BA%E5%88%86%E6%9E%90"><span class="nav-number">11.2.</span> <span class="nav-text">11-2 通用组件：方法触发的message构建分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-3-%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6%EF%BC%9A%E6%9E%84%E5%BB%BAmessage%E7%BB%84%E4%BB%B6%E5%9F%BA%E6%9C%AC%E8%83%BD%E5%8A%9B"><span class="nav-number">11.3.</span> <span class="nav-text">11-3 通用组件：构建message组件基本能力</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-4-%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6%EF%BC%9A%E6%96%B9%E6%B3%95%E8%A7%A6%E5%8F%91-message-%E5%B1%95%E7%A4%BA"><span class="nav-number">11.4.</span> <span class="nav-text">11-4 通用组件：方法触发 message 展示</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-5-%E6%A8%A1%E5%9D%97%E5%85%A8%E5%B1%8F%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-number">11.5.</span> <span class="nav-text">11-5 模块全屏解决方案</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-6-%E6%9E%84%E5%BB%BAfloating%E5%9F%BA%E7%A1%80%E5%B8%83%E5%B1%80"><span class="nav-number">11.6.</span> <span class="nav-text">11-6 构建floating基础布局</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-7-%E6%A0%B7%E5%BC%8F%E4%BF%AE%E6%AD%A3%EF%BC%9A%E5%A4%84%E7%90%86%E9%9A%BE%E7%9C%8B%E7%9A%84scrollBar"><span class="nav-number">11.7.</span> <span class="nav-text">11-7 样式修正：处理难看的scrollBar</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-8-%E5%8A%9F%E8%83%BD%E5%BC%95%E5%AF%BC%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-number">11.8.</span> <span class="nav-text">11-8 功能引导解决方案</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-9-%E8%A7%A3%E5%86%B3%E5%8A%9F%E8%83%BD%E5%BC%95%E5%AF%BC%E5%9B%BE%E6%A0%87%E4%B8%8D%E6%98%BE%E7%A4%BA%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">11.9.</span> <span class="nav-text">11-9 解决功能引导图标不显示的问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-10-%E6%80%BB%E7%BB%93"><span class="nav-number">11.10.</span> <span class="nav-text">11-10 总结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#12%E3%80%81%E9%AB%98%E9%98%B6%E8%B7%AF%E7%94%B1%E8%BF%87%E6%B8%A1%E5%A4%84%E7%90%86%E6%96%B9%E6%A1%88-%E2%80%94%E2%80%94-%E6%B5%8F%E8%A7%88%E5%99%A8%E5%A0%86%E6%A0%88%E4%B8%BB%E5%8A%A8%E4%BB%8B%E5%85%A5"><span class="nav-number">12.</span> <span class="nav-text">12、高阶路由过渡处理方案 —— 浏览器堆栈主动介入</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#12-1-%E5%89%8D%E8%A8%80"><span class="nav-number">12.1.</span> <span class="nav-text">12-1 前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-2-VueRouter%E8%BF%87%E6%B8%A1%E5%8A%A8%E6%95%88%E5%8F%AF%E8%A1%8C%E6%80%A7%E5%88%86%E6%9E%90"><span class="nav-number">12.2.</span> <span class="nav-text">12-2 VueRouter过渡动效可行性分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-3-%E4%B8%BB%E5%8A%A8%E4%BB%8B%E5%85%A5%E6%B5%8F%E8%A7%88%E5%99%A8%E5%A0%86%E6%A0%88%E7%AE%A1%E7%90%86%EF%BC%8C%E5%88%86%E6%9E%90%E5%8F%AF%E8%A1%8C%E6%80%A7%E6%96%B9%E6%A1%88"><span class="nav-number">12.3.</span> <span class="nav-text">12-3 主动介入浏览器堆栈管理，分析可行性方案</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-4-%E4%B8%BB%E5%8A%A8%E4%BB%8B%E5%85%A5%E6%B5%8F%E8%A7%88%E5%99%A8%E5%A0%86%E6%A0%88%E7%AE%A1%E7%90%86"><span class="nav-number">12.4.</span> <span class="nav-text">12-4 主动介入浏览器堆栈管理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-5-%E5%9F%BA%E4%BA%8EGSAP%E5%AE%9E%E7%8E%B0%E9%AB%98%E9%98%B6%E8%B7%AF%E7%94%B1%E8%BF%87%E6%B8%A1%E5%8A%A8%E7%94%BB%E5%88%86%E6%9E%90"><span class="nav-number">12.5.</span> <span class="nav-text">12-5 基于GSAP实现高阶路由过渡动画分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-6-%E5%9F%BA%E4%BA%8EGSAP%E5%AE%9E%E7%8E%B0%E9%AB%98%E9%98%B6%E8%B7%AF%E7%94%B1%E8%BF%87%E6%B8%A1%E5%8A%A8%E7%94%BB%E5%A4%84%E7%90%86"><span class="nav-number">12.6.</span> <span class="nav-text">12-6 基于GSAP实现高阶路由过渡动画处理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-7-%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6%EF%BC%9Anavbar%E6%9E%84%E5%BB%BA%E6%96%B9%E6%A1%88%E5%88%86%E6%9E%90"><span class="nav-number">12.7.</span> <span class="nav-text">12-7 通用组件：navbar构建方案分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-8-%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6%EF%BC%9A%E6%9E%84%E5%BB%BAnavbar"><span class="nav-number">12.8.</span> <span class="nav-text">12-8 通用组件：构建navbar</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-9-%E5%9F%BA%E4%BA%8Enavbar%E5%A4%84%E7%90%86%E5%93%8D%E5%BA%94%E5%BC%8F%E7%9A%84pins%E9%A1%B5%E9%9D%A2"><span class="nav-number">12.9.</span> <span class="nav-text">12-9 基于navbar处理响应式的pins页面</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-10-%E5%A4%84%E7%90%86%E5%88%B7%E6%96%B0%E7%A9%BA%E7%99%BD%E9%97%AE%E9%A2%98"><span class="nav-number">12.10.</span> <span class="nav-text">12-10 处理刷新空白问题</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#13%E3%80%81%E4%BA%BA%E7%B1%BB%E8%A1%8C%E4%B8%BA%E9%AA%8C%E8%AF%81%E5%A4%84%E7%90%86%E6%96%B9%E6%A1%88-%E2%80%94%E2%80%94-%E8%84%B1%E7%A6%BBUI%E7%BB%84%E4%BB%B6%E5%BA%93%E5%AE%9E%E7%8E%B0%E7%99%BB%E5%BD%95%E3%80%81%E6%B3%A8%E5%86%8C-%E8%A1%A8%E5%8D%95%E6%A0%A1%E9%AA%8C"><span class="nav-number">13.</span> <span class="nav-text">13、人类行为验证处理方案 —— 脱离UI组件库实现登录、注册+表单校验</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#13-1-%E5%89%8D%E8%A8%80"><span class="nav-number">13.1.</span> <span class="nav-text">13-1 前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-2-%E6%9E%84%E5%BB%BA%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97%E5%9F%BA%E7%A1%80UI%E7%BB%93%E6%9E%84"><span class="nav-number">13.2.</span> <span class="nav-text">13-2 构建登录模块基础UI结构</span></a></li></ol></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="Search..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>



<script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.4/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.4/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.4/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.4/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.4/source/js/dark-light-toggle.js"></script>


    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.4/source/js/local-search.js"></script>



    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.4/source/js/code-copy.js"></script>



    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.4/source/js/lazyload.js"></script>


<div class="post-scripts pjax">
    
        <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.4/source/js/left-side-toggle.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.4/source/js/libs/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.4/source/js/toc.js"></script>
    
</div>


    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.4/source/js/libs/pjax.min.js"></script>
<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            KEEP.refresh();
        });
    });
</script>



</body>
</html>
