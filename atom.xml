<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Hexo</title>
  
  
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2023-03-26T05:07:45.061Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>John Doe</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>行测之资料分析</title>
    <link href="http://example.com/2023/03/24/%E8%A1%8C%E6%B5%8B%E4%B9%8B%E8%B5%84%E6%96%99%E5%88%86%E6%9E%90/"/>
    <id>http://example.com/2023/03/24/%E8%A1%8C%E6%B5%8B%E4%B9%8B%E8%B5%84%E6%96%99%E5%88%86%E6%9E%90/</id>
    <published>2023-03-24T08:14:27.000Z</published>
    <updated>2023-03-26T05:07:45.061Z</updated>
    
    <content type="html"><![CDATA[<h1 id="一、统计术语"><a href="#一、统计术语" class="headerlink" title="一、统计术语"></a>一、统计术语</h1><h2 id="1、基期量与现期量"><a href="#1、基期量与现期量" class="headerlink" title="1、基期量与现期量"></a>1、基期量与现期量</h2><p><strong>基期量</strong>：作为对比参照的具体数值</p><p><strong>现期量</strong>：相对于基期量的数值</p><p><strong>常用表达方式</strong>：与A相比，B······；B比A······(&#x3D;&#x3D;A为基期量，B为现期量&#x3D;&#x3D;)</p><h2 id="2、增长量与增长率"><a href="#2、增长量与增长率" class="headerlink" title="2、增长量与增长率"></a>2、增长量与增长率</h2><p><strong>增长量&#x3D;现期量-基期量&#x3D;基期量×增长率</strong></p><p><strong>增长率&#x3D;增幅&#x3D;增速&#x3D;增长速度&#x3D; &#x3D;&#x3D;增长量&#x2F;基期量&#x3D;&#x3D;</strong></p><h2 id="3、年均增长量与年均增长率"><a href="#3、年均增长量与年均增长率" class="headerlink" title="3、年均增长量与年均增长率"></a>3、年均增长量与年均增长率</h2><p><strong>年均增长量&#x3D;（现期量-基期量）&#x2F;间隔年份</strong></p><p><strong>现期量&#x3D;基期量×（1+年均增长率）^n^,其中n为相差周期数</strong></p><p>&#x3D;&#x3D;2017年产值比2016年增长了280%&#x3D;&#x3D; &#x3D; &#x3D;&#x3D;2017年产值比2016年增长了2.8倍&#x3D;&#x3D; &#x3D; &#x3D;&#x3D;2017年产值是2016年的3.8倍&#x3D;&#x3D;</p><h2 id="4、同比与环比"><a href="#4、同比与环比" class="headerlink" title="4、同比与环比"></a>4、同比与环比</h2><p><strong>同比</strong>：就是跟去年这个时候进行比较</p><p><strong>环比</strong>：就是跟上一个统计周期相比（日环比，周环比，月环比，年环比）</p><h2 id="5、百分数和百分点"><a href="#5、百分数和百分点" class="headerlink" title="5、百分数和百分点"></a>5、百分数和百分点</h2><p><strong>百分数</strong>：也叫百分率和百分比，数学中用%来表示</p><p><strong>百分点</strong>：指&#x3D;&#x3D;不同时期&#x3D;&#x3D;以百分数形式表示的相对指标的变化，比如同比增幅提高了8个百分点</p><h2 id="6、比重"><a href="#6、比重" class="headerlink" title="6、比重"></a>6、比重</h2><p><strong>比重</strong>：部分在整体中所占比例</p><h2 id="7、顺差与逆差"><a href="#7、顺差与逆差" class="headerlink" title="7、顺差与逆差"></a>7、顺差与逆差</h2><p><strong>顺差</strong>：在一个时期内，一个国家的出口商品额大于进口商品额</p><p><strong>逆差</strong>：在一个时期内，一个国家的出口商品额小于进口商品额</p><h2 id="8、GDP"><a href="#8、GDP" class="headerlink" title="8、GDP"></a>8、GDP</h2><p>GDP等价于增加值</p><h2 id="9、恩格尔系数与基尼系数"><a href="#9、恩格尔系数与基尼系数" class="headerlink" title="9、恩格尔系数与基尼系数"></a>9、恩格尔系数与基尼系数</h2><p><strong>恩格尔系数</strong>：食品支出占总消费的百分比，值越低则生活水平越好</p><p><strong>基尼系数</strong>：：用来衡量贫富差距的，值越小，贫富差距越小</p><h1 id="二、结构阅读法"><a href="#二、结构阅读法" class="headerlink" title="二、结构阅读法"></a>二、结构阅读法</h1><h2 id="1、文字型资料"><a href="#1、文字型资料" class="headerlink" title="1、文字型资料"></a>1、文字型资料</h2><p><strong>多段型</strong>：时间，关键词，结构（其中）</p><p><strong>孤立段</strong>：时间，关键词，标点（。；）</p><h2 id="2、表格型资料"><a href="#2、表格型资料" class="headerlink" title="2、表格型资料"></a>2、表格型资料</h2><p><strong>设置陷阱</strong>：时间，单位及表格标题中的限定性概念</p><h2 id="3、图形型资料"><a href="#3、图形型资料" class="headerlink" title="3、图形型资料"></a>3、图形型资料</h2><p><strong>主要注意</strong>：横纵坐标，图例，单位</p><h1 id="三、基础速算技巧"><a href="#三、基础速算技巧" class="headerlink" title="三、基础速算技巧"></a>三、基础速算技巧</h1><h2 id="1、计算类"><a href="#1、计算类" class="headerlink" title="1、计算类"></a>1、计算类</h2><h3 id="1、截位法"><a href="#1、截位法" class="headerlink" title="1、截位法"></a>1、截位法</h3><p><strong>判断原则</strong>：</p><ul><li>选项首位均不同，保留两位</li><li>选项首位有相同的，保留三位</li></ul><p><strong>一步除式</strong>：只估算分母即可&#x3D;&gt;12345&#x2F;1369&#x3D;&gt;12345&#x2F;1370</p><h3 id="2、公式法"><a href="#2、公式法" class="headerlink" title="2、公式法"></a>2、公式法</h3><p>A&#x2F;（1±r）≈A（1减加r）&#x3D;&#x3D;当r小于等于5%&#x3D;&#x3D;</p><h2 id="2、比较类"><a href="#2、比较类" class="headerlink" title="2、比较类"></a>2、比较类</h2><h3 id="1、直接观察法"><a href="#1、直接观察法" class="headerlink" title="1、直接观察法"></a>1、直接观察法</h3><p>当分数的分子和分母一大一小时，直接看分子，分子大的分数就大</p><h3 id="2、速度比较法"><a href="#2、速度比较法" class="headerlink" title="2、速度比较法"></a>2、速度比较法</h3><p>（1）横向比较法：看两个分数分子之间、分母之间的变化速度，谁变化速度快就看谁，分子变化快就看分子，分子大的分数就大；分母变化快就看分母，分母小的分数大</p><p>（2）纵向比较法：当分子大于分母时，可以近似看作直除；当分子小于分母时，比较分子和分母的倍数关系，倍数越大，分数越小</p><h2 id="3、估算法"><a href="#3、估算法" class="headerlink" title="3、估算法"></a>3、估算法</h2>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;一、统计术语&quot;&gt;&lt;a href=&quot;#一、统计术语&quot; class=&quot;headerlink&quot; title=&quot;一、统计术语&quot;&gt;&lt;/a&gt;一、统计术语&lt;/h1&gt;&lt;h2 id=&quot;1、基期量与现期量&quot;&gt;&lt;a href=&quot;#1、基期量与现期量&quot; class=&quot;headerlink</summary>
      
    
    
    
    
    <category term="行测n" scheme="http://example.com/tags/%E8%A1%8C%E6%B5%8Bn/"/>
    
  </entry>
  
  <entry>
    <title>公务员之行测</title>
    <link href="http://example.com/2022/11/09/%E5%85%AC%E5%8A%A1%E5%91%98%E4%B9%8B%E8%A1%8C%E6%B5%8B/"/>
    <id>http://example.com/2022/11/09/%E5%85%AC%E5%8A%A1%E5%91%98%E4%B9%8B%E8%A1%8C%E6%B5%8B/</id>
    <published>2022-11-09T08:01:20.000Z</published>
    <updated>2022-11-09T08:40:00.873Z</updated>
    
    <content type="html"><![CDATA[<p><img                       lazyload                     src="/images/loading.svg"                     data-src="/../../../../../../AppData/Roaming/Typora/typora-user-images/image-20221109160229260.png"                      alt="image-20221109160229260"                ></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;img  
                     lazyload
                     src=&quot;/images/loading.svg&quot;
                     data-src=&quot;/../../../../../../App</summary>
      
    
    
    
    
    <category term="公务员" scheme="http://example.com/tags/%E5%85%AC%E5%8A%A1%E5%91%98/"/>
    
  </entry>
  
  <entry>
    <title>Anylogic之项目</title>
    <link href="http://example.com/2022/10/13/Anylogic%E4%B9%8B%E9%A1%B9%E7%9B%AE/"/>
    <id>http://example.com/2022/10/13/Anylogic%E4%B9%8B%E9%A1%B9%E7%9B%AE/</id>
    <published>2022-10-13T09:26:05.000Z</published>
    <updated>2022-10-14T08:36:33.747Z</updated>
    
    <content type="html"><![CDATA[<h2 id="一、说明文档"><a href="#一、说明文档" class="headerlink" title="一、说明文档"></a>一、说明文档</h2><h3 id="第一个页面如下图所示："><a href="#第一个页面如下图所示：" class="headerlink" title="第一个页面如下图所示："></a>第一个页面如下图所示：</h3><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202210141020671.png"                      alt="image-20221014102050075"                ></p><p>第一个页面的主要功能从两个方面进行说明：</p><ul><li>前端往Anylogic端传参数</li><li>热力图显示与关闭</li></ul><p>可以看出分为四个模块：左上、左下、右上、右下。</p><ul><li>左上：往输入框中写入文本框提示的对应数值，然后点击后面相应按钮，就可以传到对应的端口。<ul><li>数据格式如上图所示：id:1,count:20;id代表哪个灾害，count代表数量</li></ul></li><li>左下：是进行台风、地震、火灾伤员人数设置的，同样在文本框中输入相应的数值，点击按钮就会传入对应的端口。<ul><li>数据格式就是随便输入数字</li></ul></li><li>右上：有两个功能：<ol><li>点击地图上任意一点，右下模块就会显示对应的经纬度及地区，且最开始显示的经纬度及地区是根据IP地址进行判断的。</li><li>点击打开热力图就会不断的从后端接收数据，并显示在地图上；点击关闭就会暂停对数据的接收并且不显示热力图。</li></ol></li><li>右下：根据右上模块点击地图获取的数据进行传输，点击对应按钮输入到对应端口。</li></ul><h3 id="第二个页面如下图所示："><a href="#第二个页面如下图所示：" class="headerlink" title="第二个页面如下图所示："></a>第二个页面如下图所示：</h3><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202210140935034.png"                      alt="image-20221014093502974"                ></p><p>第二页面的主要功能：</p><ul><li>就是进行数据统计，包括公共统计数据图和日常统计数据图。</li><li>当Anylogic端和该页面同时启动就会自动接收数据</li></ul><h3 id="第三个页面如下图所示："><a href="#第三个页面如下图所示：" class="headerlink" title="第三个页面如下图所示："></a>第三个页面如下图所示：</h3><p><strong>第三个页面下总体大规模页面：</strong></p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202210140936860.png"                      alt="image-20221014093636913"                ></p><p><strong>第三个页面下单项大规模页面：</strong></p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202210141031144.png"                      alt="image-20221014103110315"                ></p><p>第三页面的主要功能：</p><ul><li>就是进行数据统计，分为总体大规模和单项大规模数据图。<ul><li>其中单项大规模需要启动单个灾害例如火灾，地震或者台风，点击任意一个，单项大规模统计图才会统计数据</li></ul></li><li>当Anylogic端和该页面同时启动就会自动接收数据</li></ul><h3 id="第四个页面如下图所示："><a href="#第四个页面如下图所示：" class="headerlink" title="第四个页面如下图所示："></a>第四个页面如下图所示：</h3><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202210141040077.png"                      alt="image-20221014104045484"                ></p><p>第三页面的主要功能：</p><ul><li>从Anyogic接收小车运行数据，在此页面进行解析并移动</li><li>小蓝点代表小车，白色框是小车编号</li></ul><h2 id="二、代码"><a href="#二、代码" class="headerlink" title="二、代码"></a>二、代码</h2><h3 id="udp传输"><a href="#udp传输" class="headerlink" title="udp传输"></a>udp传输</h3><p>udp传输总体就两种代码：</p><ul><li>接收代码</li><li>发送代码</li></ul><p>接收代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> net.sf.json.JSONObject;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramPacket;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.net.SocketException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Servlet implementation class SelectBar1Servlet</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CartServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span>&#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@see</span> HttpServlet#HttpServlet()</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">CartServlet</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="built_in">super</span>();</span><br><span class="line">      <span class="comment">// TODO Auto-generated constructor stub</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@see</span> HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">      <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">      doPost(request, response);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@see</span> HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">      <span class="type">JSONObject</span> <span class="variable">json</span> <span class="operator">=</span><span class="keyword">new</span> <span class="title class_">JSONObject</span>();<span class="comment">//JSON格式的数据结构</span></span><br><span class="line">      <span class="comment">//json.put(&quot;result&quot;,&quot; success&quot;);</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> Receive();</span><br><span class="line">      System.out.println(str);</span><br><span class="line">      <span class="comment">//从其它对象转化成JSON对象</span></span><br><span class="line">      json = JSONObject.fromObject(str);</span><br><span class="line">      response.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">      response.setContentType(<span class="string">&quot;application/json;charset=utf-8&quot;</span>);</span><br><span class="line">      <span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">      out = response.getWriter();</span><br><span class="line">      <span class="comment">//out.write(json.toString());</span></span><br><span class="line">      System.out.println(json);</span><br><span class="line">      out.println(json);</span><br><span class="line">      out.flush();</span><br><span class="line">      out.close();</span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">Receive</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="comment">//它的唯一作用就是接收和发送数据报</span></span><br><span class="line">      <span class="type">DatagramSocket</span> <span class="variable">ds</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">         ds = <span class="keyword">new</span> <span class="title class_">DatagramSocket</span>(<span class="number">1456</span>);<span class="comment">//创建一个DatagramSocket能够在UDP端口1235接收广播。</span></span><br><span class="line">      &#125; <span class="keyword">catch</span> (SocketException e) &#123;</span><br><span class="line">         <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">         e.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">         <span class="comment">// 创建包对象</span></span><br><span class="line">         <span class="type">byte</span>[] bys = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">9000</span>];</span><br><span class="line">         <span class="comment">//这类表示一个数据报包,接收数据包长度 length DatagramPacket构建。</span></span><br><span class="line">         <span class="type">DatagramPacket</span> <span class="variable">dp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramPacket</span>(bys, bys.length);</span><br><span class="line"></span><br><span class="line">         <span class="comment">// 接收数据</span></span><br><span class="line">         <span class="keyword">try</span> &#123;</span><br><span class="line">            ds.receive(dp);</span><br><span class="line">         &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         <span class="comment">// 解析数据</span></span><br><span class="line">         <span class="type">InetAddress</span> <span class="variable">address</span> <span class="operator">=</span> dp.getAddress();<span class="comment">// 获取发送端的IP对象</span></span><br><span class="line">         <span class="type">byte</span>[] data = dp.getData();<span class="comment">// 获取接收到的数据</span></span><br><span class="line">         <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> dp.getLength();<span class="comment">// 获取具体收到数据的长度</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">         <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(data);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">         System.out.println(str);</span><br><span class="line">         ds.close();</span><br><span class="line">         <span class="keyword">return</span> str;</span><br><span class="line">         <span class="comment">// 释放资源</span></span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>发送代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramPacket;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Servlet implementation class SelectLine2Servlet</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">releaseDailyServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">   <span class="comment">// 以下为Socket服务器的IP和端口，根据实际情况修改</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SOCKET_IP</span> <span class="operator">=</span> <span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">UDP_PORT</span> <span class="operator">=</span> <span class="number">60012</span>; <span class="comment">// UDP传输专用端口</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">      <span class="built_in">this</span>.doPost(req, resp);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">      <span class="built_in">this</span>.getParam(req, resp);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">getParam</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">      <span class="type">StringBuffer</span> <span class="variable">stringBuffer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">      <span class="type">BufferedReader</span> <span class="variable">bufferedReader</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">      bufferedReader = req.getReader();</span><br><span class="line">      <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="literal">null</span> ;</span><br><span class="line">      <span class="keyword">while</span>((str=bufferedReader.readLine())!=<span class="literal">null</span>)&#123;</span><br><span class="line">         stringBuffer.append(str);</span><br><span class="line">      &#125;</span><br><span class="line">      str = stringBuffer.toString() ;</span><br><span class="line">      System.out.println(str);</span><br><span class="line">      startUdpClient(str);</span><br><span class="line">      <span class="keyword">return</span> str;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 启动UDP客户端发送文本消息</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">startUdpClient</span><span class="params">(String quake)</span> &#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;UDP客户端发送消息：&quot;</span> + quake);</span><br><span class="line">      <span class="comment">// 创建一个DatagramSocket对象</span></span><br><span class="line">      <span class="keyword">try</span> (<span class="type">DatagramSocket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramSocket</span>()) &#123;</span><br><span class="line">         <span class="comment">// 根据IP地址获得对应的网络地址对象</span></span><br><span class="line">         <span class="type">InetAddress</span> <span class="variable">serverAddress</span> <span class="operator">=</span> InetAddress.getByName(SOCKET_IP);</span><br><span class="line">         <span class="type">byte</span> data[] = quake.getBytes(); <span class="comment">// 把字符串转换为字节数组</span></span><br><span class="line">         <span class="comment">// 创建一个DatagramPacket对象，构造方法的四个参数依次为：</span></span><br><span class="line">         <span class="comment">// 待发送的数据、数据的长度、服务器的网络地址、服务器的端口号。</span></span><br><span class="line">         <span class="type">DatagramPacket</span> <span class="variable">packet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramPacket</span>(data, data.length, serverAddress, UDP_PORT);</span><br><span class="line">         socket.send(packet); <span class="comment">// 向服务器发送数据包</span></span><br><span class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">         e.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="第页面代码"><a href="#第页面代码" class="headerlink" title="第页面代码"></a>第页面代码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;assets/css/BigData.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;assets/css/index.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;assets/css/index01.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;assets/js/jquery.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://a.amap.com/jsapi_demos/static/demo-center/css/demo-center.css&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;assets/js/bstable/css/bootstrap.min.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;assets/js/bstable/css/bootstrap-table.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;assets/css/Security_operation.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;assets/js/artDialog/skins/default.css&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>上海项目<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.input-card</span> <span class="selector-class">.btn</span>&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin-right</span>: <span class="number">1.2rem</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>: <span class="number">9rem</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.input-card</span> <span class="selector-class">.btn</span><span class="selector-pseudo">:last-child</span>&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin-right</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.input</span>&#123;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            -web-kit-appearance:none;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            -moz-appearance: none;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="attribute">font-size</span>:<span class="number">1.4em</span>;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="attribute">height</span>:<span class="number">2.0em</span>;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="attribute">border-radius</span>:<span class="number">5px</span>;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="attribute">border</span>:<span class="number">1px</span> solid <span class="number">#c8cccf</span>;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="attribute">color</span>:<span class="number">#6a6f77</span>;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="attribute">outline</span>:<span class="number">0</span>;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;data_bodey&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;index_nav&quot;</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">style</span>=<span class="string">&quot;height: 30px; margin-bottom: 0px;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;l_left total_chose_fr nav_active&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;index.html&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: #dbe9f1&quot;</span>&gt;</span>实时监测<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;l_left total_chose_pl&quot;</span> &gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;index1.html&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: #dbe9f1&quot;</span>&gt;</span>统计分析二<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;r_right total_chose_pl&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;index3.html&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: #dbe9f1&quot;</span>&gt;</span>小车运行<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;r_right total_chose_pl&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;index2.html&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: #dbe9f1&quot;</span>&gt;</span>统计分析四<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;index_tabs&quot;</span> &gt;</span></span><br><span class="line">        <span class="comment">&lt;!--安防运作--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;inner&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height: 109%;&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--第一页左侧--&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;left_cage&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--第一页左上角--&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder01 cage_cl&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 1.5% !important; height: 55%;&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;input&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;抽调日常救护车&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;transferDaily&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 200px; margin-left: 5px&quot;</span>/&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-white btn-info btn-bold&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleTransferDaily()&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height: 40px;margin-left: 10px&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;ace-icon fa fa-floppy-o bigger-120 blue&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                            提交</span><br><span class="line">                        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;input&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;释放抽调日常救护车&quot;</span>  <span class="attr">v-model</span>=<span class="string">&quot;releaseDaily&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 200px; margin-left: 5px&quot;</span>/&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-white btn-info btn-bold&quot;</span>  @<span class="attr">click</span>=<span class="string">&quot;handleReleaseDaily()&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height: 40px;margin-left: 10px&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;ace-icon fa fa-floppy-o bigger-120 blue&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                            提交</span><br><span class="line">                        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;input&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;抽调备用救护车&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;transferSpare&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 200px; margin-left: 5px&quot;</span>/&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-white btn-info btn-bold&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleTransferSpare()&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height: 40px;margin-left: 10px&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;ace-icon fa fa-floppy-o bigger-120 blue&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                            提交</span><br><span class="line">                        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;input&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;释放抽调备用救护车&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;releaseSpare&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 200px; margin-left: 5px&quot;</span>/&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-white btn-info btn-bold&quot;</span>  @<span class="attr">click</span>=<span class="string">&quot;handleReleaseSpare()&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height: 40px;margin-left: 10px&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;ace-icon fa fa-floppy-o bigger-120 blue&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                            提交</span><br><span class="line">                        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--第一页左中--&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder01 cage_cl&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 1.5% !important; height: 40%;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder02 &quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;input&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;台风伤员人数设置&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;typhoon&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 200px; margin-left: 5px&quot;</span>/&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-white btn-info btn-bold&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleTyphoon()&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height: 40px;margin-left: 10px&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;ace-icon fa fa-floppy-o bigger-120 blue&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                                提交</span><br><span class="line">                            <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;input&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;地震伤员人数设置&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;quake&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 200px; margin-left: 5px&quot;</span>/&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-white btn-info btn-bold&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleQuake()&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height: 40px;margin-left: 10px&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;ace-icon fa fa-floppy-o bigger-120 blue&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                                提交</span><br><span class="line">                            <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;input&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;火灾伤员人数设置&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;fire&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 200px; margin-left: 5px&quot;</span>/&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-white btn-info btn-bold&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleFire()&quot;</span>  <span class="attr">style</span>=<span class="string">&quot;height: 40px;margin-left: 10px&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;ace-icon fa fa-floppy-o bigger-120 blue&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                                提交</span><br><span class="line">                            <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--第一页中间--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;center_cage&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--中上--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder01 cage_cl&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 3.5% !important; height: 74%; position: relative;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder02&quot;</span> <span class="attr">style</span>=<span class="string">&quot;position: relative; overflow: hidden;&quot;</span>&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!--上海地图--&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;map&quot;</span> <span class="attr">id</span>=<span class="string">&quot;map&quot;</span>  &gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;input-card&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin-bottom: 120px;margin-right: 1px&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;input-item&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span> <span class="attr">value</span>=<span class="string">&quot;打开热力图&quot;</span> <span class="attr">id</span>=<span class="string">&quot;start&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;openHeatmap()&quot;</span>/&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span> <span class="attr">value</span>=<span class="string">&quot;关闭热力图&quot;</span> <span class="attr">id</span>=<span class="string">&quot;pause&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;closeHeatmap()&quot;</span>/&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app1&quot;</span>&gt;</span></span><br><span class="line">                     <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder01 cage_cl&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 0.6% !important; height: 32.1%;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                            <span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;input&quot;</span> <span class="attr">name</span>=<span class="string">&quot;address&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span><span class="attr">id</span>=<span class="string">&quot;where&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;地区&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;district&quot;</span><span class="attr">style</span>=<span class="string">&quot;width: 200px; margin-left: 5px&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                            <span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;input&quot;</span> <span class="attr">ame</span>=<span class="string">&quot;longitude&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span><span class="attr">id</span>=<span class="string">&quot;lng&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;经度&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;lngs&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 200px; margin-left: 5px&quot;</span>/&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                            <span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;input&quot;</span> <span class="attr">name</span>=<span class="string">&quot;latitude&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span><span class="attr">id</span>=<span class="string">&quot;lat&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;纬度&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;lats&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 200px; margin-left: 5px&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">br</span>&gt;</span></span><br><span class="line">                                <span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-white btn-info btn-bold&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleLats()&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height: 40px;margin-left: 10px&quot;</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;ace-icon fa fa-floppy-o bigger-120 blue&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                                    <span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span>存入台风<span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                                <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-white btn-info btn-bold&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleLats1()&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height: 40px;margin-left: 10px&quot;</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;ace-icon fa fa-floppy-o bigger-120 blue&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                                    <span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span>存入地震<span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                                <span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-white btn-info btn-bold&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleLats2()&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height: 40px;margin-left: 10px&quot;</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;ace-icon fa fa-floppy-o bigger-120 blue&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                                    <span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span>存入火灾<span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;assets/js/bstable/js/bootstrap.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;assets/js/bstable/js/bootstrap-table.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;assets/js/jquery.pagination.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;assets/js/bstable/js/bootstrap-table-zh-CN.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;http://api.map.baidu.com/api?v=2.0&amp;ak=5ieMMexWmzB9jivTq6oCRX9j&amp;callback&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;http://api.map.baidu.com/library/Heatmap/2.0/src/Heatmap_min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--百度地图--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> is_empty =<span class="number">0</span></span></span><br><span class="line"><span class="language-javascript">    lng = <span class="number">121.484205</span>;</span></span><br><span class="line"><span class="language-javascript">    lat = <span class="number">31.242241</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> map = <span class="keyword">new</span> <span class="title class_">BMap</span>.<span class="title class_">Map</span>(<span class="string">&quot;map&quot;</span>);<span class="comment">//在指定的容器内创建地图实例</span></span></span><br><span class="line"><span class="language-javascript">    map.<span class="title function_">setDefaultCursor</span>(<span class="string">&quot;crosshair&quot;</span>);<span class="comment">//设置地图默认的鼠标指针样式</span></span></span><br><span class="line"><span class="language-javascript">    map.<span class="title function_">enableScrollWheelZoom</span>();<span class="comment">//启用滚轮放大缩小，默认禁用。</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> point =<span class="keyword">new</span> <span class="title class_">BMap</span>.<span class="title class_">Point</span>(lng,lat)</span></span><br><span class="line"><span class="language-javascript">    map.<span class="title function_">centerAndZoom</span>(point, <span class="number">15</span>);</span></span><br><span class="line"><span class="language-javascript">    map.<span class="title function_">addControl</span>(<span class="keyword">new</span> <span class="title class_">BMap</span>.<span class="title class_">NavigationControl</span>());</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> marker = <span class="keyword">new</span> <span class="title class_">BMap</span>.<span class="title class_">Marker</span>(point);        <span class="comment">// 创建标注</span></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">this</span>.<span class="property">map</span>.<span class="title function_">addOverlay</span>(marker);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    map.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="keyword">function</span>(<span class="params">e</span>)&#123;<span class="comment">//地图单击事件</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> geocoder = <span class="keyword">new</span> <span class="title class_">BMap</span>.<span class="title class_">Geocoder</span>();</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> point = <span class="keyword">new</span> <span class="title class_">BMap</span>.<span class="title class_">Point</span>(e.<span class="property">point</span>.<span class="property">lng</span>,e.<span class="property">point</span>.<span class="property">lat</span>);</span></span><br><span class="line"><span class="language-javascript">        geocoder.<span class="title function_">getLocation</span>(point,<span class="keyword">function</span>(<span class="params">geocoderResult,LocationOptions</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            map.<span class="title function_">clearOverlays</span>()</span></span><br><span class="line"><span class="language-javascript">            map.<span class="title function_">addControl</span>(<span class="keyword">new</span> <span class="title class_">BMap</span>.<span class="title class_">NavigationControl</span>());</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> marker = <span class="keyword">new</span> <span class="title class_">BMap</span>.<span class="title class_">Marker</span>(point);        <span class="comment">// 创建标注</span></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">map</span>.<span class="title function_">addOverlay</span>(marker);</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//定位成功</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> address = geocoderResult.<span class="property">address</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;where&quot;</span>).<span class="property">value</span> =address</span></span><br><span class="line"><span class="language-javascript">            layer.<span class="title function_">msg</span>(<span class="string">&#x27;定位成功&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// $(&#x27;#suggestId&#x27;).val(geocoderResult.address);</span></span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;lng&quot;</span>).<span class="property">value</span> = e.<span class="property">point</span>.<span class="property">lng</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;lat&quot;</span>).<span class="property">value</span> = e.<span class="property">point</span>.<span class="property">lat</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">iploac</span>(<span class="params">result</span>)&#123;<span class="comment">//根据IP设置地图中心</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> cityName = result.<span class="property">name</span>;</span></span><br><span class="line"><span class="language-javascript">        map.<span class="title function_">setCenter</span>(cityName);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">if</span>(is_empty ==<span class="number">0</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> myCity = <span class="keyword">new</span> <span class="title class_">BMap</span>.<span class="title class_">LocalCity</span>();</span></span><br><span class="line"><span class="language-javascript">        myCity.<span class="title function_">get</span>(iploac);</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">dingwei</span>()</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">dingwei</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> geolocation = <span class="keyword">new</span> <span class="title class_">BMap</span>.<span class="title class_">Geolocation</span>();</span></span><br><span class="line"><span class="language-javascript">        geolocation.<span class="title function_">getCurrentPosition</span>(<span class="keyword">function</span>(<span class="params">r</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="title function_">getStatus</span>() == <span class="variable constant_">BMAP_STATUS_SUCCESS</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> mk = <span class="keyword">new</span> <span class="title class_">BMap</span>.<span class="title class_">Marker</span>(r.<span class="property">point</span>);</span></span><br><span class="line"><span class="language-javascript">                map.<span class="title function_">addOverlay</span>(mk);</span></span><br><span class="line"><span class="language-javascript">                map.<span class="title function_">panTo</span>(r.<span class="property">point</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;lng&quot;</span>).<span class="property">value</span> = r.<span class="property">point</span>.<span class="property">lng</span>;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;lat&quot;</span>).<span class="property">value</span> = r.<span class="property">point</span>.<span class="property">lat</span>;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> city_name =r.<span class="property">address</span>.<span class="property">province</span> + r.<span class="property">address</span>.<span class="property">city</span>;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;where&quot;</span>).<span class="property">value</span> = city_name</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;获取失败&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">sear</span>(<span class="params">result</span>)&#123;<span class="comment">//地图搜索</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span>(result.<span class="property">length</span> ==<span class="number">0</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">dingwei</span>();</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> local = <span class="keyword">new</span> <span class="title class_">BMap</span>.<span class="title class_">LocalSearch</span>(map, &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">renderOptions</span>:&#123;<span class="attr">map</span>: map&#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">        local.<span class="title function_">search</span>(result);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> points =[];</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">var</span> s;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">if</span>(!<span class="title function_">isSupportCanvas</span>())&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">alert</span>(<span class="string">&#x27;热力图目前只支持有canvas支持的浏览器,您所使用的浏览器不能使用热力图功能~&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//详细的参数,可以查看heatmap.js的文档 https://github.com/pa7/heatmap.js/blob/master/README.md</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//参数说明如下:</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">/* visible 热力图是否显示,默认为true</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">       * opacity 热力的透明度,1-100</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">       * radius 势力图的每个点的半径大小</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">       * gradient  &#123;JSON&#125; 热力图的渐变区间 . gradient如下所示</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">       * &#123;</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">        .2:&#x27;rgb(0, 255, 255)&#x27;,</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">        .5:&#x27;rgb(0, 110, 255)&#x27;,</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">        .8:&#x27;rgb(100, 0, 255)&#x27;</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">      &#125;</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">      其中 key 表示插值的位置, 0~1.</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">          value 为颜色值.</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">       */</span></span></span><br><span class="line"><span class="language-javascript">    heatmapOverlay = <span class="keyword">new</span> <span class="title class_">BMapLib</span>.<span class="title class_">HeatmapOverlay</span>(&#123;<span class="string">&quot;radius&quot;</span>:<span class="number">10</span>&#125;);</span></span><br><span class="line"><span class="language-javascript">    map.<span class="title function_">addOverlay</span>(heatmapOverlay);</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//是否显示热力图</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">openHeatmap</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">         s1 = <span class="built_in">setInterval</span>(<span class="keyword">function</span> <span class="title function_">getHeat</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">async</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">url</span>: <span class="string">&quot;/ShangHai/HertServlet&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">type</span>: <span class="string">&#x27;post&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">dataType</span>: <span class="string">&#x27;json&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">result</span>) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(points)</span></span><br><span class="line"><span class="language-javascript">                    s= points.<span class="property">length</span>;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">if</span> (points.<span class="property">length</span>)&#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; s; i++) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                            <span class="keyword">if</span> ((result.<span class="property">lng</span> ===points[i].<span class="property">lng</span>)&amp;&amp;(result.<span class="property">lat</span> ===points[i].<span class="property">lat</span>))&#123;</span></span><br><span class="line"><span class="language-javascript">                                <span class="variable language_">console</span>.<span class="title function_">log</span>(i)</span></span><br><span class="line"><span class="language-javascript">                                points[i] = result;</span></span><br><span class="line"><span class="language-javascript">                                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;111&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">                                <span class="keyword">break</span>;</span></span><br><span class="line"><span class="language-javascript">                            &#125;<span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;222&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">                                <span class="keyword">if</span> (i+<span class="number">1</span> === s )&#123;</span></span><br><span class="line"><span class="language-javascript">                                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;333&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">                                    points.<span class="title function_">push</span>(result)</span></span><br><span class="line"><span class="language-javascript">                                &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                            &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                    &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="language-javascript">                        points.<span class="title function_">push</span>(result);</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                    heatmapOverlay.<span class="title function_">setDataSet</span>(&#123;<span class="attr">data</span>:points,<span class="attr">max</span>:<span class="number">10</span>&#125;);</span></span><br><span class="line"><span class="language-javascript">                    heatmapOverlay.<span class="title function_">show</span>();</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;)</span></span><br><span class="line"><span class="language-javascript">        &#125;,<span class="number">1000</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">closeHeatmap</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="built_in">clearInterval</span>(s1)</span></span><br><span class="line"><span class="language-javascript">        heatmapOverlay.<span class="title function_">hide</span>();</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">closeHeatmap</span>();</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">setGradient</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">/*格式如下所示:</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">     &#123;</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">         0:&#x27;rgb(102, 255, 0)&#x27;,</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">         .5:&#x27;rgb(255, 170, 0)&#x27;,</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">         1:&#x27;rgb(255, 0, 0)&#x27;</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">     &#125;*/</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> gradient = &#123;&#125;;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> colors = <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&quot;input[type=&#x27;color&#x27;]&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        colors = [].<span class="property">slice</span>.<span class="title function_">call</span>(colors,<span class="number">0</span>);</span></span><br><span class="line"><span class="language-javascript">        colors.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">ele</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            gradient[ele.<span class="title function_">getAttribute</span>(<span class="string">&quot;data-key&quot;</span>)] = ele.<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">        heatmapOverlay.<span class="title function_">setOptions</span>(&#123;<span class="string">&quot;gradient&quot;</span>:gradient&#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//判断浏览区是否支持canvas</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">isSupportCanvas</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> elem = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;canvas&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> !!(elem.<span class="property">getContext</span> &amp;&amp; elem.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>));</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 引入组件库 --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;assets/js/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;assets/js/axios-0.18.0.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> vue = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">data</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span>&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">typhoon</span>:<span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">quake</span>:<span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">fire</span>:<span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">transferDaily</span>:<span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">releaseDaily</span>:<span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">transferSpare</span>:<span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">releaseSpare</span>:<span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">methods</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">handleTyphoon</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">window</span>.<span class="property">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">typhoon</span>)</span></span><br><span class="line"><span class="language-javascript">                axios.<span class="title function_">post</span>(<span class="string">&quot;/ShangHai/typhoonServlet&quot;</span>,<span class="variable language_">this</span>.<span class="property">typhoon</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">info</span>(res);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                &#125;)</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">handleQuake</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">window</span>.<span class="property">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">quake</span>)</span></span><br><span class="line"><span class="language-javascript">                axios.<span class="title function_">post</span>(<span class="string">&quot;/ShangHai/quakeServlet&quot;</span>,<span class="variable language_">this</span>.<span class="property">quake</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">info</span>(res);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                &#125;)</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">handleFire</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">window</span>.<span class="property">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">fire</span>)</span></span><br><span class="line"><span class="language-javascript">                axios.<span class="title function_">post</span>(<span class="string">&quot;/ShangHai/fireServlet&quot;</span>,<span class="variable language_">this</span>.<span class="property">fire</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">info</span>(res);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                &#125;)</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">handleTransferDaily</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                axios.<span class="title function_">post</span>(<span class="string">&quot;/ShangHai/transferDailyServlet&quot;</span>,<span class="string">&quot;&#123;&quot;</span>+<span class="variable language_">this</span>.<span class="property">transferDaily</span>+<span class="string">&quot;&#125;&quot;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">info</span>(res);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                &#125;)</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">handleReleaseDaily</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                axios.<span class="title function_">post</span>(<span class="string">&quot;/ShangHai/releaseDailyServlet&quot;</span>,<span class="string">&quot;&#123;&quot;</span>+<span class="variable language_">this</span>.<span class="property">releaseDaily</span>+<span class="string">&quot;&#125;&quot;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">info</span>(res);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                &#125;)</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">handleTransferSpare</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                axios.<span class="title function_">post</span>(<span class="string">&quot;/ShangHai/transferSpareServlet&quot;</span>,<span class="string">&quot;&#123;&quot;</span>+<span class="variable language_">this</span>.<span class="property">transferSpare</span>+<span class="string">&quot;&#125;&quot;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">info</span>(res);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                &#125;)</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">handleReleaseSpare</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">             axios.<span class="title function_">post</span>(<span class="string">&quot;/ShangHai/releaseSpareServlet&quot;</span>,<span class="string">&quot;&#123;&quot;</span>+<span class="variable language_">this</span>.<span class="property">releaseSpare</span>+<span class="string">&quot;&#125;&quot;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">info</span>(res);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                &#125;)</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> vue = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">el</span>: <span class="string">&#x27;#app1&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">data</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span>&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">district</span>:<span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">lngs</span>:<span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">lats</span>:<span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">methods</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">handleLats</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">lats</span> = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;lat&quot;</span>).<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">district</span> = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;where&quot;</span>).<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">lngs</span> = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;lng&quot;</span>).<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                axios.<span class="title function_">post</span>(<span class="string">&quot;/ShangHai/districtServlet&quot;</span>,<span class="string">&quot;&#123;&quot;</span>+<span class="string">&quot;lat:&quot;</span>+<span class="variable language_">this</span>.<span class="property">lats</span>+<span class="string">&quot;,&quot;</span>+<span class="string">&quot;lng:&quot;</span>+<span class="variable language_">this</span>.<span class="property">lngs</span>+<span class="string">&quot;,&quot;</span>+<span class="string">&quot;district:&quot;</span>+<span class="variable language_">this</span>.<span class="property">district</span>+<span class="string">&quot;&#125;&quot;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">info</span>(res);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                &#125;)</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">handleLats1</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">lats</span> = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;lat&quot;</span>).<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">district</span> = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;where&quot;</span>).<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">lngs</span> = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;lng&quot;</span>).<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                axios.<span class="title function_">post</span>(<span class="string">&quot;/ShangHai/district1Servlet&quot;</span>,<span class="string">&quot;&#123;&quot;</span>+<span class="string">&quot;lat:&quot;</span>+<span class="variable language_">this</span>.<span class="property">lats</span>+<span class="string">&quot;,&quot;</span>+<span class="string">&quot;lng:&quot;</span>+<span class="variable language_">this</span>.<span class="property">lngs</span>+<span class="string">&quot;,&quot;</span>+<span class="string">&quot;district:&quot;</span>+<span class="variable language_">this</span>.<span class="property">district</span>+<span class="string">&quot;&#125;&quot;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">info</span>(res);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                &#125;)</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">handleLats2</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">lats</span> = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;lat&quot;</span>).<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">district</span> = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;where&quot;</span>).<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">lngs</span> = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;lng&quot;</span>).<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                axios.<span class="title function_">post</span>(<span class="string">&quot;/ShangHai/district2Servlet&quot;</span>,<span class="string">&quot;&#123;&quot;</span>+<span class="string">&quot;lat:&quot;</span>+<span class="variable language_">this</span>.<span class="property">lats</span>+<span class="string">&quot;,&quot;</span>+<span class="string">&quot;lng:&quot;</span>+<span class="variable language_">this</span>.<span class="property">lngs</span>+<span class="string">&quot;,&quot;</span>+<span class="string">&quot;district:&quot;</span>+<span class="variable language_">this</span>.<span class="property">district</span>+<span class="string">&quot;&#125;&quot;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">info</span>(res);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                &#125;)</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="第二页代码"><a href="#第二页代码" class="headerlink" title="第二页代码"></a>第二页代码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;assets/css/BigData.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;assets/css/index.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;assets/css/index01.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;assets/js/jquery.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;assets/js/echarts.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://a.amap.com/jsapi_demos/static/demo-center/css/demo-center.css&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;assets/js/bstable/css/bootstrap.min.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;assets/js/bstable/css/bootstrap-table.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;assets/css/Security_operation.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>上海项目<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">html</span>, <span class="selector-tag">body</span>, <span class="selector-id">#allmap</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">height</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.input-card</span> <span class="selector-class">.btn</span>&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin-right</span>: <span class="number">1.2rem</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>: <span class="number">9rem</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.input-card</span> <span class="selector-class">.btn</span><span class="selector-pseudo">:last-child</span>&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin-right</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.input</span>&#123;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            -web-kit-appearance:none;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            -moz-appearance: none;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="attribute">font-size</span>:<span class="number">1.4em</span>;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="attribute">height</span>:<span class="number">2.0em</span>;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="attribute">border-radius</span>:<span class="number">5px</span>;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="attribute">border</span>:<span class="number">1px</span> solid <span class="number">#c8cccf</span>;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="attribute">color</span>:<span class="number">#6a6f77</span>;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="attribute">outline</span>:<span class="number">0</span>;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;assets/js/axios-0.18.0.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;data_bodey&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;index_nav&quot;</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">style</span>=<span class="string">&quot;height: 30px; margin-bottom: 0px;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;l_left total_chose_fr &quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;index.html&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: #dbe9f1&quot;</span>&gt;</span>实时监测<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;l_left total_chose_pl nav_active&quot;</span> &gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;index1.html&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: #dbe9f1&quot;</span>&gt;</span>统计分析二<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;r_right total_chose_pl&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;index3.html&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: #dbe9f1&quot;</span>&gt;</span>小车运行<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;r_right total_chose_pl&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;index2.html&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: #dbe9f1&quot;</span>&gt;</span>统计分析四<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;inner&quot;</span>  &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;clear&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;data_left01&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAll maginS&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder01&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder02&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;data_tit1&quot;</span>&gt;</span>空闲床位比率<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;data_chart&quot;</span> <span class="attr">id</span>=<span class="string">&quot;buyTime&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAll&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder01&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder02&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;data_tit1&quot;</span>&gt;</span>日常繁忙、空闲比率<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;data_chart&quot;</span> <span class="attr">id</span>=<span class="string">&quot;Package01&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAll&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder01&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder02&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;data_tit1&quot;</span>&gt;</span>二甲、三甲医院占比<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;data_chart&quot;</span> <span class="attr">id</span>=<span class="string">&quot;rode01&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;data_left01&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAll maginS&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder01&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder02&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;data_tit1&quot;</span>&gt;</span>日常伤员生成数量<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;data_chart&quot;</span> <span class="attr">id</span>=<span class="string">&quot;bookAret&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAll&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder01&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder02&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;data_tit1&quot;</span>&gt;</span>日常伤员平均等待时间<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;data_chart&quot;</span> <span class="attr">id</span>=<span class="string">&quot;bookBmonth&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAll&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder01&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder02&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;data_tit1&quot;</span>&gt;</span>日常救护车利用率<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;data_chart&quot;</span> <span class="attr">id</span>=<span class="string">&quot;whearAbook&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;data_left01&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAll maginS&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder01&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder02&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;data_tit1&quot;</span>&gt;</span>日常驾车去医院比率<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;data_chart&quot;</span> <span class="attr">id</span>=<span class="string">&quot;seaAbook01&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAll&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder01&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder02&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;data_tit1&quot;</span>&gt;</span>日常伤员车上平均耗时<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;data_chart&quot;</span> <span class="attr">id</span>=<span class="string">&quot;actionBook&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAll&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder01&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder02&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;data_tit1&quot;</span>&gt;</span>日常车上最大值输出<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;data_chart&quot;</span> <span class="attr">id</span>=<span class="string">&quot;sperceBook01&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--1空闲床位比率--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> myLine = echarts.<span class="title function_">init</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;buyTime&#x27;</span>));</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> date = [];</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> datas = [];</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> now =<span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setInterval</span>(<span class="keyword">function</span> <span class="title function_">addData</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        myLine.<span class="title function_">hideLoading</span>(); <span class="comment">//隐藏加载动画</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            type : <span class="string">&quot;post&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">async</span> : <span class="literal">true</span>, <span class="comment">//异步请求（同步请求将会锁住浏览器，用户其他操作必须等待请求完成才可以执行）</span></span></span><br><span class="line"><span class="language-javascript">            url : <span class="string">&quot;/ShangHai/data1Servlet&quot;</span>, <span class="comment">//请求发送到Controller处，路径我上面写好了的，直接拼的，你自己按照你的写</span></span></span><br><span class="line"><span class="language-javascript">            data : &#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">            dataType : <span class="string">&quot;json&quot;</span>, <span class="comment">//返回数据形式为json</span></span></span><br><span class="line"><span class="language-javascript">            success : <span class="keyword">function</span>(<span class="params">result</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//请求成功时执行该函数内容，result即为服务器返回的json对象</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                now = now+result.<span class="property">num</span>;</span></span><br><span class="line"><span class="language-javascript">                date.<span class="title function_">push</span>(now);</span></span><br><span class="line"><span class="language-javascript">                datas.<span class="title function_">push</span>(result.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            error : <span class="keyword">function</span>(<span class="params">errorMsg</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                myLine.<span class="title function_">hideLoading</span>(); <span class="comment">//隐藏加载动画</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    &#125;,<span class="number">2000</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setInterval</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        myLine.<span class="title function_">setOption</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">color</span>:[<span class="string">&#x27;#7de494&#x27;</span>,<span class="string">&#x27;#7fd7b1&#x27;</span>, <span class="string">&#x27;#5578cf&#x27;</span>, <span class="string">&#x27;#5ebbeb&#x27;</span>, <span class="string">&#x27;#d16ad8&#x27;</span>,<span class="string">&#x27;#f8e19a&#x27;</span>,  <span class="string">&#x27;#00b7ee&#x27;</span>, <span class="string">&#x27;#81dabe&#x27;</span>,<span class="string">&#x27;#5fc5ce&#x27;</span>],</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">grid</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">left</span>:<span class="number">30</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">right</span>:<span class="number">40</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">top</span>:<span class="number">30</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">bottom</span>:<span class="number">20</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">containLabel</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">toolbox</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">feature</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">saveAsImage</span>: &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">xAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">type</span>: <span class="string">&#x27;category&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">boundaryGap</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.2)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">splitLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.1)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLabel</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">color</span>:<span class="string">&quot;rgba(255,255,255,.7)&quot;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">data</span>: date</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">yAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">type</span>: <span class="string">&#x27;value&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.2)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">splitLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.1)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLabel</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">color</span>:<span class="string">&quot;rgba(255,255,255,.7)&quot;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">series</span>: [</span></span><br><span class="line"><span class="language-javascript">                &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">name</span>:<span class="string">&#x27;2014年&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">type</span>:<span class="string">&#x27;line&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">stack</span>: <span class="string">&#x27;总量&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">areaStyle</span>: &#123;<span class="attr">normal</span>: &#123;&#125;&#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">data</span>:datas</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            ]</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;, <span class="number">1000</span>);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--2日常繁忙、空闲--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> myBar1 = echarts.<span class="title function_">init</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;Package01&#x27;</span>));</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">window</span>.<span class="built_in">setInterval</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            type : <span class="string">&quot;post&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">async</span> : <span class="literal">true</span>, <span class="comment">//异步请求（同步请求将会锁住浏览器，用户其他操作必须等待请求完成才可以执行）</span></span></span><br><span class="line"><span class="language-javascript">            url : <span class="string">&quot;/ShangHai/data2Servlet&quot;</span>, <span class="comment">//请求发送到Controller处，路径我上面写好了的，直接拼的，你自己按照你的写</span></span></span><br><span class="line"><span class="language-javascript">            data : &#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">            dataType : <span class="string">&quot;json&quot;</span>, <span class="comment">//返回数据形式为json</span></span></span><br><span class="line"><span class="language-javascript">            success : <span class="keyword">function</span>(<span class="params">result</span>) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//请求成功时执行该函数内容，result即为服务器返回的json对象</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                myBar1.<span class="title function_">hideLoading</span>(); <span class="comment">//隐藏加载动画</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                myBar1.<span class="title function_">setOption</span>(&#123; <span class="comment">//加载数据图表</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">color</span>: [<span class="string">&#x27;#3398DB&#x27;</span>],</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">tooltip</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">trigger</span>: <span class="string">&#x27;axis&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">axisPointer</span>: &#123;            <span class="comment">// 坐标轴指示器，坐标轴触发有效</span></span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">type</span>: <span class="string">&#x27;shadow&#x27;</span>        <span class="comment">// 默认为直线，可选为：&#x27;line&#x27; | &#x27;shadow&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                        &#125;</span></span><br><span class="line"><span class="language-javascript">                    &#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">grid</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">left</span>: <span class="string">&#x27;3%&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">right</span>: <span class="string">&#x27;4%&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">bottom</span>: <span class="string">&#x27;3%&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">containLabel</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">xAxis</span>: [</span></span><br><span class="line"><span class="language-javascript">                        &#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">type</span>: <span class="string">&#x27;category&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">data</span>: [<span class="string">&#x27;日常繁忙&#x27;</span>,<span class="string">&#x27;日常空闲&#x27;</span>],</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">axisTick</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                                <span class="attr">alignWithLabel</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">                            &#125;,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">axisLabel</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                                <span class="attr">color</span>:<span class="string">&quot;rgba(255,255,255,.7)&quot;</span></span></span><br><span class="line"><span class="language-javascript">                            &#125;,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">axisLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                                <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                                    <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.6)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                                &#125;</span></span><br><span class="line"><span class="language-javascript">                            &#125;,</span></span><br><span class="line"><span class="language-javascript">                        &#125;</span></span><br><span class="line"><span class="language-javascript">                    ],</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">yAxis</span>:[</span></span><br><span class="line"><span class="language-javascript">                        &#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">axisLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                                <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                                    <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.6)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                                &#125;</span></span><br><span class="line"><span class="language-javascript">                            &#125;,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">splitLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                                <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                                    <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,0.1)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                                &#125;</span></span><br><span class="line"><span class="language-javascript">                            &#125;,</span></span><br><span class="line"><span class="language-javascript">                            type : <span class="string">&#x27;value&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                    ],</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">series</span>: [</span></span><br><span class="line"><span class="language-javascript">                        &#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">name</span>: <span class="string">&#x27;直接访问&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">type</span>: <span class="string">&#x27;bar&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">barWidth</span>: <span class="string">&#x27;60%&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">data</span>:[result.<span class="property">busy</span>,result.<span class="property">idle</span>]</span></span><br><span class="line"><span class="language-javascript">                        &#125;</span></span><br><span class="line"><span class="language-javascript">                    ]</span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            error : <span class="keyword">function</span>(<span class="params">errorMsg</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                myBar1.<span class="title function_">hideLoading</span>();</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    &#125;,<span class="number">1000</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--3二甲、三甲医院占比--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    myBar2 = echarts.<span class="title function_">init</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;rode01&#x27;</span>));</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">window</span>.<span class="built_in">setInterval</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            type : <span class="string">&quot;post&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">async</span> : <span class="literal">true</span>, <span class="comment">//异步请求（同步请求将会锁住浏览器，用户其他操作必须等待请求完成才可以执行）</span></span></span><br><span class="line"><span class="language-javascript">            url : <span class="string">&quot;/ShangHai/data3Servlet&quot;</span>, <span class="comment">//请求发送到Controller处，路径我上面写好了的，直接拼的，你自己按照你的写</span></span></span><br><span class="line"><span class="language-javascript">            data : &#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">            dataType : <span class="string">&quot;json&quot;</span>, <span class="comment">//返回数据形式为json</span></span></span><br><span class="line"><span class="language-javascript">            success : <span class="keyword">function</span>(<span class="params">result</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(result);</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//请求成功时执行该函数内容，result即为服务器返回的json对象</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                myBar2.<span class="title function_">setOption</span>(&#123; <span class="comment">//加载数据图表</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">color</span>: [<span class="string">&#x27;#3398DB&#x27;</span>],</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">tooltip</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">trigger</span>: <span class="string">&#x27;axis&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">axisPointer</span>: &#123;            <span class="comment">// 坐标轴指示器，坐标轴触发有效</span></span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">type</span>: <span class="string">&#x27;shadow&#x27;</span>        <span class="comment">// 默认为直线，可选为：&#x27;line&#x27; | &#x27;shadow&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                        &#125;</span></span><br><span class="line"><span class="language-javascript">                    &#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">grid</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">left</span>: <span class="string">&#x27;3%&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">right</span>: <span class="string">&#x27;4%&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">bottom</span>: <span class="string">&#x27;3%&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">containLabel</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">xAxis</span>: [</span></span><br><span class="line"><span class="language-javascript">                        &#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">type</span>: <span class="string">&#x27;category&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">data</span>: [<span class="string">&#x27;二甲&#x27;</span>,<span class="string">&#x27;三甲&#x27;</span>],</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">axisTick</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                                <span class="attr">alignWithLabel</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">                            &#125;,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">axisLabel</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                                <span class="attr">color</span>:<span class="string">&quot;rgba(255,255,255,.7)&quot;</span></span></span><br><span class="line"><span class="language-javascript">                            &#125;,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">axisLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                                <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                                    <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.6)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                                &#125;</span></span><br><span class="line"><span class="language-javascript">                            &#125;,</span></span><br><span class="line"><span class="language-javascript">                        &#125;</span></span><br><span class="line"><span class="language-javascript">                    ],</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">yAxis</span>:[</span></span><br><span class="line"><span class="language-javascript">                        &#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">axisLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                                <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                                    <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.6)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                                &#125;</span></span><br><span class="line"><span class="language-javascript">                            &#125;,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">splitLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                                <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                                    <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,0.1)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                                &#125;</span></span><br><span class="line"><span class="language-javascript">                            &#125;,</span></span><br><span class="line"><span class="language-javascript">                            type : <span class="string">&#x27;value&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                    ],</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">series</span>: [</span></span><br><span class="line"><span class="language-javascript">                        &#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">name</span>: <span class="string">&#x27;直接访问&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">type</span>: <span class="string">&#x27;bar&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">barWidth</span>: <span class="string">&#x27;60%&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">data</span>:[result.<span class="property">two</span>,result.<span class="property">three</span>]</span></span><br><span class="line"><span class="language-javascript">                        &#125;</span></span><br><span class="line"><span class="language-javascript">                    ]</span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            error : <span class="keyword">function</span>(<span class="params">errorMsg</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    &#125;,<span class="number">1000</span>);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--5日常伤员平均等待时间--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> myLine5 = echarts.<span class="title function_">init</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;bookBmonth&#x27;</span>));</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> date5 = [];</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> datas5 = [];</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> now5 =<span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setInterval</span>(<span class="keyword">function</span> <span class="title function_">addData5</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        myLine5.<span class="title function_">hideLoading</span>(); <span class="comment">//隐藏加载动画</span></span></span><br><span class="line"><span class="language-javascript">        $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            type : <span class="string">&quot;post&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">async</span> : <span class="literal">true</span>, <span class="comment">//异步请求（同步请求将会锁住浏览器，用户其他操作必须等待请求完成才可以执行）</span></span></span><br><span class="line"><span class="language-javascript">            url : <span class="string">&quot;/ShangHai/data5Servlet&quot;</span>, <span class="comment">//请求发送到Controller处，路径我上面写好了的，直接拼的，你自己按照你的写</span></span></span><br><span class="line"><span class="language-javascript">            data : &#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">            dataType : <span class="string">&quot;json&quot;</span>, <span class="comment">//返回数据形式为json</span></span></span><br><span class="line"><span class="language-javascript">            success : <span class="keyword">function</span>(<span class="params">result</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//请求成功时执行该函数内容，result即为服务器返回的json对象</span></span></span><br><span class="line"><span class="language-javascript">                now5 = now5+result.<span class="property">num</span>;</span></span><br><span class="line"><span class="language-javascript">                date5.<span class="title function_">push</span>(now5);</span></span><br><span class="line"><span class="language-javascript">                datas5.<span class="title function_">push</span>(result.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            error : <span class="keyword">function</span>(<span class="params">errorMsg</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                myLine5.<span class="title function_">hideLoading</span>(); <span class="comment">//隐藏加载动画</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    &#125;,<span class="number">2000</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setInterval</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        myLine5.<span class="title function_">setOption</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">color</span>:[<span class="string">&#x27;#7de494&#x27;</span>,<span class="string">&#x27;#7fd7b1&#x27;</span>, <span class="string">&#x27;#5578cf&#x27;</span>, <span class="string">&#x27;#5ebbeb&#x27;</span>, <span class="string">&#x27;#d16ad8&#x27;</span>,<span class="string">&#x27;#f8e19a&#x27;</span>,  <span class="string">&#x27;#00b7ee&#x27;</span>, <span class="string">&#x27;#81dabe&#x27;</span>,<span class="string">&#x27;#5fc5ce&#x27;</span>],</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">grid</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">left</span>:<span class="number">30</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">right</span>:<span class="number">40</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">top</span>:<span class="number">30</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">bottom</span>:<span class="number">20</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">containLabel</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">toolbox</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">feature</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">saveAsImage</span>: &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">xAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">type</span>: <span class="string">&#x27;category&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">boundaryGap</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.2)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">splitLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.1)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLabel</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">color</span>:<span class="string">&quot;rgba(255,255,255,.7)&quot;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">data</span>: date5</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">yAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">type</span>: <span class="string">&#x27;value&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.2)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">splitLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.1)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLabel</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">color</span>:<span class="string">&quot;rgba(255,255,255,.7)&quot;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">series</span>: [</span></span><br><span class="line"><span class="language-javascript">                &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">name</span>:<span class="string">&#x27;2014年&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">type</span>:<span class="string">&#x27;line&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">stack</span>: <span class="string">&#x27;总量&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">areaStyle</span>: &#123;<span class="attr">normal</span>: &#123;&#125;&#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">data</span>:datas5</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            ]</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;, <span class="number">1000</span>);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--6日常救护车利用率--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> myLine6 = echarts.<span class="title function_">init</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;whearAbook&#x27;</span>));</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> date6 = [];</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> datas6 = [];</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> now6 =<span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setInterval</span>(<span class="keyword">function</span> <span class="title function_">addData6</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        myLine6.<span class="title function_">hideLoading</span>(); <span class="comment">//隐藏加载动画</span></span></span><br><span class="line"><span class="language-javascript">        $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            type : <span class="string">&quot;post&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">async</span> : <span class="literal">true</span>, <span class="comment">//异步请求（同步请求将会锁住浏览器，用户其他操作必须等待请求完成才可以执行）</span></span></span><br><span class="line"><span class="language-javascript">            url : <span class="string">&quot;/ShangHai/data6Servlet&quot;</span>, <span class="comment">//请求发送到Controller处，路径我上面写好了的，直接拼的，你自己按照你的写</span></span></span><br><span class="line"><span class="language-javascript">            data : &#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">            dataType : <span class="string">&quot;json&quot;</span>, <span class="comment">//返回数据形式为json</span></span></span><br><span class="line"><span class="language-javascript">            success : <span class="keyword">function</span>(<span class="params">result</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//请求成功时执行该函数内容，result即为服务器返回的json对象</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                now6 = now6+result.<span class="property">num</span>;</span></span><br><span class="line"><span class="language-javascript">                date6.<span class="title function_">push</span>(now6);</span></span><br><span class="line"><span class="language-javascript">                datas6.<span class="title function_">push</span>(result.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            error : <span class="keyword">function</span>(<span class="params">errorMsg</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                myLine6.<span class="title function_">hideLoading</span>(); <span class="comment">//隐藏加载动画</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    &#125;,<span class="number">2000</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setInterval</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        myLine6.<span class="title function_">setOption</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">color</span>:[<span class="string">&#x27;#7de494&#x27;</span>,<span class="string">&#x27;#7fd7b1&#x27;</span>, <span class="string">&#x27;#5578cf&#x27;</span>, <span class="string">&#x27;#5ebbeb&#x27;</span>, <span class="string">&#x27;#d16ad8&#x27;</span>,<span class="string">&#x27;#f8e19a&#x27;</span>,  <span class="string">&#x27;#00b7ee&#x27;</span>, <span class="string">&#x27;#81dabe&#x27;</span>,<span class="string">&#x27;#5fc5ce&#x27;</span>],</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">grid</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">left</span>:<span class="number">30</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">right</span>:<span class="number">40</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">top</span>:<span class="number">30</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">bottom</span>:<span class="number">20</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">containLabel</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">toolbox</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">feature</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">saveAsImage</span>: &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">xAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">type</span>: <span class="string">&#x27;category&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">boundaryGap</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.2)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">splitLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.1)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLabel</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">color</span>:<span class="string">&quot;rgba(255,255,255,.7)&quot;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">data</span>: date6</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">yAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">type</span>: <span class="string">&#x27;value&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.2)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">splitLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.1)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLabel</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">color</span>:<span class="string">&quot;rgba(255,255,255,.7)&quot;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">series</span>: [</span></span><br><span class="line"><span class="language-javascript">                &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">name</span>:<span class="string">&#x27;2014年&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">type</span>:<span class="string">&#x27;line&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">stack</span>: <span class="string">&#x27;总量&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">areaStyle</span>: &#123;<span class="attr">normal</span>: &#123;&#125;&#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">data</span>:datas6</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            ]</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;, <span class="number">1000</span>);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--7日常驾车去医院比率--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> myLine7 = echarts.<span class="title function_">init</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;seaAbook01&#x27;</span>));</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> date7 = [];</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> datas7 = [];</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> now7 =<span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setInterval</span>(<span class="keyword">function</span> <span class="title function_">addData7</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        myLine7.<span class="title function_">hideLoading</span>(); <span class="comment">//隐藏加载动画</span></span></span><br><span class="line"><span class="language-javascript">        $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            type : <span class="string">&quot;post&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">async</span> : <span class="literal">true</span>, <span class="comment">//异步请求（同步请求将会锁住浏览器，用户其他操作必须等待请求完成才可以执行）</span></span></span><br><span class="line"><span class="language-javascript">            url : <span class="string">&quot;/ShangHai/data7Servlet&quot;</span>, <span class="comment">//请求发送到Controller处，路径我上面写好了的，直接拼的，你自己按照你的写</span></span></span><br><span class="line"><span class="language-javascript">            data : &#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">            dataType : <span class="string">&quot;json&quot;</span>, <span class="comment">//返回数据形式为json</span></span></span><br><span class="line"><span class="language-javascript">            success : <span class="keyword">function</span>(<span class="params">result</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//请求成功时执行该函数内容，result即为服务器返回的json对象</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                now7 = now7+result.<span class="property">num</span>;</span></span><br><span class="line"><span class="language-javascript">                date7.<span class="title function_">push</span>(now7);</span></span><br><span class="line"><span class="language-javascript">                datas7.<span class="title function_">push</span>(result.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            error : <span class="keyword">function</span>(<span class="params">errorMsg</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                myLine7.<span class="title function_">hideLoading</span>(); <span class="comment">//隐藏加载动画</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    &#125;,<span class="number">2000</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setInterval</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        myLine7.<span class="title function_">setOption</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">color</span>:[<span class="string">&#x27;#7de494&#x27;</span>,<span class="string">&#x27;#7fd7b1&#x27;</span>, <span class="string">&#x27;#5578cf&#x27;</span>, <span class="string">&#x27;#5ebbeb&#x27;</span>, <span class="string">&#x27;#d16ad8&#x27;</span>,<span class="string">&#x27;#f8e19a&#x27;</span>,  <span class="string">&#x27;#00b7ee&#x27;</span>, <span class="string">&#x27;#81dabe&#x27;</span>,<span class="string">&#x27;#5fc5ce&#x27;</span>],</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">grid</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">left</span>:<span class="number">30</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">right</span>:<span class="number">40</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">top</span>:<span class="number">30</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">bottom</span>:<span class="number">20</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">containLabel</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">toolbox</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">feature</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">saveAsImage</span>: &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">xAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">type</span>: <span class="string">&#x27;category&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">boundaryGap</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.2)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">splitLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.1)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLabel</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">color</span>:<span class="string">&quot;rgba(255,255,255,.7)&quot;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">data</span>: date7</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">yAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">type</span>: <span class="string">&#x27;value&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.2)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">splitLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.1)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLabel</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">color</span>:<span class="string">&quot;rgba(255,255,255,.7)&quot;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">series</span>: [</span></span><br><span class="line"><span class="language-javascript">                &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">name</span>:<span class="string">&#x27;2014年&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">type</span>:<span class="string">&#x27;line&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">stack</span>: <span class="string">&#x27;总量&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">areaStyle</span>: &#123;<span class="attr">normal</span>: &#123;&#125;&#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">data</span>:datas7</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            ]</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;, <span class="number">1000</span>);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--8日常伤员车上平均耗时--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> myLine8 = echarts.<span class="title function_">init</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;actionBook&#x27;</span>));</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> date8 = [];</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> datas8 = [];</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> now8 =<span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setInterval</span>(<span class="keyword">function</span> <span class="title function_">addData8</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        myLine8.<span class="title function_">hideLoading</span>(); <span class="comment">//隐藏加载动画</span></span></span><br><span class="line"><span class="language-javascript">        $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            type : <span class="string">&quot;post&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">async</span> : <span class="literal">true</span>, <span class="comment">//异步请求（同步请求将会锁住浏览器，用户其他操作必须等待请求完成才可以执行）</span></span></span><br><span class="line"><span class="language-javascript">            url : <span class="string">&quot;/ShangHai/data8Servlet&quot;</span>, <span class="comment">//请求发送到Controller处，路径我上面写好了的，直接拼的，你自己按照你的写</span></span></span><br><span class="line"><span class="language-javascript">            data : &#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">            dataType : <span class="string">&quot;json&quot;</span>, <span class="comment">//返回数据形式为json</span></span></span><br><span class="line"><span class="language-javascript">            success : <span class="keyword">function</span>(<span class="params">result</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//请求成功时执行该函数内容，result即为服务器返回的json对象</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                now8 = now8+result.<span class="property">num</span>;</span></span><br><span class="line"><span class="language-javascript">                date8.<span class="title function_">push</span>(now8);</span></span><br><span class="line"><span class="language-javascript">                datas8.<span class="title function_">push</span>(result.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            error : <span class="keyword">function</span>(<span class="params">errorMsg</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                myLine8.<span class="title function_">hideLoading</span>(); <span class="comment">//隐藏加载动画</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    &#125;,<span class="number">2000</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setInterval</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        myLine8.<span class="title function_">setOption</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">color</span>:[<span class="string">&#x27;#7de494&#x27;</span>,<span class="string">&#x27;#7fd7b1&#x27;</span>, <span class="string">&#x27;#5578cf&#x27;</span>, <span class="string">&#x27;#5ebbeb&#x27;</span>, <span class="string">&#x27;#d16ad8&#x27;</span>,<span class="string">&#x27;#f8e19a&#x27;</span>,  <span class="string">&#x27;#00b7ee&#x27;</span>, <span class="string">&#x27;#81dabe&#x27;</span>,<span class="string">&#x27;#5fc5ce&#x27;</span>],</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">grid</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">left</span>:<span class="number">30</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">right</span>:<span class="number">40</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">top</span>:<span class="number">30</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">bottom</span>:<span class="number">20</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">containLabel</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">toolbox</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">feature</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">saveAsImage</span>: &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">xAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">type</span>: <span class="string">&#x27;category&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">boundaryGap</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.2)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">splitLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.1)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLabel</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">color</span>:<span class="string">&quot;rgba(255,255,255,.7)&quot;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">data</span>: date8</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">yAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">type</span>: <span class="string">&#x27;value&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.2)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">splitLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.1)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLabel</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">color</span>:<span class="string">&quot;rgba(255,255,255,.7)&quot;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">series</span>: [</span></span><br><span class="line"><span class="language-javascript">                &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">name</span>:<span class="string">&#x27;2014年&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">type</span>:<span class="string">&#x27;line&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">stack</span>: <span class="string">&#x27;总量&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">areaStyle</span>: &#123;<span class="attr">normal</span>: &#123;&#125;&#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">data</span>:datas8</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            ]</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;, <span class="number">1000</span>);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--9日常车上最大值输出--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> myLine9 = echarts.<span class="title function_">init</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;sperceBook01&#x27;</span>));</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> date9 = [];</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> datas9 = [];</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> now9 =<span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setInterval</span>(<span class="keyword">function</span> <span class="title function_">addData9</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        myLine9.<span class="title function_">hideLoading</span>(); <span class="comment">//隐藏加载动画</span></span></span><br><span class="line"><span class="language-javascript">        $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            type : <span class="string">&quot;post&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">async</span> : <span class="literal">true</span>, <span class="comment">//异步请求（同步请求将会锁住浏览器，用户其他操作必须等待请求完成才可以执行）</span></span></span><br><span class="line"><span class="language-javascript">            url : <span class="string">&quot;/ShangHai/data9Servlet&quot;</span>, <span class="comment">//请求发送到Controller处，路径我上面写好了的，直接拼的，你自己按照你的写</span></span></span><br><span class="line"><span class="language-javascript">            data : &#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">            dataType : <span class="string">&quot;json&quot;</span>, <span class="comment">//返回数据形式为json</span></span></span><br><span class="line"><span class="language-javascript">            success : <span class="keyword">function</span>(<span class="params">result</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//请求成功时执行该函数内容，result即为服务器返回的json对象</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                now9 = now9+result.<span class="property">num</span>;</span></span><br><span class="line"><span class="language-javascript">                date9.<span class="title function_">push</span>(now9);</span></span><br><span class="line"><span class="language-javascript">                datas9.<span class="title function_">push</span>(result.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            error : <span class="keyword">function</span>(<span class="params">errorMsg</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                myLine9.<span class="title function_">hideLoading</span>(); <span class="comment">//隐藏加载动画</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    &#125;,<span class="number">2000</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setInterval</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        myLine9.<span class="title function_">setOption</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">color</span>:[<span class="string">&#x27;#7de494&#x27;</span>,<span class="string">&#x27;#7fd7b1&#x27;</span>, <span class="string">&#x27;#5578cf&#x27;</span>, <span class="string">&#x27;#5ebbeb&#x27;</span>, <span class="string">&#x27;#d16ad8&#x27;</span>,<span class="string">&#x27;#f8e19a&#x27;</span>,  <span class="string">&#x27;#00b7ee&#x27;</span>, <span class="string">&#x27;#81dabe&#x27;</span>,<span class="string">&#x27;#5fc5ce&#x27;</span>],</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">grid</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">left</span>:<span class="number">30</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">right</span>:<span class="number">40</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">top</span>:<span class="number">30</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">bottom</span>:<span class="number">20</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">containLabel</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">toolbox</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">feature</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">saveAsImage</span>: &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">xAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">type</span>: <span class="string">&#x27;category&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">boundaryGap</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.2)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">splitLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.1)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLabel</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">color</span>:<span class="string">&quot;rgba(255,255,255,.7)&quot;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">data</span>: date9</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">yAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">type</span>: <span class="string">&#x27;value&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.2)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">splitLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.1)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLabel</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">color</span>:<span class="string">&quot;rgba(255,255,255,.7)&quot;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">series</span>: [</span></span><br><span class="line"><span class="language-javascript">                &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">name</span>:<span class="string">&#x27;2014年&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">type</span>:<span class="string">&#x27;line&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">stack</span>: <span class="string">&#x27;总量&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">areaStyle</span>: &#123;<span class="attr">normal</span>: &#123;&#125;&#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">data</span>:datas9</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            ]</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;, <span class="number">1000</span>);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--4日常伤员生成数量--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> myLine4 = echarts.<span class="title function_">init</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;bookAret&#x27;</span>));</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> date4 = [];</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> datas4 = [];</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> now4 =<span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setInterval</span>(<span class="keyword">function</span> <span class="title function_">addData4</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        myLine4.<span class="title function_">hideLoading</span>(); <span class="comment">//隐藏加载动画</span></span></span><br><span class="line"><span class="language-javascript">        $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            type : <span class="string">&quot;post&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">async</span> : <span class="literal">true</span>, <span class="comment">//异步请求（同步请求将会锁住浏览器，用户其他操作必须等待请求完成才可以执行）</span></span></span><br><span class="line"><span class="language-javascript">            url : <span class="string">&quot;/ShangHai/data4Servlet&quot;</span>, <span class="comment">//请求发送到Controller处，路径我上面写好了的，直接拼的，你自己按照你的写</span></span></span><br><span class="line"><span class="language-javascript">            data : &#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">            dataType : <span class="string">&quot;json&quot;</span>, <span class="comment">//返回数据形式为json</span></span></span><br><span class="line"><span class="language-javascript">            success : <span class="keyword">function</span>(<span class="params">result</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//请求成功时执行该函数内容，result即为服务器返回的json对象</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                now4 = now4+result.<span class="property">num</span>;</span></span><br><span class="line"><span class="language-javascript">                date4.<span class="title function_">push</span>(now4);</span></span><br><span class="line"><span class="language-javascript">                datas4.<span class="title function_">push</span>(result.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            error : <span class="keyword">function</span>(<span class="params">errorMsg</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                myLine4.<span class="title function_">hideLoading</span>(); <span class="comment">//隐藏加载动画</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    &#125;,<span class="number">2000</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setInterval</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        myLine4.<span class="title function_">setOption</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">color</span>:[<span class="string">&#x27;#7de494&#x27;</span>,<span class="string">&#x27;#7fd7b1&#x27;</span>, <span class="string">&#x27;#5578cf&#x27;</span>, <span class="string">&#x27;#5ebbeb&#x27;</span>, <span class="string">&#x27;#d16ad8&#x27;</span>,<span class="string">&#x27;#f8e19a&#x27;</span>,  <span class="string">&#x27;#00b7ee&#x27;</span>, <span class="string">&#x27;#81dabe&#x27;</span>,<span class="string">&#x27;#5fc5ce&#x27;</span>],</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">grid</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">left</span>:<span class="number">30</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">right</span>:<span class="number">40</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">top</span>:<span class="number">30</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">bottom</span>:<span class="number">20</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">containLabel</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">toolbox</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">feature</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">saveAsImage</span>: &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">xAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">type</span>: <span class="string">&#x27;category&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">boundaryGap</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.2)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">splitLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.1)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLabel</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">color</span>:<span class="string">&quot;rgba(255,255,255,.7)&quot;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">data</span>: date4</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">yAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">type</span>: <span class="string">&#x27;value&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.2)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">splitLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.1)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLabel</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">color</span>:<span class="string">&quot;rgba(255,255,255,.7)&quot;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">series</span>: [</span></span><br><span class="line"><span class="language-javascript">                &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">name</span>:<span class="string">&#x27;2014年&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">type</span>:<span class="string">&#x27;line&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">stack</span>: <span class="string">&#x27;总量&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">areaStyle</span>: &#123;<span class="attr">normal</span>: &#123;&#125;&#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">data</span>:datas4</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            ]</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;, <span class="number">1000</span>);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="第三页代码"><a href="#第三页代码" class="headerlink" title="第三页代码"></a>第三页代码</h3><p>第三页第一个：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;assets/css/BigData.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;assets/css/index.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;assets/css/index01.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;assets/js/jquery.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;assets/js/echarts.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://a.amap.com/jsapi_demos/static/demo-center/css/demo-center.css&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;assets/js/bstable/css/bootstrap.min.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;assets/js/bstable/css/bootstrap-table.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;assets/css/Security_operation.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>上海项目<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">html</span>, <span class="selector-tag">body</span>, <span class="selector-id">#allmap</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">height</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.input-card</span> <span class="selector-class">.btn</span>&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin-right</span>: <span class="number">1.2rem</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>: <span class="number">9rem</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.input-card</span> <span class="selector-class">.btn</span><span class="selector-pseudo">:last-child</span>&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin-right</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.input</span>&#123;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            -web-kit-appearance:none;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            -moz-appearance: none;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="attribute">font-size</span>:<span class="number">1.4em</span>;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="attribute">height</span>:<span class="number">2.0em</span>;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="attribute">border-radius</span>:<span class="number">5px</span>;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="attribute">border</span>:<span class="number">1px</span> solid <span class="number">#c8cccf</span>;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="attribute">color</span>:<span class="number">#6a6f77</span>;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="attribute">outline</span>:<span class="number">0</span>;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;data_bodey&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;index_nav&quot;</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">style</span>=<span class="string">&quot;height: 30px; margin-bottom: 0px;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;l_left total_chose_fr&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;index.html&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: #dbe9f1&quot;</span>&gt;</span>实时监测<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;l_left total_chose_pl&quot;</span> &gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;index1.html&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: #dbe9f1&quot;</span>&gt;</span>统计分析二<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;r_right total_chose_pl&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;index3.html&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: #dbe9f1&quot;</span>&gt;</span>小车运行<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;r_right total_chose_pl nav_active&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;index2.html&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: #dbe9f1&quot;</span>&gt;</span>统计分析四<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;index_tabs&quot;</span> &gt;</span></span><br><span class="line"><span class="comment">&lt;!--四--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;inner&quot;</span> &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;shuju_nav&quot;</span> &gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ul</span> <span class="attr">style</span>=<span class="string">&quot;height: 30px; margin-bottom: 0px;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;l_left total_chose_fr nav_active1&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;index2.html&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: #dbe9f1&quot;</span>&gt;</span>总体大规模<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;l_left total_chose_pl&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;index2_1.html&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: #dbe9f1&quot;</span>&gt;</span>单项大规模<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;index1_tabs&quot;</span> &gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;inner1&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;clear&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;data_left06&quot;</span> &gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAll04 &quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder01&quot;</span><span class="attr">style</span>=<span class="string">&quot;margin-top: 0%&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder02&quot;</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;data_tit1&quot;</span>&gt;</span>总体伤员平均等待时间<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;data_chart&quot;</span> <span class="attr">id</span>=<span class="string">&quot;s1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAll04&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder01&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 0%&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder02&quot;</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;data_tit1&quot;</span>&gt;</span>伤员生成数量<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;data_chart&quot;</span> <span class="attr">id</span>=<span class="string">&quot;s2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAll04&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder01&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 0%&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder02&quot;</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;data_tit1&quot;</span>&gt;</span>台风伤员平均等待时间<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;data_chart&quot;</span> <span class="attr">id</span>=<span class="string">&quot;s3&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;data_left06&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAll04 &quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder01&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 0%;height: 150%;width:115%&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder02&quot;</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;data_tit1&quot;</span>&gt;</span>地震伤员平均等待时间<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;data_chart&quot;</span> <span class="attr">id</span>=<span class="string">&quot;s4&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAll04&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder01&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 100px;height: 150%;width:115%&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder02&quot;</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;data_tit1&quot;</span>&gt;</span>火灾伤员平均等待时间<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;data_chart&quot;</span> <span class="attr">id</span>=<span class="string">&quot;s5&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;data_left06&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAll04&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder03&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 0%;margin-left: 40px&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder02&quot;</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;data_tit1&quot;</span>&gt;</span>日常伤员生成地统计<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;data_chart&quot;</span> <span class="attr">id</span>=<span class="string">&quot;s6&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAll04&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder03&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 100px;margin-left: 40px&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder02&quot;</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;data_tit1&quot;</span>&gt;</span>各区等待时长<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;data_chart&quot;</span> <span class="attr">id</span>=<span class="string">&quot;s7&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--1总体伤员平均等待时间--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> myLine10 = echarts.<span class="title function_">init</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;s1&#x27;</span>));</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> date10 = [];</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> datas10 = [];</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> now10 =<span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setInterval</span>(<span class="keyword">function</span> <span class="title function_">addData</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            type : <span class="string">&quot;post&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">async</span> : <span class="literal">true</span>, <span class="comment">//异步请求（同步请求将会锁住浏览器，用户其他操作必须等待请求完成才可以执行）</span></span></span><br><span class="line"><span class="language-javascript">            url : <span class="string">&quot;/ShangHai/mdata1Servlet&quot;</span>, <span class="comment">//请求发送到Controller处，路径我上面写好了的，直接拼的，你自己按照你的写</span></span></span><br><span class="line"><span class="language-javascript">            data : &#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">            dataType : <span class="string">&quot;json&quot;</span>, <span class="comment">//返回数据形式为json</span></span></span><br><span class="line"><span class="language-javascript">            success : <span class="keyword">function</span>(<span class="params">result</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//请求成功时执行该函数内容，result即为服务器返回的json对象</span></span></span><br><span class="line"><span class="language-javascript">                now10 = now10+result.<span class="property">num</span>;</span></span><br><span class="line"><span class="language-javascript">                date10.<span class="title function_">push</span>(now10);</span></span><br><span class="line"><span class="language-javascript">                datas10.<span class="title function_">push</span>(result.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            error : <span class="keyword">function</span>(<span class="params">errorMsg</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    &#125;,<span class="number">2000</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setInterval</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        myLine10.<span class="title function_">setOption</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">color</span>:[<span class="string">&#x27;#7de494&#x27;</span>,<span class="string">&#x27;#7fd7b1&#x27;</span>, <span class="string">&#x27;#5578cf&#x27;</span>, <span class="string">&#x27;#5ebbeb&#x27;</span>, <span class="string">&#x27;#d16ad8&#x27;</span>,<span class="string">&#x27;#f8e19a&#x27;</span>,  <span class="string">&#x27;#00b7ee&#x27;</span>, <span class="string">&#x27;#81dabe&#x27;</span>,<span class="string">&#x27;#5fc5ce&#x27;</span>],</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">grid</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">left</span>:<span class="number">30</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">right</span>:<span class="number">40</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">top</span>:<span class="number">30</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">bottom</span>:<span class="number">20</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">containLabel</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">toolbox</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">feature</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">saveAsImage</span>: &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">xAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">type</span>: <span class="string">&#x27;category&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">boundaryGap</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.2)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">splitLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.1)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLabel</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">color</span>:<span class="string">&quot;rgba(255,255,255,.7)&quot;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">data</span>: date10</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">yAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">type</span>: <span class="string">&#x27;value&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.2)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">splitLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.1)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLabel</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">color</span>:<span class="string">&quot;rgba(255,255,255,.7)&quot;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">series</span>: [</span></span><br><span class="line"><span class="language-javascript">                &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">name</span>:<span class="string">&#x27;2014年&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">type</span>:<span class="string">&#x27;line&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">stack</span>: <span class="string">&#x27;总量&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">data</span>:datas10</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            ]</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;, <span class="number">1000</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--2伤员生成数量--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> myLine11 = echarts.<span class="title function_">init</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;s2&#x27;</span>));</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> date11 = [];</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> datas11 = [];</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> now11 =<span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setInterval</span>(<span class="keyword">function</span> <span class="title function_">addData</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            type : <span class="string">&quot;post&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">async</span> : <span class="literal">true</span>, <span class="comment">//异步请求（同步请求将会锁住浏览器，用户其他操作必须等待请求完成才可以执行）</span></span></span><br><span class="line"><span class="language-javascript">            url : <span class="string">&quot;/ShangHai/mdata2Servlet&quot;</span>, <span class="comment">//请求发送到Controller处，路径我上面写好了的，直接拼的，你自己按照你的写</span></span></span><br><span class="line"><span class="language-javascript">            data : &#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">            dataType : <span class="string">&quot;json&quot;</span>, <span class="comment">//返回数据形式为json</span></span></span><br><span class="line"><span class="language-javascript">            success : <span class="keyword">function</span>(<span class="params">result</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//请求成功时执行该函数内容，result即为服务器返回的json对象</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                now11 = now11+result.<span class="property">num</span>;</span></span><br><span class="line"><span class="language-javascript">                date11.<span class="title function_">push</span>(now11);</span></span><br><span class="line"><span class="language-javascript">                datas11.<span class="title function_">push</span>(result.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            error : <span class="keyword">function</span>(<span class="params">errorMsg</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    &#125;,<span class="number">2000</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setInterval</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        myLine11.<span class="title function_">setOption</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">color</span>:[<span class="string">&#x27;#7de494&#x27;</span>,<span class="string">&#x27;#7fd7b1&#x27;</span>, <span class="string">&#x27;#5578cf&#x27;</span>, <span class="string">&#x27;#5ebbeb&#x27;</span>, <span class="string">&#x27;#d16ad8&#x27;</span>,<span class="string">&#x27;#f8e19a&#x27;</span>,  <span class="string">&#x27;#00b7ee&#x27;</span>, <span class="string">&#x27;#81dabe&#x27;</span>,<span class="string">&#x27;#5fc5ce&#x27;</span>],</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">grid</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">left</span>:<span class="number">30</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">right</span>:<span class="number">40</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">top</span>:<span class="number">30</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">bottom</span>:<span class="number">20</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">containLabel</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">toolbox</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">feature</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">saveAsImage</span>: &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">xAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">type</span>: <span class="string">&#x27;category&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">boundaryGap</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.2)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">splitLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.1)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLabel</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">color</span>:<span class="string">&quot;rgba(255,255,255,.7)&quot;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">data</span>: date11</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">yAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">type</span>: <span class="string">&#x27;value&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.2)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">splitLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.1)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLabel</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">color</span>:<span class="string">&quot;rgba(255,255,255,.7)&quot;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">series</span>: [</span></span><br><span class="line"><span class="language-javascript">                &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">type</span>:<span class="string">&#x27;line&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">data</span>:datas11</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            ]</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;, <span class="number">1000</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--3台风伤员平均等待时间--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> myLine12 = echarts.<span class="title function_">init</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;s3&#x27;</span>));</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> date12 = [];</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> datas12 = [];</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> now12 =<span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setInterval</span>(<span class="keyword">function</span> <span class="title function_">addData</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            type : <span class="string">&quot;post&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">async</span> : <span class="literal">true</span>, <span class="comment">//异步请求（同步请求将会锁住浏览器，用户其他操作必须等待请求完成才可以执行）</span></span></span><br><span class="line"><span class="language-javascript">            url : <span class="string">&quot;/ShangHai/mdata3Servlet&quot;</span>, <span class="comment">//请求发送到Controller处，路径我上面写好了的，直接拼的，你自己按照你的写</span></span></span><br><span class="line"><span class="language-javascript">            data : &#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">            dataType : <span class="string">&quot;json&quot;</span>, <span class="comment">//返回数据形式为json</span></span></span><br><span class="line"><span class="language-javascript">            success : <span class="keyword">function</span>(<span class="params">result</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//请求成功时执行该函数内容，result即为服务器返回的json对象</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                now12 = now12+result.<span class="property">num</span>;</span></span><br><span class="line"><span class="language-javascript">                date12.<span class="title function_">push</span>(now12);</span></span><br><span class="line"><span class="language-javascript">                datas12.<span class="title function_">push</span>(result.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            error : <span class="keyword">function</span>(<span class="params">errorMsg</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    &#125;,<span class="number">2000</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setInterval</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        myLine12.<span class="title function_">setOption</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">color</span>:[<span class="string">&#x27;#7de494&#x27;</span>,<span class="string">&#x27;#7fd7b1&#x27;</span>, <span class="string">&#x27;#5578cf&#x27;</span>, <span class="string">&#x27;#5ebbeb&#x27;</span>, <span class="string">&#x27;#d16ad8&#x27;</span>,<span class="string">&#x27;#f8e19a&#x27;</span>,  <span class="string">&#x27;#00b7ee&#x27;</span>, <span class="string">&#x27;#81dabe&#x27;</span>,<span class="string">&#x27;#5fc5ce&#x27;</span>],</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">grid</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">left</span>:<span class="number">30</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">right</span>:<span class="number">40</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">top</span>:<span class="number">30</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">bottom</span>:<span class="number">20</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">containLabel</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">toolbox</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">feature</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">saveAsImage</span>: &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">xAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">type</span>: <span class="string">&#x27;category&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">boundaryGap</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.2)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">splitLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.1)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLabel</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">color</span>:<span class="string">&quot;rgba(255,255,255,.7)&quot;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">data</span>: date12</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">yAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">type</span>: <span class="string">&#x27;value&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.2)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">splitLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.1)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLabel</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">color</span>:<span class="string">&quot;rgba(255,255,255,.7)&quot;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">series</span>: [</span></span><br><span class="line"><span class="language-javascript">                &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">type</span>:<span class="string">&#x27;line&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">data</span>:datas12</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            ]</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;, <span class="number">1000</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--4地震伤员平均等待时间--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> myLine13 = echarts.<span class="title function_">init</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;s4&#x27;</span>));</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> date13 = [];</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> datas13 = [];</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> now13 =<span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setInterval</span>(<span class="keyword">function</span> <span class="title function_">addData</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            type : <span class="string">&quot;post&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">async</span> : <span class="literal">true</span>, <span class="comment">//异步请求（同步请求将会锁住浏览器，用户其他操作必须等待请求完成才可以执行）</span></span></span><br><span class="line"><span class="language-javascript">            url : <span class="string">&quot;/ShangHai/mdata4Servlet&quot;</span>, <span class="comment">//请求发送到Controller处，路径我上面写好了的，直接拼的，你自己按照你的写</span></span></span><br><span class="line"><span class="language-javascript">            data : &#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">            dataType : <span class="string">&quot;json&quot;</span>, <span class="comment">//返回数据形式为json</span></span></span><br><span class="line"><span class="language-javascript">            success : <span class="keyword">function</span>(<span class="params">result</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//请求成功时执行该函数内容，result即为服务器返回的json对象</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                now13 = now13+result.<span class="property">num</span>;</span></span><br><span class="line"><span class="language-javascript">                date13.<span class="title function_">push</span>(now13);</span></span><br><span class="line"><span class="language-javascript">                datas13.<span class="title function_">push</span>(result.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            error : <span class="keyword">function</span>(<span class="params">errorMsg</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    &#125;,<span class="number">2000</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setInterval</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        myLine13.<span class="title function_">setOption</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">color</span>:[<span class="string">&#x27;#7de494&#x27;</span>,<span class="string">&#x27;#7fd7b1&#x27;</span>, <span class="string">&#x27;#5578cf&#x27;</span>, <span class="string">&#x27;#5ebbeb&#x27;</span>, <span class="string">&#x27;#d16ad8&#x27;</span>,<span class="string">&#x27;#f8e19a&#x27;</span>,  <span class="string">&#x27;#00b7ee&#x27;</span>, <span class="string">&#x27;#81dabe&#x27;</span>,<span class="string">&#x27;#5fc5ce&#x27;</span>],</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">grid</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">left</span>:<span class="number">30</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">right</span>:<span class="number">40</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">top</span>:<span class="number">30</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">bottom</span>:<span class="number">20</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">containLabel</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">toolbox</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">feature</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">saveAsImage</span>: &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">xAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">type</span>: <span class="string">&#x27;category&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">boundaryGap</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.2)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">splitLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.1)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLabel</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">color</span>:<span class="string">&quot;rgba(255,255,255,.7)&quot;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">data</span>: date13</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">yAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">type</span>: <span class="string">&#x27;value&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.2)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">splitLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.1)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLabel</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">color</span>:<span class="string">&quot;rgba(255,255,255,.7)&quot;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">series</span>: [</span></span><br><span class="line"><span class="language-javascript">                &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">name</span>:<span class="string">&#x27;2014年&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">type</span>:<span class="string">&#x27;line&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">stack</span>: <span class="string">&#x27;总量&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">areaStyle</span>: &#123;<span class="attr">normal</span>: &#123;&#125;&#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">data</span>:datas13</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            ]</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;, <span class="number">1000</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--5火灾伤员平均等待时间--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> myLine14 = echarts.<span class="title function_">init</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;s5&#x27;</span>));</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> date14 = [];</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> datas14 = [];</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> now14 =<span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setInterval</span>(<span class="keyword">function</span> <span class="title function_">addData</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            type : <span class="string">&quot;post&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">async</span> : <span class="literal">true</span>, <span class="comment">//异步请求（同步请求将会锁住浏览器，用户其他操作必须等待请求完成才可以执行）</span></span></span><br><span class="line"><span class="language-javascript">            url : <span class="string">&quot;/ShangHai/mdata5Servlet&quot;</span>, <span class="comment">//请求发送到Controller处，路径我上面写好了的，直接拼的，你自己按照你的写</span></span></span><br><span class="line"><span class="language-javascript">            data : &#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">            dataType : <span class="string">&quot;json&quot;</span>, <span class="comment">//返回数据形式为json</span></span></span><br><span class="line"><span class="language-javascript">            success : <span class="keyword">function</span>(<span class="params">result</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//请求成功时执行该函数内容，result即为服务器返回的json对象</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                now14 = now14+result.<span class="property">num</span>;</span></span><br><span class="line"><span class="language-javascript">                date14.<span class="title function_">push</span>(now14);</span></span><br><span class="line"><span class="language-javascript">                datas14.<span class="title function_">push</span>(result.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            error : <span class="keyword">function</span>(<span class="params">errorMsg</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    &#125;,<span class="number">2000</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setInterval</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        myLine14.<span class="title function_">setOption</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">color</span>:[<span class="string">&#x27;#7de494&#x27;</span>,<span class="string">&#x27;#7fd7b1&#x27;</span>, <span class="string">&#x27;#5578cf&#x27;</span>, <span class="string">&#x27;#5ebbeb&#x27;</span>, <span class="string">&#x27;#d16ad8&#x27;</span>,<span class="string">&#x27;#f8e19a&#x27;</span>,  <span class="string">&#x27;#00b7ee&#x27;</span>, <span class="string">&#x27;#81dabe&#x27;</span>,<span class="string">&#x27;#5fc5ce&#x27;</span>],</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">grid</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">left</span>:<span class="number">30</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">right</span>:<span class="number">40</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">top</span>:<span class="number">30</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">bottom</span>:<span class="number">20</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">containLabel</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">toolbox</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">feature</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">saveAsImage</span>: &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">xAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">type</span>: <span class="string">&#x27;category&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">boundaryGap</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.2)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">splitLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.1)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLabel</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">color</span>:<span class="string">&quot;rgba(255,255,255,.7)&quot;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">data</span>: date14</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">yAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">type</span>: <span class="string">&#x27;value&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.2)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">splitLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.1)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLabel</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">color</span>:<span class="string">&quot;rgba(255,255,255,.7)&quot;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">series</span>: [</span></span><br><span class="line"><span class="language-javascript">                &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">name</span>:<span class="string">&#x27;2014年&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">type</span>:<span class="string">&#x27;line&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">stack</span>: <span class="string">&#x27;总量&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">areaStyle</span>: &#123;<span class="attr">normal</span>: &#123;&#125;&#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">data</span>:datas14</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            ]</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;, <span class="number">1000</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--6日常伤员生成地统计--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> myBar3 = echarts.<span class="title function_">init</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;s6&#x27;</span>));</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">window</span>.<span class="built_in">setInterval</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            type : <span class="string">&quot;post&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">async</span> : <span class="literal">true</span>, <span class="comment">//异步请求（同步请求将会锁住浏览器，用户其他操作必须等待请求完成才可以执行）</span></span></span><br><span class="line"><span class="language-javascript">            url : <span class="string">&quot;/ShangHai/mdata6Servlet&quot;</span>, <span class="comment">//请求发送到Controller处，路径我上面写好了的，直接拼的，你自己按照你的写</span></span></span><br><span class="line"><span class="language-javascript">            data : &#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">            dataType : <span class="string">&quot;json&quot;</span>, <span class="comment">//返回数据形式为json</span></span></span><br><span class="line"><span class="language-javascript">            success : <span class="keyword">function</span>(<span class="params">result</span>) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//请求成功时执行该函数内容，result即为服务器返回的json对象</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                myBar3.<span class="title function_">setOption</span>(&#123; <span class="comment">//加载数据图表</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">color</span>: [<span class="string">&#x27;#3398DB&#x27;</span>],</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">tooltip</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">trigger</span>: <span class="string">&#x27;axis&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">axisPointer</span>: &#123;            <span class="comment">// 坐标轴指示器，坐标轴触发有效</span></span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">type</span>: <span class="string">&#x27;shadow&#x27;</span>        <span class="comment">// 默认为直线，可选为：&#x27;line&#x27; | &#x27;shadow&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                        &#125;</span></span><br><span class="line"><span class="language-javascript">                    &#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">grid</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">left</span>: <span class="string">&#x27;3%&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">right</span>: <span class="string">&#x27;4%&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">bottom</span>: <span class="string">&#x27;3%&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">containLabel</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">xAxis</span>: [</span></span><br><span class="line"><span class="language-javascript">                        &#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">type</span>: <span class="string">&#x27;category&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">data</span>: [<span class="string">&#x27;闵行区&#x27;</span>,<span class="string">&#x27;黄浦区&#x27;</span>,<span class="string">&#x27;徐汇区&#x27;</span>,<span class="string">&#x27;长宁区&#x27;</span>,<span class="string">&#x27;静安区&#x27;</span>,<span class="string">&#x27;普陀区&#x27;</span>,<span class="string">&#x27;虹口区&#x27;</span>,<span class="string">&#x27;杨浦区&#x27;</span>,<span class="string">&#x27;浦东新区&#x27;</span>,<span class="string">&#x27;金山区&#x27;</span>,<span class="string">&#x27;闸北区&#x27;</span>,<span class="string">&#x27;嘉定区&#x27;</span>],</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">axisTick</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                                <span class="attr">alignWithLabel</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">                            &#125;,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">axisLabel</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                                <span class="attr">color</span>:<span class="string">&quot;rgba(255,255,255,.7)&quot;</span></span></span><br><span class="line"><span class="language-javascript">                            &#125;,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">axisLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                                <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                                    <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.6)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                                &#125;</span></span><br><span class="line"><span class="language-javascript">                            &#125;,</span></span><br><span class="line"><span class="language-javascript">                        &#125;</span></span><br><span class="line"><span class="language-javascript">                    ],</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">yAxis</span>:[</span></span><br><span class="line"><span class="language-javascript">                        &#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">axisLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                                <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                                    <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.6)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                                &#125;</span></span><br><span class="line"><span class="language-javascript">                            &#125;,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">splitLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                                <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                                    <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,0.1)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                                &#125;</span></span><br><span class="line"><span class="language-javascript">                            &#125;,</span></span><br><span class="line"><span class="language-javascript">                            type : <span class="string">&#x27;value&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                    ],</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">series</span>: [</span></span><br><span class="line"><span class="language-javascript">                        &#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">name</span>: <span class="string">&#x27;直接访问&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">type</span>: <span class="string">&#x27;bar&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">barWidth</span>: <span class="string">&#x27;60%&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">data</span>:[result.<span class="property">data0</span>,result.<span class="property">data1</span>,result.<span class="property">data2</span>,result.<span class="property">data3</span>,result.<span class="property">data4</span>,result.<span class="property">data5</span>,result.<span class="property">data6</span>,result.<span class="property">data7</span>,result.<span class="property">data8</span>,result.<span class="property">data9</span>,result.<span class="property">data10</span>,result.<span class="property">data11</span>]</span></span><br><span class="line"><span class="language-javascript">                        &#125;</span></span><br><span class="line"><span class="language-javascript">                    ]</span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            error : <span class="keyword">function</span>(<span class="params">errorMsg</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    &#125;,<span class="number">2000</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--7各区等待时长--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> myBar4 = echarts.<span class="title function_">init</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;s7&#x27;</span>));</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">window</span>.<span class="built_in">setInterval</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            type : <span class="string">&quot;post&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">async</span> : <span class="literal">true</span>, <span class="comment">//异步请求（同步请求将会锁住浏览器，用户其他操作必须等待请求完成才可以执行）</span></span></span><br><span class="line"><span class="language-javascript">            url : <span class="string">&quot;/ShangHai/mdata7Servlet&quot;</span>, <span class="comment">//请求发送到Controller处，路径我上面写好了的，直接拼的，你自己按照你的写</span></span></span><br><span class="line"><span class="language-javascript">            data : &#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">            dataType : <span class="string">&quot;json&quot;</span>, <span class="comment">//返回数据形式为json</span></span></span><br><span class="line"><span class="language-javascript">            success : <span class="keyword">function</span>(<span class="params">result</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(result)</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(result.<span class="property">data0</span>)</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//请求成功时执行该函数内容，result即为服务器返回的json对象</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                myBar4.<span class="title function_">setOption</span>(&#123; <span class="comment">//加载数据图表</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">color</span>: [<span class="string">&#x27;#3398DB&#x27;</span>],</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">tooltip</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">trigger</span>: <span class="string">&#x27;axis&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">axisPointer</span>: &#123;            <span class="comment">// 坐标轴指示器，坐标轴触发有效</span></span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">type</span>: <span class="string">&#x27;shadow&#x27;</span>        <span class="comment">// 默认为直线，可选为：&#x27;line&#x27; | &#x27;shadow&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                        &#125;</span></span><br><span class="line"><span class="language-javascript">                    &#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">grid</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">left</span>: <span class="string">&#x27;3%&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">right</span>: <span class="string">&#x27;4%&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">bottom</span>: <span class="string">&#x27;3%&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">containLabel</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">xAxis</span>: [</span></span><br><span class="line"><span class="language-javascript">                        &#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">type</span>: <span class="string">&#x27;category&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">data</span>: [<span class="string">&#x27;闵行区&#x27;</span>,<span class="string">&#x27;黄浦区&#x27;</span>,<span class="string">&#x27;徐汇区&#x27;</span>,<span class="string">&#x27;长宁区&#x27;</span>,<span class="string">&#x27;静安区&#x27;</span>,<span class="string">&#x27;普陀区&#x27;</span>,<span class="string">&#x27;虹口区&#x27;</span>,<span class="string">&#x27;杨浦区&#x27;</span>,<span class="string">&#x27;浦东新区&#x27;</span>,<span class="string">&#x27;金山区&#x27;</span>,<span class="string">&#x27;闸北区&#x27;</span>,<span class="string">&#x27;嘉定区&#x27;</span>],</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">axisTick</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                                <span class="attr">alignWithLabel</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">                            &#125;,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">axisLabel</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                                <span class="attr">color</span>:<span class="string">&quot;rgba(255,255,255,.7)&quot;</span></span></span><br><span class="line"><span class="language-javascript">                            &#125;,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">axisLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                                <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                                    <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.6)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                                &#125;</span></span><br><span class="line"><span class="language-javascript">                            &#125;,</span></span><br><span class="line"><span class="language-javascript">                        &#125;</span></span><br><span class="line"><span class="language-javascript">                    ],</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">yAxis</span>:[</span></span><br><span class="line"><span class="language-javascript">                        &#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">axisLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                                <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                                    <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.6)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                                &#125;</span></span><br><span class="line"><span class="language-javascript">                            &#125;,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">splitLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                                <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                                    <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,0.1)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                                &#125;</span></span><br><span class="line"><span class="language-javascript">                            &#125;,</span></span><br><span class="line"><span class="language-javascript">                            type : <span class="string">&#x27;value&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                    ],</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">series</span>: [</span></span><br><span class="line"><span class="language-javascript">                        &#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">name</span>: <span class="string">&#x27;直接访问&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">type</span>: <span class="string">&#x27;bar&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">barWidth</span>: <span class="string">&#x27;60%&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">data</span>:[result.<span class="property">data0</span>,result.<span class="property">data1</span>,result.<span class="property">data2</span>,result.<span class="property">data3</span>,result.<span class="property">data4</span>,result.<span class="property">data5</span>,result.<span class="property">data6</span>,result.<span class="property">data7</span>,result.<span class="property">data8</span>,result.<span class="property">data9</span>,result.<span class="property">data10</span>,result.<span class="property">data11</span>]</span></span><br><span class="line"><span class="language-javascript">                        &#125;</span></span><br><span class="line"><span class="language-javascript">                    ]</span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            error : <span class="keyword">function</span>(<span class="params">errorMsg</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    &#125;,<span class="number">2000</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>第三页第二个：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;assets/css/BigData.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;assets/css/index.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;assets/css/index01.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;assets/js/jquery.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;assets/js/echarts.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://a.amap.com/jsapi_demos/static/demo-center/css/demo-center.css&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;assets/js/bstable/css/bootstrap.min.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;assets/js/bstable/css/bootstrap-table.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;assets/css/Security_operation.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>上海项目<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">html</span>, <span class="selector-tag">body</span>, <span class="selector-id">#allmap</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">height</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.input-card</span> <span class="selector-class">.btn</span>&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin-right</span>: <span class="number">1.2rem</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>: <span class="number">9rem</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.input-card</span> <span class="selector-class">.btn</span><span class="selector-pseudo">:last-child</span>&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin-right</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.input</span>&#123;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            -web-kit-appearance:none;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            -moz-appearance: none;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="attribute">font-size</span>:<span class="number">1.4em</span>;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="attribute">height</span>:<span class="number">2.0em</span>;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="attribute">border-radius</span>:<span class="number">5px</span>;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="attribute">border</span>:<span class="number">1px</span> solid <span class="number">#c8cccf</span>;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="attribute">color</span>:<span class="number">#6a6f77</span>;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="attribute">outline</span>:<span class="number">0</span>;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;data_bodey&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;index_nav&quot;</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">style</span>=<span class="string">&quot;height: 30px; margin-bottom: 0px;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;l_left total_chose_fr&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;index.html&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: #dbe9f1&quot;</span>&gt;</span>实时监测<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;l_left total_chose_pl&quot;</span> &gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;index1.html&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: #dbe9f1&quot;</span>&gt;</span>统计分析二<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;r_right total_chose_pl&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;index3.html&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: #dbe9f1&quot;</span>&gt;</span>小车运行<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;r_right total_chose_pl nav_active&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;index2.html&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: #dbe9f1&quot;</span>&gt;</span>统计分析四<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;index_tabs&quot;</span> &gt;</span></span><br><span class="line"><span class="comment">&lt;!--四--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;inner&quot;</span> &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;shuju_nav&quot;</span> &gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ul</span> <span class="attr">style</span>=<span class="string">&quot;height: 30px; margin-bottom: 0px;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;l_left total_chose_fr &quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;index2.html&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: #dbe9f1&quot;</span>&gt;</span>总体大规模<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;l_left total_chose_pl nav_active1&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;index2_1.html&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: #dbe9f1&quot;</span>&gt;</span>单项大规模<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;index1_tabs&quot;</span> &gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;inner1&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;clear&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;data_left06&quot;</span> &gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAll04 maginS&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder01&quot;</span><span class="attr">style</span>=<span class="string">&quot;margin-top: 0%;height: 150%;width:105%&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder02&quot;</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;data_tit1&quot;</span>&gt;</span>大规模车上平均耗时<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;data_chart&quot;</span> <span class="attr">id</span>=<span class="string">&quot;s8&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAll04&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder01&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 100px;height: 150%;width:200%;margin-left: 50px&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder02&quot;</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;data_tit1&quot;</span>&gt;</span>大规模车上最大耗时<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;data_chart&quot;</span> <span class="attr">id</span>=<span class="string">&quot;s9&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;data_left06&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAll04 maginS&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder01&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 0%;height: 150%;width:115%;margin-left: 10px&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder02&quot;</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;data_tit1&quot;</span>&gt;</span>大规模救护车利用率<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;data_chart&quot;</span> <span class="attr">id</span>=<span class="string">&quot;s10&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;data_left06&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAll04&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder03&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 0%;margin-left: 40px&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder02&quot;</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;data_tit1&quot;</span>&gt;</span>大规模伤员平均等待时间<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;data_chart&quot;</span> <span class="attr">id</span>=<span class="string">&quot;s11&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAll04&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder03&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 100px;margin-left: 40px;width: 200%&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder02&quot;</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;data_tit1&quot;</span>&gt;</span>大规模伤员最大等待时间<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;data_chart&quot;</span> <span class="attr">id</span>=<span class="string">&quot;s12&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--8大规模车上平均耗时--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> myLine15 = echarts.<span class="title function_">init</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;s8&#x27;</span>));</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> date15 = [];</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> datas15 = [];</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> now15 =<span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setInterval</span>(<span class="keyword">function</span> <span class="title function_">addData</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        myLine15.<span class="title function_">hideLoading</span>(); <span class="comment">//隐藏加载动画</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            type : <span class="string">&quot;post&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">async</span> : <span class="literal">true</span>, <span class="comment">//异步请求（同步请求将会锁住浏览器，用户其他操作必须等待请求完成才可以执行）</span></span></span><br><span class="line"><span class="language-javascript">            url : <span class="string">&quot;/ShangHai/mdata8Servlet&quot;</span>, <span class="comment">//请求发送到Controller处，路径我上面写好了的，直接拼的，你自己按照你的写</span></span></span><br><span class="line"><span class="language-javascript">            data : &#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">            dataType : <span class="string">&quot;json&quot;</span>, <span class="comment">//返回数据形式为json</span></span></span><br><span class="line"><span class="language-javascript">            success : <span class="keyword">function</span>(<span class="params">result</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//请求成功时执行该函数内容，result即为服务器返回的json对象</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                now15 = now15+result.<span class="property">num</span>;</span></span><br><span class="line"><span class="language-javascript">                date15.<span class="title function_">push</span>(now15);</span></span><br><span class="line"><span class="language-javascript">                datas15.<span class="title function_">push</span>(result.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            error : <span class="keyword">function</span>(<span class="params">errorMsg</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                myLine15.<span class="title function_">hideLoading</span>(); <span class="comment">//隐藏加载动画</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    &#125;,<span class="number">2000</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setInterval</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        myLine15.<span class="title function_">setOption</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">color</span>:[<span class="string">&#x27;#7de494&#x27;</span>,<span class="string">&#x27;#7fd7b1&#x27;</span>, <span class="string">&#x27;#5578cf&#x27;</span>, <span class="string">&#x27;#5ebbeb&#x27;</span>, <span class="string">&#x27;#d16ad8&#x27;</span>,<span class="string">&#x27;#f8e19a&#x27;</span>,  <span class="string">&#x27;#00b7ee&#x27;</span>, <span class="string">&#x27;#81dabe&#x27;</span>,<span class="string">&#x27;#5fc5ce&#x27;</span>],</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">grid</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">left</span>:<span class="number">30</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">right</span>:<span class="number">40</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">top</span>:<span class="number">30</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">bottom</span>:<span class="number">20</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">containLabel</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">toolbox</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">feature</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">saveAsImage</span>: &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">xAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">type</span>: <span class="string">&#x27;category&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">boundaryGap</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.2)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">splitLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.1)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLabel</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">color</span>:<span class="string">&quot;rgba(255,255,255,.7)&quot;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">data</span>: date15</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">yAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">type</span>: <span class="string">&#x27;value&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.2)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">splitLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.1)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLabel</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">color</span>:<span class="string">&quot;rgba(255,255,255,.7)&quot;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">series</span>: [</span></span><br><span class="line"><span class="language-javascript">                &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">name</span>:<span class="string">&#x27;2014年&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">type</span>:<span class="string">&#x27;line&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">stack</span>: <span class="string">&#x27;总量&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">areaStyle</span>: &#123;<span class="attr">normal</span>: &#123;&#125;&#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">data</span>:datas15</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            ]</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;, <span class="number">1000</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--9大规模车上最大耗时--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> myLine16 = echarts.<span class="title function_">init</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;s9&#x27;</span>));</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> date16 = [];</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> datas16 = [];</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> now16 =<span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setInterval</span>(<span class="keyword">function</span> <span class="title function_">addData</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        myLine16.<span class="title function_">hideLoading</span>(); <span class="comment">//隐藏加载动画</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            type : <span class="string">&quot;post&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">async</span> : <span class="literal">true</span>, <span class="comment">//异步请求（同步请求将会锁住浏览器，用户其他操作必须等待请求完成才可以执行）</span></span></span><br><span class="line"><span class="language-javascript">            url : <span class="string">&quot;/ShangHai/mdata9Servlet&quot;</span>, <span class="comment">//请求发送到Controller处，路径我上面写好了的，直接拼的，你自己按照你的写</span></span></span><br><span class="line"><span class="language-javascript">            data : &#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">            dataType : <span class="string">&quot;json&quot;</span>, <span class="comment">//返回数据形式为json</span></span></span><br><span class="line"><span class="language-javascript">            success : <span class="keyword">function</span>(<span class="params">result</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//请求成功时执行该函数内容，result即为服务器返回的json对象</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                now16 = now16+result.<span class="property">num</span>;</span></span><br><span class="line"><span class="language-javascript">                date16.<span class="title function_">push</span>(now16);</span></span><br><span class="line"><span class="language-javascript">                datas16.<span class="title function_">push</span>(result.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            error : <span class="keyword">function</span>(<span class="params">errorMsg</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                myLine16.<span class="title function_">hideLoading</span>(); <span class="comment">//隐藏加载动画</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    &#125;,<span class="number">2000</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setInterval</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        myLine16.<span class="title function_">setOption</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">color</span>:[<span class="string">&#x27;#7de494&#x27;</span>,<span class="string">&#x27;#7fd7b1&#x27;</span>, <span class="string">&#x27;#5578cf&#x27;</span>, <span class="string">&#x27;#5ebbeb&#x27;</span>, <span class="string">&#x27;#d16ad8&#x27;</span>,<span class="string">&#x27;#f8e19a&#x27;</span>,  <span class="string">&#x27;#00b7ee&#x27;</span>, <span class="string">&#x27;#81dabe&#x27;</span>,<span class="string">&#x27;#5fc5ce&#x27;</span>],</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">grid</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">left</span>:<span class="number">30</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">right</span>:<span class="number">40</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">top</span>:<span class="number">30</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">bottom</span>:<span class="number">20</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">containLabel</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">toolbox</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">feature</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">saveAsImage</span>: &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">xAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">type</span>: <span class="string">&#x27;category&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">boundaryGap</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.2)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">splitLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.1)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLabel</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">color</span>:<span class="string">&quot;rgba(255,255,255,.7)&quot;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">data</span>: date16</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">yAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">type</span>: <span class="string">&#x27;value&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.2)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">splitLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.1)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLabel</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">color</span>:<span class="string">&quot;rgba(255,255,255,.7)&quot;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">series</span>: [</span></span><br><span class="line"><span class="language-javascript">                &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">name</span>:<span class="string">&#x27;2014年&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">type</span>:<span class="string">&#x27;line&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">stack</span>: <span class="string">&#x27;总量&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">areaStyle</span>: &#123;<span class="attr">normal</span>: &#123;&#125;&#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">data</span>:datas16</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            ]</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;, <span class="number">1000</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--10大规模救护车利用率--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> myLine17 = echarts.<span class="title function_">init</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;s10&#x27;</span>));</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> date17 = [];</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> datas17 = [];</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> now17 =<span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setInterval</span>(<span class="keyword">function</span> <span class="title function_">addData</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        myLine17.<span class="title function_">hideLoading</span>(); <span class="comment">//隐藏加载动画</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            type : <span class="string">&quot;post&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">async</span> : <span class="literal">true</span>, <span class="comment">//异步请求（同步请求将会锁住浏览器，用户其他操作必须等待请求完成才可以执行）</span></span></span><br><span class="line"><span class="language-javascript">            url : <span class="string">&quot;/ShangHai/mdata10Servlet&quot;</span>, <span class="comment">//请求发送到Controller处，路径我上面写好了的，直接拼的，你自己按照你的写</span></span></span><br><span class="line"><span class="language-javascript">            data : &#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">            dataType : <span class="string">&quot;json&quot;</span>, <span class="comment">//返回数据形式为json</span></span></span><br><span class="line"><span class="language-javascript">            success : <span class="keyword">function</span>(<span class="params">result</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//请求成功时执行该函数内容，result即为服务器返回的json对象</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                now17 = now17+result.<span class="property">num</span>;</span></span><br><span class="line"><span class="language-javascript">                date17.<span class="title function_">push</span>(now17);</span></span><br><span class="line"><span class="language-javascript">                datas17.<span class="title function_">push</span>(result.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            error : <span class="keyword">function</span>(<span class="params">errorMsg</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                myLine17.<span class="title function_">hideLoading</span>(); <span class="comment">//隐藏加载动画</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    &#125;,<span class="number">2000</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setInterval</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        myLine17.<span class="title function_">setOption</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">color</span>:[<span class="string">&#x27;#7de494&#x27;</span>,<span class="string">&#x27;#7fd7b1&#x27;</span>, <span class="string">&#x27;#5578cf&#x27;</span>, <span class="string">&#x27;#5ebbeb&#x27;</span>, <span class="string">&#x27;#d16ad8&#x27;</span>,<span class="string">&#x27;#f8e19a&#x27;</span>,  <span class="string">&#x27;#00b7ee&#x27;</span>, <span class="string">&#x27;#81dabe&#x27;</span>,<span class="string">&#x27;#5fc5ce&#x27;</span>],</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">grid</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">left</span>:<span class="number">30</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">right</span>:<span class="number">40</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">top</span>:<span class="number">30</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">bottom</span>:<span class="number">20</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">containLabel</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">toolbox</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">feature</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">saveAsImage</span>: &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">xAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">type</span>: <span class="string">&#x27;category&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">boundaryGap</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.2)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">splitLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.1)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLabel</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">color</span>:<span class="string">&quot;rgba(255,255,255,.7)&quot;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">data</span>: date17</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">yAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">type</span>: <span class="string">&#x27;value&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.2)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">splitLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.1)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLabel</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">color</span>:<span class="string">&quot;rgba(255,255,255,.7)&quot;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">series</span>: [</span></span><br><span class="line"><span class="language-javascript">                &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">name</span>:<span class="string">&#x27;2014年&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">type</span>:<span class="string">&#x27;line&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">stack</span>: <span class="string">&#x27;总量&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">areaStyle</span>: &#123;<span class="attr">normal</span>: &#123;&#125;&#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">data</span>:datas17</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            ]</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;, <span class="number">1000</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--11大规模伤员平均等待时间--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> myLine18 = echarts.<span class="title function_">init</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;s11&#x27;</span>));</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> date18 = [];</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> datas18 = [];</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> now18 =<span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setInterval</span>(<span class="keyword">function</span> <span class="title function_">addData</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        myLine18.<span class="title function_">hideLoading</span>(); <span class="comment">//隐藏加载动画</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            type : <span class="string">&quot;post&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">async</span> : <span class="literal">true</span>, <span class="comment">//异步请求（同步请求将会锁住浏览器，用户其他操作必须等待请求完成才可以执行）</span></span></span><br><span class="line"><span class="language-javascript">            url : <span class="string">&quot;/ShangHai/mdata11Servlet&quot;</span>, <span class="comment">//请求发送到Controller处，路径我上面写好了的，直接拼的，你自己按照你的写</span></span></span><br><span class="line"><span class="language-javascript">            data : &#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">            dataType : <span class="string">&quot;json&quot;</span>, <span class="comment">//返回数据形式为json</span></span></span><br><span class="line"><span class="language-javascript">            success : <span class="keyword">function</span>(<span class="params">result</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//请求成功时执行该函数内容，result即为服务器返回的json对象</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                now18 = now18+result.<span class="property">num</span>;</span></span><br><span class="line"><span class="language-javascript">                date18.<span class="title function_">push</span>(now18);</span></span><br><span class="line"><span class="language-javascript">                datas18.<span class="title function_">push</span>(result.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            error : <span class="keyword">function</span>(<span class="params">errorMsg</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                myLine18.<span class="title function_">hideLoading</span>(); <span class="comment">//隐藏加载动画</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    &#125;,<span class="number">2000</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setInterval</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        myLine18.<span class="title function_">setOption</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">color</span>:[<span class="string">&#x27;#7de494&#x27;</span>,<span class="string">&#x27;#7fd7b1&#x27;</span>, <span class="string">&#x27;#5578cf&#x27;</span>, <span class="string">&#x27;#5ebbeb&#x27;</span>, <span class="string">&#x27;#d16ad8&#x27;</span>,<span class="string">&#x27;#f8e19a&#x27;</span>,  <span class="string">&#x27;#00b7ee&#x27;</span>, <span class="string">&#x27;#81dabe&#x27;</span>,<span class="string">&#x27;#5fc5ce&#x27;</span>],</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">grid</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">left</span>:<span class="number">30</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">right</span>:<span class="number">40</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">top</span>:<span class="number">30</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">bottom</span>:<span class="number">20</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">containLabel</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">toolbox</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">feature</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">saveAsImage</span>: &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">xAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">type</span>: <span class="string">&#x27;category&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">boundaryGap</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.2)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">splitLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.1)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLabel</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">color</span>:<span class="string">&quot;rgba(255,255,255,.7)&quot;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">data</span>: date18</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">yAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">type</span>: <span class="string">&#x27;value&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.2)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">splitLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.1)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLabel</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">color</span>:<span class="string">&quot;rgba(255,255,255,.7)&quot;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">series</span>: [</span></span><br><span class="line"><span class="language-javascript">                &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">name</span>:<span class="string">&#x27;2014年&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">type</span>:<span class="string">&#x27;line&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">stack</span>: <span class="string">&#x27;总量&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">areaStyle</span>: &#123;<span class="attr">normal</span>: &#123;&#125;&#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">data</span>:datas18</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            ]</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;, <span class="number">1000</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--12大规模伤员最大等待时间--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> myLine19 = echarts.<span class="title function_">init</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;s12&#x27;</span>));</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> date19 = [];</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> datas19 = [];</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> now19 =<span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setInterval</span>(<span class="keyword">function</span> <span class="title function_">addData</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        myLine19.<span class="title function_">hideLoading</span>(); <span class="comment">//隐藏加载动画</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            type : <span class="string">&quot;post&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">async</span> : <span class="literal">true</span>, <span class="comment">//异步请求（同步请求将会锁住浏览器，用户其他操作必须等待请求完成才可以执行）</span></span></span><br><span class="line"><span class="language-javascript">            url : <span class="string">&quot;/ShangHai/mdata12Servlet&quot;</span>, <span class="comment">//请求发送到Controller处，路径我上面写好了的，直接拼的，你自己按照你的写</span></span></span><br><span class="line"><span class="language-javascript">            data : &#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">            dataType : <span class="string">&quot;json&quot;</span>, <span class="comment">//返回数据形式为json</span></span></span><br><span class="line"><span class="language-javascript">            success : <span class="keyword">function</span>(<span class="params">result</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//请求成功时执行该函数内容，result即为服务器返回的json对象</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                now19 = now19+result.<span class="property">num</span>;</span></span><br><span class="line"><span class="language-javascript">                date19.<span class="title function_">push</span>(now19);</span></span><br><span class="line"><span class="language-javascript">                datas19.<span class="title function_">push</span>(result.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            error : <span class="keyword">function</span>(<span class="params">errorMsg</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                myLine19.<span class="title function_">hideLoading</span>(); <span class="comment">//隐藏加载动画</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    &#125;,<span class="number">2000</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setInterval</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        myLine19.<span class="title function_">setOption</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">color</span>:[<span class="string">&#x27;#7de494&#x27;</span>,<span class="string">&#x27;#7fd7b1&#x27;</span>, <span class="string">&#x27;#5578cf&#x27;</span>, <span class="string">&#x27;#5ebbeb&#x27;</span>, <span class="string">&#x27;#d16ad8&#x27;</span>,<span class="string">&#x27;#f8e19a&#x27;</span>,  <span class="string">&#x27;#00b7ee&#x27;</span>, <span class="string">&#x27;#81dabe&#x27;</span>,<span class="string">&#x27;#5fc5ce&#x27;</span>],</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">grid</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">left</span>:<span class="number">30</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">right</span>:<span class="number">40</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">top</span>:<span class="number">30</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">bottom</span>:<span class="number">20</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">containLabel</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">toolbox</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">feature</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">saveAsImage</span>: &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">xAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">type</span>: <span class="string">&#x27;category&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">boundaryGap</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.2)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">splitLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.1)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLabel</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">color</span>:<span class="string">&quot;rgba(255,255,255,.7)&quot;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">data</span>: date19</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">yAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">type</span>: <span class="string">&#x27;value&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.2)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">splitLine</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">lineStyle</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:<span class="string">&#x27;rgba(255,255,255,.1)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">axisLabel</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">color</span>:<span class="string">&quot;rgba(255,255,255,.7)&quot;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">series</span>: [</span></span><br><span class="line"><span class="language-javascript">                &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">name</span>:<span class="string">&#x27;2014年&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">type</span>:<span class="string">&#x27;line&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">stack</span>: <span class="string">&#x27;总量&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">areaStyle</span>: &#123;<span class="attr">normal</span>: &#123;&#125;&#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">data</span>:datas19</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            ]</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;, <span class="number">1000</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="第四页代码"><a href="#第四页代码" class="headerlink" title="第四页代码"></a>第四页代码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;assets/css/BigData.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;assets/css/index.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;assets/css/index01.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;assets/js/jquery.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://a.amap.com/jsapi_demos/static/demo-center/css/demo-center.css&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;assets/js/bstable/css/bootstrap.min.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;assets/js/bstable/css/bootstrap-table.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;assets/css/Security_operation.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;assets/js/artDialog/skins/default.css&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>上海项目<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">html</span>, <span class="selector-tag">body</span>, <span class="selector-id">#allmap</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">height</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.input-card</span> <span class="selector-class">.btn</span>&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin-right</span>: <span class="number">1.2rem</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>: <span class="number">9rem</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.input-card</span> <span class="selector-class">.btn</span><span class="selector-pseudo">:last-child</span>&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin-right</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.input</span>&#123;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            -web-kit-appearance:none;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            -moz-appearance: none;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="attribute">font-size</span>:<span class="number">1.4em</span>;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="attribute">height</span>:<span class="number">2.0em</span>;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="attribute">border-radius</span>:<span class="number">5px</span>;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="attribute">border</span>:<span class="number">1px</span> solid <span class="number">#c8cccf</span>;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="attribute">color</span>:<span class="number">#6a6f77</span>;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="attribute">outline</span>:<span class="number">0</span>;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;data_bodey&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;index_nav&quot;</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">style</span>=<span class="string">&quot;height: 30px; margin-bottom: 0px;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;l_left total_chose_fr&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;index.html&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: #dbe9f1&quot;</span>&gt;</span>实时监测<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;l_left total_chose_pl&quot;</span> &gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;index1.html&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: #dbe9f1&quot;</span>&gt;</span>统计分析二<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;r_right total_chose_pl nav_active&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;index3.html&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: #dbe9f1&quot;</span>&gt;</span>小车运行<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;r_right total_chose_pl&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;index2.html&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: #dbe9f1&quot;</span>&gt;</span>统计分析四<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;index_tabs&quot;</span> &gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--完成--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;inner&quot;</span>  &gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder01 cage_cl&quot;</span> <span class="attr">style</span>=<span class="string">&quot; !important; height: 105%; position: relative;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder02&quot;</span> <span class="attr">style</span>=<span class="string">&quot;position: relative; overflow: hidden;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;allmap&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;http://api.map.baidu.com/api?v=2.0&amp;ak=5ieMMexWmzB9jivTq6oCRX9j&amp;callback&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 百度地图API功能</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> map=<span class="keyword">new</span> <span class="title class_">BMap</span>.<span class="title class_">Map</span>(<span class="string">&quot;allmap&quot;</span>); <span class="comment">// 创建map实例</span></span></span><br><span class="line"><span class="language-javascript">    map.<span class="title function_">centerAndZoom</span>(<span class="keyword">new</span> <span class="title class_">BMap</span>.<span class="title class_">Point</span>(<span class="number">121.53135</span>, <span class="number">31.165419</span>), <span class="number">13</span>);<span class="comment">// 初始化地图,设置中心点坐标和地图级别</span></span></span><br><span class="line"><span class="language-javascript">    map.<span class="title function_">enableScrollWheelZoom</span>(<span class="literal">true</span>);<span class="comment">//鼠标滚轮缩放</span></span></span><br><span class="line"><span class="language-javascript">    map.<span class="title function_">addControl</span>(<span class="keyword">new</span> <span class="title class_">BMap</span>.<span class="title class_">MapTypeControl</span>()); <span class="comment">//添加切换地图类型附件</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> time =<span class="number">3000</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> <span class="title class_">CartArr</span> = []</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> <span class="title class_">IDArr</span> = []<span class="comment">//存的是每个小车的id</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> <span class="title class_">Arr</span> = []<span class="comment">//获取传过来封装好的小车起始和终点的数据</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> <span class="title class_">Arr2</span> = &#123;&#125;<span class="comment">//每个小车都在这个对象里有对应的数组数据（起始和终点）</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> <span class="title class_">PointArr1</span> = &#123;&#125;<span class="comment">//每个小车都在这个对象里有对应的数组数据（通过百度地图解析的路径）</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> myIcon=<span class="keyword">new</span> <span class="title class_">BMap</span>.<span class="title class_">Icon</span>(<span class="string">&quot;./assets/img/cars.png&quot;</span>, <span class="keyword">new</span> <span class="title class_">BMap</span>.<span class="title class_">Size</span>(<span class="number">20</span>, <span class="number">20</span>), &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">offset</span>: <span class="keyword">new</span> <span class="title class_">BMap</span>.<span class="title class_">Size</span>(<span class="number">20</span>,<span class="number">20</span>),</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//相当于CSS精灵</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">imageOffset</span>: <span class="keyword">new</span> <span class="title class_">BMap</span>.<span class="title class_">Size</span>(<span class="number">0</span>, <span class="number">0</span>)</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//图片的偏移量。为了是图片底部中心对准坐标点。</span></span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> carMks=[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">19</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">22</span>,<span class="number">23</span>,<span class="number">24</span>,<span class="number">25</span>,<span class="number">26</span>,<span class="number">27</span>,<span class="number">28</span>,<span class="number">29</span>,<span class="number">30</span>,<span class="number">31</span>, <span class="number">32</span>,  <span class="number">33</span>,  <span class="number">34</span>,  <span class="number">35</span>,  <span class="number">36</span>,  <span class="number">37</span>,  <span class="number">38</span>,  <span class="number">39</span>,  <span class="number">40</span>,  <span class="number">41</span>,  <span class="number">42</span>,  <span class="number">43</span>,  <span class="number">44</span>,  <span class="number">45</span>,  <span class="number">46</span>,  <span class="number">47</span>,  <span class="number">48</span>,  <span class="number">49</span>,  <span class="number">50</span>,  <span class="number">51</span>,  <span class="number">52</span>,  <span class="number">53</span>,  <span class="number">54</span>,  <span class="number">55</span>,  <span class="number">56</span>,  <span class="number">57</span>,  <span class="number">58</span>,  <span class="number">59</span>,  <span class="number">60</span>,  <span class="number">61</span>,  <span class="number">62</span>,  <span class="number">63</span>,  <span class="number">64</span>,  <span class="number">65</span>,  <span class="number">66</span>,  <span class="number">67</span>,  <span class="number">68</span>,  <span class="number">69</span>,  <span class="number">70</span>,  <span class="number">71</span>,  <span class="number">72</span>,  <span class="number">73</span>,  <span class="number">74</span>,  <span class="number">75</span>,  <span class="number">76</span>,  <span class="number">77</span>,  <span class="number">78</span>,  <span class="number">79</span>,  <span class="number">80</span>,  <span class="number">81</span>,  <span class="number">82</span>,  <span class="number">83</span>,  <span class="number">84</span>,  <span class="number">85</span>,  <span class="number">86</span>,  <span class="number">87</span>,  <span class="number">88</span>,  <span class="number">89</span>,  <span class="number">90</span>,  <span class="number">91</span>,  <span class="number">92</span>,  <span class="number">93</span>,  <span class="number">94</span>,  <span class="number">95</span>,  <span class="number">96</span>,  <span class="number">97</span>,  <span class="number">98</span>,  <span class="number">99</span>,  <span class="number">100</span>, <span class="number">101</span>, <span class="number">102</span>, <span class="number">103</span>, <span class="number">104</span>, <span class="number">105</span>, <span class="number">106</span>, <span class="number">107</span>, <span class="number">108</span>, <span class="number">109</span>, <span class="number">110</span>, <span class="number">111</span>, <span class="number">112</span>, <span class="number">113</span>, <span class="number">114</span>, <span class="number">115</span>, <span class="number">116</span>, <span class="number">117</span>, <span class="number">118</span>, <span class="number">119</span>, <span class="number">120</span>, <span class="number">121</span>, <span class="number">122</span>, <span class="number">123</span>, <span class="number">124</span>, <span class="number">125</span>, <span class="number">126</span>, <span class="number">127</span>, <span class="number">128</span>, <span class="number">129</span>, <span class="number">130</span>, <span class="number">131</span>, <span class="number">132</span>, <span class="number">133</span>, <span class="number">134</span>, <span class="number">135</span>, <span class="number">136</span>, <span class="number">137</span>, <span class="number">138</span>, <span class="number">139</span>, <span class="number">140</span>, <span class="number">141</span>, <span class="number">142</span>, <span class="number">143</span>, <span class="number">144</span>, <span class="number">145</span>, <span class="number">146</span>, <span class="number">147</span>, <span class="number">148</span>, <span class="number">149</span>, <span class="number">150</span>, <span class="number">151</span>, <span class="number">152</span>, <span class="number">153</span>, <span class="number">154</span>, <span class="number">155</span>, <span class="number">156</span>, <span class="number">157</span>, <span class="number">158</span>, <span class="number">159</span>, <span class="number">160</span>, <span class="number">161</span>, <span class="number">162</span>, <span class="number">163</span>, <span class="number">164</span>, <span class="number">165</span>, <span class="number">166</span>, <span class="number">167</span>, <span class="number">168</span>, <span class="number">169</span>, <span class="number">170</span>, <span class="number">171</span>, <span class="number">172</span>, <span class="number">173</span>, <span class="number">174</span>, <span class="number">175</span>, <span class="number">176</span>, <span class="number">177</span>, <span class="number">178</span>, <span class="number">179</span>, <span class="number">180</span>, <span class="number">181</span>, <span class="number">182</span>, <span class="number">183</span>, <span class="number">184</span>, <span class="number">185</span>, <span class="number">186</span>, <span class="number">187</span>, <span class="number">188</span>, <span class="number">189</span>, <span class="number">190</span>, <span class="number">191</span>, <span class="number">192</span>, <span class="number">193</span>, <span class="number">194</span>, <span class="number">195</span>, <span class="number">196</span>, <span class="number">197</span>, <span class="number">198</span>, <span class="number">199</span>, <span class="number">200</span>,];<span class="comment">//设置车辆图标</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> <span class="title class_">Is</span>=[<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>];<span class="comment">//循环小车的数组使用</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//小车行驶图标</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//终点图标</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> terminalPoint = myIcon;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setInterval</span>(<span class="keyword">function</span> <span class="title function_">getCars</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">async</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">url</span>: <span class="string">&quot;/ShangHai/CartServlet&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">type</span>: <span class="string">&#x27;post&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">dataType</span>: <span class="string">&#x27;json&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">result</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">for</span> (<span class="keyword">let</span> k = <span class="number">0</span>; k &lt; result.<span class="property">col</span>.<span class="property">length</span>; k++) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">if</span> (!<span class="title class_">CartArr</span>.<span class="title function_">includes</span>(result.<span class="property">col</span>[k].<span class="property">id</span>))&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="title class_">CartArr</span>.<span class="title function_">push</span>(result.<span class="property">col</span>[k].<span class="property">id</span>);</span></span><br><span class="line"><span class="language-javascript">                        <span class="comment">//carMks.push(result.col[k].id);</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                    id1 = result.<span class="property">col</span>[k].<span class="property">id</span>;</span></span><br><span class="line"><span class="language-javascript">                    status = result.<span class="property">col</span>[k].<span class="property">status</span>;</span></span><br><span class="line"><span class="language-javascript">                    lng = result.<span class="property">col</span>[k].<span class="property">lng</span>;</span></span><br><span class="line"><span class="language-javascript">                    lat = result.<span class="property">col</span>[k].<span class="property">lat</span>;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">let</span> <span class="title class_">Arr1</span> = &#123;status,lng,lat,id1&#125;</span></span><br><span class="line"><span class="language-javascript">                    <span class="title class_">Arr</span>.<span class="title function_">push</span>(<span class="title class_">Arr1</span>)</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">                <span class="title class_">Arr2</span>[id1] = <span class="title class_">Arr</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="title class_">Arr</span> = []</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// for (let k = 0; k &lt; result.col.length; k++) &#123;</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//     if (!CartArr.includes(result.col[k].id))&#123;</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//         CartArr.push(result.col[k].id);</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//         carMks.push(result.col[k].id);</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//     &#125;</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//     PointArr.push(result.col[k]);</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// &#125;</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">    &#125;,<span class="number">500</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> id;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> j = <span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> i = <span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> s = <span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">startAnimation</span> () &#123;</span></span><br><span class="line"><span class="language-javascript">        time = time/<span class="number">2</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (time &lt;<span class="number">10</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            time =<span class="number">10</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">pauseAnimation</span> () &#123;</span></span><br><span class="line"><span class="language-javascript">        time = time*<span class="number">2</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setInterval</span>(<span class="keyword">function</span> <span class="title function_">start1</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// //终点</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// if(Arr2[id1][1].lon==Arr2[id1][0].lon&amp;&amp;Arr2[id1][1].lat==Arr2[id1][0].lat)&#123;</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//     //相同点，则不需要画图</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//     return;</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// &#125;</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">renderLastPoint</span>();</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    &#125;,<span class="number">700</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">renderLastPoint</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> driving=<span class="keyword">new</span> <span class="title class_">BMap</span>.<span class="title class_">DrivingRoute</span>(map);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> sp = <span class="keyword">new</span> <span class="title class_">BMap</span>.<span class="title class_">Point</span>(<span class="title class_">Arr2</span>[id1][<span class="number">0</span>].<span class="property">lng</span>, <span class="title class_">Arr2</span>[id1][<span class="number">0</span>].<span class="property">lat</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> ep = <span class="keyword">new</span> <span class="title class_">BMap</span>.<span class="title class_">Point</span>(<span class="title class_">Arr2</span>[id1][<span class="number">1</span>].<span class="property">lng</span>, <span class="title class_">Arr2</span>[id1][<span class="number">1</span>].<span class="property">lat</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//设置新的开始点</span></span></span><br><span class="line"><span class="language-javascript">        driving.<span class="title function_">search</span>(sp, ep);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        driving.<span class="title function_">setSearchCompleteCallback</span>(<span class="keyword">function</span>(<span class="params">res</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span>(driving.<span class="title function_">getStatus</span>()==<span class="variable constant_">BMAP_STATUS_SUCCESS</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//获取两点之间的实际点组</span></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> plan=res.<span class="title function_">getPlan</span>(<span class="number">0</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> arrPois=[];</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">for</span>(<span class="keyword">var</span> j=<span class="number">0</span>;j&lt;plan.<span class="title function_">getNumRoutes</span>();j++)&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> route=plan.<span class="title function_">getRoute</span>(j);</span></span><br><span class="line"><span class="language-javascript">                    arrPois=arrPois.<span class="title function_">concat</span>(route.<span class="title function_">getPath</span>());</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">let</span> <span class="title class_">PointAee</span> = []</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">for</span> (<span class="keyword">let</span> k = <span class="number">0</span>; k &lt; arrPois.<span class="property">length</span> ; k++) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">if</span> (k &lt;=arrPois.<span class="property">length</span>-<span class="number">2</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                        status = <span class="title class_">Arr2</span>[id1][<span class="number">0</span>].<span class="property">status</span>;</span></span><br><span class="line"><span class="language-javascript">                    &#125;<span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                        status = <span class="literal">null</span>;</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                    lng = arrPois[k].<span class="property">lng</span>;</span></span><br><span class="line"><span class="language-javascript">                    lat = arrPois[k].<span class="property">lat</span>;</span></span><br><span class="line"><span class="language-javascript">                    id = <span class="title class_">Arr2</span>[id1][<span class="number">1</span>].<span class="property">id1</span>;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">if</span> (!<span class="title class_">IDArr</span>.<span class="title function_">includes</span>(id))&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="title class_">IDArr</span>.<span class="title function_">push</span>(id);</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">let</span> <span class="title class_">PointAww</span> = &#123;status,lng,lat,id&#125;</span></span><br><span class="line"><span class="language-javascript">                    <span class="title class_">PointAee</span>.<span class="title function_">push</span>(<span class="title class_">PointAww</span>)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">// if (!CartArr.includes(PointArr[1].id))&#123;</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">//     CartArr.push(PointArr[1].id);</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">//</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">//     carMks.push(PointArr[1].id);</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">// &#125;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">                <span class="title class_">PointArr1</span>[id] = <span class="title class_">PointAee</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> interval = <span class="built_in">setInterval</span>(fn, time);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// clearInterval(interval);</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">IDArr</span>.<span class="property">length</span>)</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">IDArr</span>)</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">for</span> (<span class="keyword">var</span> b = <span class="number">0</span>; b &lt; <span class="title class_">IDArr</span>.<span class="property">length</span>; b++) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (<span class="title class_">PointArr1</span>[<span class="title class_">IDArr</span>[b]][<span class="title class_">Is</span>[b]])&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">drawLine</span>(map,<span class="title class_">PointArr1</span>[<span class="title class_">IDArr</span>[b]][<span class="title class_">Is</span>[b]],<span class="title class_">PointArr1</span>[<span class="title class_">IDArr</span>[b]][<span class="title class_">Is</span>[b]+<span class="number">1</span>],<span class="title class_">CartArr</span>);<span class="comment">//画线调用</span></span></span><br><span class="line"><span class="language-javascript">            &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="title class_">PointArr1</span>[<span class="title class_">IDArr</span>[b]] = [];</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="title class_">Is</span>[b]++</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            interval = <span class="built_in">setInterval</span>(fn, time);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 划线</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">drawLine</span>(<span class="params">map,pointArr,pointArrNext,CartArr</span>) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (pointArrNext != <span class="literal">undefined</span>) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (<span class="title class_">CartArr</span>.<span class="title function_">includes</span>(pointArr.<span class="property">id</span>)) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">addMarkerEnd</span>(<span class="keyword">new</span> <span class="title class_">BMap</span>.<span class="title class_">Point</span>(pointArrNext.<span class="property">lng</span>, pointArrNext.<span class="property">lat</span>), pointArrNext.<span class="property">status</span>, map, pointArrNext, <span class="keyword">new</span> <span class="title class_">BMap</span>.<span class="title class_">Point</span>(pointArr.<span class="property">lng</span>, pointArr.<span class="property">lat</span>));<span class="comment">//添加图标</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">addMarkerEnd</span>(<span class="params">point, name, mapInit, trackUnit, prePoint,</span>) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// res = carMks.indexOf(trackUnit.id)</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (name === <span class="string">&quot;false&quot;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span> (carMks[trackUnit.<span class="property">id</span>]) &#123;<span class="comment">//先判断第一次进来的时候这个值有没有定义，有的话就清除掉上一次的。然后在进行画图标。第一次进来时候没有定义也就不走这块，直接进行画图标</span></span></span><br><span class="line"><span class="language-javascript">                    mapInit.<span class="title function_">removeOverlay</span>(carMks[trackUnit.<span class="property">id</span>]);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">                carMks[trackUnit.<span class="property">id</span>] = <span class="keyword">new</span> <span class="title class_">BMap</span>.<span class="title class_">Marker</span>(point, &#123;<span class="attr">icon</span>: terminalPoint&#125;);  <span class="comment">// 创建标注</span></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> label = <span class="keyword">new</span> <span class="title class_">BMap</span>.<span class="title class_">Label</span>(trackUnit.<span class="property">id</span>, &#123;<span class="attr">offset</span>: <span class="keyword">new</span> <span class="title class_">BMap</span>.<span class="title class_">Size</span>(<span class="number">10</span>, -<span class="number">30</span>)&#125;);</span></span><br><span class="line"><span class="language-javascript">                label.<span class="title function_">setStyle</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">width</span>:<span class="string">&quot;20px&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">textAlign</span>: <span class="string">&quot;center&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">border</span>: <span class="string">&quot;1px solid rgb(204, 204, 204)&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">color</span>: <span class="string">&quot;rgb(0, 0, 0)&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">borderRadius</span>: <span class="string">&quot;10px&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">padding</span>: <span class="string">&quot;10px&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">background</span>: <span class="string">&quot;rgb(255, 255, 255)&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript">                carMks[trackUnit.<span class="property">id</span>].<span class="title function_">setLabel</span>(label);</span></span><br><span class="line"><span class="language-javascript">                mapInit.<span class="title function_">addOverlay</span>(carMks[trackUnit.<span class="property">id</span>]);               <span class="comment">// 将标注添加到地图中</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            &#125; <span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="language-javascript">                mapInit.<span class="title function_">removeOverlay</span>(carMks[trackUnit.<span class="property">id</span>]);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="小车运行前一次性传过来代码"><a href="#小车运行前一次性传过来代码" class="headerlink" title="小车运行前一次性传过来代码"></a>小车运行前一次性传过来代码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;assets/css/BigData.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;assets/css/index.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;assets/css/index01.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;assets/js/jquery.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://a.amap.com/jsapi_demos/static/demo-center/css/demo-center.css&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;assets/js/bstable/css/bootstrap.min.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;assets/js/bstable/css/bootstrap-table.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;assets/css/Security_operation.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;assets/js/artDialog/skins/default.css&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>上海项目<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">html</span>, <span class="selector-tag">body</span>, <span class="selector-id">#allmap</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">height</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.input-card</span> <span class="selector-class">.btn</span>&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin-right</span>: <span class="number">1.2rem</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>: <span class="number">9rem</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.input-card</span> <span class="selector-class">.btn</span><span class="selector-pseudo">:last-child</span>&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin-right</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.input</span>&#123;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            -web-kit-appearance:none;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            -moz-appearance: none;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="attribute">font-size</span>:<span class="number">1.4em</span>;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="attribute">height</span>:<span class="number">2.0em</span>;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="attribute">border-radius</span>:<span class="number">5px</span>;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="attribute">border</span>:<span class="number">1px</span> solid <span class="number">#c8cccf</span>;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="attribute">color</span>:<span class="number">#6a6f77</span>;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="attribute">outline</span>:<span class="number">0</span>;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;data_bodey&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;index_nav&quot;</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">style</span>=<span class="string">&quot;height: 30px; margin-bottom: 0px;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;l_left total_chose_fr&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;index.html&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: #dbe9f1&quot;</span>&gt;</span>实时监测<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;l_left total_chose_pl&quot;</span> &gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;index1.html&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: #dbe9f1&quot;</span>&gt;</span>统计分析二<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;r_right total_chose_pl nav_active&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;index3备份.html&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: #dbe9f1&quot;</span>&gt;</span>统计分析三<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;r_right total_chose_pl&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;index2.html&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: #dbe9f1&quot;</span>&gt;</span>统计分析四<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;index_tabs&quot;</span> &gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--完成--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;inner&quot;</span>  &gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder01 cage_cl&quot;</span> <span class="attr">style</span>=<span class="string">&quot; !important; height: 105%; position: relative;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataAllBorder02&quot;</span> <span class="attr">style</span>=<span class="string">&quot;position: relative; overflow: hidden;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;allmap&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;input-card&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">h4</span>&gt;</span>小车运行控制<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;input-item&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span> <span class="attr">value</span>=<span class="string">&quot;开始&quot;</span> <span class="attr">id</span>=<span class="string">&quot;start1&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;start1()&quot;</span>/&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span> <span class="attr">value</span>=<span class="string">&quot;结束&quot;</span> <span class="attr">id</span>=<span class="string">&quot;pause1&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;pausen()&quot;</span>/&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;input-item&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span> <span class="attr">value</span>=<span class="string">&quot;速度x2&quot;</span> <span class="attr">id</span>=<span class="string">&quot;start&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;startAnimation()&quot;</span>/&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span> <span class="attr">value</span>=<span class="string">&quot;速度÷2&quot;</span> <span class="attr">id</span>=<span class="string">&quot;pause&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;pauseAnimation()&quot;</span>/&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;http://api.map.baidu.com/api?v=2.0&amp;ak=5ieMMexWmzB9jivTq6oCRX9j&amp;callback&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 百度地图API功能</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> map=<span class="keyword">new</span> <span class="title class_">BMap</span>.<span class="title class_">Map</span>(<span class="string">&quot;allmap&quot;</span>); <span class="comment">// 创建map实例</span></span></span><br><span class="line"><span class="language-javascript">    map.<span class="title function_">centerAndZoom</span>(<span class="keyword">new</span> <span class="title class_">BMap</span>.<span class="title class_">Point</span>(<span class="number">121.53135</span>, <span class="number">31.165419</span>), <span class="number">13</span>);<span class="comment">// 初始化地图,设置中心点坐标和地图级别</span></span></span><br><span class="line"><span class="language-javascript">    map.<span class="title function_">enableScrollWheelZoom</span>(<span class="literal">true</span>);<span class="comment">//鼠标滚轮缩放</span></span></span><br><span class="line"><span class="language-javascript">    map.<span class="title function_">addControl</span>(<span class="keyword">new</span> <span class="title class_">BMap</span>.<span class="title class_">MapTypeControl</span>()); <span class="comment">//添加切换地图类型附件</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> time =<span class="number">4000</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> <span class="title class_">PointArr</span> = [</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// &#123;id:&quot;c1&quot;,lng:116.297611,lat:40.047363,status:200&#125;,</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// &#123;id:&quot;c1&quot;,lng:116.307223,lat:40.056379,status:null&#125;,</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// &#123;id:&quot;car2&quot;,lng:116.307223,lat:40.056379,status:null&#125;,</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// &#123;id:&quot;car2&quot;,lng:116.268751,lat:40.045313,status:400&#125;,</span></span></span><br><span class="line"><span class="language-javascript">    ]</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> <span class="title class_">CartArr</span> = []</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> <span class="title class_">IDArr</span> = []</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> <span class="title class_">Arr</span> = []</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> <span class="title class_">Arr2</span> = &#123;&#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> myIcon=<span class="keyword">new</span> <span class="title class_">BMap</span>.<span class="title class_">Icon</span>(<span class="string">&quot;./assets/img/cars.png&quot;</span>, <span class="keyword">new</span> <span class="title class_">BMap</span>.<span class="title class_">Size</span>(<span class="number">20</span>, <span class="number">20</span>), &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">offset</span>: <span class="keyword">new</span> <span class="title class_">BMap</span>.<span class="title class_">Size</span>(<span class="number">20</span>,<span class="number">20</span>),</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//相当于CSS精灵</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">imageOffset</span>: <span class="keyword">new</span> <span class="title class_">BMap</span>.<span class="title class_">Size</span>(<span class="number">0</span>, <span class="number">0</span>)</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//图片的偏移量。为了是图片底部中心对准坐标点。</span></span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> carMks=[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">19</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">22</span>,<span class="number">23</span>,<span class="number">24</span>,<span class="number">25</span>,<span class="number">26</span>,<span class="number">27</span>,<span class="number">28</span>,<span class="number">29</span>,<span class="number">30</span>];<span class="comment">//设置车辆图标</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//小车行驶图标</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//终点图标</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> terminalPoint = myIcon;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setInterval</span>(<span class="keyword">function</span> <span class="title function_">getCars</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">async</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">url</span>: <span class="string">&quot;/ShangHai/CartServlet&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">type</span>: <span class="string">&#x27;post&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">dataType</span>: <span class="string">&#x27;json&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">result</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//console.log(result)</span></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">for</span> (<span class="keyword">let</span> k = <span class="number">0</span>; k &lt; result.<span class="property">col</span>.<span class="property">length</span>; k++) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">if</span> (!<span class="title class_">CartArr</span>.<span class="title function_">includes</span>(result.<span class="property">col</span>[k].<span class="property">id</span>))&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="title class_">CartArr</span>.<span class="title function_">push</span>(result.<span class="property">col</span>[k].<span class="property">id</span>);</span></span><br><span class="line"><span class="language-javascript">                        <span class="comment">//carMks.push(result.col[k].id);</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                    id1 = result.<span class="property">col</span>[k].<span class="property">id</span>;</span></span><br><span class="line"><span class="language-javascript">                    status = result.<span class="property">col</span>[k].<span class="property">status</span>;</span></span><br><span class="line"><span class="language-javascript">                    lng = result.<span class="property">col</span>[k].<span class="property">lng</span>;</span></span><br><span class="line"><span class="language-javascript">                    lat = result.<span class="property">col</span>[k].<span class="property">lat</span>;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">let</span> <span class="title class_">Arr1</span> = &#123;status,lng,lat,id1&#125;</span></span><br><span class="line"><span class="language-javascript">                    <span class="title class_">Arr</span>.<span class="title function_">push</span>(<span class="title class_">Arr1</span>)</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">                <span class="title class_">Arr2</span>[id1] = <span class="title class_">Arr</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="title class_">Arr</span> = []</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// for (let k = 0; k &lt; result.col.length; k++) &#123;</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//     if (!CartArr.includes(result.col[k].id))&#123;</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//         CartArr.push(result.col[k].id);</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//         carMks.push(result.col[k].id);</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//     &#125;</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//     PointArr.push(result.col[k]);</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// &#125;</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//     console.log(PointArr)</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">    &#125;,<span class="number">500</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> <span class="title class_">PointArr1</span> = &#123;&#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> id;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> j = <span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> i = <span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> s = <span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">startAnimation</span> () &#123;</span></span><br><span class="line"><span class="language-javascript">        time = time/<span class="number">2</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (time &lt;<span class="number">10</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            time =<span class="number">10</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">pauseAnimation</span> () &#123;</span></span><br><span class="line"><span class="language-javascript">        time = time*<span class="number">2</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setInterval</span>(<span class="keyword">function</span> <span class="title function_">start1</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// //终点</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// if(Arr2[id1][1].lon==Arr2[id1][0].lon&amp;&amp;Arr2[id1][1].lat==Arr2[id1][0].lat)&#123;</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//     //相同点，则不需要画图</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//     return;</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// &#125;</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">renderLastPoint</span>();</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    &#125;,<span class="number">700</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">renderLastPoint</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> driving=<span class="keyword">new</span> <span class="title class_">BMap</span>.<span class="title class_">DrivingRoute</span>(map);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> sp = <span class="keyword">new</span> <span class="title class_">BMap</span>.<span class="title class_">Point</span>(<span class="title class_">Arr2</span>[id1][<span class="number">0</span>].<span class="property">lng</span>, <span class="title class_">Arr2</span>[id1][<span class="number">0</span>].<span class="property">lat</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> ep = <span class="keyword">new</span> <span class="title class_">BMap</span>.<span class="title class_">Point</span>(<span class="title class_">Arr2</span>[id1][<span class="number">1</span>].<span class="property">lng</span>, <span class="title class_">Arr2</span>[id1][<span class="number">1</span>].<span class="property">lat</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//设置新的开始点</span></span></span><br><span class="line"><span class="language-javascript">        driving.<span class="title function_">search</span>(sp, ep);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        driving.<span class="title function_">setSearchCompleteCallback</span>(<span class="keyword">function</span>(<span class="params">res</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span>(driving.<span class="title function_">getStatus</span>()==<span class="variable constant_">BMAP_STATUS_SUCCESS</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//获取两点之间的实际点组</span></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> plan=res.<span class="title function_">getPlan</span>(<span class="number">0</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> arrPois=[];</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">for</span>(<span class="keyword">var</span> j=<span class="number">0</span>;j&lt;plan.<span class="title function_">getNumRoutes</span>();j++)&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> route=plan.<span class="title function_">getRoute</span>(j);</span></span><br><span class="line"><span class="language-javascript">                    arrPois=arrPois.<span class="title function_">concat</span>(route.<span class="title function_">getPath</span>());</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">let</span> <span class="title class_">PointAee</span> = []</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">for</span> (<span class="keyword">let</span> k = <span class="number">0</span>; k &lt; arrPois.<span class="property">length</span> ; k++) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">if</span> (k &lt;=arrPois.<span class="property">length</span>-<span class="number">2</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                        status = <span class="title class_">Arr2</span>[id1][<span class="number">0</span>].<span class="property">status</span>;</span></span><br><span class="line"><span class="language-javascript">                    &#125;<span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                        status = <span class="literal">null</span>;</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                    lng = arrPois[k].<span class="property">lng</span>;</span></span><br><span class="line"><span class="language-javascript">                    lat = arrPois[k].<span class="property">lat</span>;</span></span><br><span class="line"><span class="language-javascript">                    id = <span class="title class_">Arr2</span>[id1][<span class="number">1</span>].<span class="property">id1</span>;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">if</span> (!<span class="title class_">IDArr</span>.<span class="title function_">includes</span>(id))&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="title class_">IDArr</span>.<span class="title function_">push</span>(id);</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">let</span> <span class="title class_">PointAww</span> = &#123;status,lng,lat,id&#125;</span></span><br><span class="line"><span class="language-javascript">                    <span class="title class_">PointAee</span>.<span class="title function_">push</span>(<span class="title class_">PointAww</span>)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">// if (!CartArr.includes(PointArr[1].id))&#123;</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">//     CartArr.push(PointArr[1].id);</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">//</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">//     carMks.push(PointArr[1].id);</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">// &#125;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">                <span class="title class_">PointArr1</span>[id] = <span class="title class_">PointAee</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> interval = <span class="built_in">setInterval</span>(fn, time);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="built_in">clearInterval</span>(interval);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">for</span> (<span class="keyword">var</span> b = <span class="number">0</span>; b &lt; <span class="title class_">IDArr</span>.<span class="property">length</span>; b++) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">drawLine</span>(map,<span class="title class_">PointArr1</span>[<span class="title class_">IDArr</span>[b]][i],<span class="title class_">PointArr1</span>[<span class="title class_">IDArr</span>[b]][i+<span class="number">1</span>],<span class="title class_">CartArr</span>);<span class="comment">//画线调用</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        i = i + <span class="number">1</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            interval = <span class="built_in">setInterval</span>(fn, time);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 划线</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">drawLine</span>(<span class="params">map,pointArr,pointArrNext,CartArr</span>) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (pointArrNext != <span class="literal">undefined</span>) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (<span class="title class_">CartArr</span>.<span class="title function_">includes</span>(pointArr.<span class="property">id</span>)) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">addMarkerEnd</span>(<span class="keyword">new</span> <span class="title class_">BMap</span>.<span class="title class_">Point</span>(pointArrNext.<span class="property">lng</span>, pointArrNext.<span class="property">lat</span>), pointArrNext.<span class="property">status</span>, map, pointArrNext, <span class="keyword">new</span> <span class="title class_">BMap</span>.<span class="title class_">Point</span>(pointArr.<span class="property">lng</span>, pointArr.<span class="property">lat</span>));<span class="comment">//添加图标</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">addMarkerEnd</span>(<span class="params">point, name, mapInit, trackUnit, prePoint,</span>) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// res = carMks.findIndex(function(value) &#123;</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//       return value == trackUnit.id;</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//   &#125;)</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// res = carMks.indexOf(trackUnit.id)</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (name === <span class="string">&quot;false&quot;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(carMks)</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span> (carMks[trackUnit.<span class="property">id</span>]) &#123;<span class="comment">//先判断第一次进来的时候这个值有没有定义，有的话就清除掉上一次的。然后在进行画图标。第一次进来时候没有定义也就不走这块，直接进行画图标</span></span></span><br><span class="line"><span class="language-javascript">                    mapInit.<span class="title function_">removeOverlay</span>(carMks[trackUnit.<span class="property">id</span>]);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">                carMks[trackUnit.<span class="property">id</span>] = <span class="keyword">new</span> <span class="title class_">BMap</span>.<span class="title class_">Marker</span>(point, &#123;<span class="attr">icon</span>: terminalPoint&#125;);  <span class="comment">// 创建标注</span></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> label = <span class="keyword">new</span> <span class="title class_">BMap</span>.<span class="title class_">Label</span>(trackUnit.<span class="property">id</span>, &#123;<span class="attr">offset</span>: <span class="keyword">new</span> <span class="title class_">BMap</span>.<span class="title class_">Size</span>(<span class="number">10</span>, -<span class="number">30</span>)&#125;);</span></span><br><span class="line"><span class="language-javascript">                label.<span class="title function_">setStyle</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">width</span>:<span class="string">&quot;20px&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">textAlign</span>: <span class="string">&quot;center&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">border</span>: <span class="string">&quot;1px solid rgb(204, 204, 204)&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">color</span>: <span class="string">&quot;rgb(0, 0, 0)&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">borderRadius</span>: <span class="string">&quot;10px&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">padding</span>: <span class="string">&quot;10px&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">background</span>: <span class="string">&quot;rgb(255, 255, 255)&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript">                carMks[trackUnit.<span class="property">id</span>].<span class="title function_">setLabel</span>(label);</span></span><br><span class="line"><span class="language-javascript">                mapInit.<span class="title function_">addOverlay</span>(carMks[trackUnit.<span class="property">id</span>]);               <span class="comment">// 将标注添加到地图中</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            &#125; <span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="language-javascript">                mapInit.<span class="title function_">removeOverlay</span>(carMks[trackUnit.<span class="property">id</span>]);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//获</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="web-xml代码"><a href="#web-xml代码" class="headerlink" title="web.xml代码"></a>web.xml代码</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>data1Servlet<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>data1Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>data.data1Servlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>data1Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/data1Servlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>data2Servlet<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>data2Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>data.data2Servlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>data2Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/data2Servlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>data5Servlet<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>data5Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>data.data5Servlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>data5Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/data5Servlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>data4Servlet<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>data4Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>data.data4Servlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>data4Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/data4Servlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>data3Servlet<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>data3Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>data.data3Servlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>data3Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/data3Servlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>data6Servlet<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>data6Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>data.data6Servlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>data6Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/data6Servlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>data7Servlet<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>data7Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>data.data7Servlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>data7Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/data7Servlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>data8Servlet<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>data8Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>data.data8Servlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>data8Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/data8Servlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>data9Servlet<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>data9Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>data.data9Servlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>data9Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/data9Servlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>typhoonServlet<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>typhoonServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.typhoonServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>typhoonServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/typhoonServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>SelectBar1Servlet<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>SelectBar1Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>data.data1Servlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>SelectBar1Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/SelectBar1Servlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>quakeServlet<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>quakeServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.quakeServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>quakeServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/quakeServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>fireServlet<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>fireServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.fireServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>fireServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/fireServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>transferDailyServlet<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>transferDailyServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.transferDailyServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>transferDailyServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/transferDailyServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>releaseDailyServlet<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>releaseDailyServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.releaseDailyServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>releaseDailyServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/releaseDailyServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>transferSpareServlet<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>transferSpareServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.transferSpareServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>transferSpareServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/transferSpareServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>releaseSpareServlet<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>releaseSpareServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.releaseSpareServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>releaseSpareServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/releaseSpareServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>districtServlet<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>districtServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.districtServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>districtServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/districtServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>district1Servlet<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>district1Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.district1Servlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>district1Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/district1Servlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>district2Servlet<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>district2Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.district2Servlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>district2Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/district2Servlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>HertServlet<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HertServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.HertServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HertServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/HertServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>lngsServlet<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>lngsServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.lngsServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>lngsServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/lngsServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>lngs1Servlet<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>lngs1Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.lngs1Servlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>lngs1Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/lngs1Servlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>lngs2Servlet<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>lngs2Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.lngs2Servlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>lngs2Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/lngs2Servlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>lngs3Servlet<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>lngs3Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.lngs3Servlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>lngs3Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/lngs3Servlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>CartServlet<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>CartServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.CartServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>CartServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/CartServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>latsServlet<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>latsServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.latsServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>latsServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/latsServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>lats1Servlet<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>lats1Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.lats1Servlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>lats1Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/lats1Servlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>lats2Servlet<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>lats2Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.lats2Servlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>lats2Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/lats2Servlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>mdata1Servlet<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>mdata1Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>mdata.mdata1Servlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>mdata1Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/mdata1Servlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>mdata2Servlet<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>mdata2Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>mdata.mdata2Servlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>mdata2Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/mdata2Servlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>mdata3Servlet<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>mdata3Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>mdata.mdata3Servlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>mdata3Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/mdata3Servlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>mdata4Servlet<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>mdata4Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>mdata.mdata4Servlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>mdata4Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/mdata4Servlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>mdata5Servlet<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>mdata5Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>mdata.mdata5Servlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>mdata5Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/mdata5Servlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>mdata6Servlet<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>mdata6Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>mdata.mdata6Servlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>mdata6Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/mdata6Servlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>mdata7Servlet<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>mdata7Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>mdata.mdata7Servlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>mdata7Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/mdata7Servlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>mdata8Servlet<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>mdata8Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>mdata.mdata8Servlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>mdata8Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/mdata8Servlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>mdata9Servlet<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>mdata9Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>mdata.mdata9Servlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>mdata9Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/mdata9Servlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>mdata10Servlet<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>mdata10Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>mdata.mdata10Servlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>mdata10Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/mdata10Servlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>mdata11Servlet<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>mdata11Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>mdata.mdata11Servlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>mdata11Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/mdata11Servlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>mdata12Servlet<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>mdata12Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>mdata.mdata12Servlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>mdata12Servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/mdata12Servlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure><p>注：用的大数据模板</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;一、说明文档&quot;&gt;&lt;a href=&quot;#一、说明文档&quot; class=&quot;headerlink&quot; title=&quot;一、说明文档&quot;&gt;&lt;/a&gt;一、说明文档&lt;/h2&gt;&lt;h3 id=&quot;第一个页面如下图所示：&quot;&gt;&lt;a href=&quot;#第一个页面如下图所示：&quot; class=&quot;header</summary>
      
    
    
    
    
    <category term="Anylogic" scheme="http://example.com/tags/Anylogic/"/>
    
  </entry>
  
  <entry>
    <title>基于 Vue3 ，打造前台+中台通用提效解决方案</title>
    <link href="http://example.com/2022/09/28/%E5%9F%BA%E4%BA%8E-Vue3-%EF%BC%8C%E6%89%93%E9%80%A0%E5%89%8D%E5%8F%B0-%E4%B8%AD%E5%8F%B0%E9%80%9A%E7%94%A8%E6%8F%90%E6%95%88%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"/>
    <id>http://example.com/2022/09/28/%E5%9F%BA%E4%BA%8E-Vue3-%EF%BC%8C%E6%89%93%E9%80%A0%E5%89%8D%E5%8F%B0-%E4%B8%AD%E5%8F%B0%E9%80%9A%E7%94%A8%E6%8F%90%E6%95%88%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</id>
    <published>2022-09-28T02:14:05.000Z</published>
    <updated>2022-11-20T13:16:19.533Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1、全新的项目构建方案-——-vite"><a href="#1、全新的项目构建方案-——-vite" class="headerlink" title="1、全新的项目构建方案 —— vite"></a>1、全新的项目构建方案 —— vite</h1><p>vite 作为一面世就备受瞩目的前端构建工具，它究竟有什么神奇的地方？它又凭什么挑战 webpack 老大的地位呢？学习本章带你了解 vite 的“前世今生”</p><hr><h2 id="1-1-vite-VS-webpack"><a href="#1-1-vite-VS-webpack" class="headerlink" title="1-1 vite VS webpack"></a>1-1 vite VS webpack</h2><ul><li>一个字：<strong>快</strong>！</li></ul><h2 id="1-2-素质三连：vite-为什么快？这种快的机制会不会有什么问题？官方是如何解决的？"><a href="#1-2-素质三连：vite-为什么快？这种快的机制会不会有什么问题？官方是如何解决的？" class="headerlink" title="1-2 素质三连：vite 为什么快？这种快的机制会不会有什么问题？官方是如何解决的？"></a>1-2 素质三连：vite 为什么快？这种快的机制会不会有什么问题？官方是如何解决的？</h2><ol><li><ul><li><strong>webpack会遇到这种问题</strong>：假设我们的项目有A、B两个页面，其中A页面是项目首页，里面的代码一切正常。B页面是一个需要经过跳转才会进入的页面，里面存在一些错误。比如导入一个不存在的文件a.js，然后打印a；当我们去构建这个项目时，明明没有进入过B页面，但是webpack依旧会抛出错误</li><li><strong>而vite</strong>，同样的错误，在没有进入B页面的时候他是不会出现的，只有进入B页面，才会突然出现这样的一个错误（原因：vite不会一开始就构建整个项目，而是将应用区分为<strong>依赖</strong>和<strong>源码</strong>两部分，对于<strong>源码</strong>部分，它会根据<strong>路由来拆分</strong>代码模块，只会去构建一开始就必须要构建的内容，同时vite以原生ESM方式为浏览器提供源码，让浏览器接管了<strong>打包</strong>的部分工作）</li></ul></li><li><p>如果我们项目中存在commonJS的内容怎么办？是不是就意味着不能被解析？<strong>确实如此</strong>，在vite早期版本就因为这个问题导致很多<strong>依赖</strong>无法使用。</p></li><li><p>因为这个问题非常的严重，所以针对于这个问题，vite 在后期提供了 <strong>依赖预构建</strong>的功能，其中一个非常重要的目的就是为了解决CommonJS 和 UMD 兼容性问题。目前vite会先将<strong>CommonJS 或UMD</strong> 发布的依赖项转换为 ESM 之后，再重新进行编译。这也可以理解为<strong>速度对业务的一个妥协</strong>。</p></li></ol><h2 id="1-3-为什么选择了-vite"><a href="#1-3-为什么选择了-vite" class="headerlink" title="1-3 为什么选择了 vite"></a>1-3 为什么选择了 vite</h2><p>目前最新的vite 版本为2.8.5 的版本，经过了两年多的更新的之后，现在的vite 已经非常成熟，足以满足<strong>企业级开发</strong>的需求，并且经过调研，越来越过得企业开始尝试使用 vite 作为项目的构建工具，根据npm的月下载量可以看出，目前vite 的月下载量已经达到了236万</p><p>如果说webpack 代表的是现在，那么vite 极有可能代表了未来。</p><p>所以在vite 已经足以支持企业级开发的前提下，我们是时候拥抱vite 了。</p><h2 id="1-4-通过-vite-构建《小慕前端》"><a href="#1-4-通过-vite-构建《小慕前端》" class="headerlink" title="1-4 通过 vite 构建《小慕前端》"></a>1-4 通过 vite 构建《小慕前端》</h2><p>我们通过vite去构建《小慕前端》，对应的版本信息如下：</p><blockquote><p>vite 版本：2.8.0</p><p>node 版本： 16.13.1</p><p>npm 版本： 8.1.2</p></blockquote><p>想要使用vite，我们首先需要下载vite：</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g vite@<span class="number">2</span>.<span class="number">8</span>.<span class="number">0</span></span><br></pre></td></tr></table></figure><blockquote><p>兼容性注意</p><p>Vite需要Node.js版本&gt;&#x3D;12.0.0</p></blockquote><p>在vite下载完成后，通过以下流程在构建</p><ol><li>创建一个项目</li></ol><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init vite@latest</span><br></pre></td></tr></table></figure><ol start="2"><li>如果没有安装过vite@latest，那么则会提示进行安装，选择y即可</li><li>等待依赖安装完成</li><li>输入项目名称：imooc-front</li><li>选择一个框架就是vue，语言也就是vue</li><li>如果想Network也显示地址，我们可以去项目里的package.json的dev中加入对应的–host</li></ol><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202209290951271.png"                      alt="image-20220929095113140"                ></p><h1 id="2、定制化、高可用前台样式处理方案——tailwindcss"><a href="#2、定制化、高可用前台样式处理方案——tailwindcss" class="headerlink" title="2、定制化、高可用前台样式处理方案——tailwindcss"></a>2、定制化、高可用前台样式处理方案——tailwindcss</h1><p>你还在用传统的 css 定义样式吗？你 out 了。学习 tailwind ，不写一行 css 一样实现 《高定制化、高个性化、高交互性，高可用性》 的精美前台项目。</p><hr><h2 id="2-1-企业级项目下的css处理痛点"><a href="#2-1-企业级项目下的css处理痛点" class="headerlink" title="2-1 企业级项目下的css处理痛点"></a>2-1 企业级项目下的css处理痛点</h2><ul><li>统一的维护变得困难</li><li>大量的ClassName负担</li><li>HTML、CSS分离造成了滚动问题</li><li>响应式、主题切换实现复杂</li></ul><p>难道是因为html、ess 已经足够成熟，不需要再进行改变了吗？应该也不是的，比如针对于css而言，我们在进行企业开发时，就会遇到很多问题，比如：</p><ol><li>有时我们需要统一设计方案，比如项目中的红色我们需要使用同样的色值，标题的文字大小我们期望在整个项目中进行统一的划分。这样的一套<strong>变量</strong>如果通过css来实现，那么就不得不维护一个庞大的<strong>变量组</strong>，这其实是一个非常大的心智负担。</li><li>html结构是一个非常复杂的结构化内容，为了给这些结构指定对应的样式，那么通常我们都是通过clssName来去指定。这就必须要求我们为这套复杂的结构指定各种各样包含语义化的className。比如：container、container-box，container-box-<br>title、container-box-sub-title，container-box-sub-title-left-imag大量的”无意义”命名本身就会增加很多额外的负担。</li><li>因为html 和css 是分离的，所以我们通常情况下在开发时，不得不在整个代码文件中，来回的上下翻滚，或者进行分屏操作。无论是哪一种其实都不能给我们带来一个很好地开发体验。</li><li>针对于一些”复杂“的功能，比如响应式（媒体查询）、主题定制。如果我们想要通过传统的html+ css的形式来进行实现，无疑是非常复杂的。</li></ol><h2 id="2-2-安装tailwindcss到你的项目"><a href="#2-2-安装tailwindcss到你的项目" class="headerlink" title="2-2 安装tailwindcss到你的项目"></a>2-2 安装tailwindcss到你的项目</h2><ol><li><p>在我们的&#x3D;&#x3D;项目&#x3D;&#x3D;中执行 npm install -D <a class="link"   href="mailto:&#116;&#97;&#x69;&#108;&#119;&#x69;&#x6e;&#100;&#x63;&#115;&#115;&#64;&#51;&#x2e;&#48;&#x2e;&#50;&#51;" >&#116;&#97;&#x69;&#108;&#119;&#x69;&#x6e;&#100;&#x63;&#115;&#115;&#64;&#51;&#x2e;&#48;&#x2e;&#50;&#51;<i class="fas fa-external-link-alt"></i></a> <a class="link"   href="mailto:&#112;&#x6f;&#x73;&#x74;&#x63;&#115;&#115;&#x40;&#56;&#46;&#x34;&#46;&#x38;" >&#112;&#x6f;&#x73;&#x74;&#x63;&#115;&#115;&#x40;&#56;&#46;&#x34;&#46;&#x38;<i class="fas fa-external-link-alt"></i></a> <a class="link"   href="mailto:&#97;&#117;&#116;&#x6f;&#112;&#114;&#x65;&#x66;&#105;&#x78;&#x65;&#x72;&#64;&#x31;&#48;&#46;&#52;&#x2e;&#x32;" >&#97;&#117;&#116;&#x6f;&#112;&#114;&#x65;&#x66;&#105;&#x78;&#x65;&#x72;&#64;&#x31;&#48;&#46;&#52;&#x2e;&#x32;<i class="fas fa-external-link-alt"></i></a>，装 tailwindcss</p></li><li><p>执行npx tailwindcss init -p 创建 tailwind.config.js 文件，该文件为 tailwindcss 的配置文件，该文件默认内容为：</p></li></ol><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202209290952236.png"                      alt="image-20220929095257143"                ></p><ol start="3"><li><p>接下来我们需要添加<strong>模板路径（tailwind的应用范围）</strong></p></li><li><p>在tailwind.config.js 文件中的content 选项下，写入如下内容：</p></li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">//Tailwind应用范围</span></span><br><span class="line">  <span class="attr">content</span>: [<span class="string">&#x27;./index.html&#x27;</span>,<span class="string">&#x27;./src/**/*.&#123;vue,js&#125;&#x27;</span>],</span><br><span class="line">···</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="5"><li><p>接下来我们需要添加一些tailwind的指令</p></li><li><p>创建 src&#x2F;styles&#x2F;index.scss文件，并写入如下代码：</p></li></ol><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//导入tailwind的基础指令组件</span></span><br><span class="line"><span class="keyword">@tailwind</span> base;</span><br><span class="line"><span class="keyword">@tailwind</span> components;</span><br><span class="line"><span class="keyword">@tailwind</span> utilities;</span><br></pre></td></tr></table></figure><ol start="7"><li>然后在src&#x2F;main.js引入该index.scss</li><li>因为我们使用了scss，所以我们需要安装<strong>sass</strong>，执行npm i -D <a class="link"   href="mailto:&#x73;&#x61;&#115;&#115;&#x40;&#49;&#x2e;&#x34;&#53;&#46;&#48;" >&#x73;&#x61;&#115;&#115;&#x40;&#49;&#x2e;&#x34;&#53;&#46;&#48;<i class="fas fa-external-link-alt"></i></a>安装 sass</li><li>此时tailwind 已经安装到我们的项目中</li><li>我们可以在src&#x2F;App.vue 中为img标签增加一个 class&#x3D;”bg-red-900”</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img alt=&quot;Vue logo&quot;  class=&quot;bg-red-900&quot; src=&quot;@/assets/logo.svg&quot; width=&quot;125&quot; height=&quot;125&quot; /&gt;</span><br></pre></td></tr></table></figure><h2 id="2-3-tailwindcss初体验"><a href="#2-3-tailwindcss初体验" class="headerlink" title="2-3 tailwindcss初体验"></a>2-3 tailwindcss初体验</h2><p>我们对App.vue进行修改，有一点不好就是IDEA没有对tailwind有代码补充提醒</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line"> &lt;div class=&quot;bg-slate-800 rounded-xl p-8 md:flex md:p-0&quot;&gt;</span><br><span class="line">   &lt;img class=&quot;w-24 h-24 rounded-full mx-auto md:w-48 md: h-auto md: rounded-none&quot;</span><br><span class="line">        src=&quot;https://tailwindcss.com/_next/static/media/sarah-dayan.a8ff3f1095a58085a82e3bb6aab12eb2.jpg&quot;</span><br><span class="line">        /&gt;</span><br><span class="line">   &lt;div class=&quot;pt-6 text-center space-y-4 md:p-8 md: text-lett&quot;&gt;</span><br><span class="line">     &lt;p class=&quot;text-lg font-medium text-zinc-100&quot;&gt;</span><br><span class="line">       “这是使用 tailwindcss</span><br><span class="line">       来实现的一个基础的卡片区域，在实现该卡域的过程中，我们从来没有离开过HTML 区域.”</span><br><span class="line">     &lt;/p&gt;</span><br><span class="line">     &lt;div class=&quot;font-medium&quot;&gt;</span><br><span class="line">       &lt;div class=&quot;text-sky-400&quot;&gt;LGD_Sunday&lt;/div&gt;</span><br><span class="line">       &lt;div class=&quot;text-slate-500&quot;&gt;中前台前端解决方案&lt;/div&gt;</span><br><span class="line">       &lt;/div&gt;</span><br><span class="line">   &lt;/div&gt;</span><br><span class="line"> &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure><h2 id="2-4-tailwindcss设计理念和价值体现"><a href="#2-4-tailwindcss设计理念和价值体现" class="headerlink" title="2-4 tailwindcss设计理念和价值体现"></a>2-4 tailwindcss设计理念和价值体现</h2><p><strong>设计理念</strong></p><p>tailwindcss中一个非常核心的内容就是：<strong>每一个类名都代表了一个css属性</strong>，这个样式在 tailwindcss 中被称作为<strong>原子化CSS</strong>，而大家争议的核心其实就在这里。<br>那么想要搞明白这样的一种设计理念，那么我们需要先搞清楚CSS设计史上的一些粒度划分。<br>整个前端历史中，CSS 颗粒度设计主要可以分为4种形式（<strong>颗粒度自上而下逐渐增大，颗粒度越大则约束性越高，可定制性越弱</strong>）：</p><ol><li>行内样式：样式全部写入行内。自由度最高，可定制化最强。但是不方便样式的复用，每次都要写完整的样式。|</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div style=&quot;background-color：#ffffff；color：#333333；&quot;&gt;</span><br><span class="line">    我是一个div</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><ol start="2"><li>原子化CSS：每一个类名都代表了一个css属性。自度依然很强，可定制化依然很高，也方便复用。但是大量的样式会造成大量的类名。</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;bg-white text-zinc-800&quot;&gt;-   我是一个div&lt;/div&gt;</span><br></pre></td></tr></table></figure><ol start="3"><li>传统形式：通过一个或几个具有语义化的class来描述一段css 属性。封装性强，语义化强，自由度和可定制化性一般（比如cart 就标记好了当前为一个卡片，通常边框、弧度、阴影、padding 也都一并规定好了）。但是大量的html需要取大量的语义化class，并且在html 和css中需要来回的切换、查找。</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;container-box desc-container cart&quot;&gt;我是-div&lt;/div&gt;</span><br></pre></td></tr></table></figure><ol start="4"><li>组件形式：在组件库中极为常见。封装性极强（不光封装了样式，也封装了功能），语义化强。但是自由度和可定制化性比较差。</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;m-cart&gt;我是-个div&lt;/m-cart&gt;</span><br></pre></td></tr></table></figure><p>而tailwindcss 的核心设计理念就是：第二个：<strong>原子化的CSS</strong>。那么根据我们刚才的分析，这种方式惟一的问题就是：<strong>大量的样式会造成大量的类名这样的情况</strong>。而这样的一个问题在她的高自由度、高定制化、高可复用的优势之下，也就变得没有那么重要了。</p><p><strong>价值体现</strong></p><p>想要明确 tailwindcss 的价值，那么我们需要先来明确一下<strong>现代的前端应用</strong>开发的一些问题。<br>我们以后台前端解决方案这门课中的项目为例。项目中使用了element-plus作为UI 组件库。当我们决定使用<strong>element-plus</strong>的那一刻起，就<strong>决定了整体的项目样式为element设计风格</strong>。如果此时我们想要把项目做出个性化的风格出来，那么”几乎是不可能的”。<br>不过好在后台系统，风格本就干篇一律，这样设计倒也没有问题。但是如果是前台系统呢？<br>前台系统讲究高定制化、高个性化、高交互性，在这样的一个要求下，element，antd，vant 这样的组件库是否还能够满足我们需求呢？</p><p>对于<strong>高定制化、高个性化、高交互性</strong>的前台应用而言，通用组件库这种普适的组件系统是很难满足对应需求的。那么这也就意味着我们无法借助现有的样式，而需要手动写入大量的css样式和动画。<br>那么现在再回过头来看我们的4种颗粒度的css形式，你会怎么选择呢？</p><ol><li>行内样式：无复用性，不合适！</li><li>组件形式：通用组件库，经过刚才的分析，不合适！</li></ol><p>那么剩下的就只有<strong>原子化CSS</strong> 和<strong>传统形式</strong>这两种的。<br>因为我们的项目中，包含<strong>响应式</strong>和<strong>主题更换</strong>，而这两种功能如果想要通过<strong>传统形式</strong>来进行实现的话，是比较复杂的。因为这意味着我们需要定义大量的<strong>媒体查询</strong>和<strong>主题类名</strong>。<br>所以综上所述，在<strong>高定制化、高个性化、高交互性</strong>的前台应用中，<strong>原子化CSS</strong>是最合适的一种形式。而这种形式的具体体现就是tailwindcss</p><p><strong>总结</strong></p><ol><li>如果你想要实现一个<strong>通用</strong>的后台项目，那么推荐使用通用组件库实现</li><li>如果你想要实现一个<strong>高定制化、高个性化、高交互性</strong>的前台项目，那么推荐使用tailwindcss 实现</li></ol><h1 id="3、明星项目架构解决方案——搭建基础项目结构"><a href="#3、明星项目架构解决方案——搭建基础项目结构" class="headerlink" title="3、明星项目架构解决方案——搭建基础项目结构"></a>3、明星项目架构解决方案——搭建基础项目结构</h1><p>一般被人追捧，并具备长期可维护、可扩展的能力的项目，被称为明星项目，那么你知道如何搭建一个明星项目的基础架构吗？</p><hr><h2 id="3-1-项目开发助手-Prettier-Code-formatter-、-Tailwind-CSS-IntelliSense、Volar"><a href="#3-1-项目开发助手-Prettier-Code-formatter-、-Tailwind-CSS-IntelliSense、Volar" class="headerlink" title="3-1 项目开发助手 Prettier - Code formatter 、 Tailwind CSS IntelliSense、Volar"></a>3-1 项目开发助手 Prettier - Code formatter 、 Tailwind CSS IntelliSense、Volar</h2><p>分别在插件库中进行安装</p><p>针对Prettier ，在设置一个文件是.prettierrc，内容如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;semi&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="string">&quot;singleQuote&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;trailingComma&quot;</span>: <span class="string">&quot;none&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-2-项目架构基本结构处理分析"><a href="#3-2-项目架构基本结构处理分析" class="headerlink" title="3-2 项目架构基本结构处理分析"></a>3-2 项目架构基本结构处理分析</h2><p>通过vite 创建出的这个项目，目前来看还是非常简随的，只包含了基础的项目结构，所以我们需要进行较多的一些改造内容。</p><p>那么想要明确最终的改造方案，我们就需要先来分析一下我们的项目《小慕前端》</p><p>咱们的项目分为移动端和PC端两种显示结果，但是这两种显示结果通过同一套代码进行实现，也就是所谓的响应式构建方案。那么我们在分析的时候就需要分别分析（PS：此处我们只分析大的路由方案，目的是让大家对基本的项目结构有一个初步的认识，以方便我们的项目结构处理，后续具体的细节构建方案不在这次分析行为之内）：</p><ol><li>移动端结构</li><li>PC端结构</li></ol><p>然后把这两种的分析方案，合并到一起，组成一个最终的架构方案。</p><p><strong>移动端结构分析</strong><br>移动端的结构相对比较简单，当我们去进行路由跳转时，它是以整个页面进行的整体路由切换。</p><p>那么由此可知，移动端不存在嵌套路由的概念，只需要在APP，vue 中保留一个路由出口即可。</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202209301544534.png"                      alt="image-20220930154414339"                ></p><p><strong>PC端结构分析</strong><br>而PC端的结构相对比较复杂，如下图所示：</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202209301545306.png"                      alt="image-20220930154519166"                ></p><p>我们需要通过两个路由出口进行表示：</p><ol><li>App.vue：一级路由出口，用作整页路由切换</li><li>Main.vue：二级路由出口，用作局部路由切换</li></ol><p>那么由此我们可知，移动端和PC端两者的路由结构是不同的，所以这就要求我们需要根据 当前用户所在设备的不同，构建不同的<strong>路由表</strong>。<br>那么这一小节我们分析了项目在不同设备中，需要具备不同的路由结构，所以我们就需要生成多个路由表来应对不同的情况。<br>那么接下来我们就根据这一小节的分析，结合我们的项目经验，构建出基本的项目架构。</p><h2 id="3-3-构建项目架构"><a href="#3-3-构建项目架构" class="headerlink" title="3-3 构建项目架构"></a>3-3 构建项目架构</h2><p>在这一小节中，我们需要把咱们整个项目的架子搭建起来。因为咱们的项目默认没有安装vue-router 和vuex。所以我们需要先安装这两个插件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i --save vuex@4.0.2 vue-router@4.0.14</span><br></pre></td></tr></table></figure><p>然后我们去处理项目基本架构，最终架构如下（部分省略）：</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202209301553059.png"                      alt="image-20220930155333757"                ></p><h1 id="4、企业级vite配置方案——让vite得心应手"><a href="#4、企业级vite配置方案——让vite得心应手" class="headerlink" title="4、企业级vite配置方案——让vite得心应手"></a>4、企业级vite配置方案——让vite得心应手</h1><p>任何一种构建工具都需要根据我们的需求进行对应的配置，那么针对于 vite 而言，在大厂中我们应该如何根据自己的业务进行对应的配置呢？</p><hr><h2 id="4-1-明确移动端和PC端的构建顺序"><a href="#4-1-明确移动端和PC端的构建顺序" class="headerlink" title="4-1 明确移动端和PC端的构建顺序"></a>4-1 明确移动端和PC端的构建顺序</h2><p>在上一章中（项目架构基本结构处理分析）中，我们明确了项目包含<strong>移动端路由表和PC端路由表</strong>两部分，所以我们在开发的时候就需要分别来去处理<strong>移动端</strong>和<strong>pc端</strong>对应的内容。</p><p>那么对于这两部分，我们需要按照什么样的顺序进行构建呢？</p><p>因为咱们的项目是使用的tailwindcss作为样式处理的核心库，所以我们的<strong>构建顺序</strong>需要尊重<strong>tailwindcss的构建顺序</strong>的。<br>那么在tailwind中，有这样一段内容：</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202209301656800.png"                      alt="image-20220930165624626"                ></p><p>翻译过来就是<strong>移动优先</strong>的原则。<br>也就是说，使用 tailwind构建响应式系统时，需要先构建移动端，再构建PC端。<br>而这个顺序，同样也是咱们项目的构建顺序。</p><h2 id="4-2-构建移动处理工具-MobileTerminal"><a href="#4-2-构建移动处理工具-MobileTerminal" class="headerlink" title="4-2 构建移动处理工具 MobileTerminal"></a>4-2 构建移动处理工具 MobileTerminal</h2><blockquote><p>但是我们如何判断当前的设备是移动设备呢？</p></blockquote><p>为什么达到这个目的，我们就需要先去构建出咱们的第一个工具方法：isMobileTerminal，该方法将返回一个boolean形的数据，如果为true 则表示当前所在为<strong>移动端</strong>，如果为false则表示当前为<strong>PC端</strong></p><p>那么根据我们之前的<strong>构建方案</strong>，所有的工具方法需要被放入到utils中，所以下面我们首先需要在utils中创建一个<strong>工具类flexible.js</strong>，在该方法中规定屏幕宽度**&lt;1280则为移动设备<strong>，并且为了保证这个方法的灵活性，我们可以让它称为一个</strong>计算属性**，所以我们得出如下代码</p><p>&#x2F;src&#x2F;utils&#x2F;flexible.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 判断当前是否为移动设备，判断依据为屏幕的宽度是否大于指定值（1280）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> &#123; computed &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">PC_DEVICE_WIDTH</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../constants&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> isMobileTerminal = <span class="title function_">computed</span>(<span class="function">() =&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">clientWidth</span> &lt;<span class="variable constant_">PC_DEVICE_WIDTH</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>src&#x2F;constants&#x2F;index.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//PC设备指定宽度</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">PC_DEVICE_WIDTH</span> =<span class="number">1000</span></span><br></pre></td></tr></table></figure><p>src&#x2F;APP.vue</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;&#123;&#123;isMobileTerminal&#125;&#125;&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123;isMobileTerminal&#125; from &#x27;./utils/flexible&#x27;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>此时当我们切换浏览器设备时，就可以得到对应的判断结果。</p><p><strong>注意：</strong>因为我们要在后面进行<strong>响应式的视图处理</strong>所以此处通过<strong>宽度</strong>进行移动端判断！！！！<br>大家在实际开发中更建议通过以下代码来进行是否为移动端的准确判断</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 判断当前是否为移动设备</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> isMobileTerminal = <span class="title function_">computed</span>(<span class="function">()=&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="regexp">/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i</span>.<span class="title function_">test</span>(navigator.<span class="property">userAgent</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="4-3-通过-vueuse-优化处理方案"><a href="#4-3-通过-vueuse-优化处理方案" class="headerlink" title="4-3 通过 vueuse 优化处理方案"></a>4-3 通过 vueuse 优化处理方案</h2><p>通过上面的实验，我们可以看出它并不是响应式的，因为必须通过刷新才能改变值，所以接下来我们使用<strong>vueuse库</strong>，先进行安装</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i @vueuse/core@<span class="number">8</span>.<span class="number">1</span>.<span class="number">2</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 判断当前是否为移动设备，判断依据为屏幕的宽度是否大于指定值（1280）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> &#123; computed &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">PC_DEVICE_WIDTH</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../constants&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;useWindowSize&#125; <span class="keyword">from</span> <span class="string">&#x27;@vueuse/core&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123;width&#125; = <span class="title function_">useWindowSize</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> isMobileTerminal = <span class="title function_">computed</span>(<span class="function">() =&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> width.<span class="property">value</span> &lt;<span class="variable constant_">PC_DEVICE_WIDTH</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="4-3-定义-软链接"><a href="#4-3-定义-软链接" class="headerlink" title="4-3 定义@软链接"></a>4-3 定义@软链接</h2><p>我们知道在webpack 中可以直接通过@符号表示src路径，但是在vite 默认是不可以的。</p><p>vite 提供了 <strong>resolve.alias</strong>功能，表示：<strong>通过别名在指向一个具体的路径</strong></p><p>那么我们就可以通过此配置来实现@软链接功能在vite.config.js中写入</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//新增</span></span><br><span class="line"><span class="keyword">import</span> &#123; fileURLToPath, <span class="variable constant_">URL</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;node:url&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> vue <span class="keyword">from</span> <span class="string">&#x27;@vitejs/plugin-vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// https://vitejs.dev/config/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="title function_">vue</span>()],</span><br><span class="line">  <span class="comment">//软连接</span></span><br><span class="line">  <span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="attr">alias</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;@&#x27;</span>: <span class="title function_">fileURLToPath</span>(<span class="keyword">new</span> <span class="title function_">URL</span>(<span class="string">&#x27;./src&#x27;</span>, <span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">url</span>))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>或者写成这样：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; fileURLToPath, <span class="variable constant_">URL</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;node:url&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> vue <span class="keyword">from</span> <span class="string">&#x27;@vitejs/plugin-vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;join&#125; <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// https://vitejs.dev/config/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="title function_">vue</span>()],</span><br><span class="line">  <span class="comment">//软连接</span></span><br><span class="line">  <span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="attr">alias</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;@&#x27;</span>: <span class="title function_">join</span>(__dirname,<span class="string">&#x27;/src&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="4-4-构建VueRouter移动端路由表"><a href="#4-4-构建VueRouter移动端路由表" class="headerlink" title="4-4 构建VueRouter移动端路由表"></a>4-4 构建VueRouter移动端路由表</h2><p>那么到现在我们已经有了isMobileTerminal方法，那么接下来我们就可以利用这个方法处理移动端路由表，不过在处理该路由表之前我们还需初始化咱们的vue-router</p><ol><li>在src&#x2F;router&#x2F;index.js 中初始化 VueRouter</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;createRouter,createWebHistory&#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;isMobileTerminal&#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/flexible&#x27;</span></span><br><span class="line"><span class="keyword">import</span> mobileRoutes <span class="keyword">from</span> <span class="string">&#x27;./modules/mobile-router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> pcRoutes <span class="keyword">from</span> <span class="string">&#x27;./modules/pc-router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//创建vueRouter实例</span></span><br><span class="line"><span class="keyword">const</span> router =<span class="title function_">createRouter</span>(&#123;</span><br><span class="line">  <span class="attr">history</span>: <span class="title function_">createWebHistory</span>(),</span><br><span class="line">  <span class="attr">routes</span>: isMobileTerminal.<span class="property">value</span> ? mobileRoutes : pcRoutes</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br></pre></td></tr></table></figure><ol start="2"><li>创建对应的移动端和pc端路由&#x2F;mobile-router.js和pc-router.js</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> [&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;home&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>: <span class="function">()=&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/main/index.vue&#x27;</span>)</span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> []</span><br></pre></td></tr></table></figure><ol start="3"><li>创建移动端首页@&#x2F;views&#x2F;main&#x2F;index.vue</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div&gt;我是移动端首页&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><ol start="4"><li>在main.js中使用路由</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./styles/index.scss&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(router)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure><ol start="5"><li>在App.vue中使用一级路由</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;router-view/&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure><h2 id="4-5-划分移动端首页模块"><a href="#4-5-划分移动端首页模块" class="headerlink" title="4-5 划分移动端首页模块"></a>4-5 划分移动端首页模块</h2><p>移动端首页模块总共可分为三部分：<br>1.顶部的navigationbar</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202210051651788.png"                      alt="image-20221005165100555"                ></p><p>2.中间的列表内容</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202210051652839.png"                      alt="image-20221005165206482"                ></p><p>3.底部的tabbar</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/202210051652038.png"                      alt="image-20221005165221913"                ></p><p>那么我们首先要开发的就是<strong>顶部的navigationBar</strong>部分。<br>而对于该部分又可以分为三块内容：</p><ol><li>navigator 表：</li><li>右侧汉堡按钮：</li><li>点击汉堡按钮展示的popup弹出层：</li></ol><p>那么明确好这些内容之后，接下来我们就可以按照这个顺序依次开发。</p><p>那么下面首先我们创建移动端的navigation模块：</p><ol><li>建 src&#x2F;views&#x2F;main&#x2F;components&#x2F;navigation&#x2F;mobile&#x2F;index.vue 组件</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;我是移动端首页&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;&lt;/script&gt;</span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure><ol start="2"><li>创建 src&#x2F;views&#x2F;main&#x2F;components&#x2F;navigation&#x2F;index.vue 组件，为<strong>控制移动端和PC端的navigation 展示组件</strong></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;mobile-navigation-vue v-if=&quot;isMobileTerminal&quot;/&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123;isMobileTerminal&#125; from &#x27;@/utils/flexible&#x27;</span><br><span class="line">import mobileNavigationVue from &#x27;./mobile/index.vue&#x27;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>3.在src&#x2F;views&#x2F;main&#x2F;index.vue中导入该组件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">  &lt;navigation-vue/&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import navigationVue from &#x27;./components/navigation/index.vue&#x27;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h2 id="4-6-导入并配置axios"><a href="#4-6-导入并配置axios" class="headerlink" title="4-6 导入并配置axios"></a>4-6 导入并配置axios</h2><p>在有了 navigation 组件之后，接下来我们就可以尝试<strong>获取数据，渲染数据</strong>了</p><p>那么想要获取数据，我们将使用 axios</p><ol><li>安装 axios 依赖</li></ol><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i --save axios@<span class="number">0</span>.<span class="number">26</span>.<span class="number">1</span></span><br></pre></td></tr></table></figure><ol start="2"><li>创建 src&#x2F;utils&#x2F;request.js</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> service = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">  <span class="attr">baseURL</span>: <span class="string">&#x27;https://api.imooc-front.lgdsunday.club/api&#x27;</span>,</span><br><span class="line">  <span class="attr">timeout</span>: <span class="number">5000</span> <span class="comment">//请求超时时间</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> service</span><br></pre></td></tr></table></figure><ol start="3"><li>创建请求接口 src&#x2F;api&#x2F;category.js</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*获取分类列表</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getCategory</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/category&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>在src&#x2F;views&#x2F;main&#x2F;components&#x2F;navigation&#x2F;mobile&#x2F;index.vue中使用获得分类列表方法</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123;getCategory&#125; from &#x27;@/api/category&#x27;</span><br><span class="line">const getCategoryData = async ()=&gt;&#123;</span><br><span class="line">  const res = await getCategory()</span><br><span class="line">  console.log(res)</span><br><span class="line">&#125;</span><br><span class="line">getCategoryData()</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><blockquote><p>在vue中，await是等待的意思，await关键字只能放在async函数里，await配合async一起使用，相当于把异步函数变成了同步，await会等待后面表达式的返回结果之后才执行下一步。</p><p><a class="link"   href="https://www.cnblogs.com/zhoujuan/p/11692818.html" >vue中异步函数async和await的用法 - zhouj2019 - 博客园 (cnblogs.com)<i class="fas fa-external-link-alt"></i></a></p></blockquote><h2 id="4-7-vite处理代理服务器"><a href="#4-7-vite处理代理服务器" class="headerlink" title="4-7 vite处理代理服务器"></a>4-7 vite处理代理服务器</h2><p>我们遇到了一个跨域的问题，这个问题在<strong>前后端分离</strong>的项目开发中是非常常见的。同时对于webpack可以直接通过proxy进行处理，那么vite 中是否也提供了类似的能力呢？</p><p>是的，vite同样提供了<strong>proxy</strong>的配置项。</p><p>具体使用的方式与webpack 中的proxy 基本没有区别，依然是通过devServer 根据url 进行代理处理。</p><p>具体配置方式如下：</p><ol><li>在src&#x2F;utils&#x2F;request.js 中，修改basURL为api，示当前请求为开发时的api请求</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> service = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">  <span class="attr">baseURL</span>: <span class="string">&#x27;/api&#x27;</span>,</span><br><span class="line">  <span class="attr">timeout</span>:<span class="number">5000</span><span class="comment">//请求超时时间</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> service</span><br></pre></td></tr></table></figure><ol start="2"><li>在vite.config.js 中新增 server选项，配置代理</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//代理配置</span></span><br><span class="line"><span class="attr">server</span>:&#123;</span><br><span class="line">  <span class="attr">proxy</span>:&#123;</span><br><span class="line">    <span class="comment">//代理所有/api的请求</span></span><br><span class="line">    <span class="string">&#x27;/api&#x27;</span>:&#123;</span><br><span class="line">      <span class="comment">//代理请求之后的请求地址</span></span><br><span class="line">      <span class="attr">target</span>:<span class="string">&#x27;https://api.imooc-front.lgdsunday.club/&#x27;</span>,</span><br><span class="line">      <span class="comment">//跨域</span></span><br><span class="line">      <span class="attr">changeOrigin</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-8-vite处理环境变量"><a href="#4-8-vite处理环境变量" class="headerlink" title="4-8 vite处理环境变量"></a>4-8 vite处理环境变量</h2><p>到这里咱们已经可以请求到服务端，并且得到对应的数据响应了。</p><p>但是如果大家查看咱们的接口文档，那么可以发现baseURL分为两种：</p><p>DEV：<a class="link"   href="https://api.imooc-front.lgdsunday.club/api" >https://api.imooc-front.lgdsunday.club/api<i class="fas fa-external-link-alt"></i></a> </p><p>PROD：<a class="link"   href="https://api,imooc-front.lgdsunday.club/prod-api" >https://api，imooc-front.lgdsunday.club/prod-api<i class="fas fa-external-link-alt"></i></a></p><p>在通常咱们的企业级项目开发之中，都会区分<strong>开发时服务</strong>和<strong>生产时服务</strong>。</p><p>对于开发时服务而言，它内部的数据是<strong>假数据</strong>，所以我们可以随便修改。</p><p>而生产时服务，它内部数据为<strong>真实数据</strong>，所以是不能随意修改的。</p><p>那么在我们进行项目开发时，我们需要把服务切换为DEV 模式，而在打包项目时需要切换为PROD模式。</p><p>但是如果这个操作全靠人工切换，那么难免会有疏忽，一旦出现问题将会引起巨大的风险，所以我们期望可以<strong>根据项目状态，自动切换请求的服务地址。</strong></p><p>那么这样应该怎么做呢？</p><p>在vite中提供了**.env文件**，该文件为环境变量文件，默认提供了四种文件格式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.env#所有情况下都会加载</span><br><span class="line">.env.local.     #所有情况下都会加载，但会被git 忽略</span><br><span class="line">.env.[mode]  #只在指定模式下加载</span><br><span class="line">.env.[mode].local      #只在指定模式下加载，但会被git 忽略</span><br></pre></td></tr></table></figure><p>其中有一种.env.[mode]的格式可以在<strong>不同模式下加载不同内容</strong>，这不正是我们想要的吗？</p><p>那么明确好之后，下面我们就创建对应的文件：</p><ol><li>新建.env.development文件，表示<strong>开发时</strong>的.env文件</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#只在指定模式(development)下加载</span><br><span class="line">#base api，只有以 VITE_为前缀的变量才会暴露给经过vite处理</span><br><span class="line">VITE_BASE_API =&#x27;/api</span><br></pre></td></tr></table></figure><ol start="2"><li>新建.env.production文件，表示<strong>生产时</strong>的.env文件</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#只在指定模式（production）下加载</span><br><span class="line">#base api，只有以 VITE_为前缀的变量才会暴露给经过vite处理</span><br><span class="line">VITE_BASE_API =&#x27;/prod-api&#x27;</span><br></pre></td></tr></table></figure><p>3.在src&#x2F;utils&#x2F;request.js 中打印 VITE_BASE_API</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">env</span>.<span class="property">VITE_BASE_API</span>)</span><br></pre></td></tr></table></figure><ol start="4"><li>此时当找们执行 npm run dev时，可以发现浏览器打&#x2F;ap1，表示<strong>开发时</strong>服务地址</li><li>执行 npm run build 打包项目后运行（可以通过anywhere运行 dist 目录），浏览器打印为&#x2F;prod-api，表示<strong>发布时</strong>服务地址</li><li>表明咱们的环境变量配置成功</li><li>那么我们只需要修改 baseURL 为import.meta.env.VITE_BASE_API变量即可</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">baseURL</span>: <span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">env</span>.<span class="property">VITE_BASE_API</span>,</span><br></pre></td></tr></table></figure><h1 id="5、构建自己的物料解决方案——构建物料库，实现前端设计"><a href="#5、构建自己的物料解决方案——构建物料库，实现前端设计" class="headerlink" title="5、构建自己的物料解决方案——构建物料库，实现前端设计"></a>5、构建自己的物料解决方案——构建物料库，实现前端设计</h1><h2 id="5-1-为什么不使用组件库，而要自己构建？前台系统与后台系统的根本性区别！"><a href="#5-1-为什么不使用组件库，而要自己构建？前台系统与后台系统的根本性区别！" class="headerlink" title="5-1 为什么不使用组件库，而要自己构建？前台系统与后台系统的根本性区别！"></a>5-1 为什么不使用组件库，而要自己构建？前台系统与后台系统的根本性区别！</h2><p>我们明确了<strong>本项目中，不会使用现有的前端组件库，而是会构建一个咱们自己的物料库（组件库）。</strong>那么为什么要这么做呢？是为了故作高深吗？</p><p>不是的！</p><p>为了让大家更加明确原因，所以我们专门在抽出来一小节的内容，来明确这一点。</p><p>想要明确这一点内容，那么我们首先需要明确<strong>后台系统</strong>和<strong>前台系统</strong>的根本性区别。<br><strong>后台系统</strong></p><p>后台系统是大家平时项目开发中非常常见的一种项目形式。</p><p>但是后台系统有一个非常好的地方，那就是<strong>样式同质化高</strong></p><p>这些系统无论以什么样子的主题构建，他都有非常类似的地方：</p><ol><li><p>左侧通常为menu菜单</p><ol><li>菜单一般都是可折叠的</li><li>菜单一般都是可分层的</li><li>菜单一般都有图片和文字组成</li></ol></li><li><p>右侧通常为内容展示</p></li></ol><p>那么这种就叫做<strong>样式同质化高</strong>。因为它的样式同质化高，所以我们可以总结出一种通用的方式，来处理这种高同质化的<strong>功能</strong>和<strong>样式</strong>。<br>而这种通用的方式就是<strong>通用组件库</strong>，比如 element，antd，vant等等</p><p><strong>前台系统</strong><br>前台系统又分为了：</p><ol><li>pc端前台系统</li><li>移动端前台系统</li></ol><p>这个之外前台系统讲究 <strong>个性化样式</strong></p><p><strong>总结</strong></p><p>因为<strong>前台系统和后台系统</strong>的这种根本性的设计区别（前台讲究个性化，后台偏同质化），所以这就导致了目前市面上的<strong>通用组件库</strong>更多的是后台PC系统组件库（比如element 或者antd）。<br>这就导致，如果你想要开发一个前台系统，那么就需要拥有你自己的<strong>组件库</strong>！<br>这也是为什么我们必须要开发一个组件库的原因。</p><h2 id="5-2-数据拦截简化数据获取流程"><a href="#5-2-数据拦截简化数据获取流程" class="headerlink" title="5-2 数据拦截简化数据获取流程"></a>5-2 数据拦截简化数据获取流程</h2><p>我们在src&#x2F;utils&#x2F;request.js中新增数据拦截器，获取我们需要的东西，过滤不需要的</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 响应拦截器：</span></span><br><span class="line"><span class="comment"> * 服务端返回数据之后，前端.then之前被调用</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">service.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(<span class="function">(<span class="params">response</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;success,message,data&#125; =response.<span class="property">data</span></span><br><span class="line">  <span class="keyword">if</span> (success)&#123;</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//<span class="doctag">TODO:</span>业务请求错误</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(message))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="5-3-业务组件：移动端navigationBar"><a href="#5-3-业务组件：移动端navigationBar" class="headerlink" title="5-3 业务组件：移动端navigationBar"></a>5-3 业务组件：移动端navigationBar</h2><ol><li>将navigation&#x2F;mobile&#x2F;index.vue中的代码，移植到navigation&#x2F;index.vue，并加以修改</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import &#123;ref&#125; from &#x27;vue&#x27;</span><br><span class="line">const categoryData = ref([])</span><br><span class="line">const getCategoryData = async () =&gt; &#123;</span><br><span class="line">  const &#123;categorys&#125; = await getCategory()</span><br><span class="line">  categoryData.value = categorys</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>在子组件navigation&#x2F;mobile&#x2F;index.vue中进行数据接收，并优化数据在web端显示的格式</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;bg-white sticky top-0 left-0 z-10&quot;&gt;</span><br><span class="line">    &lt;ul</span><br><span class="line">      class=&quot; relative flex overflow-x-auto p-1 text-xs text-zinc-600</span><br><span class="line">      overflow-hidden&quot;&gt;</span><br><span class="line">      &lt;li v-for=&quot;item in data&quot; :key=&quot;item.id&quot; class=&quot;shrink-0 px-1.5 py-0.5 z-10 duration-200&quot;&gt;&#123;&#123;item.name&#125;&#125;&lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">//vite 构建的项目中，我们可以直接使用 defineProps方法</span><br><span class="line">defineProps(&#123;</span><br><span class="line">  data:&#123;</span><br><span class="line">    type: Array,</span><br><span class="line">    required:true</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><ol start="3"><li>在父组件navigation&#x2F;index.vue中进行数据绑定</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;mobile-navigation-vue v-if=&quot;isMobileTerminal&quot; :data=&quot;categoryData&quot; /&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h2 id="5-4-动态rem基准-修正tailwind，完善移动端navig"><a href="#5-4-动态rem基准-修正tailwind，完善移动端navig" class="headerlink" title="5-4 动态rem基准+修正tailwind，完善移动端navig"></a>5-4 动态rem基准+修正tailwind，完善移动端navig</h2><ol><li>现在src&#x2F;utils&#x2F;flexible.js中写一个方法（调整字体的）</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">useREM</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  <span class="comment">//定义最大的fontSize</span></span><br><span class="line">  <span class="keyword">const</span> <span class="variable constant_">MAX_FONT_SIZE</span> = <span class="number">40</span></span><br><span class="line">  <span class="comment">//监听html文档被解析完成的事件</span></span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;DOMContentLoaded&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//拿到html标签</span></span><br><span class="line">    <span class="keyword">const</span> html =<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;html&#x27;</span>)</span><br><span class="line">    <span class="comment">//计算fontSize，根据屏幕宽度/10</span></span><br><span class="line">    <span class="keyword">let</span> fontSize = <span class="variable language_">window</span>.<span class="property">innerWidth</span>/<span class="number">10</span></span><br><span class="line">    fontSize = fontSize&gt;<span class="variable constant_">MAX_FONT_SIZE</span> ? <span class="variable constant_">MAX_FONT_SIZE</span> : fontSize</span><br><span class="line">    <span class="comment">//赋值给html</span></span><br><span class="line">    html.<span class="property">style</span>.<span class="property">fontSize</span> = fontSize + <span class="string">&#x27;px&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>在src&#x2F;main.js中调用方法</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useREM &#125; <span class="keyword">from</span> <span class="string">&#x27;./utils/flexible&#x27;</span></span><br><span class="line"><span class="title function_">useREM</span>()</span><br></pre></td></tr></table></figure><ol start="3"><li>通过观察web页面的字体跟想象中的不一样，那么我们需要调整tailwind中fontsize的大小，在tailwind.config.js中进行修改</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">theme</span>: &#123;</span><br><span class="line">  <span class="attr">extend</span>: &#123;</span><br><span class="line">    <span class="attr">fontsize</span>:&#123;</span><br><span class="line">      <span class="attr">xs</span>:[<span class="string">&#x27;0.25rem&#x27;</span>,<span class="string">&#x27;0.35rem&#x27;</span>],</span><br><span class="line">      <span class="attr">sm</span>:[<span class="string">&#x27;0.35rem&#x27;</span>,<span class="string">&#x27;0.45rem&#x27;</span>],</span><br><span class="line">      <span class="attr">base</span>:[<span class="string">&#x27;0.45rem&#x27;</span>,<span class="string">&#x27;0.55rem&#x27;</span>],</span><br><span class="line">      <span class="attr">lg</span>:[<span class="string">&#x27;0.55rem&#x27;</span>,<span class="string">&#x27;0.65rem&#x27;</span>],</span><br><span class="line">      <span class="attr">xl</span>:[<span class="string">&#x27;0.65rem&#x27;</span>,<span class="string">&#x27;0.75rem&#x27;</span>],</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h2 id="5-5-通用组件：基于vite的统一svg处理svg-icon"><a href="#5-5-通用组件：基于vite的统一svg处理svg-icon" class="headerlink" title="5-5 通用组件：基于vite的统一svg处理svg-icon"></a>5-5 通用组件：基于vite的统一svg处理svg-icon</h2><ol><li>我们首先创建一个icon的通用组件src&#x2F;lib&#x2F;svg-icon&#x2F;index.vue</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;!--  把 aria-hidden=&quot;true&quot; 加到元素上会把该元素和它的所有子元素从无障碍树上移除。--&gt;</span><br><span class="line">&lt;svg aria-hidden=&#x27;true&#x27;&gt;</span><br><span class="line">  &lt;use :xlink:href=&#x27;symbolId&#x27; :class =&quot;fillClass&quot; :fill=&#x27;color&#x27;/&gt;</span><br><span class="line">&lt;/svg&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; computed &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">const props = defineProps(&#123;</span><br><span class="line">  //显示的svg</span><br><span class="line">  name:&#123;</span><br><span class="line">    type:String,</span><br><span class="line">    required:true</span><br><span class="line">  &#125;,</span><br><span class="line">  //svg图标的颜色</span><br><span class="line">  color:&#123;</span><br><span class="line">    type:String</span><br><span class="line">  &#125;,</span><br><span class="line">  //tailwind指定svg颜色的类名</span><br><span class="line">  fillClass:&#123;</span><br><span class="line">    type:String</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">//真实显示的svg图标（拼接#icon-）</span><br><span class="line">const symbolId = computed(()=&gt;`#icon-$&#123;props.name&#125;`)</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><ol start="2"><li>然后我们在src&#x2F;lib&#x2F;index.js中进行注册</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> svgIcon <span class="keyword">from</span> <span class="string">&#x27;./svg-icon/index.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">install</span>(<span class="params">app</span>)&#123;</span><br><span class="line">    app.<span class="title function_">component</span>(<span class="string">&#x27;m-svg-icon&#x27;</span>,svgIcon)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3.在main.js中进行使用</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mLibs <span class="keyword">from</span> <span class="string">&#x27;./lib&#x27;</span></span><br><span class="line">app.<span class="title function_">use</span>(mLibs)</span><br></pre></td></tr></table></figure><ol start="4"><li>我们首先给tailwind增加一个阴影效果，就是横着拉动那些标签时，有隐隐约约的感觉，在tailwind.config.js中</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">theme</span>: &#123;</span><br><span class="line">  <span class="attr">extend</span>: &#123;</span><br><span class="line">    <span class="attr">boxShadow</span>:&#123;</span><br><span class="line">      <span class="string">&#x27;l-white&#x27;</span>: <span class="string">&#x27;-10px 0 10px white&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><ol start="5"><li>我们在src&#x2F;views&#x2F;main&#x2F;components&#x2F;navigation&#x2F;mobile&#x2F;ndex.vue中的ul下使用我们定义的组件，</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--汉堡按钮--&gt;</span><br><span class="line">&lt;li class=&quot;fixed top-0 right-[-1px] h-4 px-1 flex items-center bg-white z-20 shadow-l-white&quot;&gt;</span><br><span class="line">  &lt;m-svg-icon class=&quot;w-1.5 h-1.5&quot; name=&quot;hamburger&quot;&gt;&lt;/m-svg-icon&gt;</span><br><span class="line">&lt;/li&gt;</span><br></pre></td></tr></table></figure><ol start="6"><li>另外我们在要使原有标签最后一个距离最右边有一定距离，在原有的基础上，class上加上最后一个样式</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;li v-for=&quot;item in data&quot; :key=&quot;item.id&quot; class=&quot;shrink-0 px-1.5 py-0.5 z-10 duration-200 last:mr-4&quot;&gt;&#123;&#123;item.name&#125;&#125;&lt;/li&gt;</span><br></pre></td></tr></table></figure><h2 id="5-6-vite处理svg矢量图"><a href="#5-6-vite处理svg矢量图" class="headerlink" title="5-6 vite处理svg矢量图"></a>5-6 vite处理svg矢量图</h2><p>无论是vue-cli 还是vite 默认他们都不会处理咱们主动导入的svg矢量图标，也就是说<strong>虽然我们把svg图标放入到了项目中，但是vite“无法使用”到它们</strong></p><p>那么怎么办呢？</p><p>此时我们就需要使用到一个 vite 的 plugin，vite-plugin-svg-icons</p><ol><li>安装vite-plugin-svg-icons 到项目中</li></ol><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm i fast-glob</span><br><span class="line">npm i --save-dev vite-plugin-svg-icons@<span class="number">2</span>.<span class="number">0</span>.<span class="number">1</span></span><br></pre></td></tr></table></figure><ol start="2"><li>在vite.config.js中注册</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> path,&#123;join&#125; <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;createSvgIconsPlugin&#125; <span class="keyword">from</span> <span class="string">&#x27;vite-plugin-svg-icons&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// https://vitejs.dev/config/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="title function_">vue</span>(),</span><br><span class="line">    <span class="title function_">createSvgIconsPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">//指定需要缓存的图标文件夹</span></span><br><span class="line">      <span class="comment">//就是说process.cwd()返回的是当前Node.js进程执行时的工作目录</span></span><br><span class="line">      <span class="attr">iconDirs</span>:[path.<span class="title function_">resolve</span>(process.<span class="title function_">cwd</span>(),<span class="string">&#x27;src/assets/icons&#x27;</span>)],</span><br><span class="line">      <span class="comment">//指定symbolId格式，这的symbolId是与src/lib/svg-icon/index.vue中的symbolId对应const symbolId = computed(()=&gt;`#icon-$&#123;props.name&#125;`)</span></span><br><span class="line">      <span class="attr">symbolId</span>:<span class="string">&#x27;icon-[name]&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ],</span><br></pre></td></tr></table></figure><ol start="3"><li>在main.js中注册svg-icons,由于createSvgIconsPlugin给我们生成的是虚拟地址，所以这里就引用一个虚拟地址</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注册svg-icons</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;virtual:svg-icons-register&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="5-7-移动端slider处理"><a href="#5-7-移动端slider处理" class="headerlink" title="5-7 移动端slider处理"></a>5-7 移动端slider处理</h2><p>那么处理好了以上内容之后，接下来我们来处理对应的slider 选中滑块。</p><p>对于选中滑块而言，我们想要处理分为两部分</p><ol><li>slider 滑块的本身样式</li><li>滑块切换时逻辑与滚动动画</li></ol><p><strong>slider 样式处理</strong></p><p>在 src&#x2F;views&#x2F;main&#x2F;components&#x2F;navigation&#x2F;mobile&#x2F;index.vue 中新增：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--滑块--&gt;</span><br><span class="line">&lt;li</span><br><span class="line">  ref=&quot;sliderTarget&quot;</span><br><span class="line">  :style=&quot;sliderStyle&quot;</span><br><span class="line">  class=&quot;absolute h-[22px] bg-zinc-900 rounded-lg duration-200&quot;</span><br><span class="line">&gt;</span><br><span class="line">&lt;/li&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">//滑块</span><br><span class="line">const sliderStyle =ref(&#123;</span><br><span class="line">  transform: &#x27;translateX(0px)&#x27;,</span><br><span class="line">  width: &#x27;60px&#x27;</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p><strong>处理切换逻辑</strong></p><p>当slider 进行切换时，它的当前位置就是通过translatex进行指定，也就是说我们只需要<strong>计算出当前点击的item位置与宽度即可</strong></p><p>那么想要达到这个目的，我们就需要具备以下内容：</p><ol><li>选中的 item T标：currentCategoryIndex</li><li>所有item元素：itemRefs</li><li>ul 的横向滚动偏离位置：ulScrollLeft</li><li>最后在 currentCategoryIndex 发生改变时，获取 item下标元素的left和width，计算 sliderStyle 即可</li></ol><hr><ol><li>首先给li标签增加一个ref</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;li</span><br><span class="line">  v-for=&quot;item in data&quot;</span><br><span class="line">  :key=&quot;item.id&quot;</span><br><span class="line">  class=&quot;shrink-0 px-1.5 py-0.5 z-10 duration-200 last:mr-4&quot;</span><br><span class="line">  :ref=&quot;setItemRef&quot;</span><br><span class="line">&gt;</span><br><span class="line">    &#123;&#123;item.name&#125;&#125;</span><br><span class="line">&lt;/li&gt;</span><br></pre></td></tr></table></figure><ol start="2"><li>选中的 item 下标：currentCategoryIndex</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//选中item下标</span></span><br><span class="line"><span class="keyword">const</span> currentCategoryIndex = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br></pre></td></tr></table></figure><ol start="3"><li>所有item元素：itemRefs；通过1中绑定的函数，我们可以直接获取其中的所有的DOM元素，然后进行判断，如果有值就将他添加到数组里</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取所有的item元素</span></span><br><span class="line"><span class="keyword">let</span> itemRefs = []</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">setItemRef</span> = (<span class="params">el</span>) =&gt;&#123;</span><br><span class="line"><span class="keyword">if</span> (el)&#123;</span><br><span class="line">  itemRefs.<span class="title function_">push</span>(el)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>又因为setItemRef是每次DOM进行变化的时候都会执行一遍，这样的话每次只要改变一次数据，就会重复导入，所以我们新增一个监听函数，让他在每次DOM变化前将数组置空</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//数据改变之后，DOM变化之前</span><br><span class="line">onBeforeUpdate(() =&gt;&#123;</span><br><span class="line">  itemRefs = []</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ol start="5"><li>我们要拿到ul 的横向滚动偏离位置：ulScrollLeft，首先我们先获取ul元素，然后通过vueuse-&gt;useScroll获取响应式得scroll滚动距离。</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--先绑定一个ref--&gt;</span><br><span class="line">&lt;ul ref=&quot;ulTarget&quot;&gt;</span><br><span class="line">  </span><br><span class="line"> //获取ul元素</span><br><span class="line">const ulTarget = ref(null)</span><br><span class="line">//通过vueuse-&gt;useScroll获取响应式得scroll滚动距离</span><br><span class="line">const &#123;x: ulScrollLeft&#125; =useScroll(ulTarget)</span><br></pre></td></tr></table></figure><ol start="6"><li>最后在 currentCategoryIndex 发生改变时，获取 item下标元素的left和width，计算 sliderStyle</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//增加了一个index，又增加一个onItemClick方法</span><br><span class="line">&lt;li</span><br><span class="line">  v-for=&quot;(item,index) in data&quot;</span><br><span class="line">  :key=&quot;item.id&quot;</span><br><span class="line">  class=&quot;shrink-0 px-1.5 py-0.5 z-10 duration-200 last:mr-4&quot;</span><br><span class="line">  :ref=&quot;setItemRef&quot;</span><br><span class="line">  @click=&quot;onItemClick(index)&quot;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//item点击事件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onItemClick</span> =(<span class="params">index</span>)=&gt;&#123;</span><br><span class="line">  currentCategoryIndex.<span class="property">value</span> =index</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//watch监听</span></span><br><span class="line"><span class="title function_">watch</span>(currentCategoryIndex,<span class="function">(<span class="params">val</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; left,width &#125; = itemRefs[val].<span class="title function_">getBoundingClientRect</span>()</span><br><span class="line">  sliderStyle.<span class="property">value</span> = &#123;</span><br><span class="line">    <span class="comment">//滑块的位置= ul横向滚动的位置+当前元素的left-ul的padding</span></span><br><span class="line">    <span class="attr">transform</span>: <span class="string">`translateX(<span class="subst">$&#123;ulScrollLeft.value+left-<span class="number">10</span>&#125;</span>px)`</span>,</span><br><span class="line">    <span class="attr">width</span>: width+<span class="string">&#x27;px&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ol start="7"><li>最后给增加一个点击哪个标签哪个标签就显示高亮样式</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//增加一个：class</span><br><span class="line">&lt;li</span><br><span class="line">  v-for=&quot;(item,index) in data&quot;</span><br><span class="line">  :key=&quot;item.id&quot;</span><br><span class="line">  class=&quot;shrink-0 px-1.5 py-0.5 z-10 duration-200 last:mr-4&quot;</span><br><span class="line">  :class=&quot;&#123;</span><br><span class="line">    &#x27;text-zinc-100&#x27;: currentCategoryIndex === index</span><br><span class="line">  &#125;&quot;</span><br><span class="line">  :ref=&quot;setItemRef&quot;</span><br><span class="line">  @click=&quot;onItemClick(index)&quot;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure><h2 id="5-8-补全category数据"><a href="#5-8-补全category数据" class="headerlink" title="5-8 补全category数据"></a>5-8 补全category数据</h2><ol><li>首先在常量模块src&#x2F;constants&#x2F;index.js中定义category的本地构建数据</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//category的本地构建数据</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">ALL_CATEGORY_ITEM</span> =&#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="string">&#x27;all&#x27;</span>,</span><br><span class="line">  <span class="attr">name</span>:<span class="string">&#x27;全部&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>我们在获取数据源的时候将这个直接插入到头部就可以,在navigation&#x2F;index.vue中</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//增加unshift方法</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getCategoryData</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;categorys&#125; = <span class="keyword">await</span> <span class="title function_">getCategory</span>()</span><br><span class="line">  categoryData.<span class="property">value</span> = categorys</span><br><span class="line">  categoryData.<span class="property">value</span>.<span class="title function_">unshift</span>(<span class="variable constant_">ALL_CATEGORY_ITEM</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>如果发现开始的滑块跟全部标签对不上那么就先修改navigation&#x2F;mobile&#x2F;index.vue的滑块样式</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//滑块</span></span><br><span class="line"><span class="keyword">const</span> sliderStyle =<span class="title function_">ref</span>(&#123;</span><br><span class="line">  <span class="attr">transform</span>: <span class="string">&#x27;translateX(0px)&#x27;</span>,</span><br><span class="line">  <span class="attr">width</span>: <span class="string">&#x27;60px&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="5-9-通用组件：弹出窗口-popup能力分析"><a href="#5-9-通用组件：弹出窗口-popup能力分析" class="headerlink" title="5-9 通用组件：弹出窗口-popup能力分析"></a>5-9 通用组件：弹出窗口-popup能力分析</h2><p>当我们点击<strong>面包屑按钮</strong>时，会有一个弹出窗口 popup 自低而上弹出，那么这样的一个功能，我们一样可以把它处理为项目的<strong>通用组件</strong></p><p>那么想要处理popup的话，首先就需要先搞清楚popup的能力。</p><ol><li>当popup展开时，内容视图应该不属于任何一个<strong>组件内部</strong>，而应该直接被插入到body下面</li><li>popup应该包含两部分内容，一部分为背景蒙版，一部分为内容的包裹容器</li><li>popup应该通过一个双向绑定进行控制展示和隐藏</li><li>popup 展示时，滚动应该被锁定</li><li>内容区域应该接收所有的 attrs，并且应该通过插槽让调用方指定其内容</li></ol><h2 id="5-9-通用组件：弹出窗口-popup-实现"><a href="#5-9-通用组件：弹出窗口-popup-实现" class="headerlink" title="5-9 通用组件：弹出窗口-popup 实现"></a>5-9 通用组件：弹出窗口-popup 实现</h2><ol><li>当popup展开时，内容视图应该不属于任何一个<strong>组件内部</strong>，而应该直接被插入到body下面。这里使用的就是vue3中的一个标签</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">  &lt;teleport to=&quot;body&quot;&gt;</span><br><span class="line">    &lt;!-- 蒙版--&gt;</span><br><span class="line">      &lt;div&gt;蒙版&lt;/div&gt;</span><br><span class="line">    &lt;!-- 内容--&gt;</span><br><span class="line">      &lt;div&gt;内容&lt;/div&gt;</span><br><span class="line">  &lt;/teleport&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><ol start="2"><li>我们给蒙版和内容都增加过度和动画</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;teleport to=&quot;body&quot;&gt;</span><br><span class="line">  &lt;!-- 蒙版--&gt;</span><br><span class="line">  &lt;transition name=&quot;fade&quot;&gt;</span><br><span class="line">    &lt;div &gt;蒙版&lt;/div&gt;</span><br><span class="line">  &lt;/transition&gt;</span><br><span class="line">  &lt;!-- 内容--&gt;</span><br><span class="line">  &lt;transition name=&quot;popup-down-up&quot;&gt;</span><br><span class="line">    &lt;div&gt;内容&lt;/div&gt;</span><br><span class="line">  &lt;/transition&gt;</span><br><span class="line"></span><br><span class="line">&lt;/teleport&gt;</span><br></pre></td></tr></table></figure><ol start="3"><li>我们定义蒙版和内容的过度和动画样式</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line">//fade动画</span><br><span class="line">.fade-enter-active,</span><br><span class="line">.fade-leave-active&#123;</span><br><span class="line">  transition: all 0.3s;</span><br><span class="line">&#125;</span><br><span class="line">//准备进入，离开完成</span><br><span class="line">.fade-enter-from,</span><br><span class="line">.fade-enter-to&#123;</span><br><span class="line">  opacity: 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.popup-down-up-enter-active,</span><br><span class="line">.popup-down-up-leave-active&#123;</span><br><span class="line">  transition: all 0.3s;</span><br><span class="line">&#125;</span><br><span class="line">.popup-down-up-enter-from,</span><br><span class="line">.popup-down-up-enter-to&#123;</span><br><span class="line">  transform: translateY(100%);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><ol start="4"><li>给蒙版和内容绑定样式</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;teleport to=&quot;body&quot;&gt;</span><br><span class="line">  &lt;!-- 蒙版--&gt;</span><br><span class="line">  &lt;transition name=&quot;fade&quot;&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      class=&#x27;w-screen h-screen bg-zinc-900/80 z-40 fixed top-0 left-0&#x27;</span><br><span class="line">    &gt;&lt;/div&gt;</span><br><span class="line">  &lt;/transition&gt;</span><br><span class="line">  &lt;!-- 内容--&gt;</span><br><span class="line">  &lt;transition name=&quot;popup-down-up&quot;&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      v-bind=&quot;$attrs&quot;</span><br><span class="line">      class=&#x27;w-screen bg-white z-50 fixed bottom-0 &#x27;&gt;</span><br><span class="line">      &lt;slot/&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/transition&gt;</span><br><span class="line"></span><br><span class="line">&lt;/teleport&gt;</span><br></pre></td></tr></table></figure><ol start="5"><li>popup通过一个双向绑定进行控制展示和隐藏</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> props = <span class="title function_">defineProps</span>(&#123;</span><br><span class="line">  <span class="attr">modelValue</span>:&#123;</span><br><span class="line">    <span class="attr">required</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">type</span>:<span class="title class_">Boolean</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> emits = <span class="title function_">defineEmits</span>([<span class="string">&#x27;update:modelValue&#x27;</span>])</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;teleport to=&quot;body&quot;&gt;</span><br><span class="line">  &lt;!-- 蒙版--&gt;</span><br><span class="line">  &lt;transition name=&quot;fade&quot;&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      v-if=&#x27;modelValue&#x27;</span><br><span class="line">      class=&#x27;w-screen h-screen bg-zinc-900/80 z-40 fixed top-0 left-0&#x27;</span><br><span class="line">      @click=&quot;emits(&#x27;update:modelValue&#x27;,false)&quot;</span><br><span class="line">    &gt;&lt;/div&gt;</span><br><span class="line">  &lt;/transition&gt;</span><br><span class="line">  &lt;!-- 内容--&gt;</span><br><span class="line">  &lt;transition name=&quot;popup-down-up&quot;&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      v-if=&#x27;modelValue&#x27;</span><br><span class="line">      v-bind=&quot;$attrs&quot;</span><br><span class="line">      class=&#x27;w-screen bg-white z-50 fixed bottom-0 &#x27;&gt;</span><br><span class="line">      &lt;slot/&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/transition&gt;</span><br></pre></td></tr></table></figure><ol start="6"><li>在lib&#x2F;index.js中定义组件，在第一步之后，并且插入到mobile&#x2F;index.vue的ul后面</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> popup <span class="keyword">from</span> <span class="string">&#x27;./popup/index.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">install</span>(<span class="params">app</span>)&#123;</span><br><span class="line">    app.<span class="title function_">component</span>(<span class="string">&#x27;m-popup&#x27;</span>,popup)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;m-popup&gt;&lt;/m-popup&gt;</span><br></pre></td></tr></table></figure><ol start="7"><li>在mobile&#x2F;index.vue中增加</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//控制popup展示</span></span><br><span class="line"><span class="keyword">const</span> isVisable = <span class="title function_">ref</span>(<span class="literal">false</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onShowPopup</span> =(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  isVisable.<span class="property">value</span>=<span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--汉堡按钮增加click--&gt;</span><br><span class="line">&lt;li</span><br><span class="line">  class=&quot;fixed top-0 right-[-1px] h-4 px-1 flex items-center bg-white z-20 shadow-l-white&quot;</span><br><span class="line">  @click=&#x27;onShowPopup&#x27;&gt;</span><br><span class="line">  &lt;m-svg-icon class=&quot;w-1.5 h-1.5&quot; name=&quot;hamburger&quot;&gt;&lt;/m-svg-icon&gt;</span><br><span class="line">&lt;/li&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">组件传值</span><br><span class="line">&lt;m-popup v-model=&#x27;isVisable&#x27;&gt;&lt;/m-popup&gt;</span><br></pre></td></tr></table></figure><ol start="8"><li>popup 展示时，滚动应该被锁定</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useScrollLock&#125; <span class="keyword">from</span> <span class="string">&#x27;@vueuse/core&#x27;</span></span><br><span class="line"><span class="comment">//锁定滚动</span></span><br><span class="line"><span class="keyword">const</span> isLocked =<span class="title function_">useScrollLock</span>(<span class="variable language_">document</span>.<span class="property">body</span>)</span><br><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">  <span class="function">()=&gt;</span>props.<span class="property">modelValue</span>,</span><br><span class="line">  <span class="function">(<span class="params">val</span>)=&gt;</span>&#123;</span><br><span class="line">    isLocked.<span class="property">value</span> =val</span><br><span class="line">  &#125;,&#123;</span><br><span class="line">    <span class="attr">immediate</span>:<span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="5-10-组件间双向数据绑定功能优化"><a href="#5-10-组件间双向数据绑定功能优化" class="headerlink" title="5-10 组件间双向数据绑定功能优化"></a>5-10 组件间双向数据绑定功能优化</h2><p>这里我们使用useVModel，直接完成双向数据绑定。 props + emit -&gt; ref</p><ol><li>首先我们引入useVModel</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useVModel&#125; <span class="keyword">from</span> <span class="string">&#x27;@vueuse/core&#x27;</span></span><br><span class="line"><span class="comment">//是一个响应式数据，当isVisable值发生变化时，会自动触发emit修改modelValue</span></span><br><span class="line"><span class="keyword">const</span> isVisable = <span class="title function_">useVModel</span>(props)</span><br></pre></td></tr></table></figure><ol start="2"><li>我们将使用modelValue全部换掉，蒙版的点击方法也换了</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;teleport to=&quot;body&quot;&gt;</span><br><span class="line">  &lt;!-- 蒙版--&gt;</span><br><span class="line">  &lt;transition name=&quot;fade&quot;&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      v-if=&#x27;isVisable&#x27;</span><br><span class="line">      class=&#x27;w-screen h-screen bg-zinc-900/80 z-40 fixed top-0 left-0&#x27;</span><br><span class="line">      @click=&quot;isVisable = false&quot;</span><br><span class="line">    &gt;&lt;/div&gt;</span><br><span class="line">  &lt;/transition&gt;</span><br><span class="line">  &lt;!-- 内容--&gt;</span><br><span class="line">  &lt;transition name=&quot;popup-down-up&quot;&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      v-if=&#x27;isVisable&#x27;</span><br><span class="line">      v-bind=&quot;$attrs&quot;</span><br><span class="line">      class=&#x27;w-screen bg-white z-50 fixed bottom-0 &#x27;&gt;</span><br><span class="line">      &lt;slot/&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;/transition&gt;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">  isVisable,<span class="comment">//这也换了</span></span><br><span class="line">  <span class="function">(<span class="params">val</span>)=&gt;</span>&#123;</span><br><span class="line">    isLocked.<span class="property">value</span> =val</span><br><span class="line">  &#125;,&#123;</span><br><span class="line">    <span class="attr">immediate</span>:<span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="5-11-vite通用组件自动化注册"><a href="#5-11-vite通用组件自动化注册" class="headerlink" title="5-11 vite通用组件自动化注册"></a>5-11 vite通用组件自动化注册</h2><p>目前我们在项目中已经完成了两个通用组件，将来我们还会完成更多的通用组件开发。</p><p>那么如果每次开发完成一个通用组件之后，都去手动进行注册，未免有些过于麻烦了，所以我们期望通过vite 提供的功能，进行通用组件的自动化注册那么，如果想要完成这个功能的话，就需要使用到两个关键的知识点：</p><ol><li>vite的Glob 导入功能：该功能可以帮助我们在文件系统中导入多个模块</li><li>vue defineAsyncCommponent方法：该方法可以创建一个<strong>按需加载的异步组件</strong></li></ol><p>基于以上两个方法，实现组件<strong>自动注册</strong></p><p>在src&#x2F;libs&#x2F;index.js 中：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineAsyncComponent &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">install</span>(<span class="params">app</span>)&#123;</span><br><span class="line">    <span class="comment">//1.获取当前路径下的所有文件夹的index.vue</span></span><br><span class="line">    <span class="keyword">const</span> components = <span class="keyword">import</span>.<span class="property">meta</span>.<span class="title function_">glob</span>(<span class="string">&#x27;./*/index.vue&#x27;</span>)</span><br><span class="line">    <span class="comment">//2.遍历获取到的组件模块</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> [fullPath,fn] <span class="keyword">of</span> <span class="title class_">Object</span>.<span class="title function_">entries</span>(components))&#123;</span><br><span class="line">      <span class="keyword">const</span> componentName = <span class="string">&#x27;m-&#x27;</span>+fullPath.<span class="title function_">replace</span>(<span class="string">&#x27;./&#x27;</span>,<span class="string">&#x27;&#x27;</span>).<span class="title function_">split</span>(<span class="string">&#x27;/&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">      <span class="comment">//3.利用app.component进行注册</span></span><br><span class="line">      app.<span class="title function_">component</span>(componentName,<span class="title function_">defineAsyncComponent</span>(fn))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-12-业务组件：移动端弹层menu"><a href="#5-12-业务组件：移动端弹层menu" class="headerlink" title="5-12 业务组件：移动端弹层menu"></a>5-12 业务组件：移动端弹层menu</h2><ol><li>我们先新建&#x2F;views&#x2F;main&#x2F;components&#x2F;menu&#x2F;index.vue</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;div class=&#x27;py-2 h-[80vh] flex flex-col&#x27;&gt;</span><br><span class="line">  &lt;h2 class=&#x27;text-xl text-zinc-900 font-bold mb-2 px-1&#x27;&gt;</span><br><span class="line">    所有分类</span><br><span class="line">  &lt;/h2&gt;</span><br><span class="line">  &lt;ul class=&#x27;overflow-y-scroll&#x27;&gt;</span><br><span class="line">    &lt;li</span><br><span class="line">      v-for=&quot;(item,index)in categorys&quot;</span><br><span class="line">      :key=&quot;item.id&quot;</span><br><span class="line">      class=&quot;text-lg text-zinc-900 px-1 py-1.5</span><br><span class="line">      duration-100 active:bg-zinc-100&quot;</span><br><span class="line">      @click=&quot;$emit(&#x27;onItemClick&#x27;,index)&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &#123;&#123;item.name&#125;&#125;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">  &lt;/ul&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">//需要接收的数据</span><br><span class="line">defineProps(&#123;</span><br><span class="line">  categorys:&#123;</span><br><span class="line">    type:Array,</span><br><span class="line">    required:true</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">//推荐，所有事件都进行一个手动注册</span><br><span class="line">defineEmits([&#x27;onItemClick&#x27;])</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><ol start="2"><li>在&#x2F;views&#x2F;main&#x2F;components&#x2F;mobile&#x2F;index.vue中导入组件；然后使用组件（绑定需要传入的数据，并绑定1中的点击事件）</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">MenuVue</span> <span class="keyword">from</span> <span class="string">&#x27;@/views/main/components/menu/index.vue&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;m-popup v-model=&#x27;isVisable&#x27;&gt;</span><br><span class="line">  &lt;menu-vue :categorys=&quot;data&quot; @onItemClick=&quot;onItemClick&quot;&gt;&lt;/menu-vue&gt;</span><br><span class="line">&lt;/m-popup&gt;</span><br></pre></td></tr></table></figure><ol start="3"><li>我们想当点击menu中数据的上面导航栏也跳转到相应的位置，并自动退出menu，只需要在点击事件下修改下可见值。</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//item点击事件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onItemClick</span> =(<span class="params">index</span>)=&gt;&#123;</span><br><span class="line">  currentCategoryIndex.<span class="property">value</span> =index</span><br><span class="line">  isVisable.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-13-总结"><a href="#5-13-总结" class="headerlink" title="5-13 总结"></a>5-13 总结</h2><p>在本章中我们处理了<strong>移动端的navgationBar模块</strong>，在处理该模块的过程中，我们做了：</p><ol><li><p>自定义了两个通用组件，这两个组件都是将来可以被大家放入到中台组件库&#x2F;物料库中的：</p><ol><li>svg-icon</li><li>popup</li></ol></li><li><p>修正了rem值，对于移动端的rem处理目前可以根据设备的不同来自动修正</p></li><li><p>基于vite的svg矢量图导入和自动组件注册</p></li><li><p>介绍了vueuse中更多的功能方法</p></li></ol><h1 id="6、企业级通用业务Header处理方案——结合中台组件的业务组件处理"><a href="#6、企业级通用业务Header处理方案——结合中台组件的业务组件处理" class="headerlink" title="6、企业级通用业务Header处理方案——结合中台组件的业务组件处理"></a>6、企业级通用业务Header处理方案——结合中台组件的业务组件处理</h1><p>Header 模块是 PC 端业务中的高频功能，通用性极强。那么对于这样的功能大厂通常如何去进行处理呢？当它与中台组件库结合时，又会碰撞出什么样的火花呢？</p><hr><h2 id="6-1-处理PC端基础架构"><a href="#6-1-处理PC端基础架构" class="headerlink" title="6-1 处理PC端基础架构"></a>6-1 处理PC端基础架构</h2><p>PC端将具备两个路由的出口：</p><ol><li>一级路由出口：APP.vue中</li><li>二级路由出口：Main.vue中</li></ol><p>那么对于我们当前的代码而言，我们仅存在一个一级路由出口，所以接下来我们就需要处理二级路由出口</p><ol><li>创建 src&#x2F;views&#x2F;layout&#x2F;index.vue文件，表示一级路由出口对应的组件</li><li>在layout&#x2F;components 中分别创建三个业务组件：<ol><li>header&#x2F;index.vue：表示PC端头部区域</li><li>main.vue：二级路由出口</li><li>.floating：右下角悬浮区域</li></ol></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div&gt;header&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;main&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div &gt;floating&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><ol start="3"><li>在src&#x2F;views&#x2F;layout&#x2F;index.vue文件中，导入这三个组件</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div class=&#x27;h-screen&#x27;&gt;</span><br><span class="line">  &lt;header-vue&gt;&lt;/header-vue&gt;</span><br><span class="line">  &lt;main-vue &gt;&lt;/main-vue&gt;</span><br><span class="line">  &lt;floating-vue&gt;&lt;/floating-vue&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import headerVue from &#x27;./components/header/index.vue&#x27;</span><br><span class="line">import mainVue from &#x27;./components/main.vue&#x27;</span><br><span class="line">import floatingVue from &#x27;./components/floating.vue&#x27;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><ol start="4"><li>在router&#x2F;modules&#x2F;mobile-router增加路由</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> [&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;main&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>: <span class="function">()=&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/layout/index.vue&#x27;</span>),</span><br><span class="line">  <span class="attr">children</span>:[]</span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure><ol start="5"><li>手动设置页面布局，让头部高为72px，main为整个页面减去头部，悬浮框在右下角。<ol><li>首先在tailwind.config.js中增加高的样式</li><li>src&#x2F;views&#x2F;layout&#x2F;index.vue文件中使用</li><li>悬浮框就在layout&#x2F;components &#x2F;floating中设置</li></ol></li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">theme</span>: &#123;</span><br><span class="line">  <span class="attr">extend</span>: &#123;</span><br><span class="line">    <span class="attr">height</span>:&#123;</span><br><span class="line">      <span class="attr">header</span>:<span class="string">&#x27;72px&#x27;</span>,</span><br><span class="line">      <span class="attr">main</span>:<span class="string">&#x27;calc(100vh-72px)&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div class=&#x27;h-screen&#x27;&gt;</span><br><span class="line">  &lt;header-vue class=&#x27;h-header&#x27;&gt;&lt;/header-vue&gt;</span><br><span class="line">  &lt;main-vue class=&#x27;h-main&#x27;&gt;&lt;/main-vue&gt;</span><br><span class="line">  &lt;floating-vue&gt;&lt;/floating-vue&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import headerVue from &#x27;./components/header/index.vue&#x27;</span><br><span class="line">import mainVue from &#x27;./components/main.vue&#x27;</span><br><span class="line">import floatingVue from &#x27;./components/floating.vue&#x27;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&#x27;fixed bottom-10 right-2&#x27;&gt;floating&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h2 id="6-2-PC端Header模块处理分析与简单实现"><a href="#6-2-PC端Header模块处理分析与简单实现" class="headerlink" title="6-2 PC端Header模块处理分析与简单实现"></a>6-2 PC端Header模块处理分析与简单实现</h2><p>我们在src&#x2F;views&#x2F;layout&#x2F;components&#x2F;header中建立三个模块分别是：</p><ol><li>header-search&#x2F;index.vue</li><li>header-my.vue</li><li>header-theme.vue</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;search&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;my&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;theme&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>然后在src&#x2F;views&#x2F;layout&#x2F;components&#x2F;header中进行使用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&#x27;w-full bg-white border-b border-b-zinc-200</span><br><span class="line">  px-2 py-1&#x27;&gt;</span><br><span class="line">    &lt;div class=&#x27;flex items-center&#x27;&gt;</span><br><span class="line">      &lt;img</span><br><span class="line">        class=&#x27;h-4 cusor-pointer mr-2&#x27;</span><br><span class="line">        src=&quot;https://m.imooc.com/static/wap/static/common/img/logo-small@2x.png&quot;</span><br><span class="line">        @click=&#x27;onToHome&#x27;</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;header-search-vue class=&#x27;mr-1&#x27;&gt;&lt;/header-search-vue&gt;</span><br><span class="line">      &lt;header-theme-vue class=&#x27;mr-1&#x27;&gt;&lt;/header-theme-vue&gt;</span><br><span class="line">      &lt;header-my-vue&gt;&lt;/header-my-vue&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import headerSearchVue from &#x27;./header-search/index.vue&#x27;</span><br><span class="line">import headerThemeVue from &#x27;./header-theme.vue&#x27;</span><br><span class="line">import headerMyVue from &#x27;./header-my.vue&#x27;</span><br><span class="line">import &#123; useRouter &#125; from &#x27;vue-router&#x27;</span><br><span class="line"></span><br><span class="line">//router===this.$router</span><br><span class="line">const router = useRouter()</span><br><span class="line">const onToHome = () =&gt;&#123;</span><br><span class="line">  router.push(&#x27;/&#x27;)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h2 id="6-3-通用组件：search搜索框能力分析"><a href="#6-3-通用组件：search搜索框能力分析" class="headerlink" title="6-3 通用组件：search搜索框能力分析"></a>6-3 通用组件：search搜索框能力分析</h2><p>对于header 中的模块我们依次进行处理</p><p>search 部分为搜索框，对于该搜索框而言我们期望把它做成通用组件</p><p>那么既然是通用组件，我们就需要分析它的能力，它应该具备什么样的功能：</p><ol><li>输入内容实现双向数据绑定</li><li>鼠标移入与获取焦点时的动画</li><li>一键清空文本功能</li><li>搜索触发功能</li><li>可控制，可填充的下拉展示区</li><li>监听到以下事件列表：<ol><li>clear：删除所有文本事件</li><li>input：输入事件</li><li>focus：获取焦点事件</li><li>blur：失去焦点事件</li><li>search：触发搜索（点击或回车）事件</li></ol></li></ol><h2 id="6-4-通用组件：search搜索框样式处理"><a href="#6-4-通用组件：search搜索框样式处理" class="headerlink" title="6-4 通用组件：search搜索框样式处理"></a>6-4 通用组件：search搜索框样式处理</h2><ol><li>我们创建通用组件src&#x2F;lib&#x2F;search&#x2F;index.vue</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    class=&#x27;group relative p-0.5 rounded-xl border-white</span><br><span class="line">    duration-500 hover:bg-red-100/40&#x27;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;!--搜索图标--&gt;</span><br><span class="line">      &lt;m-svg-icon</span><br><span class="line">        class=&#x27;w-1.5 h-1.5 absolute translate-y-[-50%] top-[50%] left-2&#x27;</span><br><span class="line">        name=&quot;search&quot;</span><br><span class="line">        color=&quot;#70707&quot;</span><br><span class="line">      &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">      &lt;!--输入框--&gt;</span><br><span class="line">      &lt;input</span><br><span class="line">        class=&#x27;block w-full h-[44px] pl-4 outline-0</span><br><span class="line">        bg-zinc-100 caret-zinc-400 rounded-xl</span><br><span class="line">        text-zinc-900 tracking-wide text-sm font-semibold border</span><br><span class="line">        border-zinc-100 focus:border-red-300 group-hover:bg-white</span><br><span class="line">        group-hover:border-zinc-200&#x27;</span><br><span class="line">        type=&quot;text&quot;</span><br><span class="line">        placeholder=&quot;搜索&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;!--删除按钮--&gt;</span><br><span class="line">      &lt;m-svg-icon</span><br><span class="line">        name = &quot;input-delete&quot;</span><br><span class="line">        class=&#x27;w-1.5 h-1.5 absolute translate-y-[-50%] top-[50%] right-9</span><br><span class="line">        cursor-pointer duration-500&#x27;</span><br><span class="line">      &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">      &lt;!--分割线--&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class=&#x27;opacity-0 h-1.5 w-[1px] absolute translate-y-[-50%] top-[50%]</span><br><span class="line">        right-[62px] duration-500 bg-zinc-200 group-hover:opacity-100&#x27;</span><br><span class="line">      &gt;&lt;/div&gt;</span><br><span class="line">      &lt;!--TODO:搜索按钮（通用组件）--&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!--下拉区--&gt;</span><br><span class="line">    &lt;transition name=&#x27;slide&#x27;&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class=&#x27;max-h-[368px] w-full text-base overflow-auto bg-white</span><br><span class="line">        absolute z-20 left-0 top-[56px] p-2 rounded border border-zinc-200</span><br><span class="line">        duration-200 hover:shadow-2xl&#x27;</span><br><span class="line">      &gt;&lt;/div&gt;</span><br><span class="line">    &lt;/transition&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line">.slide-enter-active,</span><br><span class="line">.slide-leave-active&#123;</span><br><span class="line">  transition:all 0.5s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.slide-enter-from,</span><br><span class="line">.slide-leave-to&#123;</span><br><span class="line">  opacity: 0;</span><br><span class="line">  transform: translateY(40px);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><ol start="2"><li>我们不需要在进行路由注册了，已经自动注册过了，直接使用就行，在views&#x2F;layout&#x2F;components&#x2F;header&#x2F;header-search&#x2F;index.vue</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;m-search&gt;&lt;/m-search&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h2 id="6-5-通用组件：button按钮能力分析"><a href="#6-5-通用组件：button按钮能力分析" class="headerlink" title="6-5 通用组件：button按钮能力分析"></a>6-5 通用组件：button按钮能力分析</h2><p>现在咱们的search 通用组件还差最后的一个<strong>按钮显示</strong></p><p>因为咱们在课程中会经常使用到各种各样的button按钮组件，所以说我们期望拥有一个button 按钮通用组件</p><p>那么对于这个按钮来说，我们期望拥有以下能力：</p><ol><li>可以显示文字按钮，并提供Loading功能</li><li>可以显示 icon按钮，并可以任意指定icon颜色</li><li>可开关的点击动画</li><li>可以指定各种风格和大小</li><li>当指定的风格或大小不符合预设时，需要给开发者以提示消息</li></ol><h2 id="6-6-通用组件：button按钮功能实现"><a href="#6-6-通用组件：button按钮功能实现" class="headerlink" title="6-6 通用组件：button按钮功能实现-"></a>6-6 通用组件：button按钮功能实现-</h2><ol><li>我们创建lib&#x2F;button&#x2F;index.vue</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;button</span><br><span class="line">    class=&#x27;text-xs text-center rounded duration-150 flex justify-center items-center&#x27;</span><br><span class="line">    :class=&quot;[</span><br><span class="line">      typeEnum[type],</span><br><span class="line">      sizeEnum[sizeKey].button,</span><br><span class="line">      &#123;</span><br><span class="line">        &#x27;active:scale-105&#x27;:isActiveAnim</span><br><span class="line">      &#125;</span><br><span class="line">    ]&quot;</span><br><span class="line">    @click.stop=&#x27;onBtnClick&#x27;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;!-- loading--&gt;</span><br><span class="line">    &lt;m-svg-icon</span><br><span class="line">      v-if=&#x27;loading&#x27;</span><br><span class="line">      name=&#x27;loading&#x27;</span><br><span class="line">      class=&#x27;w-2 h-2 animate-spin mr-1&#x27;</span><br><span class="line">    &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">    &lt;!-- icon按钮--&gt;</span><br><span class="line">    &lt;m-svg-icon</span><br><span class="line">      v-if=&#x27;icon&#x27;</span><br><span class="line">      :name=&#x27;icon&#x27;</span><br><span class="line">      class=&#x27;m-auto&#x27;</span><br><span class="line">      :class=&#x27;sizeEnum[sizeKey].icon&#x27;</span><br><span class="line">      :color=&#x27;iconColor&#x27;</span><br><span class="line">      :fillClass=&#x27;iconClass&#x27;</span><br><span class="line">    &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">    &lt;!-- icon按钮--&gt;</span><br><span class="line">    &lt;slot v-else/&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;!--1.构建 type风格可选项和size大小可选项--&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">const EMITS_CLICK=&#x27;click&#x27;</span><br><span class="line">//type可选项：表示按钮风格</span><br><span class="line">const typeEnum = &#123;</span><br><span class="line">  primary:&#x27;text-white bg-zinc-800 hover:bg-zinc-900 active:bg-zinc-800&#x27;,</span><br><span class="line">  main:&#x27;text-white bg-main hover:bg-hover-main active:bg-main&#x27;,</span><br><span class="line">  info:&#x27;text-zinc-800 bg-zinc-200 hover:bg-zinc-300 active:bg-zinc-200&#x27;</span><br><span class="line">&#125;</span><br><span class="line">//size可选项：表示按钮的大小。区分文字按钮和icon按钮</span><br><span class="line">const sizeEnum = &#123;</span><br><span class="line">  //文字按钮</span><br><span class="line">  default:&#123;</span><br><span class="line">    button:&#x27;w-8 h-4 text-sm&#x27;,</span><br><span class="line">    icon:&#x27;&#x27;</span><br><span class="line">  &#125;,</span><br><span class="line">  //icon按钮</span><br><span class="line">  &#x27;icon-default&#x27;:&#123;</span><br><span class="line">    button:&#x27;w-4 h-4&#x27;,</span><br><span class="line">    icon:&#x27;w-1.5 h-1.5&#x27;</span><br><span class="line">  &#125;,</span><br><span class="line">  small:&#123;</span><br><span class="line">    button:&#x27;w-7 h-3 text-base&#x27;,</span><br><span class="line">    icon:&#x27;&#x27;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#x27;icon-small&#x27;:&#123;</span><br><span class="line">    button:&#x27;w-3 h-3&#x27;,</span><br><span class="line">    icon:&#x27;w-1.5 h-1.5&#x27;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">/**</span><br><span class="line"> * 1.构建 type风格可选项和size大小可选项</span><br><span class="line"> 2.通过props让开发者控制按钮3.区分 icon button和 text button</span><br><span class="line"> 4.依据当前的数据，实现视图</span><br><span class="line"> 5.处理点击事件</span><br><span class="line"> */</span><br><span class="line">import &#123; computed &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">const props = defineProps(&#123;</span><br><span class="line">  //icon图标</span><br><span class="line">  icon:String,</span><br><span class="line">  //icon颜色</span><br><span class="line">  iconColor:String,</span><br><span class="line">  //icon图标类名（taliwind）</span><br><span class="line">  iconClass:String,</span><br><span class="line">  //按钮风格</span><br><span class="line">  type: &#123;</span><br><span class="line">    type: String,</span><br><span class="line">    default: &#x27;main&#x27;,</span><br><span class="line">    validator(val) &#123;</span><br><span class="line">      //1.获取所有的可选项</span><br><span class="line">      const keys = Object.keys(typeEnum)</span><br><span class="line">      //2.开发者这顶的风格在可选项中嘛</span><br><span class="line">      const result = keys.includes(val)</span><br><span class="line">      if (!result) &#123;</span><br><span class="line">        throw new Error(`你的type必须是$&#123;keys.join(&#x27;、&#x27;)&#125;中的一个`)</span><br><span class="line">      &#125;</span><br><span class="line">      return result</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">    //大小风格</span><br><span class="line">    size:&#123;</span><br><span class="line">      type:String,</span><br><span class="line">      default:&#x27;default&#x27;,</span><br><span class="line">      validator(val) &#123;</span><br><span class="line">        const keys = Object.keys(sizeEnum).filter((key)=&gt;</span><br><span class="line">        !key.includes(&#x27;icon&#x27;))</span><br><span class="line">        const result = keys.includes(val)</span><br><span class="line">        if (!result)&#123;</span><br><span class="line">          throw new Error(`你的size必须是$&#123;keys.join(&#x27;、&#x27;)&#125;中的一个`)</span><br><span class="line">        &#125;</span><br><span class="line">        return result</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  //按钮点击时，是否需要动画</span><br><span class="line">  isActiveAnim:&#123;</span><br><span class="line">    type:Boolean,</span><br><span class="line">    default:true</span><br><span class="line">  &#125;,</span><br><span class="line">  //加载状态</span><br><span class="line">  loading:&#123;</span><br><span class="line">    type:Boolean,</span><br><span class="line">    default:false</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">const emits = defineEmits([EMITS_CLICK])</span><br><span class="line">//props.size</span><br><span class="line">const sizeKey = computed(()=&gt;&#123;</span><br><span class="line">  return props.icon ? &#x27;icon-&#x27;+props.size :props.size</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 点击事件处理</span><br><span class="line"> */</span><br><span class="line">const onBtnClick=()=&gt;&#123;</span><br><span class="line">  if (props.loading) return</span><br><span class="line">  emits(EMITS_CLICK)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><ol start="2"><li>在tailwind.config.js中新增样式</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">colors</span>:&#123;</span><br><span class="line">  <span class="attr">main</span>:<span class="string">&#x27;#f44c58&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;hover-main&#x27;</span>:<span class="string">&#x27;$f32836&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3.在lib&#x2F;search&#x2F;index.vue中使用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--TODO:搜索按钮（通用组件）--&gt;</span><br><span class="line">&lt;m-button</span><br><span class="line">  class=&#x27;absolute translate-y-[-50%] top-[50%] right-1 rounded-full&#x27;</span><br><span class="line">  icon=&#x27;search&#x27;</span><br><span class="line">  iconColor=&#x27;#ffffff&#x27;</span><br><span class="line">&gt;&lt;/m-button&gt;</span><br></pre></td></tr></table></figure><h2 id="6-7-通用组件：完善search基本能力"><a href="#6-7-通用组件：完善search基本能力" class="headerlink" title="6-7 通用组件：完善search基本能力"></a>6-7 通用组件：完善search基本能力</h2><ol><li>输入内容实现双向数据绑定，在lib&#x2F;search&#x2F;index.vue中进行，在输入框处进行绑定</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">EMIT_UPDATE_MODELVALUE</span> = <span class="string">&#x27;update:modelValue&#x27;</span></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">/**</span></span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"><span class="language-xml">   1.输入内容实现双向数据绑定</span></span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"><span class="language-xml">   2.搜索按钮在hover 是展示</span></span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"><span class="language-xml">   3.一键清空文本功能</span></span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"><span class="language-xml">   4.触发搜索</span></span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"><span class="language-xml">   5.控制下拉展示区的展示</span></span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"><span class="language-xml">   6.事件处理</span></span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"><span class="language-xml"> */</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; useVModel &#125; <span class="keyword">from</span> <span class="string">&#x27;@vueuse/core&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> props =<span class="title function_">defineProps</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">modelValue</span>:&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">required</span>:<span class="literal">true</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">type</span>:<span class="title class_">String</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="title function_">defineEmits</span>([<span class="variable constant_">EMIT_UPDATE_MODELVALUE</span>])</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> intputValue = <span class="title function_">useVModel</span>(props)</span></span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--输入框--&gt;</span><br><span class="line">&lt;input</span><br><span class="line">  class=&#x27;block w-full h-[44px] pl-4 outline-0</span><br><span class="line">  bg-zinc-100 caret-zinc-400 rounded-xl</span><br><span class="line">  text-zinc-900 tracking-wide text-sm font-semibold border</span><br><span class="line">  border-zinc-100 focus:border-red-300 group-hover:bg-white</span><br><span class="line">  group-hover:border-zinc-200&#x27;</span><br><span class="line">  type=&quot;text&quot;</span><br><span class="line">  placeholder=&quot;搜索&quot;</span><br><span class="line">  v-model=&#x27;intputValue&#x27;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure><ol start="2"><li>搜索按钮在hover 是展示 ，就是增加下搜索按钮的样式</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--TODO:搜索按钮（通用组件）--&gt;</span><br><span class="line">&lt;m-button</span><br><span class="line">  class=&#x27;opacity-0 absolute translate-y-[-50%] top-[50%] right-1 rounded-full duration-500 group-hover:opacity-100&#x27;</span><br><span class="line">  icon=&#x27;search&#x27;</span><br><span class="line">  iconColor=&#x27;#ffffff&#x27;</span><br><span class="line">&gt;&lt;/m-button&gt;</span><br></pre></td></tr></table></figure><ol start="3"><li>一键清空文本功能，就是在删除按钮处增加一个显示条件，在绑定一个清空函数</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--删除按钮--&gt;</span><br><span class="line">&lt;m-svg-icon</span><br><span class="line">  v-show=&#x27;intputValue&#x27;</span><br><span class="line">  name = &quot;input-delete&quot;</span><br><span class="line">  class=&#x27;w-1.5 h-1.5 absolute translate-y-[-50%] top-[50%] right-9</span><br><span class="line">  cursor-pointer duration-500&#x27;</span><br><span class="line">  @click=&#x27;onClearClick&#x27;</span><br><span class="line">&gt;&lt;/m-svg-icon&gt;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 删除文本</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onClearClick</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  intputValue.<span class="property">value</span>=<span class="string">&#x27;&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>触发搜索 ，我们首先在搜索按钮增加点击事件，在文本框增加回车事件，然后注册一个emits，最后写一个搜索事件</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--TODO:搜索按钮（通用组件）--&gt;</span><br><span class="line">&lt;m-button</span><br><span class="line">  class=&#x27;opacity-0 absolute translate-y-[-50%] top-[50%] right-1 rounded-full duration-500 group-hover:opacity-100&#x27;</span><br><span class="line">  icon=&#x27;search&#x27;</span><br><span class="line">  iconColor=&#x27;#ffffff&#x27;</span><br><span class="line">  @click=&#x27;onSearchHandler&#x27;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--输入框--&gt;</span><br><span class="line">&lt;input</span><br><span class="line">  class=&#x27;block w-full h-[44px] pl-4 outline-0</span><br><span class="line">  bg-zinc-100 caret-zinc-400 rounded-xl</span><br><span class="line">  text-zinc-900 tracking-wide text-sm font-semibold border</span><br><span class="line">  border-zinc-100 focus:border-red-300 group-hover:bg-white</span><br><span class="line">  group-hover:border-zinc-200&#x27;</span><br><span class="line">  type=&quot;text&quot;</span><br><span class="line">  placeholder=&quot;搜索&quot;</span><br><span class="line">  v-model=&#x27;intputValue&#x27;</span><br><span class="line">  @keyup.enter=&#x27;onSearchHandler&#x27;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">EMIT_SEARCH</span> = <span class="string">&#x27;search&#x27;</span></span><br><span class="line"><span class="keyword">const</span> emits = <span class="title function_">defineEmits</span>([<span class="variable constant_">EMIT_UPDATE_MODELVALUE</span>,<span class="variable constant_">EMIT_SEARCH</span>])</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 搜索</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onSearchHandler</span> = (<span class="params"></span>) =&gt;&#123;</span><br><span class="line">  <span class="title function_">emits</span>(<span class="variable constant_">EMIT_SEARCH</span>,intputValue.<span class="property">value</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;search&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="5"><li>控制下拉展示区的展示</li></ol><ul><li>首先我们先给下拉框设置一个什么时候显示，什么情况下显示</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;transition name=&#x27;slide&#x27;&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    v-if=&#x27;$slots.dropdown&#x27;</span><br><span class="line">    v-show=&#x27;isFocus&#x27;</span><br><span class="line">    class=&#x27;max-h-[368px] w-full text-base overflow-auto bg-white</span><br><span class="line">    absolute z-20 left-0 top-[56px] p-2 rounded border border-zinc-200</span><br><span class="line">    duration-200 hover:shadow-2xl&#x27;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;slot name=&#x27;dropdown&#x27;/&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/transition&gt;</span><br></pre></td></tr></table></figure><ul><li>然后我们在header&#x2F;header-search&#x2F;index.vue中进行使用这个插槽</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;m-search v-model=&#x27;inputValue&#x27;&gt;</span><br><span class="line">      &lt;template #dropdown&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          dropdown</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/m-search&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">const inputValue = ref(&#x27;&#x27;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><ul><li>其次我们给输入框设置获取焦点的函数</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--输入框--&gt;</span><br><span class="line">&lt;input</span><br><span class="line">  class=&#x27;block w-full h-[44px] pl-4 outline-0</span><br><span class="line">  bg-zinc-100 caret-zinc-400 rounded-xl</span><br><span class="line">  text-zinc-900 tracking-wide text-sm font-semibold border</span><br><span class="line">  border-zinc-100 focus:border-red-300 group-hover:bg-white</span><br><span class="line">  group-hover:border-zinc-200&#x27;</span><br><span class="line">  type=&quot;text&quot;</span><br><span class="line">  placeholder=&quot;搜索&quot;</span><br><span class="line">  v-model=&#x27;intputValue&#x27;</span><br><span class="line">  @keyup.enter=&#x27;onSearchHandler&#x27;</span><br><span class="line">  @focus=&#x27;onFocusHandler&#x27;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure><ul><li>下面对获取焦点函数进行定义</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//input 是否获取焦点</span></span><br><span class="line"><span class="keyword">const</span> isFocus = <span class="title function_">ref</span>(<span class="literal">false</span>)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取到焦点</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onFocusHandler</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  isFocus.<span class="property">value</span> =<span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>然后我们想让下拉框点击外面的时候进行隐藏这时我们使用vue自带的onClickOutside，现在开头进行</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;div</span><br><span class="line">  class=&#x27;group relative p-0.5 rounded-xl border-white</span><br><span class="line">  duration-500 hover:bg-red-100/40&#x27;</span><br><span class="line">  ref=&#x27;containerTarge&#x27;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> containerTarge = <span class="title function_">ref</span>(<span class="literal">null</span>)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 点击containerTarge区域外隐藏dropdown</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">onClickOutside</span>(containerTarge,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  isFocus.<span class="property">value</span>=<span class="literal">false</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ol start="6"><li>事件处理</li></ol><ul><li>先定义这些事件</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//删除所有文本</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">EMIT_CLEAR</span> = <span class="string">&#x27;clear&#x27;</span></span><br><span class="line"><span class="comment">//输入事件</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">EMIT_INPUT</span> = <span class="string">&#x27;input&#x27;</span></span><br><span class="line"><span class="comment">//获取焦点</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">EMIT_FOCUS</span> = <span class="string">&#x27;focus&#x27;</span></span><br><span class="line"><span class="comment">//失去焦点</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">EMIT_BULR</span> = <span class="string">&#x27;blur&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>然后将这些事件进行注册</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> emits = <span class="title function_">defineEmits</span>([</span><br><span class="line">  <span class="variable constant_">EMIT_UPDATE_MODELVALUE</span>,</span><br><span class="line">  <span class="variable constant_">EMIT_SEARCH</span>,</span><br><span class="line">  <span class="variable constant_">EMIT_CLEAR</span>,</span><br><span class="line">  <span class="variable constant_">EMIT_INPUT</span>,</span><br><span class="line">  <span class="variable constant_">EMIT_FOCUS</span>,</span><br><span class="line">  <span class="variable constant_">EMIT_BULR</span></span><br><span class="line">])</span><br></pre></td></tr></table></figure><ul><li>使用这些事件，记得输入框绑定失去焦点事件</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 监听用户输入行为</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">watch</span>(intputValue,<span class="function">(<span class="params">val</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="title function_">emits</span>(<span class="variable constant_">EMIT_INPUT</span>,val)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 删除文本</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onClearClick</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  intputValue.<span class="property">value</span>=<span class="string">&#x27;&#x27;</span></span><br><span class="line">  <span class="title function_">emits</span>(<span class="variable constant_">EMIT_CLEAR</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 搜索</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onSearchHandler</span> = (<span class="params"></span>) =&gt;&#123;</span><br><span class="line">  <span class="title function_">emits</span>(<span class="variable constant_">EMIT_SEARCH</span>,intputValue.<span class="property">value</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> * 获取到焦点</span><br><span class="line"> */</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onFocusHandler</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  isFocus.<span class="property">value</span> =<span class="literal">true</span></span><br><span class="line">  <span class="title function_">emits</span>(<span class="variable constant_">EMIT_FOCUS</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 失去焦点</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onBlurHandler</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  <span class="title function_">emits</span>(<span class="variable constant_">EMIT_BULR</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--输入框--&gt;</span><br><span class="line">&lt;input</span><br><span class="line">  class=&#x27;block w-full h-[44px] pl-4 outline-0</span><br><span class="line">  bg-zinc-100 caret-zinc-400 rounded-xl</span><br><span class="line">  text-zinc-900 tracking-wide text-sm font-semibold border</span><br><span class="line">  border-zinc-100 focus:border-red-300 group-hover:bg-white</span><br><span class="line">  group-hover:border-zinc-200&#x27;</span><br><span class="line">  type=&quot;text&quot;</span><br><span class="line">  placeholder=&quot;搜索&quot;</span><br><span class="line">  v-model=&#x27;intputValue&#x27;</span><br><span class="line">  @keyup.enter=&#x27;onSearchHandler&#x27;</span><br><span class="line">  @focus=&#x27;onFocusHandler&#x27;</span><br><span class="line">  @blur=&#x27;onBlurHandler&#x27;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure><h2 id="6-8-通用组件：popover气泡卡片能力分析"><a href="#6-8-通用组件：popover气泡卡片能力分析" class="headerlink" title="6-8 通用组件：popover气泡卡片能力分析"></a>6-8 通用组件：popover气泡卡片能力分析</h2><ol><li>提供两个插槽</li></ol><ul><li>具名插槽：<strong>触发弹层的视图</strong></li><li>匿名插槽：<strong>弹出层视图中展示的内容</strong></li></ul><ol start="2"><li>控制弹出层的位置，我们期望可以具备以下位置弹出：<ul><li>左上</li><li>右上</li><li>左下</li><li>右下</li></ul></li></ol><h2 id="6-9-通用组件：popover气泡卡片基础功能实现"><a href="#6-9-通用组件：popover气泡卡片基础功能实现" class="headerlink" title="6-9 通用组件：popover气泡卡片基础功能实现"></a>6-9 通用组件：popover气泡卡片基础功能实现</h2><ol><li>我们在lib中创建组件popover&#x2F;index.vue</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div class=&#x27;relative&#x27; @mouseenter=&#x27;onMouseenter&#x27;</span><br><span class="line">@mouseleave=&#x27;onMouseleave&#x27;&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">&lt;!--    具名插槽：触发弹层的视图--&gt;</span><br><span class="line">    &lt;slot name=&#x27;reference&#x27;/&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;!--  气泡展示--&gt;</span><br><span class="line">  &lt;transition name=&#x27;slide&#x27;&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      v-show=&#x27;isVisable&#x27;</span><br><span class="line">      class=&#x27;absolute p-1 z-20 bg-white border rounded-md&#x27;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;!--    匿名插槽:弹出层视图中展示的内容--&gt;</span><br><span class="line">      &lt;slot/&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/transition&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">const isVisable = ref(false)</span><br><span class="line">/**</span><br><span class="line"> * 鼠标移入触发</span><br><span class="line"> */</span><br><span class="line">const onMouseenter = () =&gt;&#123;</span><br><span class="line">  isVisable.value=true</span><br><span class="line">&#125;</span><br><span class="line">/**</span><br><span class="line"> * 鼠标移出触发</span><br><span class="line"> */</span><br><span class="line">const onMouseleave = () =&gt;&#123;</span><br><span class="line">  isVisable.value=false</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line">.slide-enter-active,</span><br><span class="line">.slide-leave-active&#123;</span><br><span class="line">  transition:opacity 0.3s,transform 0.3s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.slide-enter-from,</span><br><span class="line">.slide-leave-to&#123;</span><br><span class="line">  opacity: 0;</span><br><span class="line">  transform: translateY(20px);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><ol start="2"><li>我们在src&#x2F;constants&#x2F;index.js中定义常量</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//极简白</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">THEME_LIGHT</span> =<span class="string">&#x27;THEME_LIGHT&#x27;</span></span><br><span class="line"><span class="comment">//极夜黑</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">THEME_DARK</span> = <span class="string">&#x27;THEME_DARK&#x27;</span></span><br><span class="line"><span class="comment">//跟随系统</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">THEME_SYSTEM</span> = <span class="string">&#x27;THEME_SYSTEM&#x27;</span></span><br></pre></td></tr></table></figure><ol start="3"><li>在views&#x2F;layout&#x2F;components&#x2F;header&#x2F;header-theme.vue中使用</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;m-popover&gt;</span><br><span class="line">    &lt;!--具名插槽：触发弹层的视图--&gt;</span><br><span class="line">    &lt;template #reference&gt;</span><br><span class="line">      &lt;m-svg-icon</span><br><span class="line">        name=&#x27;theme-light&#x27;</span><br><span class="line">        class=&#x27;w-4 h-4 p-1 cursor-pointer rounded-sm duration-200</span><br><span class="line">        outline-none hover:bg-zinc-100/60&#x27;</span><br><span class="line">        fillClass=&#x27;fill-zinc-900&#x27;</span><br><span class="line">      &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">      &lt;!--    匿名插槽:弹出层视图中展示的内容--&gt;</span><br><span class="line">      &lt;div class=&#x27;w-[140px] overflow-hidden&#x27;&gt;</span><br><span class="line">        &lt;div</span><br><span class="line">          class=&#x27;flex item-center p-1 cursor-pointer rounded hover:bg-zinc-100/60&#x27;</span><br><span class="line">          v-for=&#x27;item in themeArr&#x27;</span><br><span class="line">          :key=&#x27;item.id&#x27;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;m-svg-icon</span><br><span class="line">            :name=&#x27;item.icon&#x27;</span><br><span class="line">            class=&#x27;w-1.5 h-1.5 mr-1&#x27;</span><br><span class="line">            fillClass=&#x27;fill-zinc-900&#x27;</span><br><span class="line">          &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">          &lt;span class=&#x27;text-zinc-900 text-sm&#x27;&gt;&#123;&#123; item.name &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/m-popover&gt;</span><br><span class="line"></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123;THEME_LIGHT,THEME_DARK,THEME_SYSTEM&#125; from &#x27;@/constants&#x27;</span><br><span class="line">const themeArr = [</span><br><span class="line">  &#123;</span><br><span class="line">    id:&#x27;0&#x27;,</span><br><span class="line">    type:THEME_LIGHT,</span><br><span class="line">    icon:&#x27;theme-light&#x27;,</span><br><span class="line">    name:&#x27;极简白&#x27;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    id:&#x27;1&#x27;,</span><br><span class="line">    type:THEME_DARK,</span><br><span class="line">    icon:&#x27;theme-dark&#x27;,</span><br><span class="line">    name:&#x27;极夜黑&#x27;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    id:&#x27;2&#x27;,</span><br><span class="line">    type:THEME_SYSTEM,</span><br><span class="line">    icon:&#x27;theme-system&#x27;,</span><br><span class="line">    name:&#x27;跟随系统&#x27;</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h2 id="6-10-通用组件：popover功能延伸，控制气泡展示位置"><a href="#6-10-通用组件：popover功能延伸，控制气泡展示位置" class="headerlink" title="6-10 通用组件：popover功能延伸，控制气泡展示位置"></a>6-10 通用组件：popover功能延伸，控制气泡展示位置</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> 1.指定所有可选位置的常量，并生成enum</span><br><span class="line"> 2.通过prop控制指定位置</span><br><span class="line"> 3.获取元素的DOM。创建读取元素尺寸的方法</span><br><span class="line"> 4.生成气泡的样式对象，用来控制每个位置对应的样式</span><br><span class="line"> 5.根据prop，计算样式对象</span><br><span class="line"> */</span><br></pre></td></tr></table></figure><ol><li>指定所有可选位置的常量，并生成enum,在lib&#x2F;popover&#x2F;index.vue</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="comment">//左上</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PROP_TOP_LEFT</span> = <span class="string">&#x27;top-left&#x27;</span></span><br><span class="line"><span class="comment">//右上</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PROP_TOP_RIGHT</span> = <span class="string">&#x27;top-right&#x27;</span></span><br><span class="line"><span class="comment">//左下</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PROP_BOTTOM_LEFT</span> = <span class="string">&#x27;bottom-left&#x27;</span></span><br><span class="line"><span class="comment">//右下</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PROP_BOTTOM_RIGHT</span> = <span class="string">&#x27;bottom-right&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> placementEnum=[</span><br><span class="line">  <span class="variable constant_">PROP_TOP_LEFT</span>,</span><br><span class="line">  <span class="variable constant_">PROP_TOP_RIGHT</span>,</span><br><span class="line">  <span class="variable constant_">PROP_BOTTOM_LEFT</span>,</span><br><span class="line">  <span class="variable constant_">PROP_BOTTOM_RIGHT</span></span><br><span class="line">  ]</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><ol start="2"><li>通过prop控制指定位置</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">defineProps</span>(&#123;</span><br><span class="line">  <span class="comment">//控制气泡弹出位置，给出开发者错误提示</span></span><br><span class="line">  <span class="attr">placement</span>:&#123;</span><br><span class="line">    <span class="attr">type</span>:<span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">default</span>:<span class="variable constant_">PROP_BOTTOM_LEFT</span>,</span><br><span class="line">    <span class="title function_">validator</span>(<span class="params">val</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> result = placementEnum.<span class="title function_">includes</span>(val)</span><br><span class="line">      <span class="keyword">if</span> (!result)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`你的placement必须是<span class="subst">$&#123;placementEnum.join(<span class="string">&#x27;、&#x27;</span>)&#125;</span>中的一个`</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> result</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ol start="3"><li>获取元素的DOM。创建读取元素尺寸的方法,获取dom先在两个插槽设置ref</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> &lt;div ref=&#x27;referenceTarget&#x27;&gt;</span><br><span class="line">&lt;!--    具名插槽：触发弹层的视图--&gt;</span><br><span class="line">    &lt;slot name=&#x27;reference&#x27;/&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  </span><br><span class="line">   &lt;div</span><br><span class="line">      ref=&#x27;contentTarget&#x27;</span><br><span class="line">      v-show=&#x27;isVisable&#x27;</span><br><span class="line">      class=&#x27;absolute p-1 z-20 bg-white border rounded-md&#x27;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;!--    匿名插槽:弹出层视图中展示的内容--&gt;</span><br><span class="line">      &lt;slot/&gt;</span><br><span class="line">    &lt;/div&gt;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 计算元素的尺寸</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> referenceTarget = <span class="title function_">ref</span>(<span class="literal">null</span>)</span><br><span class="line"><span class="keyword">const</span> contentTarget = <span class="title function_">ref</span>(<span class="literal">null</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useElementSize</span> = (<span class="params">target</span>) =&gt;&#123;</span><br><span class="line">  <span class="keyword">if</span>(!target) <span class="keyword">return</span> &#123;&#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">width</span>:target.<span class="property">offsetWidth</span>,</span><br><span class="line">    <span class="attr">height</span>:target.<span class="property">offsetHeight</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>生成气泡样式，然后绑定使用</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 气泡样式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> contentStyle = <span class="title function_">ref</span>(&#123;</span><br><span class="line">  <span class="attr">top</span>:<span class="number">0</span>,</span><br><span class="line">  <span class="attr">left</span>:<span class="number">0</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;div</span><br><span class="line">  ref=&#x27;contentTarget&#x27;</span><br><span class="line">  v-show=&#x27;isVisable&#x27;</span><br><span class="line">  class=&#x27;absolute p-1 z-20 bg-white border rounded-md&#x27;</span><br><span class="line">  :style=&#x27;contentStyle&#x27;</span><br><span class="line">&gt;</span><br><span class="line">  &lt;!--    匿名插槽:弹出层视图中展示的内容--&gt;</span><br><span class="line">  &lt;slot/&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><ol start="5"><li>根据prop，计算样式对象，然后在header-theme中组件使用</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//计算：期望气泡展示的时候再进行计算</span></span><br><span class="line"><span class="title function_">watch</span>(isVisable,<span class="function">(<span class="params">val</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!val) <span class="keyword">return</span></span><br><span class="line">  <span class="comment">//等待元素渲染</span></span><br><span class="line">  <span class="comment">//vue在数据改变之后，需要等待一段时间Dom才会变化，所以我们可以通过nextTick函数的参数，来监听DOM变化之后的回调</span></span><br><span class="line">  <span class="title function_">nextTick</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (props.<span class="property">placement</span>)&#123;</span><br><span class="line">      <span class="comment">//左上</span></span><br><span class="line">        <span class="keyword">case</span> <span class="attr">PROP_TOP_LEFT</span>:</span><br><span class="line">          contentStyle.<span class="property">value</span>.<span class="property">top</span> = <span class="number">0</span></span><br><span class="line">          contentStyle.<span class="property">value</span>.<span class="property">left</span> = -<span class="title function_">useElementSize</span>(contentTarget).<span class="property">width</span>+<span class="string">&#x27;px&#x27;</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="comment">//右上</span></span><br><span class="line">      <span class="keyword">case</span> <span class="attr">PROP_TOP_RIGHT</span>:</span><br><span class="line">        contentStyle.<span class="property">value</span>.<span class="property">top</span> = <span class="number">0</span></span><br><span class="line">        contentStyle.<span class="property">value</span>.<span class="property">left</span> = <span class="title function_">useElementSize</span>(referenceTarget).<span class="property">width</span>+<span class="string">&#x27;px&#x27;</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="comment">//左下</span></span><br><span class="line">      <span class="keyword">case</span> <span class="attr">PROP_BOTTOM_LEFT</span>:</span><br><span class="line">        contentStyle.<span class="property">value</span>.<span class="property">top</span> = <span class="title function_">useElementSize</span>(referenceTarget).<span class="property">height</span>+<span class="string">&#x27;px&#x27;</span></span><br><span class="line">        contentStyle.<span class="property">value</span>.<span class="property">left</span> = <span class="title function_">useElementSize</span>(contentTarget).<span class="property">width</span>+<span class="string">&#x27;px&#x27;</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="comment">//右下</span></span><br><span class="line">      <span class="keyword">case</span> <span class="attr">PROP_BOTTOM_RIGHT</span>:</span><br><span class="line">        contentStyle.<span class="property">value</span>.<span class="property">top</span> = <span class="title function_">useElementSize</span>(referenceTarget).<span class="property">height</span>+<span class="string">&#x27;px&#x27;</span></span><br><span class="line">        contentStyle.<span class="property">value</span>.<span class="property">left</span> = <span class="title function_">useElementSize</span>(referenceTarget).<span class="property">width</span>+<span class="string">&#x27;px&#x27;</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;m-popover placement=&#x27;bottom-left&#x27;&gt;&lt;/m-popover&gt;</span><br></pre></td></tr></table></figure><h2 id="6-11-通用组件：处理慢速移动时，气泡消失问题"><a href="#6-11-通用组件：处理慢速移动时，气泡消失问题" class="headerlink" title="6-11 通用组件：处理慢速移动时，气泡消失问题"></a>6-11 通用组件：处理慢速移动时，气泡消失问题</h2><p>想要处理这个问题，那么我们首先需要明白，为什么气泡会消失。</p><p>其实这个问题非常简单，因为在reference与气泡之间存在间隙，当鼠标移动到这个间隙处时，就会触发mouseleave 鼠标移出事件，那么此时 isVisable 就会变为false。</p><p>那么这样的原因分析出来之后，我们又应该如何解决这个问题呢？</p><p>想要解决这个问题，我们可以利用类似于防抖（debounce）的概念。</p><p>也就是：<strong>鼠标刚离开时，不去立刻修改 isVisable，而是延迟一段时间，如果在这段时间之内，再次触发了鼠标移入时间，则不再修改isViable</strong>以此来解决慢速移动的问题。</p><p>那么明确好了处理方案，接下来我们就实现这个功能：修改lib&#x2F;popover&#x2F;index.vue</p><ol><li>定义延迟关闭时长</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//延迟关闭时间</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">DELAY_TIME</span> = <span class="number">100</span></span><br></pre></td></tr></table></figure><ol start="2"><li>修改鼠标移入和移出的方法</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> timeout</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 鼠标移入触发</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onMouseenter</span> = (<span class="params"></span>) =&gt;&#123;</span><br><span class="line">  isVisable.<span class="property">value</span>=<span class="literal">true</span></span><br><span class="line">  <span class="keyword">if</span> (timeout)&#123;</span><br><span class="line">    <span class="built_in">clearTimeout</span>(timeout)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 鼠标移出触发</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onMouseleave</span> = (<span class="params"></span>) =&gt;&#123;</span><br><span class="line">timeout = <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  isVisable.<span class="property">value</span>=<span class="literal">false</span></span><br><span class="line">  timeout = <span class="literal">null</span></span><br><span class="line">&#125;,<span class="variable constant_">DELAY_TIME</span>)</span><br></pre></td></tr></table></figure><h2 id="6-12-基于popover处理用户模块"><a href="#6-12-基于popover处理用户模块" class="headerlink" title="6-12 基于popover处理用户模块"></a>6-12 基于popover处理用户模块</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;m-popover class=&#x27;flex items-center&#x27; placement=&#x27;bottom-left&#x27;&gt;</span><br><span class="line">    &lt;template #reference&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class=&#x27;relative flex items-center p-0.5 rounded-sm</span><br><span class="line">        cursor-pointer duration-200 outline-none</span><br><span class="line">        hover:bg-zinc-100&#x27;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;!--头像--&gt;</span><br><span class="line">        &lt;img</span><br><span class="line">          class=&#x27;w-3 h-3 rounded-sm&#x27;</span><br><span class="line">          src=&#x27;  https://w.wallhaven.cc/full/rd/wallhaven-rdwjj7.jpg&#x27;</span><br><span class="line">        /&gt;</span><br><span class="line">&lt;!--        下箭头--&gt;</span><br><span class="line">        &lt;m-svg-icon</span><br><span class="line">          class=&#x27;h-1.5 w-1.5 ml-0.5&#x27;</span><br><span class="line">          name=&#x27;down-arrow&#x27;</span><br><span class="line">          fillClass=&#x27;fill-zinc-900&#x27;</span><br><span class="line">        &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">&lt;!--        VIP--&gt;</span><br><span class="line">        &lt;m-svg-icon</span><br><span class="line">          class=&#x27;h-1.5 w-1.5 absolute right-[16px] bottom-0&#x27;</span><br><span class="line">          name = &#x27;vip&#x27;</span><br><span class="line">        &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">&lt;!--气泡--&gt;</span><br><span class="line">    &lt;div class=&#x27;w-[140px] overflow-hidden&#x27;&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class=&#x27;flex items-center p-1 cursor-pointer rounded hover:bg-zinc-100/60&#x27;</span><br><span class="line">        v-for=&#x27;item in menuArr&#x27;</span><br><span class="line">        :key=&#x27;item.id&#x27;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;m-svg-icon</span><br><span class="line">          :name=&#x27;item.icon&#x27;</span><br><span class="line">          class=&#x27;w-1.5 h-1.5 mr-1&#x27;</span><br><span class="line">          fillClass=&#x27;fill-zinc-900&#x27;</span><br><span class="line">        &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">        &lt;span class=&#x27;text-zinc-800 text-sm&#x27; &gt;&#123;&#123;item.title&#125;&#125;&lt;/span&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/m-popover&gt;</span><br><span class="line"></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">//构建数据源</span><br><span class="line">const menuArr =[</span><br><span class="line">  &#123;</span><br><span class="line">    id:0,</span><br><span class="line">    title:&#x27;个人资料&#x27;,</span><br><span class="line">    icon:&#x27;profile&#x27;,</span><br><span class="line">    path:&#x27;/profile&#x27;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    id:1,</span><br><span class="line">    title:&#x27;升级VIP&#x27;,</span><br><span class="line">    icon:&#x27;vip-profile&#x27;,</span><br><span class="line">    path:&#x27;/memeber&#x27;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    id:2,</span><br><span class="line">    title:&#x27;退出登陆&#x27;,</span><br><span class="line">    icon:&#x27;logout&#x27;,</span><br><span class="line">    path:&#x27;&#x27;</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h1 id="7、企业级复杂前中台项目响应式处理方案-——-一套代码多端共用"><a href="#7、企业级复杂前中台项目响应式处理方案-——-一套代码多端共用" class="headerlink" title="7、企业级复杂前中台项目响应式处理方案 —— 一套代码多端共用"></a>7、企业级复杂前中台项目响应式处理方案 —— 一套代码多端共用</h1><p>一种样式可以同时适配移动端和PC端，这样的功能我们通常称之为响应式。但是咱们的项目是一个复杂的前中台系统，在这样的系统中，我们又应该如何应对这种响应式的问题处理呢？在 《样式复用、逻辑复用、可维护性》之间，我们又应该如何进行权衡呢？…</p><hr><h2 id="7-1-前言"><a href="#7-1-前言" class="headerlink" title="7-1 前言"></a>7-1 前言</h2><p>我们已经完成了<strong>PC端</strong>的Header的处理，那么接下来要处理的就是navigationBar。</p><p>但是我们知道，目前我们已经完成过一个移动端的navigationBar 了。</p><p>那么对于navigationBar 这个功能，我们还需要在PC端同样进行实现。通常我们把这样的一套功能称之为响应式（<strong>多指响应式布局：一套样式在多端展示</strong>）</p><p>但是咱们当前的项目不光是一个简单的响应式布局，而是一个复杂的前中台系统。那么在这样的前中台系统之中，我们又应该如何应对这种响应式的问题处理呢？</p><p>在<strong>样式复用、逻辑复用、代码可维护性</strong>之间，我们又应该如何去进行权衡呢？</p><h2 id="7-2-响应式下navigationBar实现方案分析"><a href="#7-2-响应式下navigationBar实现方案分析" class="headerlink" title="7-2 响应式下navigationBar实现方案分析"></a>7-2 响应式下navigationBar实现方案分析</h2><p>通常情况下<strong>复杂功能的响应式处理</strong>，一般我们有三种处理方案：</p><ol><li><p>一套代码处理多端：</p><ol><li>优势：代码量相对比较少</li><li>劣势：耦合性强，不利于后期维护</li></ol></li><li><p>多套代码分别处理各端：</p><ol><li>优势：逻辑清晰</li><li>劣势：可能会产生很多重复的逻辑</li></ol></li><li><p>结合以上两种方案，抽离公用逻辑，封装私有逻辑</p><ol><li>优势：结合以上两点优势</li><li>劣势：需要对业务和逻辑足够清楚</li></ol></li></ol><p>那么综合来看，肯定是第三种方式更好，所以咱们的navigationBar就通过第三种方式来去进行实现。</p><p>那么具体我们应该怎么去做呢？哪些是公用逻辑？哪些是私有逻辑？</p><p>我们知道一个功能由两部分组成：</p><ol><li>数据</li><li>视图</li></ol><p><strong>数据</strong></p><p>那么首先我们先来分析数据，双方（移动端和PC端）的数据是一样的。所以说这一块是完全可以复用的。</p><p>那么目前咱们的数据是通过 src&#x2F;views&#x2F;main&#x2F;compones&#x2F;navigation&#x2F;index.vue 进行获取，然后进行传递的。那么我们期望进行数据的复用，如果一直进行数据传递的话，未免有些过于复杂了。</p><p>所以说对于数据，我们可以直接通过vuex 来封装这一列的获取、切换行为。</p><p><strong>视图</strong><br>双方的视图在展示中的逻辑具备较大差异，所以为了综合可维护性，视图逻辑部分我们期望单独封装到各自的组件来来进行处理。</p><p><strong>总结</strong></p><p>那么这样我们就分析好了 navigationBar 的公有和私有部分：</p><ol><li>数据为公有数据，可以在vuex 中进行抽离处理。</li><li>视图为私有部分，需要在各自的组件l来进行单独处理。</li></ol><h2 id="7-3-抽离公用逻辑，封装系列动作"><a href="#7-3-抽离公用逻辑，封装系列动作" class="headerlink" title="7-3 抽离公用逻辑，封装系列动作"></a>7-3 抽离公用逻辑，封装系列动作</h2><ol><li>我们现在store&#x2F;index.js中定义createStore方法</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>  &#123;createStore&#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">import</span> getters <span class="keyword">from</span> <span class="string">&#x27;./getters&#x27;</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">createStore</span>(&#123;</span><br><span class="line">  getters</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure><ol start="2"><li>然后再store&#x2F;getter.js中导出一个空数组</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>然后在main.js中进行注册</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./store&#x27;</span></span><br><span class="line">app.<span class="title function_">use</span>(store)</span><br></pre></td></tr></table></figure><ol start="4"><li>我们创建store&#x2F;modules&#x2F;category.js模块，使用store方法进行数据的封装</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="variable constant_">ALL_CATEGORY_ITEM</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;@/constants&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;getCategory&#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/category&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 处理navigationBar中的数据categorys</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">//独立作用域</span></span><br><span class="line">  <span class="attr">namespaced</span>:<span class="literal">true</span>,</span><br><span class="line">  <span class="attr">state</span>:<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span>&#123;</span><br><span class="line">      <span class="attr">categorys</span>:[<span class="variable constant_">ALL_CATEGORY_ITEM</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mutations</span>:&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 为categorys赋值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="title function_">setCategorys</span>(<span class="params">state,newCategorys</span>)&#123;</span><br><span class="line">      state.<span class="property">categorys</span> =[<span class="variable constant_">ALL_CATEGORY_ITEM</span>,...newCategorys]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">actions</span>:&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取category数据，并自动保存到vuex中</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">useCategoryData</span>(<span class="params">context</span>)&#123;</span><br><span class="line">      <span class="keyword">const</span> &#123;categorys&#125; = getCategory</span><br><span class="line">      context.<span class="title function_">commit</span>(<span class="string">&#x27;setCategorys&#x27;</span>,categorys)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="5"><li>最后在store&#x2F;index.js中注册数据模块</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>  &#123;createStore&#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">import</span> getters <span class="keyword">from</span> <span class="string">&#x27;./getters&#x27;</span></span><br><span class="line"><span class="keyword">import</span> category <span class="keyword">from</span> <span class="string">&#x27;./modules/category&#x27;</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">createStore</span>(&#123;</span><br><span class="line">  getters,</span><br><span class="line">  <span class="attr">modules</span>:&#123;</span><br><span class="line">    category</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure><ol start="6"><li>接下来我们就可以去触发categorys了，为了使访问变得简单，我们修改store&#x2F;getters.js</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">//简单访问</span></span><br><span class="line">  <span class="attr">categorys</span>:<span class="function">(<span class="params">state</span>)=&gt;</span>state.<span class="property">category</span>.<span class="property">categorys</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="7"><li>我们对原有的src&#x2F;views&#x2F;main&#x2F;components&#x2F;navigation&#x2F;index. vue进行修改，使用store</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;mobile-navigation-vue v-if=&quot;isMobileTerminal&quot;  /&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; isMobileTerminal &#125; from &#x27;@/utils/flexible&#x27;</span><br><span class="line">import mobileNavigationVue from &#x27;./mobile/index.vue&#x27;</span><br><span class="line">import &#123;useStore&#125; from &#x27;vuex&#x27;</span><br><span class="line">const store = useStore()</span><br><span class="line">//触发category获取数据</span><br><span class="line">store.dispatch(&#x27;category/useCategoryData&#x27;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure><ol start="8"><li>修改src&#x2F;views&#x2F;main&#x2F;components&#x2F;navigation&#x2F;mobile&#x2F;index.vue，这时候defineProps就可以不需要了；data需要换成store方法，直接获取数据；我们观察看出menu-vue的数据绑定也就不需要了，然后menu-vue组件中重复8.中前两个步骤</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">defineProps</span>(&#123;</span><br><span class="line">  <span class="attr">data</span>:&#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">Array</span>,</span><br><span class="line">    <span class="attr">required</span>:<span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;li</span><br><span class="line">  v-for=&quot;(item,index) in $store.getters.categorys&quot;</span><br><span class="line">  :key=&quot;item.id&quot;</span><br><span class="line">  class=&quot;shrink-0 px-1.5 py-0.5 z-10 duration-200 last:mr-4&quot;</span><br><span class="line">  :class=&quot;&#123;</span><br><span class="line">    &#x27;text-zinc-100&#x27;: currentCategoryIndex === index</span><br><span class="line">  &#125;&quot;</span><br><span class="line">  :ref=&quot;setItemRef&quot;</span><br><span class="line">  @click=&quot;onItemClick(index)&quot;</span><br><span class="line">&gt;</span><br><span class="line">  &#123;&#123;item.name&#125;&#125;</span><br><span class="line">&lt;/li&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;m-popup v-model=&#x27;isVisable&#x27;&gt;</span><br><span class="line">  &lt;menu-vue  @onItemClick=&quot;onItemClick&quot;&gt;&lt;/menu-vue&gt;</span><br><span class="line">&lt;/m-popup&gt;</span><br></pre></td></tr></table></figure><h2 id="7-4-PC端navigationBar私有视图处理"><a href="#7-4-PC端navigationBar私有视图处理" class="headerlink" title="7-4 PC端navigationBar私有视图处理"></a>7-4 PC端navigationBar私有视图处理</h2><ol><li>我们首先创建navigation&#x2F;pc&#x2F;index.vue</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&#x27;bg-white sticky top-0 left-0 w-full z-10&#x27;&gt;</span><br><span class="line">    &lt;ul</span><br><span class="line">      class=&#x27;w-[800px] relative flex flex-wrap justify-center</span><br><span class="line">      overflow-x-auto px-[10px] py-1 text-xs text-zinc-600 duration-300</span><br><span class="line">      overflow-hidden max-auto&#x27;</span><br><span class="line">    &gt;</span><br><span class="line">&lt;!--      展示箭头--&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class=&#x27;absolute right-1 bottom-1 z-20 p-1 rounded cursor-pointer</span><br><span class="line">        duration-200 hover:bg-zinc-200&#x27;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;m-svg-icon</span><br><span class="line">          name=&#x27;unfold&#x27;</span><br><span class="line">          class=&#x27;w-1 h-1&#x27;</span><br><span class="line">          fillClass=&#x27;fill-zinc-900&#x27;</span><br><span class="line">        &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">&lt;!--      item--&gt;</span><br><span class="line">      &lt;li</span><br><span class="line">        v-for=&#x27;item in $store.getters.categorys&#x27;</span><br><span class="line">        :key=&#x27;item.id&#x27;</span><br><span class="line">        class=&#x27;shrink-0 px-1.5 py-0 z-10 duration-200 text-zinc-900</span><br><span class="line">        text-base font-bold h-4 leading-4 cursor-pointer hover:bg-zinc-200</span><br><span class="line">        rounded mr-1 mb-1&#x27;</span><br><span class="line">      &gt;</span><br><span class="line">        &#123;&#123;item.name&#125;&#125;</span><br><span class="line">      &lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><ol start="2"><li>在navigation&#x2F;index.vue中进行使用</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;pc-navigation-vue v-else&gt;&lt;/pc-navigation-vue&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">import pcNavigationVue from &#x27;./pc/index.vue&#x27;</span><br></pre></td></tr></table></figure><ol start="3"><li>发现还不能使，因为我们没有设置二级路由，我们在views&#x2F;layout&#x2F;components&#x2F;main.vue中使用二级路由</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;router-view&gt;&lt;/router-view&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><ol start="4"><li>我们在router&#x2F;modules&#x2F;pc-router.js中设置，里面的children</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> [&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;main&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>: <span class="function">()=&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/layout/index.vue&#x27;</span>),</span><br><span class="line">  <span class="attr">children</span>:[</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>:<span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>:<span class="string">&#x27;home&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>:<span class="function">()=&gt;</span><span class="title function_">import</span>(<span class="string">&#x27;@/views/main/index.vue&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure><h2 id="7-5-PC端navigationBar私有逻辑处理"><a href="#7-5-PC端navigationBar私有逻辑处理" class="headerlink" title="7-5 PC端navigationBar私有逻辑处理"></a>7-5 PC端navigationBar私有逻辑处理</h2><ol><li>首先在navigation&#x2F;pc&#x2F;index.vue创建数据源</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;<span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 状态切换处理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isOpenCategory = <span class="title function_">ref</span>(<span class="literal">false</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">triggerState</span> = (<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  isOpenCategory.<span class="property">value</span> = !isOpenCategory.<span class="property">value</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><ol start="2"><li>实现pc端展开和收起导航栏，在ul处以数据源为根据进行处理导航栏的高度；然后设置点击箭头时，数据源进行变化，同时icon也发生相应变化</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul</span><br><span class="line">      class=&#x27;w-[800px] relative flex flex-wrap justify-center</span><br><span class="line">      overflow-x-auto px-[10px] py-1 text-xs text-zinc-600 duration-300</span><br><span class="line">      overflow-hidden max-auto&#x27;</span><br><span class="line">      :class=&quot;[isOpenCategory ? &#x27;h-[206px]&#x27; : &#x27;h-[56px]&#x27;]&quot;</span><br><span class="line">    &gt;</span><br><span class="line">&lt;!--      展示箭头--&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class=&#x27;absolute right-1 bottom-1 z-20 p-1 rounded cursor-pointer</span><br><span class="line">        duration-200 hover:bg-zinc-200&#x27;</span><br><span class="line">        @click=&#x27;triggerState&#x27;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;m-svg-icon</span><br><span class="line">          :name=&quot;isOpenCategory ? &#x27;fold&#x27;:&#x27;unfold&#x27; &quot;</span><br><span class="line">          class=&#x27;w-1 h-1&#x27;</span><br><span class="line">          fillClass=&#x27;fill-zinc-900&#x27;</span><br><span class="line">        &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">      &lt;/div&gt;</span><br></pre></td></tr></table></figure><ol start="3"><li>我们给导航栏里的小模块设置高亮，增加选中方法，然后在li标签获取index，并且设置点击方法，根据值再来设置样式</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 选中状态处理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> currentCategoryIndex = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onItemClick</span> = (<span class="params">index</span>) =&gt;&#123;</span><br><span class="line">  currentCategoryIndex.<span class="property">value</span> = index</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--      item--&gt;</span><br><span class="line">      &lt;li</span><br><span class="line">        v-for=&#x27;(item,index) in $store.getters.categorys&#x27;</span><br><span class="line">        :key=&#x27;item.id&#x27;</span><br><span class="line">        class=&#x27;shrink-0 px-1.5 py-0 z-10 duration-200 text-zinc-900</span><br><span class="line">        text-base font-bold h-4 leading-4 cursor-pointer hover:bg-zinc-200</span><br><span class="line">        rounded mr-1 mb-1&#x27;</span><br><span class="line">        :class=&quot;&#123;</span><br><span class="line">          &#x27;text-zinc-900 bg-zinc-200&#x27; :currentCategoryIndex === index</span><br><span class="line">        &#125;&quot;</span><br><span class="line">        @click=&quot;onItemClick(index)&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &#123;&#123;item.name&#125;&#125;</span><br><span class="line">      &lt;/li&gt;</span><br></pre></td></tr></table></figure><h2 id="7-6-分析navigationBar闪烁问题"><a href="#7-6-分析navigationBar闪烁问题" class="headerlink" title="7-6 分析navigationBar闪烁问题"></a>7-6 分析navigationBar闪烁问题</h2><p>分析：</p><ul><li>出现闪烁的问题是因为网页先加载初始数据，后续的从后端调用的数据没有瞬间传过来</li></ul><p>解决方法：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//1.让categorys 具备一个初始化数据</span><br><span class="line">//2.从服务端获取数据，替换初始化数据（之前就已经完成了）</span><br><span class="line">//3.为了防止初始化数据太老，我们把每次获取到的新数据，都作为下一次的初始化数据</span><br></pre></td></tr></table></figure><h2 id="7-7-处理navigationBar闪烁问题"><a href="#7-7-处理navigationBar闪烁问题" class="headerlink" title="7-7 处理navigationBar闪烁问题"></a>7-7 处理navigationBar闪烁问题</h2><ol><li>让categorys 具备一个初始化数据,对constants&#x2F;index.vue进行新增</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//category的初始化数据</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">CATEGORY_NOMAR_DATA</span> = [</span><br><span class="line">  <span class="variable constant_">ALL_CATEGORY_ITEM</span>,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="string">&#x27;web_app_icon&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;UI/UX&#x27;</span>, <span class="attr">col</span>: <span class="number">1</span>, <span class="attr">urlname</span>: <span class="string">&#x27;web_app_icon&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="string">&#x27;design&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;平面&#x27;</span>, <span class="attr">col</span>: <span class="number">1</span>, <span class="attr">urlname</span>: <span class="string">&#x27;design&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="string">&#x27;illustration&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;插画/漫画&#x27;</span>, <span class="attr">col</span>: <span class="number">1</span>, <span class="attr">urlname</span>: <span class="string">&#x27;illustration&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="string">&#x27;photography&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;摄影&#x27;</span>, <span class="attr">col</span>: <span class="number">2</span>, <span class="attr">urlname</span>: <span class="string">&#x27;photography&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="string">&#x27;games&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;游戏&#x27;</span>, <span class="attr">urlname</span>: <span class="string">&#x27;games&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="string">&#x27;anime&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;动漫&#x27;</span>, <span class="attr">urlname</span>: <span class="string">&#x27;anime&#x27;</span> &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="string">&#x27;industrial_design&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;工业设计&#x27;</span>,</span><br><span class="line">    <span class="attr">col</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">urlname</span>: <span class="string">&#x27;industrial_design&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="string">&#x27;architecture&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;建筑设计&#x27;</span>, <span class="attr">urlname</span>: <span class="string">&#x27;architecture&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="string">&#x27;art&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;人文艺术&#x27;</span>, <span class="attr">urlname</span>: <span class="string">&#x27;art&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="string">&#x27;home&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;家居/家装&#x27;</span>, <span class="attr">col</span>: <span class="number">1</span>, <span class="attr">urlname</span>: <span class="string">&#x27;home&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="string">&#x27;apparel&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;女装/搭配&#x27;</span>, <span class="attr">col</span>: <span class="number">1</span>, <span class="attr">urlname</span>: <span class="string">&#x27;apparel&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="string">&#x27;men&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;男士/风尚&#x27;</span>, <span class="attr">col</span>: <span class="number">2</span>, <span class="attr">urlname</span>: <span class="string">&#x27;men&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="string">&#x27;modeling_hair&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;造型/美妆&#x27;</span>, <span class="attr">urlname</span>: <span class="string">&#x27;modeling_hair&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="string">&#x27;diy_crafts&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;手工/布艺&#x27;</span>, <span class="attr">urlname</span>: <span class="string">&#x27;diy_crafts&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="string">&#x27;food_drink&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;美食&#x27;</span>, <span class="attr">urlname</span>: <span class="string">&#x27;food_drink&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="string">&#x27;travel_places&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;旅行&#x27;</span>, <span class="attr">urlname</span>: <span class="string">&#x27;travel_places&#x27;</span> &#125;</span><br><span class="line">  <span class="comment">// &#123; id: &#x27;wedding_events&#x27;, name: &#x27;婚礼&#x27;, col: 2, urlname: &#x27;wedding_events&#x27; &#125;,</span></span><br><span class="line">  <span class="comment">// &#123; id: &#x27;kids&#x27;, name: &#x27;儿童&#x27;, urlname: &#x27;kids&#x27; &#125;,</span></span><br><span class="line">  <span class="comment">// &#123; id: &#x27;pets&#x27;, name: &#x27;宠物&#x27;, urlname: &#x27;pets&#x27; &#125;,</span></span><br><span class="line">  <span class="comment">// &#123; id: &#x27;quotes&#x27;, name: &#x27;美图&#x27;, urlname: &#x27;quotes&#x27; &#125;,</span></span><br><span class="line">  <span class="comment">// &#123; id: &#x27;people&#x27;, name: &#x27;明星&#x27;, urlname: &#x27;people&#x27; &#125;,</span></span><br><span class="line">  <span class="comment">// &#123; id: &#x27;beauty&#x27;, name: &#x27;美女&#x27;, urlname: &#x27;beauty&#x27; &#125;,</span></span><br><span class="line">  <span class="comment">// &#123; id: &#x27;desire&#x27;, name: &#x27;礼物&#x27;, urlname: &#x27;desire&#x27; &#125;,</span></span><br><span class="line">  <span class="comment">// &#123; id: &#x27;geek&#x27;, name: &#x27;极客&#x27;, urlname: &#x27;geek&#x27; &#125;,</span></span><br><span class="line">  <span class="comment">// &#123; id: &#x27;data_presentation&#x27;, name: &#x27;数据图&#x27;, urlname: &#x27;data_presentation&#x27; &#125;,</span></span><br><span class="line">  <span class="comment">// &#123; id: &#x27;cars_motorcycles&#x27;, name: &#x27;汽车/摩托&#x27;, urlname: &#x27;cars_motorcycles&#x27; &#125;,</span></span><br><span class="line">  <span class="comment">// &#123; id: &#x27;film_music_books&#x27;, name: &#x27;电影/图书&#x27;, urlname: &#x27;film_music_books&#x27; &#125;,</span></span><br><span class="line">  <span class="comment">// &#123; id: &#x27;tips&#x27;, name: &#x27;生活百科&#x27;, urlname: &#x27;tips&#x27; &#125;,</span></span><br><span class="line">  <span class="comment">// &#123; id: &#x27;education&#x27;, name: &#x27;教育&#x27;, urlname: &#x27;education&#x27; &#125;,</span></span><br><span class="line">  <span class="comment">// &#123; id: &#x27;sports&#x27;, name: &#x27;运动&#x27;, urlname: &#x27;sports&#x27; &#125;,</span></span><br><span class="line">  <span class="comment">// &#123; id: &#x27;funny&#x27;, name: &#x27;搞笑&#x27;, urlname: &#x27;funny&#x27; &#125;</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><ol start="2"><li>在store&#x2F;modules&#x2F;category.js进行数据导入</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="variable constant_">ALL_CATEGORY_ITEM</span>,<span class="variable constant_">CATEGORY_NOMAR_DATA</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;@/constants&#x27;</span></span><br><span class="line"><span class="attr">state</span>:<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span>&#123;</span><br><span class="line">      <span class="comment">//1.让categorys 具备一个初始化数据</span></span><br><span class="line">      <span class="comment">//2.从服务端获取数据，替换初始化数据</span></span><br><span class="line">      <span class="comment">//3.为了防止初始化数据太老，我们把每次获取到的新数据，都作为下一次的初始化数据</span></span><br><span class="line">      <span class="attr">categorys</span>:<span class="variable constant_">CATEGORY_NOMAR_DATA</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure><h2 id="7-8-category数据缓存，覆盖初始数据"><a href="#7-8-category数据缓存，覆盖初始数据" class="headerlink" title="7-8 category数据缓存，覆盖初始数据"></a>7-8 category数据缓存，覆盖初始数据</h2><p>那么在处理好了闪烁的问题之后，接下来我们要完成之前明确的第三步，也就是<strong>缓存请求得来的vuex 中的数据</strong>，<strong>并且在下次运行时把缓存的数据作为初始值。</strong></p><p>那么想要实现这一步的功能，我们可以利用<strong>vuex-persistedstate</strong></p><p>vuex-persistedstate：可以自动保存 vuex 中的数据到 localStorage，并且在下次开始的时候自动读取这个数据到对应的state中</p><p>那么，接下来就利用这个库来实现我们的功能：</p><ol><li>安装vuex-persistedstate</li></ol><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i --save vuex-persistedstate@<span class="number">4</span>.<span class="number">1</span>.<span class="number">0</span></span><br></pre></td></tr></table></figure><ol start="2"><li>我们在store&#x2F;index.js中使用这个库</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> createPersistedState <span class="keyword">from</span> <span class="string">&#x27;vuex-persistedstate&#x27;</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">createStore</span>(&#123;</span><br><span class="line">  getters,</span><br><span class="line">  <span class="attr">modules</span>:&#123;</span><br><span class="line">    category</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>:[</span><br><span class="line">   <span class="title function_">createPersistedState</span>(&#123;</span><br><span class="line">     <span class="comment">//指定保存到localStorage中的key</span></span><br><span class="line">     <span class="attr">key</span>:<span class="string">&#x27;imooc-front&#x27;</span>,</span><br><span class="line">     <span class="comment">//需要保存的模块</span></span><br><span class="line">     <span class="attr">paths</span>:[<span class="string">&#x27;category&#x27;</span>]</span><br><span class="line">   &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure><h1 id="8、-主题替换解决方案-——-打造完善多主题系统"><a href="#8、-主题替换解决方案-——-打造完善多主题系统" class="headerlink" title="8、 主题替换解决方案 —— 打造完善多主题系统"></a>8、 主题替换解决方案 —— 打造完善多主题系统</h1><p>市面上很多的组件库都存在主题替换的功能，但是如果脱离了组件库你还知道如何实现主题替换吗？整个主题替换方案背后的原理是什么？如果我们想要跟随系统主题发生变化，那么又应该怎么做呢？</p><hr><h2 id="8-1-主题替换原理分析"><a href="#8-1-主题替换原理分析" class="headerlink" title="8-1 主题替换原理分析"></a>8-1 主题替换原理分析</h2><p>就是一句话：</p><ul><li>通过类名的控制对应的样式（主题），当类名发生变化时，即完成了主题替换</li></ul><h2 id="8-2-ailwindDarkMode原理"><a href="#8-2-ailwindDarkMode原理" class="headerlink" title="8-2 ailwindDarkMode原理"></a>8-2 ailwindDarkMode原理</h2><ol><li>首先在tailwind.config.js下设置手动切换暗黑模式</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//手动切换暗黑模式</span></span><br><span class="line"><span class="attr">darkMode</span>:<span class="string">&#x27;class&#x27;</span>,</span><br></pre></td></tr></table></figure><ol start="2"><li>然后我们在header&#x2F;index.vue中的div标签加上dark样式</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&#x27;w-full bg-white dark:bg-zinc-800 border-b border-b-zinc-200</span><br><span class="line">px-2 py-1&#x27;&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure><ol start="3"><li>去浏览器按住F12，然后修改元素的html标签增加class&#x3D;’dark’就可以看到效果</li></ol><h2 id="8-3-为组件增加dark适配"><a href="#8-3-为组件增加dark适配" class="headerlink" title="8-3 为组件增加dark适配"></a>8-3 为组件增加dark适配</h2><p>下面就是修改各个页面的样式：</p><ol><li>首先修改header&#x2F;header-my.vue</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;m-popover class=&#x27;flex items-center&#x27; placement=&#x27;bottom-left&#x27;&gt;</span><br><span class="line">    &lt;template #reference&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class=&#x27;relative flex items-center p-0.5 rounded-sm</span><br><span class="line">        cursor-pointer duration-200 outline-none</span><br><span class="line">        hover:bg-zinc-100 dark:hover:bg-zinc-900&#x27;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;!--头像--&gt;</span><br><span class="line">        &lt;img</span><br><span class="line">          class=&#x27;w-3 h-3 rounded-sm&#x27;</span><br><span class="line">          src=&#x27;  https://w.wallhaven.cc/full/rd/wallhaven-rdwjj7.jpg&#x27;</span><br><span class="line">        /&gt;</span><br><span class="line">&lt;!--        下箭头--&gt;</span><br><span class="line">        &lt;m-svg-icon</span><br><span class="line">          class=&#x27;h-1.5 w-1.5 ml-0.5&#x27;</span><br><span class="line">          name=&#x27;down-arrow&#x27;</span><br><span class="line">          fillClass=&#x27;fill-zinc-900 dark:fill-zinc-300&#x27;</span><br><span class="line">        &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">&lt;!--        VIP--&gt;</span><br><span class="line">        &lt;m-svg-icon</span><br><span class="line">          class=&#x27;h-1.5 w-1.5 absolute right-[16px] bottom-0&#x27;</span><br><span class="line">          name = &#x27;vip&#x27;</span><br><span class="line">        &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">&lt;!--气泡--&gt;</span><br><span class="line">    &lt;div class=&#x27;w-[140px] overflow-hidden&#x27;&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class=&#x27;flex items-center p-1 cursor-pointer rounded</span><br><span class="line">        hover:bg-zinc-100/60 dark:hover:bg-zinc-800&#x27;</span><br><span class="line">        v-for=&#x27;item in menuArr&#x27;</span><br><span class="line">        :key=&#x27;item.id&#x27;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;m-svg-icon</span><br><span class="line">          :name=&#x27;item.icon&#x27;</span><br><span class="line">          class=&#x27;w-1.5 h-1.5 mr-1&#x27;</span><br><span class="line">          fillClass=&#x27;fill-zinc-900 dark:fill-zinc-300&#x27;</span><br><span class="line">        &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">        &lt;span class=&#x27;text-zinc-800 text-sm dark:text-zinc-300&#x27; &gt;&#123;&#123;item.title&#125;&#125;&lt;/span&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/m-popover&gt;</span><br><span class="line"></span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><ol start="2"><li>修改header&#x2F;header-theme.vue</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;m-popover placement=&#x27;bottom-left&#x27;&gt;</span><br><span class="line">    &lt;!--具名插槽：触发弹层的视图--&gt;</span><br><span class="line">    &lt;template #reference&gt;</span><br><span class="line">      &lt;m-svg-icon</span><br><span class="line">        name=&#x27;theme-light&#x27;</span><br><span class="line">        class=&#x27;w-4 h-4 p-1 cursor-pointer rounded-sm duration-200</span><br><span class="line">        outline-none hover:bg-zinc-100/60 dark:hover:bg-zinc-900&#x27;</span><br><span class="line">        fillClass=&#x27;fill-zinc-900 dark:fill-zinc-300&#x27;</span><br><span class="line">      &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">      &lt;!--    匿名插槽:弹出层视图中展示的内容--&gt;</span><br><span class="line">      &lt;div class=&#x27;w-[140px] overflow-hidden&#x27;&gt;</span><br><span class="line">        &lt;div</span><br><span class="line">          class=&#x27;flex item-center p-1 cursor-pointer rounded</span><br><span class="line">          hover:bg-zinc-100/60 dark:hover:bg-zinc-800&#x27;</span><br><span class="line">          v-for=&#x27;item in themeArr&#x27;</span><br><span class="line">          :key=&#x27;item.id&#x27;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;m-svg-icon</span><br><span class="line">            :name=&#x27;item.icon&#x27;</span><br><span class="line">            class=&#x27;w-1.5 h-1.5 mr-1&#x27;</span><br><span class="line">            fillClass=&#x27;fill-zinc-900 dark:fill-zinc-300&#x27;</span><br><span class="line">          &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">          &lt;span class=&#x27;text-zinc-900 text-sm dark:text-zinc-300&#x27;&gt;&#123;&#123; item.name &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/m-popover&gt;</span><br><span class="line"></span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><ol start="3"><li>修改view&#x2F;main&#x2F;components&#x2F;menu&#x2F;index.vue</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;div class=&#x27;py-2 h-[80vh] flex flex-col&#x27;&gt;</span><br><span class="line">  &lt;h2 class=&#x27;text-xl text-zinc-900 dark:text-zinc-200 font-bold mb-2 px-1&#x27;&gt;</span><br><span class="line">    所有分类</span><br><span class="line">  &lt;/h2&gt;</span><br><span class="line">  &lt;ul class=&#x27;overflow-y-scroll&#x27;&gt;</span><br><span class="line">    &lt;li</span><br><span class="line">      v-for=&quot;(item,index)in $store.getters.categorys&quot;</span><br><span class="line">      :key=&quot;item.id&quot;</span><br><span class="line">      class=&quot;text-lg text-zinc-900 dark:text-zinc-300 px-1 py-1.5</span><br><span class="line">      duration-100 active:bg-zinc-100 dark:active:bg-zinc-900&quot;</span><br><span class="line">      @click=&quot;$emit(&#x27;onItemClick&#x27;,index)&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &#123;&#123;item.name&#125;&#125;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">  &lt;/ul&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><ol start="4"><li>修改view&#x2F;main&#x2F;components&#x2F;navigation&#x2F;mobile&#x2F;index.vue</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;bg-white dark :bg-zinc-900 sticky top-0 left-0 z-10&quot;&gt;</span><br><span class="line">    &lt;ul</span><br><span class="line">      ref=&quot;ulTarget&quot;</span><br><span class="line">      class=&quot; relative flex overflow-x-auto p-1 text-xs text-zinc-600</span><br><span class="line">      overflow-hidden&quot;&gt;</span><br><span class="line">      &lt;!--滑块--&gt;</span><br><span class="line">      &lt;li</span><br><span class="line">        ref=&quot;sliderTarget&quot;</span><br><span class="line">        :style=&quot;sliderStyle&quot;</span><br><span class="line">        class=&quot;absolute h-[22px] bg-zinc-900 dark:bg-zinc-800 rounded-lg duration-200&quot;</span><br><span class="line">      &gt;</span><br><span class="line">      &lt;/li&gt;</span><br><span class="line">      &lt;!--汉堡按钮--&gt;</span><br><span class="line">      &lt;li</span><br><span class="line">        class=&quot;fixed top-0 right-[-1px] h-4 px-1 flex items-center bg-white</span><br><span class="line">        dark:bg-zinc-900 z-20 shadow-l-white dark:shadow-l-zinc&quot;</span><br><span class="line">        @click=&#x27;onShowPopup&#x27;&gt;</span><br><span class="line">        &lt;m-svg-icon class=&quot;w-1.5 h-1.5&quot; name=&quot;hamburger&quot;&gt;&lt;/m-svg-icon&gt;</span><br><span class="line">      &lt;/li&gt;</span><br><span class="line">      &lt;li</span><br><span class="line">        v-for=&quot;(item,index) in $store.getters.categorys&quot;</span><br><span class="line">        :key=&quot;item.id&quot;</span><br><span class="line">        class=&quot;shrink-0 px-1.5 py-0.5 z-10 duration-200 last:mr-4&quot;</span><br><span class="line">        :class=&quot;&#123;</span><br><span class="line">          &#x27;text-zinc-100&#x27;: currentCategoryIndex === index</span><br><span class="line">        &#125;&quot;</span><br><span class="line">        :ref=&quot;setItemRef&quot;</span><br><span class="line">        @click=&quot;onItemClick(index)&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &#123;&#123;item.name&#125;&#125;</span><br><span class="line">      &lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">    &lt;m-popup v-model=&#x27;isVisable&#x27;&gt;</span><br><span class="line">      &lt;menu-vue  @onItemClick=&quot;onItemClick&quot;&gt;&lt;/menu-vue&gt;</span><br><span class="line">    &lt;/m-popup&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><ol start="5"><li>修改view&#x2F;main&#x2F;components&#x2F;navigation&#x2F;pc&#x2F;index.vue</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&#x27;bg-white dark:bg-zinc-800 sticky top-0 left-0 w-full z-10&#x27;&gt;</span><br><span class="line">    &lt;ul</span><br><span class="line">      class=&#x27;w-[800px] relative flex flex-wrap justify-center</span><br><span class="line">      overflow-x-auto px-[10px] py-1 text-xs text-zinc-600 duration-300</span><br><span class="line">      overflow-hidden max-auto&#x27;</span><br><span class="line">      :class=&quot;[isOpenCategory ? &#x27;h-[206px]&#x27; : &#x27;h-[56px]&#x27;]&quot;</span><br><span class="line">    &gt;</span><br><span class="line">&lt;!--      展示箭头--&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class=&#x27;absolute right-1 bottom-1 z-20 p-1 rounded cursor-pointer</span><br><span class="line">        duration-200 hover:bg-zinc-200 dark:hover:bg-zinc-900&#x27;</span><br><span class="line">        @click=&#x27;triggerState&#x27;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;m-svg-icon</span><br><span class="line">          :name=&quot;isOpenCategory ? &#x27;fold&#x27;:&#x27;unfold&#x27; &quot;</span><br><span class="line">          class=&#x27;w-1 h-1&#x27;</span><br><span class="line">          fillClass=&#x27;fill-zinc-900 dark:fill-zinc-300&#x27;</span><br><span class="line">        &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">&lt;!--      item--&gt;</span><br><span class="line">      &lt;li</span><br><span class="line">        v-for=&#x27;(item,index) in $store.getters.categorys&#x27;</span><br><span class="line">        :key=&#x27;item.id&#x27;</span><br><span class="line">        class=&#x27;shrink-0 px-1.5 py-0 z-10 duration-200 text-zinc-900</span><br><span class="line">        dark:text-zinc-500 dark:hover:text-zinc-300 text-base font-bold</span><br><span class="line">        h-4 leading-4 cursor-pointer hover:bg-zinc-200 dark:hover:bg-zinc-900</span><br><span class="line">        rounded mr-1 mb-1&#x27;</span><br><span class="line">        :class=&quot;&#123;</span><br><span class="line">          &#x27;text-zinc-900 dark:text-zinc-300 bg-zinc-200 dark:bg-zinc-900&#x27; :currentCategoryIndex === index</span><br><span class="line">        &#125;&quot;</span><br><span class="line">        @click=&quot;onItemClick(index)&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &#123;&#123;item.name&#125;&#125;</span><br><span class="line">      &lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><ol start="6"><li>修改lib&#x2F;button&#x2F;index.vue</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;button</span><br><span class="line">    class=&#x27;text-xs text-center rounded duration-150 flex justify-center items-center&#x27;</span><br><span class="line">    :class=&quot;[</span><br><span class="line">      typeEnum[type],</span><br><span class="line">      sizeEnum[sizeKey].button,</span><br><span class="line">      &#123;</span><br><span class="line">        &#x27;active:scale-105&#x27;:isActiveAnim</span><br><span class="line">      &#125;</span><br><span class="line">    ]&quot;</span><br><span class="line">    @click.stop=&#x27;onBtnClick&#x27;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;!-- loading--&gt;</span><br><span class="line">    &lt;m-svg-icon</span><br><span class="line">      v-if=&#x27;loading&#x27;</span><br><span class="line">      name=&#x27;loading&#x27;</span><br><span class="line">      class=&#x27;w-2 h-2 animate-spin mr-1&#x27;</span><br><span class="line">    &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">    &lt;!-- icon按钮--&gt;</span><br><span class="line">    &lt;m-svg-icon</span><br><span class="line">      v-if=&#x27;icon&#x27;</span><br><span class="line">      :name=&#x27;icon&#x27;</span><br><span class="line">      class=&#x27;m-auto&#x27;</span><br><span class="line">      :class=&#x27;sizeEnum[sizeKey].icon&#x27;</span><br><span class="line">      :color=&#x27;iconColor&#x27;</span><br><span class="line">      :fillClass=&#x27;iconClass&#x27;</span><br><span class="line">    &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">    &lt;!-- icon按钮--&gt;</span><br><span class="line">    &lt;slot v-else/&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><ol start="7"><li>修改lib&#x2F;popover&#x2F;index.vue</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div class=&#x27;relative&#x27; @mouseenter=&#x27;onMouseenter&#x27;</span><br><span class="line">@mouseleave=&#x27;onMouseleave&#x27;&gt;</span><br><span class="line">  &lt;div ref=&#x27;referenceTarget&#x27;&gt;</span><br><span class="line">&lt;!--    具名插槽：触发弹层的视图--&gt;</span><br><span class="line">    &lt;slot name=&#x27;reference&#x27;/&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;!--  气泡展示--&gt;</span><br><span class="line">  &lt;transition name=&#x27;slide&#x27;&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      ref=&#x27;contentTarget&#x27;</span><br><span class="line">      v-show=&#x27;isVisable&#x27;</span><br><span class="line">      class=&#x27;absolute p-1 z-20 bg-white dark:bg-zinc-900 border</span><br><span class="line">      dark:border-zinc-700 rounded-md&#x27;</span><br><span class="line">      :style=&#x27;contentStyle&#x27;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;!--    匿名插槽:弹出层视图中展示的内容--&gt;</span><br><span class="line">      &lt;slot/&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/transition&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><ol start="8"><li>修改lib&#x2F;popup&#x2F;index.vue</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">  &lt;teleport to=&quot;body&quot;&gt;</span><br><span class="line">    &lt;!-- 蒙版--&gt;</span><br><span class="line">    &lt;transition name=&quot;fade&quot;&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        v-if=&#x27;isVisable&#x27;</span><br><span class="line">        class=&#x27;w-screen h-screen bg-zinc-900/80 z-40 fixed top-0 left-0&#x27;</span><br><span class="line">        @click=&quot;isVisable = false&quot;</span><br><span class="line">      &gt;&lt;/div&gt;</span><br><span class="line">    &lt;/transition&gt;</span><br><span class="line">    &lt;!-- 内容--&gt;</span><br><span class="line">    &lt;transition name=&quot;popup-down-up&quot;&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        v-if=&#x27;isVisable&#x27;</span><br><span class="line">        v-bind=&quot;$attrs&quot;</span><br><span class="line">        class=&#x27;w-screen bg-white dark:bg-zinc-800 z-50 fixed bottom-0 &#x27;&gt;</span><br><span class="line">        &lt;slot/&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/transition&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/teleport&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><ol start="9"><li>修改lib&#x2F;search&#x2F;index.vue</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    class=&#x27;group relative p-0.5 rounded-xl border-white dark:border-zinc-200</span><br><span class="line">    duration-500 hover:bg-red-100/40&#x27;</span><br><span class="line">    ref=&#x27;containerTarge&#x27;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;!--搜索图标--&gt;</span><br><span class="line">      &lt;m-svg-icon</span><br><span class="line">        class=&#x27;w-1.5 h-1.5 absolute translate-y-[-50%] top-[50%] left-2&#x27;</span><br><span class="line">        name=&quot;search&quot;</span><br><span class="line">        color=&quot;#70707&quot;</span><br><span class="line">      &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">      &lt;!--输入框--&gt;</span><br><span class="line">      &lt;input</span><br><span class="line">        class=&#x27;block w-full h-[44px] pl-4 outline-0 bg-zinc-100</span><br><span class="line">        dark:bg-zinc-800  caret-zinc-400 rounded-xl text-zinc-900</span><br><span class="line">        dark:text-zinc-200 tracking-wide text-sm font-semibold border</span><br><span class="line">        border-zinc-100 dark:border-zinc-700 duration-500</span><br><span class="line">        focus:border-red-300 group-hover:bg-white</span><br><span class="line">        dark:group-hover:bg-zinc-900 group-hover:border-zinc-200</span><br><span class="line">        dark:group-hover:bg-zinc-700&#x27;</span><br><span class="line">        type=&quot;text&quot;</span><br><span class="line">        placeholder=&quot;搜索&quot;</span><br><span class="line">        v-model=&#x27;intputValue&#x27;</span><br><span class="line">        @keyup.enter=&#x27;onSearchHandler&#x27;</span><br><span class="line">        @focus=&#x27;onFocusHandler&#x27;</span><br><span class="line">        @blur=&#x27;onBlurHandler&#x27;</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;!--删除按钮--&gt;</span><br><span class="line">      &lt;m-svg-icon</span><br><span class="line">        v-show=&#x27;intputValue&#x27;</span><br><span class="line">        name = &quot;input-delete&quot;</span><br><span class="line">        class=&#x27;w-1.5 h-1.5 absolute translate-y-[-50%] top-[50%] right-9</span><br><span class="line">        cursor-pointer duration-500&#x27;</span><br><span class="line">        @click=&#x27;onClearClick&#x27;</span><br><span class="line">      &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">      &lt;!--分割线--&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class=&#x27;opacity-0 h-1.5 w-[1px] absolute translate-y-[-50%] top-[50%]</span><br><span class="line">        right-[62px] duration-500 bg-zinc-200 group-hover:opacity-100&#x27;</span><br><span class="line">      &gt;&lt;/div&gt;</span><br><span class="line">      &lt;!--TODO:搜索按钮（通用组件）--&gt;</span><br><span class="line">      &lt;m-button</span><br><span class="line">        class=&#x27;opacity-0 absolute translate-y-[-50%] top-[50%] right-1 rounded-full duration-500 group-hover:opacity-100&#x27;</span><br><span class="line">        icon=&#x27;search&#x27;</span><br><span class="line">        iconColor=&#x27;#ffffff&#x27;</span><br><span class="line">        @click=&#x27;onSearchHandler&#x27;</span><br><span class="line">      &gt;&lt;/m-button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!--下拉区--&gt;</span><br><span class="line">    &lt;transition name=&#x27;slide&#x27;&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        v-if=&#x27;$slots.dropdown&#x27;</span><br><span class="line">        v-show=&#x27;isFocus&#x27;</span><br><span class="line">        class=&#x27;max-h-[368px] w-full text-base overflow-auto bg-white</span><br><span class="line">        dark:bg-zinc-800 absolute z-20 left-0 top-[56px] p-2 rounded border</span><br><span class="line">        border-zinc-200 dark:border-zinc-600 duration-200 hover:shadow-2xl&#x27;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;slot name=&#x27;dropdown&#x27;/&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/transition&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><ol start="10"><li>最后就是个tailwind.config.js增加一个新的阴影特效</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">boxShadow</span>:&#123;</span><br><span class="line">  <span class="string">&#x27;l-white&#x27;</span>: <span class="string">&#x27;-10px 0 10px white&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;l-zinc&#x27;</span>: <span class="string">&#x27;-10px 0 10px #18181b&#x27;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h2 id="8-4-DarkMode在复杂应用中的实现逻辑分析"><a href="#8-4-DarkMode在复杂应用中的实现逻辑分析" class="headerlink" title="8-4 DarkMode在复杂应用中的实现逻辑分析"></a>8-4 DarkMode在复杂应用中的实现逻辑分析</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//1.监听主题的切换行为</span><br><span class="line">//2.根据行为保存当前需要展示的主题到vuex中</span><br><span class="line">//3.根据vuex中保存的当前主题，展示header-theme下的显示图标</span><br><span class="line">//4.根据vuex中保存的当前主题，修改html的class</span><br></pre></td></tr></table></figure><h2 id="8-5-DarkMode在复杂应用中的实现"><a href="#8-5-DarkMode在复杂应用中的实现" class="headerlink" title="8-5 DarkMode在复杂应用中的实现"></a>8-5 DarkMode在复杂应用中的实现</h2><ol><li>首先创建store&#x2F;modules&#x2F;theme.js</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>&#123;<span class="variable constant_">THEME_LIGHT</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;@/constants&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">namespaced</span>:<span class="literal">true</span>,</span><br><span class="line">  <span class="attr">state</span>:<span class="function">()=&gt;</span>(&#123;</span><br><span class="line">    <span class="comment">//当前主题模式</span></span><br><span class="line">    <span class="attr">themeType</span>:<span class="variable constant_">THEME_LIGHT</span></span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="attr">mutations</span>:&#123;</span><br><span class="line">    <span class="title function_">changeThemeType</span>(<span class="params">state,newTheme</span>)&#123;</span><br><span class="line">      state.<span class="property">themeType</span> = newTheme</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>将该模块进行注册在store&#x2F;index.js</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> theme <span class="keyword">from</span> <span class="string">&#x27;./modules/theme&#x27;</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">createStore</span>(&#123;</span><br><span class="line">  getters,</span><br><span class="line">  <span class="attr">modules</span>:&#123;</span><br><span class="line">    category,</span><br><span class="line">    theme</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>:[</span><br><span class="line">   <span class="title function_">createPersistedState</span>(&#123;</span><br><span class="line">     <span class="comment">//指定保存到localStorage中的key</span></span><br><span class="line">     <span class="attr">key</span>:<span class="string">&#x27;imooc-front&#x27;</span>,</span><br><span class="line">     <span class="comment">//需要保存的模块</span></span><br><span class="line">     <span class="attr">paths</span>:[<span class="string">&#x27;category&#x27;</span>,<span class="string">&#x27;theme&#x27;</span>]</span><br><span class="line">   &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure><ol start="3"><li>在store&#x2F;getter.js中创建新的访问</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">//当前主题</span></span><br><span class="line">  <span class="attr">themeType</span>:<span class="function">(<span class="params">state</span>)=&gt;</span> state.<span class="property">theme</span>.<span class="property">themeType</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面这些步骤是创建vuex</p><hr><p>以下内容全是基于header&#x2F;header-theme.vue</p><ol start="4"><li>监听主题的切换行为并根据行为保存当前需要展示的主题到vuex中，首先在匿名插槽设置点击事件，然后使用store进行传输</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--    匿名插槽:弹出层视图中展示的内容--&gt;</span><br><span class="line">&lt;div class=&#x27;w-[140px] overflow-hidden&#x27;&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    class=&#x27;flex item-center p-1 cursor-pointer rounded</span><br><span class="line">    hover:bg-zinc-100/60 dark:hover:bg-zinc-800&#x27;</span><br><span class="line">    v-for=&#x27;item in themeArr&#x27;</span><br><span class="line">    :key=&#x27;item.id&#x27;</span><br><span class="line">    @click=&#x27;onItemClick(item)&#x27;</span><br><span class="line">  &gt;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useStore &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">useStore</span>()</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * menu切换事件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onItemClick</span> =(<span class="params">themeItem</span>) =&gt;&#123;</span><br><span class="line">  store.<span class="title function_">commit</span>(<span class="string">&#x27;theme/changeThemeType&#x27;</span>,themeItem.<span class="property">type</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="5"><li>根据vuex中保存的当前主题，展示header-theme下的显示图标，在具名插槽中设置name</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 展示图标</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> svgIconName =<span class="title function_">computed</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> findTheme =themeArr.<span class="title function_">find</span>(<span class="function">(<span class="params">item</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> item.<span class="property">type</span>===store.<span class="property">getters</span>.<span class="property">themeType</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> findTheme?.<span class="property">icon</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;m-svg-icon</span><br><span class="line">  :name=&#x27;svgIconName&#x27;</span><br><span class="line">  class=&#x27;w-4 h-4 p-1 cursor-pointer rounded-sm duration-200</span><br><span class="line">  outline-none hover:bg-zinc-100/60 dark:hover:bg-zinc-900&#x27;</span><br><span class="line">  fillClass=&#x27;fill-zinc-900 dark:fill-zinc-300&#x27;</span><br><span class="line">&gt;&lt;/m-svg-icon&gt;</span><br></pre></td></tr></table></figure><ol start="6"><li>根据vuex中保存的当前主题，修改html的class，我们先创建工具类utils&#x2F;theme.js，这样的方法我们在main.js中触发一次就可以了，如果觉得切换过于生硬那么就添加过度动画</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="variable constant_">THEME_LIGHT</span>,<span class="variable constant_">THEME_DARK</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;@/constants&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;watch&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;../store&#x27;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 初始化主题</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> ()=&gt;&#123;</span><br><span class="line">  <span class="comment">//1.当主题发生改变时，或者当进入系统时，可以进行html class的配置</span></span><br><span class="line">  <span class="title function_">watch</span>(</span><br><span class="line">    <span class="function">()=&gt;</span>store.<span class="property">getters</span>.<span class="property">themeType</span>,</span><br><span class="line">    <span class="function">(<span class="params">val</span>)=&gt;</span>&#123;</span><br><span class="line">      <span class="comment">//html的class</span></span><br><span class="line">      <span class="keyword">let</span> themeClassName = <span class="string">&#x27;&#x27;</span></span><br><span class="line">      <span class="keyword">switch</span> (val)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="attr">THEME_LIGHT</span>:</span><br><span class="line">          themeClassName=<span class="string">&#x27;light&#x27;</span></span><br><span class="line">          <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">case</span> <span class="attr">THEME_DARK</span>:</span><br><span class="line">          themeClassName=<span class="string">&#x27;dark&#x27;</span></span><br><span class="line">          <span class="keyword">break</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//修改html的class</span></span><br><span class="line">      <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;html&#x27;</span>).<span class="property">className</span> = themeClassName</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">//初始执行一次</span></span><br><span class="line">      <span class="attr">immediate</span>:<span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> useTheme <span class="keyword">from</span> <span class="string">&#x27;./utils/theme&#x27;</span></span><br><span class="line"><span class="title function_">useREM</span>()</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">duration-<span class="number">500</span></span><br></pre></td></tr></table></figure><h2 id="8-6-跟随系统的主题变更"><a href="#8-6-跟随系统的主题变更" class="headerlink" title="8-6 跟随系统的主题变更"></a>8-6 跟随系统的主题变更</h2><p>想要生成跟随系统的主题变更，那么我们就需要<strong>监听系统的主题变化</strong></p><p>想要做到这一点，可以利用<strong>Window.matchMedia（）</strong>方法，该方法接收一个 mediaQueryString（媒体查询解析的字符串）<br>该字符串我们可以传递 <strong>prefers-color-scheme</strong>，即window.matchMedia（’（prefers-color-scheme：dark）’）方法</p><p>该方法可以返回一个<strong>MediaQueryList</strong>对象：</p><p>1.该对象存在一个<strong>change</strong>事件，可以监听<strong>主题发生变更</strong>的行为。<br>2.同时存在一个<strong>matches</strong>属性，该属性为boolean性的值：</p><ol><li>true：深色主题</li><li>false：浅色主题</li></ol><p>那么据此，可生成以下代码。在src&#x2F;utils&#x2F;theme.js中</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="variable constant_">THEME_LIGHT</span>,<span class="variable constant_">THEME_DARK</span>,<span class="variable constant_">THEME_SYSTEM</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;@/constants&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;watch&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;../store&#x27;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 监听系统主题变更</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">let</span> matchMedia</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">watchSystemThemeChange</span> =(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  <span class="comment">//仅需一次初始化</span></span><br><span class="line">  <span class="keyword">if</span> (matchMedia) <span class="keyword">return</span></span><br><span class="line">  matchMedia =<span class="variable language_">window</span>.<span class="title function_">matchMedia</span>(<span class="string">&#x27;(prefers-color-scheme:dark)&#x27;</span>)</span><br><span class="line">  <span class="comment">//监听主题变化</span></span><br><span class="line">  matchMedia.<span class="property">onchange</span>=<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="title function_">changeTheme</span>(<span class="variable constant_">THEME_SYSTEM</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 变更主题</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> theme主题的标记</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">changeTheme</span>=(<span class="params">theme</span>)=&gt;&#123;</span><br><span class="line">  <span class="comment">//html的class</span></span><br><span class="line">  <span class="keyword">let</span> themeClassName = <span class="string">&#x27;&#x27;</span></span><br><span class="line">  <span class="keyword">switch</span> (theme)&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="attr">THEME_LIGHT</span>:</span><br><span class="line">      themeClassName=<span class="string">&#x27;light&#x27;</span></span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">case</span> <span class="attr">THEME_DARK</span>:</span><br><span class="line">      themeClassName=<span class="string">&#x27;dark&#x27;</span></span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">case</span> <span class="attr">THEME_SYSTEM</span>:</span><br><span class="line">      <span class="comment">//调用方法，监听系统主题变化</span></span><br><span class="line">      <span class="title function_">watchSystemThemeChange</span>()</span><br><span class="line">      themeClassName=matchMedia.<span class="property">matches</span>?<span class="string">&#x27;dark&#x27;</span>:<span class="string">&#x27;light&#x27;</span></span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//修改html的class</span></span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;html&#x27;</span>).<span class="property">className</span> = themeClassName</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 初始化主题</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> ()=&gt;&#123;</span><br><span class="line">  <span class="comment">//1.当主题发生改变时，或者当进入系统时，可以进行html class的配置</span></span><br><span class="line">  <span class="title function_">watch</span>(<span class="function">() =&gt;</span>store.<span class="property">getters</span>.<span class="property">themeType</span>,changeTheme, &#123;</span><br><span class="line">      <span class="comment">//初始执行一次</span></span><br><span class="line">      <span class="attr">immediate</span>:<span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="9、瀑布流-长列表-懒加载处理方案-——-打造企业级高性能通用模块"><a href="#9、瀑布流-长列表-懒加载处理方案-——-打造企业级高性能通用模块" class="headerlink" title="9、瀑布流+长列表+懒加载处理方案 —— 打造企业级高性能通用模块"></a>9、瀑布流+长列表+懒加载处理方案 —— 打造企业级高性能通用模块</h1><p>为什么大厂的应用使用起来总是那么的丝滑？他们到底给应用施加了什么样的“魔法”？我能开发出媲美大厂团队的精美前台应用吗？应该怎么做？本章把这些“咒语”统统告诉你！</p><hr><h2 id="9-1-业务组件：构建基础列表展示"><a href="#9-1-业务组件：构建基础列表展示" class="headerlink" title="9-1 业务组件：构建基础列表展示"></a>9-1 业务组件：构建基础列表展示</h2><ol><li>首先创建api&#x2F;pexeis.js来获取图片数据</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取图片数据列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getPexlesList</span> = (<span class="params">data</span>) =&gt;&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>:<span class="string">&#x27;/pexels/list&#x27;</span>,</span><br><span class="line">    <span class="attr">params</span>:data</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>其次在main&#x2F;components&#x2F;下创建list目录，list目录包括index.vue（本身）及item.vue（每个小图片），并在main&#x2F;components&#x2F;index.vue导入组件</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&#x27;h-full overflow-auto bg-white dark:bg-zinc-800 duration-500&#x27;&gt;</span><br><span class="line">  &lt;navigation-vue/&gt;</span><br><span class="line">  &lt;div class=&#x27;max-w-screen-xl mx-auto relative m-1 xl:mt-4&#x27;&gt;</span><br><span class="line">    &lt;list-vue&gt;&lt;/list-vue&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import navigationVue from &#x27;./components/navigation/index.vue&#x27;</span><br><span class="line">import listVue from &#x27;./components/list/index.vue&#x27;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><ol start="3"><li>在main&#x2F;components&#x2F;list&#x2F;index.vue中获取图片那些数据</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123;getPexlesList&#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/pexeis&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">/**</span></span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"><span class="language-xml"> * 构建数据请求</span></span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"><span class="language-xml"> */</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">let</span> query=&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">page</span>:<span class="number">1</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">size</span>:<span class="number">20</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> <span class="title function_">getPexlesData</span> = <span class="keyword">async</span>(<span class="params"></span>)=&gt;&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">getPexlesList</span>(query)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="title function_">getPexlesData</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&#x27;scss&#x27;</span> <span class="attr">scoped</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure><ol start="4"><li>在main&#x2F;components&#x2F;list&#x2F;index.vue中加载数据源</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">  &lt;item-vue v-for=&#x27;item in pexelsList&#x27; :key=&#x27;item.id&#x27; :data=&#x27;item&#x27;&gt;&lt;/item-vue&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123;getPexlesList&#125; from &#x27;@/api/pexeis&#x27;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">import itemVue from &#x27;./item.vue&#x27;</span><br><span class="line">/**</span><br><span class="line"> * 构建数据请求</span><br><span class="line"> */</span><br><span class="line">let query=&#123;</span><br><span class="line">  page:1,</span><br><span class="line">  size:20</span><br><span class="line">&#125;</span><br><span class="line">const pexelsList = ref([])</span><br><span class="line">const getPexlesData = async()=&gt;&#123;</span><br><span class="line">  const res = await getPexlesList(query)</span><br><span class="line">  pexelsList.value=res.list</span><br><span class="line">&#125;</span><br><span class="line">getPexlesData()</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><ol start="5"><li>设置main&#x2F;components&#x2F;list&#x2F;item.vue的内容</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div class=&#x27;bg-white dark:bg-zinc-900 xl:dark:bg-zinc-800 rounded pb-1 h-[280px] w-[230px]&#x27;&gt;</span><br><span class="line">  &lt;div class=&#x27;relative w-full rounded cursor-zoom-in group&#x27;&gt;</span><br><span class="line">&lt;!--    图片--&gt;</span><br><span class="line">    &lt;img class=&#x27;w-full rounded bg-transparent&#x27; :src=&#x27;data.photo&#x27;/&gt;</span><br><span class="line">&lt;!--    遮罩层--&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      class=&#x27;hidden opacity-0 w-full h-full bg-zinc-900/50 absolute top-0</span><br><span class="line">      left-0 rounded duration-300 group-hover:opacity-100 xl:block&#x27;&gt;</span><br><span class="line">&lt;!--      分享--&gt;</span><br><span class="line">      &lt;m-button class=&#x27;absolute top-1.5 left-1.5&#x27;&gt;分享&lt;/m-button&gt;</span><br><span class="line">&lt;!--      点赞--&gt;</span><br><span class="line">      &lt;m-button</span><br><span class="line">        class=&#x27;absolute top-1.5 right-1.5&#x27;</span><br><span class="line">        type=&#x27;info&#x27;</span><br><span class="line">        icon=&#x27;heart&#x27;</span><br><span class="line">        iconClass=&#x27;fill-zinc-900 dark:fill-zinc-200&#x27;</span><br><span class="line">      &gt;&lt;/m-button&gt;</span><br><span class="line">&lt;!--      下载--&gt;</span><br><span class="line">      &lt;m-button</span><br><span class="line">        class=&#x27;absolute bottom-1.5 left-1.5 bg-zinc-100/70&#x27;</span><br><span class="line">        type=&#x27;info&#x27;</span><br><span class="line">        size=&#x27;small&#x27;</span><br><span class="line">        icon=&#x27;download&#x27;</span><br><span class="line">        iconClass=&#x27;fill-zinc-900 dark:fill-zinc-200&#x27;</span><br><span class="line">      &gt;&lt;/m-button&gt;</span><br><span class="line">&lt;!--      全屏--&gt;</span><br><span class="line">      &lt;m-button</span><br><span class="line">        class=&#x27;absolute bottom-1.5 right-1.5 bg-zinc-100/70&#x27;</span><br><span class="line">        type=&#x27;info&#x27;</span><br><span class="line">        size=&#x27;small&#x27;</span><br><span class="line">        icon=&#x27;full&#x27;</span><br><span class="line">        iconClass=&#x27;fill-zinc-900 dark:fill-zinc-200&#x27;</span><br><span class="line">      &gt;&lt;/m-button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;!--  标题--&gt;</span><br><span class="line">  &lt;p class=&#x27;text-sm mt-1 font-bold text-zinc-900 dark:text-zinc-300 px-1&#x27;&gt;</span><br><span class="line">    &#123;&#123;data.title&#125;&#125;</span><br><span class="line">  &lt;/p&gt;</span><br><span class="line">&lt;!--  作者--&gt;</span><br><span class="line">  &lt;div class=&#x27;flex items-center mt-1 px-1&#x27;&gt;</span><br><span class="line">    &lt;img class=&quot;h-2 w-2 rounded-full&quot; :src=&quot;data.avatar&quot; alt=&#x27;&#x27;/&gt;</span><br><span class="line">    &lt;span class=&#x27;text-sm text-zinc-500 ml-1&#x27;&gt;&#123;&#123;data.author&#125;&#125;&lt;/span&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h2 id="9-2-通用组件：瀑布流组件构建分析"><a href="#9-2-通用组件：瀑布流组件构建分析" class="headerlink" title="9-2 通用组件：瀑布流组件构建分析"></a>9-2 通用组件：瀑布流组件构建分析</h2><p>目前咱们的列表组件已经可以展示了，只不过是展示的样式还存在一些问题。</p><p>那么这样的一个样式处理的过程就是<strong>瀑布流组件的构建过程</strong></p><p>所以说我们想要搞清楚，这个瀑布流如何构建，那么就需要搞明白，现在的样式中，还存在的问题是什么？</p><p>存在的问题就是<strong>：每个item应该横向排列，第二行的item顺序连接到当前最短的列中</strong>，而这个也就是构建瀑布流的核心逻辑。</p><p>那么想要实现这个核心逻辑，我们的每个item肯定就不可以使用正常的布局方式，而必须使用 absolute 绝对布局，通过top 和left 来手动控制位置。</p><p>那么明确好了这个核心逻辑之后，接下来如何进行构建呢？</p><p>想要搞明白一个复杂组件的构建机制，那么最好的方式是想象一下：<strong>当你去使用这个组件时，你希望如何进行使用。</strong></p><p>按照你期望的使用方式来反向思考构建过程，这样在主要的思路上就不会出现大的偏差。<br>那么我们期望，将来这个通用组件可以这样使用：在main&#x2F;components&#x2F;list&#x2F;index.vue</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">  &lt;m-waterfall :data=&quot;&quot; :nodeKey=&quot;&quot; :column=&quot;&quot; :picturePreReading=&quot;&quot;&gt;</span><br><span class="line">    &lt;template v-slot=&#x27;&#123;item,width&#125;&#x27;&gt;</span><br><span class="line">      &lt;item-vue :data=&#x27;item&#x27;&gt;&lt;/item-vue&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">  &lt;/m-waterfall&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><p>那么综合起来来看，整个的一个瀑布流组件的构建我们需要分成几分：</p><ol><li><p>通过props传递关键数据（部分）:</p><ol><li>data：数据源</li><li>nodeKey：唯一标识</li><li>column：宣染的列数</li><li>picturePreReading：是否需要图片预宣染</li></ol></li><li><p>瀑布流宣染机制：通过absolute 配合 relative完成布局，布局逻辑为：<strong>每个item应该横向排列，第二行的item顺序连接到当前最短的列中</strong></p></li><li><p>通过<strong>作用域插槽</strong>将每个item中涉及到的关键数据，传递到item视图中</p></li></ol><h2 id="9-3-通用组件-瀑布流：构建瀑布流布局，获取容器宽度与列宽"><a href="#9-3-通用组件-瀑布流：构建瀑布流布局，获取容器宽度与列宽" class="headerlink" title="9-3 通用组件-瀑布流：构建瀑布流布局，获取容器宽度与列宽"></a>9-3 通用组件-瀑布流：构建瀑布流布局，获取容器宽度与列宽</h2><ol><li>创建 src&#x2F;libs&#x2F;waterfall&#x2F;index.vue组件，并创建如下 props：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> props = <span class="title function_">defineProps</span>(&#123;</span><br><span class="line">  <span class="comment">//数据源</span></span><br><span class="line">  <span class="attr">data</span>:&#123;</span><br><span class="line">    <span class="attr">type</span>:<span class="title class_">Array</span>,</span><br><span class="line">    <span class="attr">require</span>:<span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//唯一标识</span></span><br><span class="line">  <span class="attr">nodeKey</span>:&#123;</span><br><span class="line">    <span class="attr">type</span>:<span class="title class_">String</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//列数</span></span><br><span class="line">  <span class="attr">colunm</span>:&#123;</span><br><span class="line">    <span class="attr">default</span>:<span class="number">2</span>,</span><br><span class="line">    <span class="attr">type</span>:<span class="title class_">Number</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//列间距</span></span><br><span class="line">  <span class="attr">colunmSpacing</span>:&#123;</span><br><span class="line">    <span class="attr">default</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="attr">type</span>:<span class="title class_">Number</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//行间距</span></span><br><span class="line">  <span class="attr">rowSpacing</span>:&#123;</span><br><span class="line">    <span class="attr">default</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="attr">type</span>:<span class="title class_">Number</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//是否需要进行图片预读取</span></span><br><span class="line">  <span class="attr">picturePreReading</span>:&#123;</span><br><span class="line">    <span class="attr">type</span>:<span class="title class_">Boolean</span>,</span><br><span class="line">    <span class="attr">default</span>:<span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ol start="2"><li>构建对应的基础视图</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    class=&#x27;relative&#x27;</span><br><span class="line">    ref=&#x27;containerTarget&#x27;</span><br><span class="line">    :style=&quot;&#123;</span><br><span class="line">      height:containerHeight+&#x27;px&#x27; //因为当前为relative布局，所以需要主动指定高度</span><br><span class="line">    &#125;&quot;</span><br><span class="line">  &gt;</span><br><span class="line">&lt;!--因为列数不确定，所以需要根据列数计算每列的宽度，所以等待列宽计算完成，并且有了数据源后进行渲染--&gt;</span><br><span class="line">    &lt;template v-if=&#x27;columnWidth &amp;&amp; data.length&#x27;&gt;</span><br><span class="line">&lt;!--      通过动态的style来计算对应的列宽、left、top--&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        v-for=&quot;&#123;item,index&#125; in data&quot;</span><br><span class="line">        :key=&quot;nodeKey ?item[nodeKey] :index&quot;</span><br><span class="line">        class=&#x27;m-waterfall-item absolute duration-300&#x27;</span><br><span class="line">        :style=&quot;&#123;</span><br><span class="line">          width:columnWidth+&#x27;px&#x27;,</span><br><span class="line">          left:item._style?.left+&#x27;px&#x27;,</span><br><span class="line">          top:item._style?.top+&#x27;px&#x27;</span><br><span class="line">        &#125;&quot;</span><br><span class="line">&gt;</span><br><span class="line">        &lt;slot :item=&#x27;item&#x27; :width=&#x27;columnWidth&#x27; :index=&#x27;index&#x27;/&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">&lt;!--    加载中--&gt;</span><br><span class="line">    &lt;div v-else&gt;加载中...&lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><ol start="3"><li><p>根据以上基础视图，我们需要生成对应的：</p><ol><li>containerHeight：总高度</li><li>columnWidth：列宽</li><li>item.<em>style.left：每个item对应的left</em></li><li>_item._style.right：每个item对应的right</li></ol></li><li><p>想要计算<strong>总高度</strong>，那么需要计算出<strong>每一列的高度</strong>，最高的一列为<strong>总高度</strong></p></li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//容器的总高度 = 最高的这一列的高度</span></span><br><span class="line"><span class="keyword">const</span> containerHeight = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line"><span class="comment">//记录每列高度的容器key:所在列 val：列高</span></span><br><span class="line"><span class="keyword">const</span> columnHeightObj = <span class="title function_">ref</span>(&#123;&#125;)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 构建记录每列高度的对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useColumnHeightObj</span> =(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  columnHeightObj.<span class="property">value</span>=&#123;&#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; props.<span class="property">colunm</span>; i++) &#123;</span><br><span class="line">    columnHeightObj.<span class="property">value</span>[i]= <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="5"><li>想要计算列宽，那么首先需要有容器的总宽度：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//容器实例</span></span><br><span class="line"><span class="keyword">const</span> containerTarget = <span class="title function_">ref</span>(<span class="literal">null</span>)</span><br><span class="line"><span class="comment">//容器总宽度（不包括padding、margin、border）</span></span><br><span class="line"><span class="keyword">const</span> containerWidth = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line"><span class="comment">//容器左边距、计算item left 时，需要定位</span></span><br><span class="line"><span class="keyword">const</span> containerLeft = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 计算容器宽度</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useContainerWidth</span> = (<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;paddingLeft,paddingRight&#125;=<span class="title function_">getComputedStyle</span>(</span><br><span class="line">    containerTarget.<span class="property">value</span>,</span><br><span class="line">    <span class="literal">null</span></span><br><span class="line">  )</span><br><span class="line">  <span class="comment">//容器左边距</span></span><br><span class="line">  containerLeft.<span class="property">value</span>=<span class="built_in">parseFloat</span>(paddingLeft)</span><br><span class="line">  <span class="comment">//容器宽度</span></span><br><span class="line">  containerWidth.<span class="property">value</span> =</span><br><span class="line">    containerTarget.<span class="property">value</span>.<span class="property">offsetWidth</span>-</span><br><span class="line">    <span class="built_in">parseFloat</span>(paddingLeft)-</span><br><span class="line">    <span class="built_in">parseFloat</span>(paddingRight)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="6"><li>计算列宽</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//列宽</span></span><br><span class="line"><span class="keyword">const</span> columnWidth = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line"><span class="comment">//列间距合计</span></span><br><span class="line"><span class="keyword">const</span> columnSpacingTotal = <span class="title function_">computed</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">//如果是五列，则存在4个列间距</span></span><br><span class="line">  <span class="keyword">return</span>(props.<span class="property">colunm</span>-<span class="number">1</span>)*props.<span class="property">colunmSpacing</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 开始计算</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useColumnWidth</span> =(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  <span class="comment">//获取容器宽度</span></span><br><span class="line">  <span class="title function_">useContainerWidth</span>()</span><br><span class="line">  <span class="comment">//计算列宽</span></span><br><span class="line">  columnWidth.<span class="property">value</span> = (containerWidth.<span class="property">value</span>-columnSpacingTotal)/props.<span class="property">colunm</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">onMounted</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">//计算列宽</span></span><br><span class="line">  <span class="title function_">useColumnWidth</span>()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ol start="7"><li>此时，在src&#x2F;views&#x2F;main&#x2F;components&#x2F;list&#x2F;index，vue 中使用该组件，可以打印出计算的值</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">  &lt;m-waterfall :data=&quot;pexelsList&quot; :nodeKey=&quot;id&quot; :column=&quot;5&quot; :picturePreReading=&quot;true&quot;&gt;</span><br><span class="line">    &lt;template v-slot=&#x27;&#123;item,width&#125;&#x27;&gt;</span><br><span class="line">      &lt;item-vue :data=&#x27;item&#x27;&gt;&lt;/item-vue&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">  &lt;/m-waterfall&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h2 id="9-4-布流：区分图片预加载，获取元素关键属性"><a href="#9-4-布流：区分图片预加载，获取元素关键属性" class="headerlink" title="9-4 布流：区分图片预加载，获取元素关键属性"></a>9-4 布流：区分图片预加载，获取元素关键属性</h2><p>想要计算每列的left，right，那么需要拿到每个 item的高度，因为只有有了每个item高，才可以判断下一列的第一个item的位置。</p><p>同时我们根据<strong>picturePreReading</strong>又可以分为两种情况：</p><ol><li>需要图片预加载时：图片高度未知</li><li>不需要图片预加载时：图片高度已知</li></ol><p>根据以上分析可得出以下代码:</p><ol><li>根据两种不同的情况，我们需要有两个不同的方法来进行计算：</li></ol><p><strong>需要图片预加载时</strong></p><ol><li>图片高度未知</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//item高度集合</span></span><br><span class="line"><span class="keyword">let</span> itemHeights=[]</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 监听图片加载完成(需要图片加载)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">waitImgComplate</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  itemHeights = []</span><br><span class="line">  <span class="comment">//拿到所有的元素</span></span><br><span class="line">  <span class="keyword">let</span> itemElements = [...<span class="variable language_">document</span>.<span class="title function_">getElementsByClassName</span>(<span class="string">&#x27;m-waterfall-item&#x27;</span>)]</span><br><span class="line">  <span class="comment">//获取到元素的img标签</span></span><br><span class="line">  <span class="keyword">const</span> imgElements = <span class="title function_">getImgElements</span>(itemElements)</span><br><span class="line">  <span class="comment">//获取所有img标签的图片</span></span><br><span class="line">  <span class="keyword">const</span> allImgs = <span class="title function_">getAllImg</span>(imgElements)</span><br><span class="line">  <span class="comment">//等待图片加载完成</span></span><br><span class="line">  <span class="title function_">onComplateImgs</span>(allImgs).<span class="title function_">then</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//图片加载完成</span></span><br><span class="line">    imgElements.<span class="title function_">forEach</span>(<span class="function">(<span class="params">el</span>)=&gt;</span>&#123;</span><br><span class="line">      itemHeights.<span class="title function_">push</span>(el.<span class="property">offsetHeight</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">//渲染位置</span></span><br><span class="line">    <span class="title function_">useItemLocation</span>()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>以上使用到了多个工具方法，可以创建src&#x2F;libs&#x2F;waterfall&#x2F;utils.js 模块进行处理：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 从itemElement中抽离出所有的imgElements</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getImgElements</span> = (<span class="params">itemElements</span>)=&gt;&#123;</span><br><span class="line">  <span class="keyword">const</span> imgElements = []</span><br><span class="line">  itemElements.<span class="title function_">forEach</span>(<span class="function">(<span class="params">el</span>)=&gt;</span>&#123;</span><br><span class="line">    imgElements.<span class="title function_">push</span>(...el.<span class="title function_">getElementsByTagName</span>(<span class="string">&#x27;img&#x27;</span>))</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> imgElements</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 生成所有的图片连接数组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getAllImg</span> = (<span class="params">imgElements</span>)=&gt;&#123;</span><br><span class="line">  <span class="keyword">return</span> imgElements.<span class="title function_">map</span>(<span class="function">(<span class="params">imgElements</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> imgElements.<span class="property">src</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 监听图片数组加载完成（promise）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">onComplateImgs</span> = (<span class="params">imgs</span>) =&gt;&#123;</span><br><span class="line">  <span class="comment">//promise集合</span></span><br><span class="line">  <span class="keyword">const</span> promiseAll = []</span><br><span class="line">  <span class="comment">//循环imgs,构建promiseAll</span></span><br><span class="line">  imgs.<span class="title function_">forEach</span>(<span class="function">(<span class="params">img,index</span>)=&gt;</span>&#123;</span><br><span class="line">    promiseAll[index] = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resole,reject</span>)=&gt;</span>&#123;</span><br><span class="line">      <span class="comment">//处理img的加载情况</span></span><br><span class="line">      <span class="keyword">const</span> imageObj = <span class="keyword">new</span> <span class="title class_">Image</span>()</span><br><span class="line">      imageObj.<span class="property">src</span> = img</span><br><span class="line">      imageObj.<span class="property">onload</span> = <span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="title function_">resolve</span>(&#123;</span><br><span class="line">          img,</span><br><span class="line">          index</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>(promiseAll)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>不需要图片预加载时</strong></p><ol><li>图片高度已知</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 不需要图片预加载</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useItemHeight</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  itemHeights = []</span><br><span class="line">  <span class="comment">//拿到所有的元素</span></span><br><span class="line">  <span class="keyword">let</span> itemElements = [...<span class="variable language_">document</span>.<span class="title function_">getElementsByClassName</span>(<span class="string">&#x27;m-waterfall-item&#x27;</span>)]</span><br><span class="line">  <span class="comment">//计算item高度</span></span><br><span class="line">  itemElements.<span class="title function_">forEach</span>(<span class="function">(<span class="params">el</span>)=&gt;</span>&#123;</span><br><span class="line">    itemHeights.<span class="title function_">push</span>(el.<span class="property">offsetHeight</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">//渲染位置</span></span><br><span class="line">  <span class="title function_">useItemLocation</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>渲染位置</strong></p><p>在useItemLocation方法中，打印所有的图片高度：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 渲染位置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useItemLocation</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(itemHeights)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>监听数据获取时，触发对应的计算：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 触发计算</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">  <span class="function">()=&gt;</span>props.<span class="property">data</span>,</span><br><span class="line">  <span class="function">(<span class="params">newVal</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="title function_">nextTick</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (props.<span class="property">picturePreReading</span>)&#123;</span><br><span class="line">        <span class="title function_">waitImgComplate</span>()</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="title function_">useItemHeight</span>()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">deep</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">immediate</span>:<span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="9-5-通用组件-瀑布流：触发计算，定位item位置"><a href="#9-5-通用组件-瀑布流：触发计算，定位item位置" class="headerlink" title="9-5 通用组件-瀑布流：触发计算，定位item位置"></a>9-5 通用组件-瀑布流：触发计算，定位item位置</h2><ol><li>在useItemLocation方法中为每个item定位位置：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 为每个item生成位置属性</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useItemLocation</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  <span class="comment">//遍历数据源</span></span><br><span class="line">  props.<span class="property">data</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item,index</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//避免重复计算</span></span><br><span class="line">    <span class="keyword">if</span> (item.<span class="property">_style</span>)&#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//生成style属性</span></span><br><span class="line">    item.<span class="property">_style</span>=&#123;&#125;</span><br><span class="line">    <span class="comment">//left</span></span><br><span class="line">    item.<span class="property">_style</span>.<span class="property">left</span> = <span class="title function_">getItemLeft</span>()</span><br><span class="line">    <span class="comment">//top</span></span><br><span class="line">    item.<span class="property">_style</span>.<span class="property">top</span> = <span class="title function_">getItemTop</span>()</span><br><span class="line">    <span class="comment">//指定的列高度的自增</span></span><br><span class="line">    <span class="title function_">increasingHeight</span>(index)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">//指定容器高度</span></span><br><span class="line">  containerHeight.<span class="property">value</span>=<span class="title function_">getMaxHeight</span>(columnHeightObj.<span class="property">value</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>创建getItemLeft 方法</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 返回下一个item的left</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getItemLeft</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  <span class="comment">//拿到最小宽度的列</span></span><br><span class="line">  <span class="keyword">const</span> column = <span class="title function_">getMinHeightColumn</span>(columnHeightObj.<span class="property">value</span>)</span><br><span class="line">  <span class="keyword">return</span> column*(columnWidth.<span class="property">value</span>+props.<span class="property">colunmSpacing</span>)+containerLeft.<span class="property">value</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>在utils中创建getMinHeightColumn方法</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 返回列高对象中最小高度所在的列</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getMinHeightColumn</span> = (<span class="params">columnHeightObj</span>)=&gt;&#123;</span><br><span class="line">  <span class="comment">//拿到最小高度</span></span><br><span class="line">  <span class="keyword">const</span> minHeight = <span class="title function_">getMinHeight</span>(columnHeightObj)</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">keys</span>(columnHeightObj).<span class="title function_">find</span>(<span class="function">(<span class="params">key</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> columnHeightObj[key] === minHeight</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>创建 getItemTop方法：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 返回下一个item的Top</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getItemTop</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line"> <span class="keyword">return</span> <span class="title function_">getMinHeight</span>(columnHeightObj.<span class="property">value</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="5"><li>在utils中创建 getMinHeight方法</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 返回列高对象中最小的高度</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getMinHeight</span>=(<span class="params">columnHeightObj</span>)=&gt;&#123;</span><br><span class="line">  <span class="keyword">const</span> columnHeightArr = <span class="title class_">Object</span>.<span class="title function_">values</span>(columnHeightObj)</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">min</span>(...columnHeightArr)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="6"><li>创建 increasingHeight 方法：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 指定列高度自增</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">increasingHeight</span> =(<span class="params">index</span>)=&gt;&#123;</span><br><span class="line">  <span class="comment">//最小高度所在列</span></span><br><span class="line">  <span class="keyword">const</span> minHeightColumn=<span class="title function_">getMinHeightColumn</span>(columnHeightObj.<span class="property">value</span>)</span><br><span class="line">  <span class="comment">//使该列自增</span></span><br><span class="line">  columnHeightObj.<span class="property">value</span>[minHeightColumn] += itemHeights[index]+props.<span class="property">rowSpacing</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="7"><li>在utils中创建getMaxHeight方法作为容器高度</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 返回列高对象中最大的高度</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getMaxHeight</span>=(<span class="params">columnHeightObj</span>)=&gt;&#123;</span><br><span class="line">  <span class="keyword">const</span> columnHeightArr = <span class="title class_">Object</span>.<span class="title function_">values</span>(columnHeightObj)</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">max</span>(...columnHeightArr)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="8"><li>在组件销毁时，清除所有的_style</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 在组件销毁的时候，清除所有的_style</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">onUnmounted</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  props.<span class="property">data</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">delete</span> item.<span class="property">_style</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ol start="9"><li>最后我们修改触发计算，构建高度记录容器</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 触发计算</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">  <span class="function">()=&gt;</span>props.<span class="property">data</span>,</span><br><span class="line">  <span class="function">(<span class="params">newVal</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="title function_">nextTick</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">      <span class="comment">//第一次获取数据时，构建高度记录容器</span></span><br><span class="line">      <span class="keyword">const</span> resetColumnHeight = newVal.<span class="title function_">every</span>(<span class="function">(<span class="params">item</span>)=&gt;</span>!item.<span class="property">_style</span>)</span><br><span class="line">      <span class="keyword">if</span> (resetColumnHeight)&#123;</span><br><span class="line">        <span class="comment">//构建高度记录容器</span></span><br><span class="line">        <span class="title function_">useColumnHeightObj</span>()</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (props.<span class="property">picturePreReading</span>)&#123;</span><br><span class="line">        <span class="title function_">waitImgComplate</span>()</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="title function_">useItemHeight</span>()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">deep</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">immediate</span>:<span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="9-6-通用组件-瀑布流：解决瀑布流展示不全的问题"><a href="#9-6-通用组件-瀑布流：解决瀑布流展示不全的问题" class="headerlink" title="9-6 通用组件-瀑布流：解决瀑布流展示不全的问题"></a>9-6 通用组件-瀑布流：解决瀑布流展示不全的问题</h2><p>现在我们运行项目可以发现最底部的瀑布流元素无法展示完全。</p><p>出现这个问题的原因是因为在src&#x2F;views&#x2F;layout&#x2F;index.vue中的h-main的高度，被子组件内部的h-full的class给冲掉了。</p><p>为了防止以后还出现这样的情况，所以我们只要在src&#x2F;views&#x2F;layout&#x2F;index.vue 中为main-vue 外层包一个 div即可：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&#x27;h-main&#x27;&gt;</span><br><span class="line">  &lt;main-vue&gt;&lt;/main-vue&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><h2 id="9-7-通用组件-瀑布流：适配移动端，动态列"><a href="#9-7-通用组件-瀑布流：适配移动端，动态列" class="headerlink" title="9-7 通用组件-瀑布流：适配移动端，动态列"></a>9-7 通用组件-瀑布流：适配移动端，动态列</h2><p>目前，我们的瀑布流组件可以适配PC端，但是移动端，还存在一些问题，所以说，我们需要让我们的<strong>瀑布流</strong>组件可以适配移动端场景。</p><p>那么想要适配移动端，关键在于三点：</p><p><strong>列数变化</strong></p><p>列数的变化想要处理比较简单，我们只需要利用isMobileTerminal方法来去判断即可。</p><p>在 src&#x2F;views&#x2F;main&#x2F;components&#x2F;list&#x2F;index.vue中</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:column=<span class="string">&quot;isMobileTerminal?2:5&quot;</span></span><br></pre></td></tr></table></figure><p><strong>列宽和定位</strong></p><p>比较麻烦的地方在于<strong>列宽和定位</strong>如何进行重新计算，即：重新计算的时机是什么？</p><p>我们期望当<strong>列数发生变化时</strong>，重新执行计算：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 监听列数变化，重新构建瀑布流</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">reset</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  <span class="comment">//延迟100毫秒，否则会导致宽度计算不正确</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//重新计算列宽</span></span><br><span class="line">    <span class="title function_">useColumnWidth</span>()</span><br><span class="line">    <span class="comment">//重置所有的定位数据，因为data中进行了深度监听，所以该操作会触发data的watch</span></span><br><span class="line">    props.<span class="property">data</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>)=&gt;</span>&#123;</span><br><span class="line">      item.<span class="property">_style</span> = <span class="literal">null</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,<span class="number">100</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 监听列数变化</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">  <span class="function">()=&gt;</span>props.<span class="property">colunm</span>,</span><br><span class="line">  <span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//在picturePreReading为true的前提下，需要首先为列宽滞空，列宽滞空之后，会取消瀑布流渲染</span></span><br><span class="line">    columnWidth.<span class="property">value</span>=<span class="number">0</span></span><br><span class="line">    <span class="title function_">reset</span>()</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>此时，在 src&#x2F;views&#x2F;main&#x2F;components&#x2F;list&#x2F;index.vue 中修改 picturePreReading 为true，表示等待图片预加载。</p><p>则双端切换可以正常实现。</p><p>处理两个小的样式问题：</p><ol><li>移动端下navigationBar 定位，在src&#x2F;App.vue中：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--  一级路由出口--&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&#x27;h-screen w-screen fixed top-0 left-0&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">router-view</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure><ol start="2"><li>移动端下列表的横向 padding，在 src&#x2F;views&#x2F;main&#x2F;components&#x2F;list&#x2F;index.vue：</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;m-waterfall</span><br><span class="line">  class=&quot;px-1 w-full&quot;&gt;</span><br><span class="line">&lt;/m-waterfall&gt;</span><br></pre></td></tr></table></figure><h2 id="9-8-通用组件-瀑布流：无需图片预加载时，优化功能处理"><a href="#9-8-通用组件-瀑布流：无需图片预加载时，优化功能处理" class="headerlink" title="9-8 通用组件-瀑布流：无需图片预加载时，优化功能处理"></a>9-8 通用组件-瀑布流：无需图片预加载时，优化功能处理</h2><ol><li>我们修改src&#x2F;views&#x2F;main&#x2F;components&#x2F;list&#x2F;index.vue的picturePreReading为false，会出现的是切换pc和手机端时刷新后页面图片显示不全</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;m-waterfall</span><br><span class="line">  :picturePreReading=&quot;false&quot;&gt;</span><br><span class="line">&lt;/m-waterfall&gt;</span><br></pre></td></tr></table></figure><ol start="2"><li>此时我们需要利用服务器所返回的宽高主动为item指定一个高度，我们将插槽中的width传到item组件中</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;m-waterfall&gt;</span><br><span class="line">  &lt;template v-slot=&#x27;&#123;item,width&#125;&#x27;&gt;</span><br><span class="line">    &lt;item-vue :data=&#x27;item&#x27; :width=&#x27;width&#x27;&gt;&lt;/item-vue&gt;</span><br><span class="line">  &lt;/template&gt;</span><br><span class="line">&lt;/m-waterfall&gt;</span><br></pre></td></tr></table></figure><ol start="3"><li>然后我们在main&#x2F;componnets&#x2F;list&#x2F;item.vue中引入width，并在图片中样式进行显示</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">defineProps</span>(&#123;</span><br><span class="line">  <span class="attr">width</span>:&#123;</span><br><span class="line">    <span class="attr">type</span>:<span class="title class_">Number</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">&lt;!--    图片--&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&#x27;w-full rounded bg-transparent&#x27;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">         <span class="attr">:src</span>=<span class="string">&#x27;data.photo&#x27;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">         <span class="attr">:style</span>=<span class="string">&quot;&#123;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">           height:(width/data.photoWidth)*data.photoWidth+&#x27;px&#x27;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">         &#125;&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    /&gt;</span></span></span><br></pre></td></tr></table></figure><ol start="4"><li>我们修改libs&#x2F;waterfall&#x2F;index.vue</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 监听列数变化</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">  <span class="function">()=&gt;</span>props.<span class="property">colunm</span>,</span><br><span class="line">  <span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (props.<span class="property">picturePreReading</span>)&#123;</span><br><span class="line">      columnWidth.<span class="property">value</span>=<span class="number">0</span></span><br><span class="line">      <span class="comment">//数据改变之后，视图改变之后的回调</span></span><br><span class="line">      <span class="title function_">reset</span>()</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">reset</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="9-9-通用组件-瀑布流：总结"><a href="#9-9-通用组件-瀑布流：总结" class="headerlink" title="9-9 通用组件-瀑布流：总结"></a>9-9 通用组件-瀑布流：总结</h2><p>瀑布流是一个比较复杂的通用组件，因为我们要尽量做到<strong>普适</strong>，所以就需要考虑到各种场景下的处理方案，尽量可以满足日常开发的场景。所以这就在原本就复杂的前提下，让这个功能变得更加复杂了。</p><p>下面我们就再来梳理一下整个瀑布流的构建过程：</p><ol><li><p>瀑布流的核心就是：<strong>通过relative和absolute定位的方式，来控制每个item的位置</strong></p></li><li><p>影响瀑布流高度的主要元素，通常都是<strong>img</strong>标签</p></li><li><p>有些服务端会返回<strong>关键img的高度</strong>，有些不会，所以我们需要分别处理：</p><ol><li>当服务端<strong>不返回</strong>高度时：我们需要等待img加载完成之后，再来计算高度，然后通过得到的高度计算定位。否则则会出现高度计算不准确导致定位计算不准确的问题。</li><li>当服务端<strong>返回</strong>高度时：开发者则必须利用此高度为item进行高度设定。一旦item具备指定高度，那么我们就不需要等待img加载的过程，这样效率更高，并且可以业务的逻辑会变得更加简单。</li></ol></li><li><p>当进行响应式切换时，同样需要区分对应场景：</p><ol><li>当服务端<strong>不返回</strong>高度时：我们需要重<strong>新执行整个宣染流程</strong>，虽然会耗费一些性能，但是这样可以最大可能的避免出现逻辑错误。让组件拥有更强的普适性。</li><li>当服务端<strong>返回</strong>高度时：我们同样需要重新计算<strong>列宽和定位</strong>，但是因为item具备明确的高度，所以我们可以直接拿到具体的高度，而无需重复整个渲染流程，从而可以实现更多的交互逻辑。比如：位移动画、将来的图片懒加载占位.</li></ol></li></ol><h2 id="9-10-通用组件：长列表infinite构建分析"><a href="#9-10-通用组件：长列表infinite构建分析" class="headerlink" title="9-10 通用组件：长列表infinite构建分析"></a>9-10 通用组件：长列表infinite构建分析</h2><p>处理好瀑布流之后，接下来我们就需要来处理对应的长列表功能。</p><p>我们知道对于对于首页中的瀑布流而言，是需要进行长列表展示的，也就说它是一个分页的数据。</p><p>那么对于这种分页功能而言，我们又应该如何进行实现呢？</p><p>想要搞明白这个问题，那么同样我们需要分成两个方面来去看：</p><ol><li>长列表的实现原理是什么？</li><li>我们使用长列表时，希望如何进行使用？</li></ol><p><strong>长列表的实现原理</strong></p><p>所谓长列表分页加载，其实指的就是：<strong>当滚动到列表底部时，加载数据</strong></p><p>那么我们想要实现咱们的长列表组件，围绕着的依然是这句话。</p><p>那么想要实现这个功能，我们需要做的核心的一点就是能够<strong>监听到列表滚动到底部</strong></p><p>那么想要监听到列表滚动到底部的话，可以利用<strong>IntersectionObserver</strong>，该接口可以判断：<strong>目标元素与其祖先元素或顶级文档视窗（viewport）的交叉状态（是否可见）</strong></p><p>那么我们就可以利用这个特性，把一个元素<strong>置于列表底部</strong>，当这个元素可见时则表示<strong>列表滚动到了底部</strong>。</p><p>那么原生的IntersectionObserver 使用起来比较复杂，所以<strong>vueuse提供了uselntersectionObserver方法。</strong></p><p><strong>我们使用长列表时，希望如何进行使用</strong></p><p>这个的判断和瀑布流时的判断逻辑一样，通过这样的逻辑，可以让我们知道这个组件的prop应该如何构建。</p><p>那么我们期望使用它时是这样的：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;m-infinite-list</span><br><span class="line">    v-model=&quot;&quot;//当前是否处于加载状态</span><br><span class="line">    :isFinished=&quot;&quot;//数据是否全部加载完成</span><br><span class="line">    @onLoad=&quot;&quot;//加载下一页数据的触发事件</span><br><span class="line">&gt;</span><br><span class="line">    列表</span><br><span class="line">&lt;/m-infinite-list&gt;</span><br></pre></td></tr></table></figure><h2 id="9-11-通用组件：构建长列表infinite组件"><a href="#9-11-通用组件：构建长列表infinite组件" class="headerlink" title="9-11 通用组件：构建长列表infinite组件"></a>9-11 通用组件：构建长列表infinite组件</h2><ol><li>创建 src&#x2F;libs&#x2F;infinite-list&#x2F;index.vue 组件</li><li>构建props与emits，并处理双向数据绑定逻辑</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useVModel &#125; <span class="keyword">from</span> <span class="string">&#x27;@vueuse/core&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> props = <span class="title function_">defineProps</span>(&#123;</span><br><span class="line">  <span class="comment">//是否处于加载状态</span></span><br><span class="line">  <span class="attr">modelValue</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">Boolean</span>,</span><br><span class="line">    <span class="attr">required</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//数据是否全部加载完成</span></span><br><span class="line">  <span class="attr">isFinished</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">Boolean</span>,</span><br><span class="line">    <span class="attr">default</span>: <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> emits = <span class="title function_">defineEmits</span>([<span class="string">&#x27;onLoad&#x27;</span>, <span class="string">&#x27;update:modelValue&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">//处理loading状态</span></span><br><span class="line"><span class="keyword">const</span> loading = <span class="title function_">useVModel</span>(props)</span><br></pre></td></tr></table></figure><ol start="3"><li>构建对应视图与插槽逻辑</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;!--内容--&gt;</span><br><span class="line">    &lt;slot /&gt;</span><br><span class="line">    &lt;div ref=&quot;loadingTarget&quot; class=&quot;h-6 py-4&quot;&gt;</span><br><span class="line">      &lt;!--加载更多--&gt;</span><br><span class="line">      &lt;m-svg-icon</span><br><span class="line">        v-show=&#x27;loading&#x27;</span><br><span class="line">        class=&#x27;w-4 h-4 mx-auto animate-spin&#x27;</span><br><span class="line">        name=&#x27;infinite-load&#x27;</span><br><span class="line">      &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">      &lt;!--没有更多数据--&gt;</span><br><span class="line">      &lt;p v-if=&#x27;isFinished&#x27; class=&#x27;text-center text-base text-zinc-400&#x27;&gt;</span><br><span class="line">        已经没有更多数据了</span><br><span class="line">      &lt;/p&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><ol start="4"><li>利用 uselntersectionObserver方法，监听元素可见行为，用于判断列表滚动到底部：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//滚动的元素</span></span><br><span class="line"><span class="keyword">const</span> loadingTarget= <span class="title function_">ref</span>(<span class="literal">null</span>)</span><br><span class="line"><span class="title function_">useIntersectionObserver</span>(loadingTarget,<span class="function">(<span class="params">[&#123;isIntersecting&#125;]</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">//当加载更多的视图可见时，同时loading为false，同时数据尚未全部加载完</span></span><br><span class="line">  <span class="comment">//处理加载更多逻辑</span></span><br><span class="line">  <span class="keyword">if</span>(isIntersecting &amp;&amp; !loading.<span class="property">value</span> &amp;&amp; !props.<span class="property">isFinished</span>)&#123;</span><br><span class="line">    <span class="comment">//修改加载数据标记</span></span><br><span class="line">    loading.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">    <span class="comment">//触发加载更多的行为</span></span><br><span class="line">    <span class="title function_">emits</span>(<span class="string">&#x27;onLoad&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="9-12-通用组件：应用-infinite-结合-waterfall-实现长列表瀑布流效果"><a href="#9-12-通用组件：应用-infinite-结合-waterfall-实现长列表瀑布流效果" class="headerlink" title="9-12 通用组件：应用 infinite 结合 waterfall 实现长列表瀑布流效果"></a>9-12 通用组件：应用 infinite 结合 waterfall 实现长列表瀑布流效果</h2><p>那么现在我们已经有了长列表组件 infinite 也有了瀑布流组件 waterfall，接下来就可以结合这两个通用组件，构建咱们的长列表瀑布流效果了</p><ol><li>src&#x2F;views&#x2F;main&#x2F;components&#x2F;list&#x2F;index.vue：</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;m-infinite</span><br><span class="line">      v-model=&quot;loading&quot;</span><br><span class="line">      :isFinished=&quot;isFinished&quot;</span><br><span class="line">      @onLoad=&quot;getPexlesData&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;m-waterfall&gt;</span><br><span class="line">      .......</span><br><span class="line">      &lt;/m-waterfall&gt;</span><br><span class="line">    &lt;/m-infinite&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; getPexlesList &#125; from &#x27;@/api/pexeis&#x27;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">import itemVue from &#x27;./item.vue&#x27;</span><br><span class="line">import &#123; isMobileTerminal &#125; from &#x27;@/utils/flexible&#x27;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 构建数据请求</span><br><span class="line"> */</span><br><span class="line">let query = &#123;</span><br><span class="line">  page: 1,</span><br><span class="line">  size: 20</span><br><span class="line">&#125;</span><br><span class="line">//数据是否在加载中</span><br><span class="line">const loading = ref(false)</span><br><span class="line">//数据是否全部加载完成</span><br><span class="line">const isFinished = ref(false)</span><br><span class="line">//数据源</span><br><span class="line">const pexelsList = ref([])</span><br><span class="line">/**</span><br><span class="line"> * 加载数据的方法</span><br><span class="line"> * @returns &#123;Promise&lt;void&gt;&#125;</span><br><span class="line"> */</span><br><span class="line">const getPexlesData = async () =&gt; &#123;</span><br><span class="line">  //数据全部加载完成return</span><br><span class="line">  if (isFinished.value)&#123;</span><br><span class="line">    return</span><br><span class="line">  &#125;</span><br><span class="line">  //完成了第一次请求之后，后续的请求让page自增</span><br><span class="line">  if (pexelsList.value.length)&#123;</span><br><span class="line">    query.page+=1</span><br><span class="line">  &#125;</span><br><span class="line">  //触发接口</span><br><span class="line">  const res = await getPexlesList(query)</span><br><span class="line">  if (query.page === 1)&#123;</span><br><span class="line">    pexelsList.value = res.list</span><br><span class="line">  &#125;else&#123;</span><br><span class="line">    pexelsList.value.push(...res.list)</span><br><span class="line">  &#125;</span><br><span class="line">  //判断数据是否全部加载完成</span><br><span class="line">  if (pexelsList.value.length === res.total)&#123;</span><br><span class="line">    isFinished.value = true</span><br><span class="line">  &#125;</span><br><span class="line">  //修改loading标记</span><br><span class="line">  loading.value = false</span><br><span class="line">&#125;</span><br><span class="line">getPexlesData()</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure><h2 id="9-13-通用组件：解决首次数据无法铺满全屏时，数据无法继续加载"><a href="#9-13-通用组件：解决首次数据无法铺满全屏时，数据无法继续加载" class="headerlink" title="9-13 通用组件：解决首次数据无法铺满全屏时，数据无法继续加载"></a>9-13 通用组件：解决首次数据无法铺满全屏时，数据无法继续加载</h2><p>现在对于咱们当前的功能而言，还存在一个小的bug，那就是<strong>假如：首次加载的数据无法铺满全屏时，数据无法继续加载</strong></p><hr><p>其实出现这个问题的原因非常简单，我们在infinite 组件中，监听 laodingTarget元素是否可见，依次来判断是否需要进行下次的load，但是当首次加载数据无法铺满全屏时，isIntersecting虽然为true，但是它只会被触发一次，并不会再次触发，所以，我们就不再次触发oad。从而出现此bug。</p><p>那么明确好了原因只会，接下来想要解决这个问题就非常简单了，我们只需要：让load 可以在loading状态发生变化后，重新判断是否需要再次触发即可。</p><ol><li>我们修改lib&#x2F;infinite&#x2F;index.vue</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//滚动的元素</span></span><br><span class="line"><span class="keyword">const</span> loadingTarget= <span class="title function_">ref</span>(<span class="literal">null</span>)</span><br><span class="line"><span class="comment">//记录当前是否在底部</span></span><br><span class="line"><span class="keyword">const</span> targetIsIntersecting = <span class="title function_">ref</span>(<span class="literal">false</span>)</span><br><span class="line"><span class="title function_">useIntersectionObserver</span>(loadingTarget,<span class="function">(<span class="params">[&#123;isIntersecting&#125;]</span>)=&gt;</span>&#123;</span><br><span class="line">  targetIsIntersecting.<span class="property">value</span> = isIntersecting</span><br><span class="line">  <span class="title function_">emitLoad</span>()</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *触发load事件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">emitLoad</span> =(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//当加载更多的视图可见时，同时loading为false，同时数据尚未全部加载完</span></span><br><span class="line">    <span class="comment">//处理加载更多逻辑</span></span><br><span class="line">    <span class="keyword">if</span>(targetIsIntersecting &amp;&amp; !loading.<span class="property">value</span> &amp;&amp; !props.<span class="property">isFinished</span>)&#123;</span><br><span class="line">      <span class="comment">//修改加载数据标记</span></span><br><span class="line">      loading.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">      <span class="comment">//触发加载更多的行为</span></span><br><span class="line">      <span class="title function_">emits</span>(<span class="string">&#x27;onLoad&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 监听loading的变化，解决数据加载完成之后，首屏未铺满的问题</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">watch</span>(loading,emitLoad)</span><br></pre></td></tr></table></figure><h2 id="9-14-图片懒加载构建原因-实现原理"><a href="#9-14-图片懒加载构建原因-实现原理" class="headerlink" title="9-14 图片懒加载构建原因+实现原理"></a>9-14 图片懒加载构建原因+实现原理</h2><p><strong>为什么需要图片懒加载</strong></p><p>此时如果我们把src&#x2F;views&#x2F;main&#x2F;components&#x2F;list&#x2F;index.vue的query.size 修改为 100，然后切换到浏览器的network-&gt; img 可以发现此时的图片请求高达575次</p><p>但是我们现在显示的图片，明显是远远少于575这个数字的。</p><p>那么多余的这些请求是不是就会很“浪费”啊。</p><p>所以我们不想有这种浪费，就可以利用图片懒加载功能进行实现。</p><p><strong>图片懒加载实现原理</strong></p><p>那么图片懒加载如何进行实现呢？想要搞明日这个，我们就需要先明白图片懒加载的原理是什么。</p><p>所谓图片懒加载指的是：<strong>当图片不可见时，不加载图片。当图片可见时，才去加载图片。</strong></p><p>大家看见这个“不可见&amp;&amp;可见”是不是觉得很眼熟。是啊，这不就是实现长列表时用过的套路吗？</p><p>所以据此，咱们的实现方案是不是就呼之欲出了。</p><p>我们可以<strong>监听所有图片是否被可见，如果图片处于不可见状态，那么就不加载图片，如果图片处于可见状态，那么开始加载图片。</strong><br>而这个功能的实现关键就是<strong>IntersectionObserver。</strong></p><h2 id="9-15-通用指令：实现图片懒加载"><a href="#9-15-通用指令：实现图片懒加载" class="headerlink" title="9-15 通用指令：实现图片懒加载"></a>9-15 通用指令：实现图片懒加载</h2><p>我们知道了图片懒加载的实现原理。</p><p>但是到这里，那么多的img标签咱们怎么一个个监听到呢？</p><p>那么想要监听到所有img标签，我们可以利用指令来进行实现。</p><p>比如我们可以给所有的img增加一个v-lazy指令，在这个指令中可以拿到el也就是img标签本身，这样我们就可以监听到所有的img标签状态了。</p><p>所以据上所述，我们可以直接创建出对应的指</p><ol><li>我们首先创建文件src&#x2F;directives&#x2F;modules&#x2F;lazy.js</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useIntersectionObserver &#125; <span class="keyword">from</span> <span class="string">&#x27;@vueuse/core&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">//图片懒加载：在用户无法看到图片时，不加载图片，在用户可以看到图片后加载图片</span></span><br><span class="line">  <span class="comment">//如何判断用户是否看到了图片：useIntersectionObserver</span></span><br><span class="line">  <span class="comment">//如何做到不加载图片（网络）：img标签宣染图片，指的是img的src属性，src 属性是网络地址时，则会从网络中获取该图片资源。那么如果img标签不是网络地址呢？把该网络地址默认替换为非网络地址，然后当用户可见时，在替换成网络地址。</span></span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params">el</span>) &#123;</span><br><span class="line">    <span class="comment">//1.拿到当前的src</span></span><br><span class="line">    <span class="keyword">const</span> imgSrc = el.<span class="property">src</span></span><br><span class="line">    <span class="comment">//2. 把src变为空</span></span><br><span class="line">    el.<span class="property">src</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">const</span> &#123; stop &#125; = <span class="title function_">useIntersectionObserver</span>(el, <span class="function">(<span class="params">[&#123; isIntersecting &#125;]</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (isIntersecting) &#123;</span><br><span class="line">        <span class="comment">//3.当图片可见时，加载图片</span></span><br><span class="line">        el.<span class="property">src</span> = imgSrc</span><br><span class="line">        <span class="comment">//4.停止监听</span></span><br><span class="line">        <span class="title function_">stop</span>()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="2"><li>然后我们在src&#x2F;directives&#x2F;index.js完成基本注册</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lazy <span class="keyword">from</span> <span class="string">&#x27;./modules/lazy&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 全局注册指令</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">install</span>(<span class="params">app</span>)&#123;</span><br><span class="line">    app.<span class="title function_">directive</span>(<span class="string">&#x27;lazy&#x27;</span>,lazy)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>紧接着在main.js中完成注册</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mDirectives <span class="keyword">from</span> <span class="string">&#x27;./directives&#x27;</span></span><br><span class="line">app.<span class="title function_">use</span>(mDirectives)</span><br></pre></td></tr></table></figure><ol start="4"><li>在item.vue和header-my.vue和header&#x2F;index.vue中在img标签添加v-lazy</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img v-lazy/&gt;</span><br></pre></td></tr></table></figure><h2 id="9-16-深入vite：指令的自动注册"><a href="#9-16-深入vite：指令的自动注册" class="headerlink" title="9-16 深入vite：指令的自动注册"></a>9-16 深入vite：指令的自动注册</h2><p>此时在src&#x2F;directives&#x2F;index.js 中，我们面临了一个和注册组件时的同样问题，那就是：<strong>如果指令过多，那么一个一个注册未免过于麻烦了</strong>。所以我们最好有一种方式完成指令的自动注册</p><p>那么想要完成这个功能我们依然要利用 Glob导入（import.meta.globEager）_和Object.entries功能：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lazy <span class="keyword">from</span> <span class="string">&#x27;./modules/lazy&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 全局注册指令</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">install</span>(<span class="params">app</span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> directives = <span class="keyword">import</span>.<span class="property">meta</span>.<span class="title function_">globEager</span>(<span class="string">&#x27;./modules/*.js&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> [key , value] <span class="keyword">of</span> <span class="title class_">Object</span>.<span class="title function_">entries</span>(directives))&#123;</span><br><span class="line">      <span class="keyword">const</span> arr = key.<span class="title function_">split</span>(<span class="string">&#x27;./&#x27;</span>)</span><br><span class="line">      <span class="keyword">const</span> name = arr[arr.<span class="property">length</span>-<span class="number">1</span>].<span class="title function_">replace</span>(<span class="string">&#x27;.js&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">      app.<span class="title function_">directive</span>(name,value.<span class="property">default</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="9-17-指定彩色占位图"><a href="#9-17-指定彩色占位图" class="headerlink" title="9-17 指定彩色占位图"></a>9-17 指定彩色占位图</h2><ol><li>我们现在utils&#x2F;color.js中写导出随机rgb方法</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 生成随机色值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span>  <span class="keyword">const</span> <span class="title function_">randomRGB</span> =(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  <span class="keyword">const</span> r = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>()*<span class="number">255</span>)</span><br><span class="line">  <span class="keyword">const</span> g = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>()*<span class="number">255</span>)</span><br><span class="line">  <span class="keyword">const</span> b = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>()*<span class="number">255</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`rgb(<span class="subst">$&#123;r&#125;</span>,<span class="subst">$&#123;g&#125;</span>,<span class="subst">$&#123;b&#125;</span>)`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>我们在item.vue中使用该方法</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; randomRGB &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/color&#x27;</span></span><br><span class="line"></span><br><span class="line">  &lt;div <span class="keyword">class</span>=<span class="string">&quot;relative w-full rounded cursor-zoom-in group&quot;</span></span><br><span class="line">         :style=<span class="string">&quot;&#123;</span></span><br><span class="line"><span class="string">            backgroundColor:randomRGB()</span></span><br><span class="line"><span class="string">         &#125;&quot;</span>&gt;</span><br></pre></td></tr></table></figure><h2 id="9-18-总结"><a href="#9-18-总结" class="headerlink" title="9-18 总结"></a>9-18 总结</h2><p>我们借用首页list模块业务，实现了：</p><ol><li>瀑布流</li><li>长列表</li><li>懒加载</li><li>指令自动注册</li><li>….</li></ol><p>等通用组件或指令。</p><p>这些内容都是咱们日常开发中非常常见的功能，那么在我们把他们抽离了之后，日后的开发中就可以直接拿过来使用了。</p><p>但是现在对于首页而言，我们所欠缺的内容还是比较多的，比如：</p><ol><li>search 模块到首页的联动</li><li>item 上的点击处理</li></ol><h1 id="10、多组件联动与高阶组件方案——list联动search和navigationBar"><a href="#10、多组件联动与高阶组件方案——list联动search和navigationBar" class="headerlink" title="10、多组件联动与高阶组件方案——list联动search和navigationBar"></a>10、多组件联动与高阶组件方案——list联动search和navigationBar</h1><p>多组件联动是日常工作中的常见业务。高阶通用组件是构建中台组件库的难点。</p><h2 id="10-1-前言"><a href="#10-1-前言" class="headerlink" title="10-1 前言"></a>10-1 前言</h2><p>到目前为止我们已经实现了首页的search、navigationBar、list 模块。只不过目前三个模块完全是独立的，没有任何的关联性。</p><p>所以我们接下来要处理的就是让它们三个可以联动起来。也就是我们标题所说的：list联动search和navigationBar</p><p>那么在这样的联动之中，我们应该注意哪些事情，联动的数据又应该如何进行处理？如果可以让我们的逻辑更加清晰？</p><h2 id="10-2-多组件联动注意事项与整体逻辑分析"><a href="#10-2-多组件联动注意事项与整体逻辑分析" class="headerlink" title="10-2 多组件联动注意事项与整体逻辑分析"></a>10-2 多组件联动注意事项与整体逻辑分析</h2><p>在我们的实际开发中，我们经常会遇到多个组件之间互相进行联动的场景。那么这样的场景我们通常应该怎么去进行处理呢？下面让我们来说一下：</p><p>所谓的多组件联动，其实更准确一点来说，通常指的是：多个组件之间，存在一个或多个共享的数据。当数据发生改变时，执行对应的逻辑。</p><p>那么把这一句话拆分开来看，就是两部分：</p><ol><li>多组件之间需要共享数据</li><li>监听数据变化，并执行对应逻辑</li></ol><p><strong>多组件之间需要共享数据</strong></p><p>多组件之间共享数据，通常有三种方式：</p><ol><li><p>组件之间的数据传递–常见于层级关系比较清晰的多组件之中</p><ol><li>父传子</li><li>子传父</li><li>….</li></ol></li><li><p>依赖注入：<strong>Provide&#x2F;Inject</strong>–嵌套层级比较深，并且子组件只需要父组件的部分内容</p></li><li><p>全局状态管理工具：<strong>vuex</strong>-以上两种情况都不适用的情况下</p></li></ol><p>那么针对于我们这里的场景，层级关系比较复杂，并且需要进行复杂的逻辑操作，那么此时，我们此时多组件之间共享数据的策略就需要通过vuex 来实现。</p><p><strong>监听数据变化的方式</strong></p><p>当组件之间共享的数据发生变化时，我们需要执行对应的逻辑操作。所以首当其冲我们就需要监听到数据的变化。</p><p>那么在vue中监听数据变化的方式，首推就是watch。</p><p>并且在刚才我们已经确定了共享的数据需要被保存到vuex 中，所以我们就需要通过watch监听到vuex 中共享数据的变化，然后在监听到变化时，执行对应的业务逻辑。</p><p><strong>整体逻辑分析</strong></p><p>那么依据我们以上所说的内容，我们的整体实现逻辑应该为：</p><ol><li>创建共享数据对应的vuex模块</li><li>在getters中建立对应的快捷访问计算属性</li><li>在对应的业务组件中，监听getters，并执行对应逻辑</li></ol><h2 id="10-3-简单联动处理：navigationBar对应list"><a href="#10-3-简单联动处理：navigationBar对应list" class="headerlink" title="10-3 简单联动处理：navigationBar对应list"></a>10-3 简单联动处理：navigationBar对应list</h2><p>我们期望当 navigationBar 中的 item发生切换时，切换对应的list中的展示数据，那么根据我们刚才的分析，切换的关键就在于：<strong>共享数据的变化，引起的逻辑变化</strong></p><p>那么在这样的场景中，共享数据指的就是<strong>被选中项</strong>。</p><p>目前无论是PC端 下还是移动端下，被选中项都是在组件内部进行处理的，这肯定不符合我们的最初逻辑。我们期望共享的数据可以在vuex 中被维护。</p><p>所以我们将产生如下代码：</p><p>1.创建 src&#x2F;store&#x2F;modules&#x2F;app.js，该模块下的数据不会被缓存：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="variable constant_">ALL_CATEGORY_ITEM</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;@/constants&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * app模块中的数据不会被缓存</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">//独立作用域</span></span><br><span class="line">  <span class="attr">namespaced</span>:<span class="literal">true</span>,</span><br><span class="line">  <span class="attr">state</span>:<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span>&#123;</span><br><span class="line">      <span class="comment">//当前选中的分类</span></span><br><span class="line">      <span class="attr">currentCategory</span>:<span class="variable constant_">ALL_CATEGORY_ITEM</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mutations</span>:&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 切换选中分类</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="title function_">changeCurrentCategory</span>(<span class="params">state,newCategory</span>)&#123;</span><br><span class="line">      state.<span class="property">currentCategory</span>=newCategory</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">actions</span>:&#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>在 src&#x2F;store&#x2F;index.js中对app进行注册，因为我们不希望app缓存，所以只在modules中注册，不在paths中写入</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> app <span class="keyword">from</span> <span class="string">&#x27;./modules/app&#x27;</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">createStore</span>(&#123;</span><br><span class="line">  getters,</span><br><span class="line">  <span class="attr">modules</span>:&#123;</span><br><span class="line">    category,</span><br><span class="line">    theme,</span><br><span class="line">    app</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>:[</span><br><span class="line">   <span class="title function_">createPersistedState</span>(&#123;</span><br><span class="line">     <span class="comment">//指定保存到localStorage中的key</span></span><br><span class="line">     <span class="attr">key</span>:<span class="string">&#x27;imooc-front&#x27;</span>,</span><br><span class="line">     <span class="comment">//需要保存的模块</span></span><br><span class="line">     <span class="attr">paths</span>:[<span class="string">&#x27;category&#x27;</span>,<span class="string">&#x27;theme&#x27;</span>]</span><br><span class="line">   &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ol start="3"><li>完成注册后就要处理对应的getters，在 src&#x2F;store&#x2F;getter.js中增加</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * category选中项</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="attr">currentCategory</span>:<span class="function">(<span class="params">state</span>)=&gt;</span>state.<span class="property">app</span>.<span class="property">currentCategory</span>,</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * category选中项下标</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="attr">currentCategoryIndex</span>:<span class="function">(<span class="params">state,getter</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> getter.<span class="property">categorys</span>.<span class="title function_">findIndex</span>(<span class="function">(<span class="params">item</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> item.<span class="property">id</span> === getter.<span class="property">currentCategory</span>.<span class="property">id</span></span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><ol start="4"><li>修改pc端的代码，src&#x2F;views&#x2F;main&#x2F;components&#x2F;navigation &#x2F;pc&#x2F;index.vue</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--      item--&gt;</span><br><span class="line">   &lt;li</span><br><span class="line">     v-for=&quot;(item, index) in $store.getters.categorys&quot;</span><br><span class="line">     :key=&quot;item.id&quot;</span><br><span class="line">     class=&quot;shrink-0 px-1.5 py-0 z-10 duration-200 text-zinc-900 dark:text-zinc-500 dark:hover:text-zinc-300 text-base font-bold h-4 leading-4 cursor-pointer hover:bg-zinc-200 dark:hover:bg-zinc-900 rounded mr-1 mb-1&quot;</span><br><span class="line">     :class=&quot;&#123;</span><br><span class="line">       &#x27;text-zinc-900 dark:text-zinc-300 bg-zinc-200 dark:bg-zinc-900&#x27;:</span><br><span class="line">         $store.getters.currentCategoryIndex === index</span><br><span class="line">     &#125;&quot;</span><br><span class="line">     @click=&quot;onItemClick(item)&quot;</span><br><span class="line">   &gt;</span><br><span class="line">     &#123;&#123; item.name &#125;&#125;</span><br><span class="line">   &lt;/li&gt;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> store = <span class="title function_">useStore</span>()</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 选中状态处理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onItemClick</span> = (<span class="params">item</span>) =&gt; &#123;</span><br><span class="line">  store.<span class="title function_">commit</span>(<span class="string">&#x27;app/changeCurrentCategory&#x27;</span>,item)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="5"><li>修改pc端的代码，src&#x2F;views&#x2F;main&#x2F;components&#x2F;navigation &#x2F;mobile&#x2F;index.vue</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--      items--&gt;</span><br><span class="line">&lt;li</span><br><span class="line">  v-for=&quot;(item, index) in $store.getters.categorys&quot;</span><br><span class="line">  :key=&quot;item.id&quot;</span><br><span class="line">  class=&quot;shrink-0 px-1.5 py-0.5 z-10 duration-200 last:mr-4&quot;</span><br><span class="line">  :class=&quot;&#123;</span><br><span class="line">    &#x27;text-zinc-100&#x27;: $store.getters.currentCategoryIndex === index</span><br><span class="line">  &#125;&quot;</span><br><span class="line">  :ref=&quot;setItemRef&quot;</span><br><span class="line">  @click=&quot;onItemClick(item)&quot;</span><br><span class="line">&gt;</span><br><span class="line">  &#123;&#123; item.name &#125;&#125;</span><br><span class="line">&lt;/li&gt;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> store = <span class="title function_">useStore</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">//watch监听getters 的时候，我们需要传递一个函数</span></span><br><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">  <span class="function">() =&gt;</span> store.<span class="property">getters</span>.<span class="property">currentCategoryIndex</span>,</span><br><span class="line">  <span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; left, width &#125; = itemRefs[val].<span class="title function_">getBoundingClientRect</span>()</span><br><span class="line">    sliderStyle.<span class="property">value</span> = &#123;</span><br><span class="line">      <span class="comment">//滑块的位置= ul横向滚动的位置+当前元素的left-ul的padding</span></span><br><span class="line">      <span class="attr">transform</span>: <span class="string">`translateX(<span class="subst">$&#123;ulScrollLeft.value + left - <span class="number">10</span>&#125;</span>px)`</span>,</span><br><span class="line">      <span class="attr">width</span>: width + <span class="string">&#x27;px&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//item点击事件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onItemClick</span> = (<span class="params">item</span>) =&gt; &#123;</span><br><span class="line">  store.<span class="title function_">commit</span>(<span class="string">&#x27;app/changeCurrentCategory&#x27;</span>, item)</span><br><span class="line">  isVisable.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="6"><li>增加views&#x2F;main&#x2F;components&#x2F;list&#x2F;index.vue代码</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过此方法修改query，重新发起请求</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">resetQuery</span> = (<span class="params">newQuery</span>)=&gt;&#123;</span><br><span class="line">  query=&#123;...query,...newQuery&#125;</span><br><span class="line">  <span class="comment">//重置状态</span></span><br><span class="line">  isFinished.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">  pexelsList.<span class="property">value</span> = []</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 监听currentCategory的变化</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">  <span class="function">()=&gt;</span>store.<span class="property">getters</span>.<span class="property">currentCategory</span>,</span><br><span class="line">  <span class="function">(<span class="params">currentCategory</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="title function_">resetQuery</span>(&#123;</span><br><span class="line">      <span class="attr">page</span>:<span class="number">1</span>,</span><br><span class="line">      <span class="attr">categoryId</span>:currentCategory.<span class="property">id</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="10-4-明确searchBar对应list处理流程"><a href="#10-4-明确searchBar对应list处理流程" class="headerlink" title="10-4 明确searchBar对应list处理流程"></a>10-4 明确searchBar对应list处理流程</h2><p>接下来我们需要处理 searchBar 区域对应list区域的联动效果。</p><p>但是对于 searchBar 区域而言，目前我们还没有处理完成，所以我们需要先把 searchBar 区域的处理流程将清楚，然后再处理对应的联动。</p><p>那么对于searchBar 区域我们目前还缺少三部分的内容处理：</p><ol><li>搜索提示</li><li>搜索历史</li><li>推荐主题</li></ol><p>所以我们接下来的处理顺序为</p><ol><li>搜索提示</li><li>搜索历史</li><li>推荐主题</li><li>search触发时的list 联动</li></ol><h2 id="10-5-searchBar：搜索提示初步实现"><a href="#10-5-searchBar：搜索提示初步实现" class="headerlink" title="10-5 searchBar：搜索提示初步实现"></a>10-5 searchBar：搜索提示初步实现</h2><ol><li>我们在src&#x2F;api&#x2F;pexeis.js中注册获取搜索提示接口</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取搜索提示</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getHint</span> = (<span class="params">q</span>) =&gt;&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>:<span class="string">&#x27;/pexels/hint&#x27;</span>,</span><br><span class="line">    <span class="attr">params</span>: &#123; </span><br><span class="line">      q</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>创建组件src&#x2F;views&#x2F;layout&#x2F;components&#x2F;header&#x2F;header-search&#x2F;hint.vue</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      v-for=&#x27;(item,index) in hintData&#x27;</span><br><span class="line">      :key=&#x27;index&#x27;</span><br><span class="line">      class=&#x27;py-1 pl-1 text-base font-bold text-zinc-500 rounded</span><br><span class="line">      cursor-pointer duration-300 hover:bg-zinc-200 dark:hover:bg-zinc-900&#x27;</span><br><span class="line">      @click=&#x27;onItemClick(item)&#x27;</span><br><span class="line">    &gt;</span><br><span class="line">      &#123;&#123;item&#125;&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">const EMINTS_ITEM_CLICK=&#x27;itemClick&#x27;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">import &#123; getHint &#125; from &#x27;@/api/pexeis&#x27;</span><br><span class="line">import &#123;watch&#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">const props = defineProps(&#123;</span><br><span class="line">  /**</span><br><span class="line">   * 搜索文本</span><br><span class="line">   */</span><br><span class="line">  searchText:&#123;</span><br><span class="line">    type:String,</span><br><span class="line">    required:true</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">const emits=defineEmits(EMINTS_ITEM_CLICK)</span><br><span class="line">/**</span><br><span class="line"> * 处理搜索提示数据获取</span><br><span class="line"> */</span><br><span class="line">const hintData = ref([])</span><br><span class="line">const getHintData = async()=&gt;&#123;</span><br><span class="line">  if (!props.searchText) return</span><br><span class="line">  const &#123;result&#125; = await getHint(props.searchText)</span><br><span class="line">  hintData.value = result</span><br><span class="line">&#125;</span><br><span class="line">/**</span><br><span class="line"> * watch可以监听一个ref响应式数据，或者一个包含getter的函数</span><br><span class="line"> */</span><br><span class="line">watch(()=&gt;props.searchText,getHintData,&#123;</span><br><span class="line">  immediate:true</span><br><span class="line">&#125;)</span><br><span class="line">/**</span><br><span class="line"> * item点击事件处理</span><br><span class="line"> */</span><br><span class="line">const onItemClick=(item)=&gt;&#123;</span><br><span class="line">  emits((EMINTS_ITEM_CLICK,item))</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><ol start="3"><li>我们在父组件src&#x2F;views&#x2F;layout&#x2F;components&#x2F;header&#x2F;header-search&#x2F;index.vue中使用子组件</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;m-search v-model=&quot;inputValue&quot;&gt;</span><br><span class="line">      &lt;template #dropdown&gt;</span><br><span class="line">        &lt;!--        搜索提示--&gt;</span><br><span class="line">        &lt;hint-vue</span><br><span class="line">          :searchText=&quot;inputValue&quot;</span><br><span class="line">          v-show=&quot;inputValue&quot;</span><br><span class="line">          @itemClick=&#x27;onSearchHandler&#x27;</span><br><span class="line">        &gt;&lt;/hint-vue&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/m-search&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">import hintVue from &#x27;./hint.vue&#x27;</span><br><span class="line"></span><br><span class="line">const inputValue = ref(&#x27;&#x27;)</span><br><span class="line">/**</span><br><span class="line"> * 搜索回调</span><br><span class="line"> */</span><br><span class="line">const onSearchHandler =(val)=&gt;&#123;</span><br><span class="line">  inputValue.value=val</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="10-6-searchBar：处理防抖功能"><a href="#10-6-searchBar：处理防抖功能" class="headerlink" title="10-6 searchBar：处理防抖功能"></a>10-6 searchBar：处理防抖功能</h2><p>目前的searchBar 中，当我输入内容时，会触发搜索提示功能。但是我们发现，加入我们想要搜索一个单词，比如：mac，却进行了三次的搜索。这明显是不合理的。</p><p>所以如果想要让这个搜索变得更加合理，那么我们就需要使用到防抖这样的功能。</p><p>所谓防抖指的就是：<strong>当触发一个事件时，不去立刻执行，而是延迟一段时间，该事件变为等待执行事件。如果在这段时间之内，该事件被再次触发，则上次等待执行的事件取消，本次触发的事件变为等待执行事件。循环往复，直到某一个等待事件被执行为止</strong></p><p>那么这样的防抖，通常我们称为：debounce</p><p>那么目前在 src&#x2F;views&#x2F;layout&#x2F;components&#x2F;header&#x2F;header-search&#x2F;hint.vue 中，我们通过watch 监听输入内容的变化，所以当输入内容发生过一次变化时，则会立刻触发 getHintData事件。</p><p>那么我们所需要做的防抖处理，就需要在watch中进行。</p><p>不过这样的防抖watch 我们不需要自己进行实现，vueuse中提供了对应的<strong>watchDebounced</strong>，我们可以直接利用这个API直接实现防抖的watch</p><p>修改src&#x2F;views&#x2F;layout&#x2F;components&#x2F;header&#x2F;header-search&#x2F;hint.vue的watch</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * watch可以监听一个ref响应式数据，或者一个包含getter的函数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">watchDebounced</span>(<span class="function">()=&gt;</span>props.<span class="property">searchText</span>,getHintData,&#123;</span><br><span class="line">  <span class="attr">immediate</span>:<span class="literal">true</span>,</span><br><span class="line">  <span class="comment">//每次事件触发时，延迟的事件</span></span><br><span class="line">  <span class="attr">debounce</span>:<span class="number">500</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">/**</span></span><br></pre></td></tr></table></figure><h2 id="10-7-searchBar：提示关键字高亮处理"><a href="#10-7-searchBar：提示关键字高亮处理" class="headerlink" title="10-7 searchBar：提示关键字高亮处理"></a>10-7 searchBar：提示关键字高亮处理</h2><ol><li>在src&#x2F;views&#x2F;layout&#x2F;components&#x2F;header&#x2F;header-search&#x2F;hint.vue添加方法，增加一个正则替换，最后进行一个富文本替换</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 处理关键字高亮</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">highlightText</span> = (<span class="params">text</span>)=&gt;&#123;</span><br><span class="line">  <span class="comment">//生成高亮标签</span></span><br><span class="line">  <span class="keyword">const</span> highlightSte = <span class="string">`&lt;span class=&quot;text-zinc-900 dark:text-zinc-200&quot;&gt;</span></span><br><span class="line"><span class="string">  <span class="subst">$&#123;props.searchText&#125;</span>&lt;/span&gt;`</span></span><br><span class="line">  <span class="comment">//正则表达式：从《显示文本中》找出与《用户输入文本相同的内容》，使用《高亮标签》进行替换</span></span><br><span class="line">  <span class="keyword">const</span> reg = <span class="keyword">new</span> <span class="title class_">RegExp</span>(props.<span class="property">searchText</span>,<span class="string">&#x27;gi&#x27;</span>)</span><br><span class="line">  <span class="comment">//替换</span></span><br><span class="line">  <span class="keyword">return</span> text.<span class="title function_">replace</span>(reg,highlightSte)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;div</span><br><span class="line">  v-for=&#x27;(item,index) in hintData&#x27;</span><br><span class="line">  :key=&#x27;index&#x27;</span><br><span class="line">  class=&#x27;py-1 pl-1 text-base font-bold text-zinc-500 rounded</span><br><span class="line">  cursor-pointer duration-300 hover:bg-zinc-200 dark:hover:bg-zinc-900&#x27;</span><br><span class="line">  v-html=&#x27;highlightText(item)&#x27;</span><br><span class="line">  @click=&#x27;onItemClick(item)&#x27;</span><br><span class="line">&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure><h2 id="10-8-searchBar：搜索历史处理"><a href="#10-8-searchBar：搜索历史处理" class="headerlink" title="10-8 searchBar：搜索历史处理"></a>10-8 searchBar：搜索历史处理</h2><ol><li>创建模块store&#x2F;modules&#x2F;search.js</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 搜索</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">//独立作用域</span></span><br><span class="line">  <span class="attr">namespaced</span>:<span class="literal">true</span>,</span><br><span class="line">  <span class="attr">state</span>:<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span>&#123;</span><br><span class="line">      <span class="attr">historys</span>:[]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mutations</span>:&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新增</span></span><br><span class="line"><span class="comment">     * 1.新增的历史记录位于头部</span></span><br><span class="line"><span class="comment">     * 2.不可出现重复的记录</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="title function_">addHistory</span>(<span class="params">state,newHistory</span>)&#123;</span><br><span class="line">      <span class="keyword">const</span> isFindIndex = state.<span class="property">historys</span>.<span class="title function_">findIndex</span>(</span><br><span class="line">        <span class="function">(<span class="params">item</span>)=&gt;</span>item === newHistory</span><br><span class="line">      )</span><br><span class="line">      <span class="comment">//提出旧数据</span></span><br><span class="line">      <span class="keyword">if</span> (isFindIndex !==-<span class="number">1</span>)&#123;</span><br><span class="line">        state.<span class="property">historys</span>.<span class="title function_">splice</span>(isFindIndex,<span class="number">1</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//新增记录</span></span><br><span class="line">      state.<span class="property">historys</span>.<span class="title function_">unshift</span>(newHistory)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 单个删除</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="title function_">deleteHistory</span>(<span class="params">state,index</span>)&#123;</span><br><span class="line">      state.<span class="property">historys</span>.<span class="title function_">splice</span>(index,<span class="number">1</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 全部删除</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="title function_">deleteAllHistory</span>(<span class="params">state</span>)&#123;</span><br><span class="line">      state.<span class="property">historys</span>=[]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">actions</span>:&#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>在store&#x2F;index.js中注册</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> search <span class="keyword">from</span> <span class="string">&#x27;./modules/search&#x27;</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">createStore</span>(&#123;</span><br><span class="line">  getters,</span><br><span class="line">  <span class="attr">modules</span>:&#123;</span><br><span class="line">    category,</span><br><span class="line">    theme,</span><br><span class="line">    app,</span><br><span class="line">    search</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>:[</span><br><span class="line">   <span class="title function_">createPersistedState</span>(&#123;</span><br><span class="line">     <span class="comment">//指定保存到localStorage中的key</span></span><br><span class="line">     <span class="attr">key</span>:<span class="string">&#x27;imooc-front&#x27;</span>,</span><br><span class="line">     <span class="comment">//需要保存的模块</span></span><br><span class="line">     <span class="attr">paths</span>:[<span class="string">&#x27;category&#x27;</span>,<span class="string">&#x27;theme&#x27;</span>,<span class="string">&#x27;search&#x27;</span>]</span><br><span class="line">   &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure><ol start="3"><li>所有的store的访问都应该有一个getters</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 搜索历史</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="attr">historys</span>:<span class="function">(<span class="params">state</span>)=&gt;</span>state.<span class="property">search</span>.<span class="property">historys</span></span><br></pre></td></tr></table></figure><ol start="4"><li>至此vuex的所有操作都完成了</li></ol><hr><ol start="5"><li>我们创建组件views&#x2F;layout&#x2F;components&#x2F;header&#x2F;header-search&#x2F;history.vue</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;div class=&#x27;flex items-center text-xs mb-1 text-zinc-400&#x27;&gt;</span><br><span class="line">      &lt;span&gt;最新搜索&lt;/span&gt;</span><br><span class="line">      &lt;m-svg-icon</span><br><span class="line">        name=&#x27;delete&#x27;</span><br><span class="line">        class=&#x27;w-2.5 h-2.5 ml-1 p-0.5 cursor-pointer duration-300 rounded-sm hover:bg-zinc-100&#x27;</span><br><span class="line">        fillClass=&#x27;fill-zinc-400&#x27;</span><br><span class="line">        @click=&#x27;onDeleteAllClick&#x27;</span><br><span class="line">      &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div class=&#x27;flex flex-wrap&#x27;&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        v-for=&#x27;(item,index) in $store.getter.historys()&#x27;</span><br><span class="line">        :key=&#x27;index&#x27;</span><br><span class="line">        class=&#x27;mr-2 mb-1.5 flex items-center cursor-pointer bg-zinc-100 px-1.5</span><br><span class="line">        py-0.5 text-zinc-900 text-sm font-bold rounded-sm dutation-300</span><br><span class="line">        hover:bg-zinc-200&#x27;</span><br><span class="line">        @click=&#x27;onItemClick(item)&#x27;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;span&gt;&#123;&#123;item&#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;m-svg-icon</span><br><span class="line">          name=&#x27;input-deldete&#x27;</span><br><span class="line">          class=&#x27;w-2.5 h-2.5 p-0.5 ml-1 duration-300 rounded-sm</span><br><span class="line">          hover:bg-zinc-100&#x27;</span><br><span class="line">          @click.stop=&#x27;onDeleteClick(index)&#x27;</span><br><span class="line">        &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">const EMITS_ITEM_CLICK=&#x27;itemClick&#x27;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; useStore &#125; from &#x27;vuex&#x27;</span><br><span class="line">const emits = defineEmits([EMITS_ITEM_CLICK])</span><br><span class="line">const store = useStore()</span><br><span class="line">/**</span><br><span class="line"> * 删除全部</span><br><span class="line"> */</span><br><span class="line">const onDeleteAllClick =()=&gt;&#123;</span><br><span class="line">  store.commit(&#x27;search/deleteAllHistory&#x27;)</span><br><span class="line">&#125;</span><br><span class="line">/**</span><br><span class="line"> * 单个删除</span><br><span class="line"> */</span><br><span class="line">const onDeleteClick=(index)=&gt;&#123;</span><br><span class="line">  store.commit(&#x27;search/deleteHistory&#x27;,index)</span><br><span class="line">&#125;</span><br><span class="line">/**</span><br><span class="line"> * 触发搜索</span><br><span class="line"> */</span><br><span class="line">const onItemClick=(item)=&gt;&#123;</span><br><span class="line">  emits(EMITS_ITEM_CLICK,item)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><ol start="6"><li>我们在views&#x2F;layout&#x2F;components&#x2F;header&#x2F;header-search&#x2F;index.vue中使用history组件；另外当我们回车的时候也调用搜索回调方法</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--最近搜索--&gt;</span><br><span class="line">&lt;history-vue</span><br><span class="line">  v-show=&quot;!inputValue&quot;</span><br><span class="line">  @itemClick=&quot;onSearchHandler&quot;</span><br><span class="line">&gt;&lt;/history-vue&gt;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> historyVue <span class="keyword">from</span> <span class="string">&#x27;./history.vue&#x27;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 搜索回调</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onSearchHandler</span> = (<span class="params">val</span>) =&gt; &#123;</span><br><span class="line">  inputValue.<span class="property">value</span> = val</span><br><span class="line">  <span class="keyword">if</span> (val) &#123;</span><br><span class="line">    store.<span class="title function_">commit</span>(<span class="string">&#x27;search/addHistory&#x27;</span>, val)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;m-search v-model=&quot;inputValue&quot; @search=&quot;onSearchHandler&quot;&gt;</span><br><span class="line">&lt;/m-search&gt;</span><br></pre></td></tr></table></figure><h2 id="10-9-通用组件：confirm应用场景"><a href="#10-9-通用组件：confirm应用场景" class="headerlink" title="10-9 通用组件：confirm应用场景"></a>10-9 通用组件：confirm应用场景</h2><p>目前当我们点击<strong>删除全部</strong>历史记录时，会直接删除，这样体验并不好，我们期望的是能够给用户一个提示，也就是confirm</p><p>所以我们就期望能够构建出一个对应的confirm组件。</p><p>但是对于confirm这种组件而言，我们不希望它通过标签的形式进行使用，而是期望可以像element-plus中的<strong>confirm</strong>-样，可以直接通过方法的形式进行调用，这样就太爽了</p><p>那么如果我们想要通过一个方法来进行一个组件的展示，并与其进行交互的话，那么应该怎么做呢？</p><h2 id="10-10-通用组件：vnode-h函数-render函数-明确-confirm-构建思路"><a href="#10-10-通用组件：vnode-h函数-render函数-明确-confirm-构建思路" class="headerlink" title="10-10 通用组件：vnode + h函数 + render函数 明确 confirm 构建思路"></a>10-10 通用组件：vnode + h函数 + render函数 明确 confirm 构建思路</h2><p>那么想要搞明白这一点，我们就需要了解一些比较冷僻的知识点，那就是<strong>渲染函数</strong>，在渲染函数中，我们需要了解如下概念：</p><ol><li>虚拟dom：通过js来描述dom</li><li>vnode 虚拟节点：告诉vue 页面上需要渲染什么样子的节点</li><li>h函数：用来创建vnode 的函数，接受三个参数（要渲染的dom，attrs 对象，子元素）</li><li>render 函数：可以根据vnode 来染dom</li></ol><p>根据以上所说我们知道：<strong>通过h函数可以生成一个vnode，vnode 可以通过render 函数被宣染</strong></p><p>所以据此我们就可以得出confirm组件的实现思路：</p><ol><li>创建一个confirm组件</li><li>创建一个confir.js模块，在该模块中返回一个promise</li><li>同时利用h函数生成confirm.vue的vnode</li><li>最后利用 render函数，宣染vnode到body中</li></ol><h2 id="10-11-通用组件：构建confirm组件"><a href="#10-11-通用组件：构建confirm组件" class="headerlink" title="10-11 通用组件：构建confirm组件"></a>10-11 通用组件：构建confirm组件</h2><p>根据以上分析:</p><ol><li>创建 src&#x2F;libs&#x2F;confirm&#x2F;index.vue组件，并创建对应的props：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> props = <span class="title function_">defineProps</span>(&#123;</span><br><span class="line">  <span class="comment">//标题</span></span><br><span class="line">  <span class="attr">title</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">String</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//描述</span></span><br><span class="line">  <span class="attr">content</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">required</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//取消按钮文本</span></span><br><span class="line">  <span class="attr">cancelText</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">default</span>: <span class="string">&#x27;取消&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//确定按钮文本</span></span><br><span class="line">  <span class="attr">confirmText</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">default</span>: <span class="string">&#x27;确定&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//取消按钮事件</span></span><br><span class="line">  <span class="attr">cancelHandler</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">Function</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//确定按钮事件</span></span><br><span class="line">  <span class="attr">confirmHandler</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">Function</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//关闭confirm的回调</span></span><br><span class="line">  <span class="attr">close</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">Function</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ol start="2"><li>因为我们最终期望通过方法进行调用，这会导致<strong>自动导入的组件无法使用</strong>，所以我们需要手动导入需要使用到的通用组件：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//因为将来 confirm组件会以方法调用的形式展示，需要主动导入组件</span></span><br><span class="line"><span class="keyword">import</span> mButton <span class="keyword">from</span> <span class="string">&#x27;../button/index.vue&#x27;</span></span><br></pre></td></tr></table></figure><ol start="3"><li>创建对应样式</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;!--  蒙版--&gt;</span><br><span class="line">    &lt;transition name=&quot;fade&quot;&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        v-else-if=&quot;isVisable&quot;</span><br><span class="line">        class=&quot;w-screen h-screen bg-zinc-900/80 z-40 fixed top-0 left-0&quot;</span><br><span class="line">        @click=&quot;close&quot;</span><br><span class="line">      &gt;&lt;/div&gt;</span><br><span class="line">    &lt;/transition&gt;</span><br><span class="line">    &lt;!--  内容--&gt;</span><br><span class="line">    &lt;transition name=&quot;up&quot;&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        v-if=&quot;isVisable&quot;</span><br><span class="line">        class=&quot;w-[80%] fixed top-1/3 left-[50%] translate-x-[-50%] z-50 px-2 py-1.5 rounded-sm border dark:border-zinc-600 cursor-pointer bg-white dark:bg-zinc-800 xl:w-[35%]&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;!--      标题--&gt;</span><br><span class="line">        &lt;div class=&quot;text-lg font-bold text-zinc-900 dark:text-zinc-200 mb-2&quot;&gt;</span><br><span class="line">          &#123;&#123; title &#125;&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">&lt;!--        文本--&gt;</span><br><span class="line">        &lt;div class=&#x27;text-base text-zinc-900 dark:text-zinc-200 mb-2&#x27;&gt;</span><br><span class="line">          &#123;&#123;content&#125;&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">&lt;!--        按钮--&gt;</span><br><span class="line">        &lt;div class=&#x27;flex justify-end&#x27;&gt;</span><br><span class="line">          &lt;m-button type=&#x27;info&#x27; class=&#x27;mr-2&#x27; @click=&#x27;onCancelClick&#x27;&gt;</span><br><span class="line">            &#123;&#123;cancelText&#125;&#125;</span><br><span class="line">          &lt;/m-button&gt;</span><br><span class="line">          &lt;m-button type=&#x27;primary&#x27; @click=&#x27;onConfirmClick&#x27;&gt;</span><br><span class="line">            &#123;&#123;confirmText&#125;&#125;</span><br><span class="line">          &lt;/m-button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/transition&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class="line">//fade动画</span><br><span class="line">.fade-enter-active,</span><br><span class="line">.fade-leave-active &#123;</span><br><span class="line">  transition: all 0.5s;</span><br><span class="line">&#125;</span><br><span class="line">//准备进入，离开完成</span><br><span class="line">.fade-enter-from,</span><br><span class="line">.fade-enter-to &#123;</span><br><span class="line">  opacity: 0;</span><br><span class="line">&#125;</span><br><span class="line">//up动画</span><br><span class="line">.up-enter-active,</span><br><span class="line">.up-leave-active &#123;</span><br><span class="line">  transition: all 0.5s;</span><br><span class="line">&#125;</span><br><span class="line">//准备进入，离开完成</span><br><span class="line">.up-enter-from,</span><br><span class="line">.up-enter-to &#123;</span><br><span class="line">  opacity: 0;</span><br><span class="line">  transform: translate3d(-50%, 100px, 0);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><ol start="4"><li>创建展示控制方法，因为需要保留执行动画，所以我们在mounted时，让内容展示：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//控制显示处理</span></span><br><span class="line"><span class="keyword">const</span> isVisable = <span class="title function_">ref</span>(<span class="literal">false</span>)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * confirm展示</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">show</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  isVisable.<span class="property">value</span>=<span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 处理动画（render 函数的宣染，会直接进行）页面构建完成之后，执行。保留动画</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">onMounted</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="title function_">show</span>()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ol start="5"><li>处理关闭控制方法，同样因为动画需要展示，所以我们需要预留动画执行时间：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//关闭动画执行时间</span></span><br><span class="line"><span class="keyword">const</span> duration = <span class="string">&#x27;0.5s&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 关闭事件，保留动画执行时长</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">close</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  isVisable.<span class="property">value</span>=<span class="literal">false</span></span><br><span class="line">  <span class="comment">//延迟一段时间进行关闭，等待动画完全关闭之后，再去触发props.close()</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (props.<span class="property">close</span>)&#123;</span><br><span class="line">      props.<span class="title function_">close</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,<span class="built_in">parseInt</span>(duration.<span class="title function_">replace</span>(<span class="string">&#x27;0.&#x27;</span>,<span class="string">&#x27;&#x27;</span>).<span class="title function_">replace</span>(<span class="string">&#x27;s&#x27;</span>,<span class="string">&#x27;&#x27;</span>)*<span class="number">100</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="6"><li>利用<strong>状态驱动css概念</strong>绑定响应式数据到css中：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;style lang=<span class="string">&quot;scss&quot;</span> scoped&gt;</span><br><span class="line"><span class="comment">//fade动画</span></span><br><span class="line">.<span class="property">fade</span>-enter-active,</span><br><span class="line">.<span class="property">fade</span>-leave-active &#123;</span><br><span class="line">  <span class="attr">transition</span>: all v-<span class="title function_">bind</span>(duration);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//准备进入，离开完成</span></span><br><span class="line">.<span class="property">fade</span>-enter-<span class="keyword">from</span>,</span><br><span class="line">.<span class="property">fade</span>-enter-to &#123;</span><br><span class="line">  <span class="attr">opacity</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//up动画</span></span><br><span class="line">.<span class="property">up</span>-enter-active,</span><br><span class="line">.<span class="property">up</span>-leave-active &#123;</span><br><span class="line">  <span class="attr">transition</span>: all v-<span class="title function_">bind</span>(duration);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//准备进入，离开完成</span></span><br><span class="line">.<span class="property">up</span>-enter-<span class="keyword">from</span>,</span><br><span class="line">.<span class="property">up</span>-enter-to &#123;</span><br><span class="line">  <span class="attr">opacity</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attr">transform</span>: <span class="title function_">translate3d</span>(-<span class="number">50</span>%, 100px, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><ol start="7"><li>取消和点击事件</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 取消按钮点击事件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onCancelClick</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  <span class="keyword">if</span> (props.<span class="property">cancelHandler</span>)&#123;</span><br><span class="line">    props.<span class="title function_">cancelHandler</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">close</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 确定按钮点击事件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onConfirmClick</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  <span class="keyword">if</span> (props.<span class="property">confirmHandler</span>)&#123;</span><br><span class="line">    props.<span class="title function_">confirmHandler</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">close</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="10-12-通用组件：函数调用confirm组件"><a href="#10-12-通用组件：函数调用confirm组件" class="headerlink" title="10-12 通用组件：函数调用confirm组件"></a>10-12 通用组件：函数调用confirm组件</h2><ol><li>我们创建一个函数，通过这个函数来调用confirm进行展示，创建lib&#x2F;confirm&#x2F;index.js</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> confirmComponent <span class="keyword">from</span> <span class="string">&#x27;./index.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; h &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 展示confirm，用户只传递一个参数，那么这个参数为content</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> title 标题（如果用户没有传递内容，那么标题被作为内容）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> content 内容（如果没有 title，那么content会被作为第一个参数传入）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> cancelText 取消按钮文本</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> confirmText 确定按钮的文本</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">confirm</span>=(<span class="params">title,content,cancelText,</span></span><br><span class="line"><span class="params">confirmText</span>)=&gt;&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (title&amp;&amp;content)&#123;</span><br><span class="line">      content = title</span><br><span class="line">      title = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 关闭回调</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">close</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">      <span class="comment">//3.把渲染的vnode去掉</span></span><br><span class="line">      <span class="title function_">render</span>(<span class="literal">null</span>,<span class="variable language_">document</span>.<span class="property">body</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 取消按钮的回调</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">cancelHandler</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">      <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;取消按钮点击&#x27;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 确定按钮的回调</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">confirmHandler</span> =(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">      <span class="title function_">resolve</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1.生成vnode</span></span><br><span class="line">    <span class="keyword">const</span> vnode = <span class="title function_">h</span>(confirmComponent,&#123;</span><br><span class="line">      title,</span><br><span class="line">      content,</span><br><span class="line">      cancelText,</span><br><span class="line">      confirmText,</span><br><span class="line">      cancelHandler,</span><br><span class="line">      confirmHandler,</span><br><span class="line">      close</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">//2.render渲染</span></span><br><span class="line">    <span class="title function_">render</span>(vnode,<span class="variable language_">document</span>.<span class="property">body</span>)</span><br><span class="line"></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>我们在lib&#x2F;index.js中导入并导出</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> &#123;confirm&#125; <span class="keyword">from</span> <span class="string">&#x27;./confirm/index&#x27;</span></span><br></pre></td></tr></table></figure><ol start="3"><li>然后我们在header&#x2F;header-search&#x2F;history.vue中触发confirm</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;confirm&#125; <span class="keyword">from</span> <span class="string">&#x27;@/lib&#x27;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 删除全部</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onDeleteAllClick</span> =(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  <span class="title function_">confirm</span>(<span class="string">&#x27;标题&#x27;</span>,<span class="string">&#x27;你要删除所有记录吗？&#x27;</span>,<span class="string">&#x27;不删了&#x27;</span>,<span class="string">&#x27;删了&#x27;</span>)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">      store.<span class="title function_">commit</span>(<span class="string">&#x27;search/deleteAllHistory&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;点击了取消&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>因为我们是方法导出，所以在lib&#x2F;button&#x2F;index.vue中我们需要引入组件</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mSvgIcon <span class="keyword">from</span> <span class="string">&#x27;../svg-icon/index.vue&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="10-13-searchBar：热门精选模块构建"><a href="#10-13-searchBar：热门精选模块构建" class="headerlink" title="10-13 searchBar：热门精选模块构建"></a>10-13 searchBar：热门精选模块构建</h2><ol><li>我们先在api&#x2F;pexeis.js中定义获取主题接口</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取推荐主题</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getThemes</span> = (<span class="params"></span>) =&gt;&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>:<span class="string">&#x27;/pexels/themes&#x27;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>创建对应组件header&#x2F;header-search&#x2F;theme.vue</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;div class=&quot;text-xs mb-1 text-zinc-400&quot;&gt;热门精选&lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;flex h-[140px]&quot; v-if=&quot;themeData.list.length&quot;&gt;</span><br><span class="line">      &lt;!--大图--&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class=&quot;relative rounded w-[260px] cursor-pointer&quot;</span><br><span class="line">        :style=&quot;&#123;</span><br><span class="line">          backgroundColor: randomRGB()</span><br><span class="line">        &#125;&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;img</span><br><span class="line">          v-lazy</span><br><span class="line">          class=&quot;h-full w-full object-cover rounded&quot;</span><br><span class="line">          src=&quot;themeData.big.photo&quot;</span><br><span class="line">          alt=&quot;&quot;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;p</span><br><span class="line">          class=&quot;absolute bottom-0 left-0 w-full h-[45%] flex items-center backdrop-blur rounded px-1 text-white text-xs duration-300 hover:backdrop-blur-none&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          #&#123;&#123; themeData.big.title &#125;&#125;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;!--小图--&gt;</span><br><span class="line">      &lt;div class=&quot;flex flex-wrap flex-1 max-w-[860px]&quot;&gt;</span><br><span class="line">        &lt;div</span><br><span class="line">          v-for=&quot;item in themeData.list&quot;</span><br><span class="line">          :key=&quot;item.id&quot;</span><br><span class="line">          class=&quot;h-[45%] w-[260px] text-white text-xs relative ml-1.5 mb-1.5 rounded&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;img</span><br><span class="line">            v-lazy</span><br><span class="line">            class=&quot;w-full h-full object-cover rounded&quot;</span><br><span class="line">            :src=&quot;item.photo&quot;</span><br><span class="line">            alt=&quot;&quot;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;p</span><br><span class="line">            class=&quot;backdrop-blur absolute top-0 left-0 w-full h-full flex items-center px-1 rounded cursor-pointer duration-300 hover:backdrop-blur-none&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            #&#123;&#123; item.title &#125;&#125;</span><br><span class="line">          &lt;/p&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; getThemes &#125; from &#x27;@/api/pexeis&#x27;</span><br><span class="line">import &#123; randomRGB &#125; from &#x27;@/utils/color&#x27;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">const themeData = ref(&#123;</span><br><span class="line">  big: &#123;&#125;,</span><br><span class="line">  list: []</span><br><span class="line">&#125;)</span><br><span class="line">const getThemeDate = async () =&gt; &#123;</span><br><span class="line">  const &#123; themes &#125; = await getThemes()</span><br><span class="line">  themeData.value = &#123;</span><br><span class="line">    big: themes[0],</span><br><span class="line">    list: themes.splice(1, themes.length)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">getThemeDate()</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="3"><li>将上面的组件渲染到header&#x2F;header-search&#x2F;index.vue里，在最近搜索后使用</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> themeVue <span class="keyword">from</span> <span class="string">&#x27;./theme.vue&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--最近搜索--&gt;</span><br><span class="line">        &lt;history-vue</span><br><span class="line">          v-show=&quot;!inputValue&quot;</span><br><span class="line">          @itemClick=&quot;onSearchHandler&quot;</span><br><span class="line">        &gt;&lt;/history-vue&gt;</span><br><span class="line">        &lt;!--推荐主题--&gt;</span><br><span class="line">        &lt;theme-vue v-show=&#x27;!inputValue&#x27;&gt;&lt;/theme-vue&gt;</span><br></pre></td></tr></table></figure><h2 id="10-14-searchBar-联动-list"><a href="#10-14-searchBar-联动-list" class="headerlink" title="10-14 searchBar 联动 list-"></a>10-14 searchBar 联动 list-</h2><ol><li>首先在store&#x2F;modules&#x2F;app.js中增加代码</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * app模块中的数据不会被缓存</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">//独立作用域</span></span><br><span class="line">  <span class="attr">namespaced</span>:<span class="literal">true</span>,</span><br><span class="line">  <span class="attr">state</span>:<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span>&#123;</span><br><span class="line">      <span class="comment">//搜索的文本</span></span><br><span class="line">      <span class="attr">searchText</span>:<span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mutations</span>:&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改searchText</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="title function_">changeSearchText</span>(<span class="params">state,newSearchText</span>)&#123;</span><br><span class="line">      state.<span class="property">searchText</span>=newSearchText</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">actions</span>:&#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>在store&#x2F;getters.js增加直接访问代码</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 搜索文本</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="attr">searchText</span>:<span class="function">(<span class="params">state</span>)=&gt;</span>state.<span class="property">app</span>.<span class="property">searchText</span></span><br></pre></td></tr></table></figure><ol start="3"><li>在layout&#x2F;components&#x2F;header&#x2F;header-search&#x2F;index.vue中搜索回调时调用changeSearchText</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 搜索回调</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onSearchHandler</span> = (<span class="params">val</span>) =&gt; &#123;</span><br><span class="line">  inputValue.<span class="property">value</span> = val</span><br><span class="line">  <span class="keyword">if</span> (val) &#123;</span><br><span class="line">    store.<span class="title function_">commit</span>(<span class="string">&#x27;search/addHistory&#x27;</span>, val)</span><br><span class="line">      <span class="comment">//以下新增</span></span><br><span class="line">    store.<span class="title function_">commit</span>(<span class="string">&#x27;search/changeSearchText&#x27;</span>, val)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>最后在main&#x2F;components&#x2F;index.vue中监听searchText的变化</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 监听searchText的变化</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">  <span class="function">()=&gt;</span>store.<span class="property">getters</span>.<span class="property">searchText</span>,</span><br><span class="line">  <span class="function">(<span class="params">val</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="title function_">resetQuery</span>(&#123;</span><br><span class="line">      <span class="attr">page</span>:<span class="number">1</span>,</span><br><span class="line">      <span class="attr">searchText</span>:val</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="10-15-总结"><a href="#10-15-总结" class="headerlink" title="10-15 总结"></a>10-15 总结</h2><p>那么本章节我们的核心实际上包含了两部分内容：</p><ol><li>多组件联动逻辑</li><li>confirm通用组件<ol><li>vnode</li><li>h函数</li><li>render 函数</li></ol></li></ol><h1 id="11-、前台常见功能解决方案：下载-全屏-引导"><a href="#11-、前台常见功能解决方案：下载-全屏-引导" class="headerlink" title="11 、前台常见功能解决方案：下载+全屏+引导"></a>11 、前台常见功能解决方案：下载+全屏+引导</h1><p>在前台项目中，我们会存在很多的常见功能，这些功能通常情况下是偏通用的，比如：文件下载、全屏处理、功能引导 等等… 那么这些功能如何进行实现呢？</p><hr><h2 id="11-1-文件下载解决方案"><a href="#11-1-文件下载解决方案" class="headerlink" title="11-1 文件下载解决方案"></a>11-1 文件下载解决方案</h2><p>当我们点击 item中的下载按钮时，我们期望可以下载当前的图片。</p><p>那么想要实现该功能，则需要使用到专门的下载包。</p><p>目前常用的支持下载功能包有两个：</p><ol><li>小文件下载：file-saver</li><li>大文件下载：streamsaver</li></ol><p>咱们的图片下载属于小文件的下载，所以我们可以直接使用file-saver</p><ol><li>安装 file-saver</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i --save file-saver@2.0.5</span><br></pre></td></tr></table></figure><ol start="2"><li>在src&#x2F;views&#x2F;main&#x2F;components&#x2F;list&#x2F;item.vue中，增加下载功能： 下载处增加一个点击事件，然后使用saveAs</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--      下载--&gt;</span><br><span class="line">&lt;m-button</span><br><span class="line">  @click=&#x27;onDownload&#x27;</span><br><span class="line">&gt;&lt;/m-button&gt;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;saveAs&#125; <span class="keyword">from</span> <span class="string">&#x27;file-saver&#x27;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 下载按钮点击事件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onDownload</span> =(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 1.下载的图片连接</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">saveAs</span>(props.<span class="property">data</span>.<span class="property">photoDownLink</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="11-2-通用组件：方法触发的message构建分析"><a href="#11-2-通用组件：方法触发的message构建分析" class="headerlink" title="11-2 通用组件：方法触发的message构建分析"></a>11-2 通用组件：方法触发的message构建分析</h2><p>在之前的时候，我们构建过一个confirm的通用组件，该组件我们可以直接通过 方法进行调用展示</p><p>那么对于咱们接下来打算构建的 message 组件，同样如此，我们依然希望可以通过方法的调用直接展示对应的组件。</p><p>那么根据我们之前的经验，我们知道：</p><ol><li>首先我们需要先构建出一个对应的 message.vue</li><li>然后构建出对应的message.js模块</li><li>在模块中，通过：<ol><li>‘h函数’构建vnode</li><li>render 函数，进行渲染</li></ol></li></ol><p>进行处理</p><p>那么以上方式，就是是咱们message的构建过程。</p><h2 id="11-3-通用组件：构建message组件基本能力"><a href="#11-3-通用组件：构建message组件基本能力" class="headerlink" title="11-3 通用组件：构建message组件基本能力"></a>11-3 通用组件：构建message组件基本能力</h2><ol><li>创建 src&#x2F;libs&#x2F;message&#x2F;index.vue 组件：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">SUCCESS</span> = <span class="string">&#x27;success&#x27;</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">WARN</span> = <span class="string">&#x27;warn&#x27;</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">ERROR</span> = <span class="string">&#x27;error&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> typeEnum = [<span class="variable constant_">SUCCESS</span>,<span class="variable constant_">WARN</span>,<span class="variable constant_">ERROR</span>]</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"><span class="keyword">const</span> props =<span class="title function_">defineProps</span>(&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * message的消息类型</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">type</span>:&#123;</span><br><span class="line">    <span class="attr">type</span>:<span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">required</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="title function_">validator</span>(<span class="params">val</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> result = typeEnum.<span class="title function_">includes</span>(val)</span><br><span class="line">      <span class="keyword">if</span> (!result)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`你的type必须是<span class="subst">$&#123;typeEnum.join(<span class="string">&#x27;、&#x27;</span>)&#125;</span>中的一个`</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> result</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 描述文本</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">content</span>:&#123;</span><br><span class="line">    <span class="attr">type</span>:<span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">required</span>:<span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 展示时长</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">duration</span>:&#123;</span><br><span class="line">    <span class="attr">type</span>:<span class="title class_">Number</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 关闭时的回调</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">destroy</span>:&#123;</span><br><span class="line">    <span class="attr">type</span>:<span class="title class_">Function</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ol start="2"><li>构建各种状态下的样式表：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//样式表数据</span></span><br><span class="line"><span class="keyword">const</span> styles=&#123;</span><br><span class="line">  <span class="comment">//警告</span></span><br><span class="line">  <span class="attr">warn</span>:&#123;</span><br><span class="line">    <span class="attr">icon</span>:<span class="string">&#x27;warn&#x27;</span>,</span><br><span class="line">    <span class="attr">fillClass</span>:<span class="string">&#x27;fill-warn-300&#x27;</span>,</span><br><span class="line">    <span class="attr">textClass</span>:<span class="string">&#x27;text-warn-300&#x27;</span>,</span><br><span class="line">    <span class="attr">containerClass</span>:</span><br><span class="line">      <span class="string">&#x27;bg-warn-100 border-warn-200 hover:shadow-lg hover:shadow-warn-100&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//错误</span></span><br><span class="line">  <span class="attr">error</span>:&#123;</span><br><span class="line">    <span class="attr">icon</span>:<span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">    <span class="attr">fillClass</span>:<span class="string">&#x27;fill-error-300&#x27;</span>,</span><br><span class="line">    <span class="attr">textClass</span>:<span class="string">&#x27;text-error-300&#x27;</span>,</span><br><span class="line">    <span class="attr">containerClass</span>:</span><br><span class="line">      <span class="string">&#x27;bg-error-100 border-error-200 hover:shadow-lg hover:shadow-error-100&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//成功</span></span><br><span class="line">  <span class="attr">success</span>:&#123;</span><br><span class="line">    <span class="attr">icon</span>:<span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">    <span class="attr">fillClass</span>:<span class="string">&#x27;fill-success-300&#x27;</span>,</span><br><span class="line">    <span class="attr">textClass</span>:<span class="string">&#x27;text-success-300&#x27;</span>,</span><br><span class="line">    <span class="attr">containerClass</span>:</span><br><span class="line">      <span class="string">&#x27;bg-success-100 border-success-200 hover:shadow-lg hover:shadow-success-100&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>配合样式表，构建template</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;transition name=&#x27;down&#x27; @after-leave=&#x27;destroy&#x27;&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      v-show=&#x27;isVisable&#x27;</span><br><span class="line">      class=&#x27;min-w-[420px] fixed top-[20px] left-[50%] translate-x-[-50%] z-50</span><br><span class="line">      flex items-center px-3 py-1.5 rounded-sm border cursor-pointer&#x27;</span><br><span class="line">      :class=&#x27;styles[type].containerClass&#x27;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;m-svg-icon</span><br><span class="line">        :name=&#x27;styles[type].icon&#x27;</span><br><span class="line">        :fillClass=&#x27;styles[type].fillClass&#x27;</span><br><span class="line">        class=&#x27;h-1.5 w-1.5 mr-1.5&#x27;</span><br><span class="line">      &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">      &lt;span class=&#x27;text-sm&#x27; :class=&#x27;styles[type].textClass&#x27;&gt;</span><br><span class="line">        &#123;&#123;content&#125;&#125;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/transition&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import mSvgIcon from &#x27;../svg-icon/index.vue&#x27;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line">.down-enter-active,</span><br><span class="line">.down-leave-active&#123;</span><br><span class="line">  transition: all 0.5s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.down-enter-from,</span><br><span class="line">.down-leave-to&#123;</span><br><span class="line">  opacity: 0;</span><br><span class="line">  transform: translate3d(-50%,-100px,0);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><ol start="4"><li>处理展示逻辑</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isVisable = <span class="title function_">ref</span>(<span class="literal">false</span>)</span><br><span class="line"><span class="keyword">const</span> animDuration = <span class="string">&#x27;0.5s&#x27;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 保证动画展示，需要在mounted 之后进行展示</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">onMounted</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  isVisable.<span class="property">value</span>=<span class="literal">true</span></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 延迟时间关闭</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    isVisable.<span class="property">value</span>=<span class="literal">false</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (props.<span class="property">destroy</span>)&#123;</span><br><span class="line">        props.<span class="title function_">destroy</span>()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,<span class="built_in">parseInt</span>(animDuration.<span class="title function_">replace</span>(<span class="string">&#x27;0.&#x27;</span>,<span class="string">&#x27;&#x27;</span>).<span class="title function_">replace</span>(<span class="string">&#x27;s&#x27;</span>,<span class="string">&#x27;&#x27;</span>)*<span class="number">100</span>))</span><br><span class="line">  &#125;,props.<span class="property">duration</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ol start="5"><li>新增tailwind的自定义样式</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">colors</span>:&#123;</span><br><span class="line">  <span class="string">&#x27;success-100&#x27;</span>:<span class="string">&#x27;#F2F9EC&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;success-200&#x27;</span>:<span class="string">&#x27;#E4F2DB&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;success-300&#x27;</span>:<span class="string">&#x27;#7EC050&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;warn-100&#x27;</span>:<span class="string">&#x27;#FCF6ED&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;warn-200&#x27;</span>:<span class="string">&#x27;#F8ECDA&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;warn-300&#x27;</span>:<span class="string">&#x27;#DCA550&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;error-100&#x27;</span>:<span class="string">&#x27;#ED7456&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;error-200&#x27;</span>:<span class="string">&#x27;#f3471c&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;error-300&#x27;</span>:<span class="string">&#x27;#ffffff&#x27;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="11-4-通用组件：方法触发-message-展示"><a href="#11-4-通用组件：方法触发-message-展示" class="headerlink" title="11-4 通用组件：方法触发 message 展示"></a>11-4 通用组件：方法触发 message 展示</h2><ol><li>创建 src&#x2F;libs&#x2F;message&#x2F;index.js方法：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;h , render&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> messageComponent <span class="keyword">from</span> <span class="string">&#x27;./index.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> type 类型:success、warn、error</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> content 描述文本</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> duration 展示时间（毫秒），默认3000</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">message</span> = (<span class="params">type,content,duration = <span class="number">3000</span></span>)=&gt;&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 动画结束时的回调</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">onDestory</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">    <span class="comment">//3.删除render</span></span><br><span class="line">    <span class="title function_">render</span>(<span class="literal">null</span>,<span class="variable language_">document</span>.<span class="property">body</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//1.拿到vnode</span></span><br><span class="line">  <span class="keyword">const</span> vnode = <span class="title function_">h</span>(messageComponent,&#123;</span><br><span class="line">    type,</span><br><span class="line">    content,</span><br><span class="line">    duration,</span><br><span class="line">    <span class="attr">destory</span>:<span class="title function_">onDestory</span>()</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">//2.render vonde</span></span><br><span class="line">  <span class="title function_">render</span>(vnode,<span class="variable language_">document</span>.<span class="property">body</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>紧接着我们再lib&#x2F;index.js中将message方法导出</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> &#123;message&#125; <span class="keyword">from</span> <span class="string">&#x27;./message/index&#x27;</span></span><br></pre></td></tr></table></figure><ol start="3"><li>我们再main&#x2F;components&#x2F;list&#x2F;item.vue中使用该方法</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;message&#125; <span class="keyword">from</span> <span class="string">&#x27;@/lib&#x27;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 下载按钮点击事件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onDownload</span> =(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  <span class="title function_">message</span>(<span class="string">&#x27;success&#x27;</span>,<span class="string">&#x27;图片开始下载&#x27;</span>)</span><br><span class="line">  <span class="comment">//延迟一段时间执行，可以得到更好的体验</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 1.下载的图片连接</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="title function_">saveAs</span>(props.<span class="property">data</span>.<span class="property">photoDownLink</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="11-5-模块全屏解决方案"><a href="#11-5-模块全屏解决方案" class="headerlink" title="11-5 模块全屏解决方案"></a>11-5 模块全屏解决方案</h2><p>让页面中的指定区域进行全屏展示也是非常常见的一个功能。</p><p>想要让页面的指定区域进行全屏展示，我们通常可以使用全屏API，该API中提供了两个方法：</p><p>1.<strong>Element，requestFullscreen（）</strong>：让指定元素进行全屏</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;app&#x27;</span>).<span class="title function_">requestFullscreen</span>()</span><br></pre></td></tr></table></figure><p>2.<strong>Document.exitFullscreen（）</strong>：退出全屏</p><p>但是这个API 比较原始，使用起来没有那么方便，所以我们可以使用一个vueuse 中的更加简便的API：<strong>useFullScreen</strong></p><ol><li>利用useFullScreen生成img图片的全屏方法：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 生成全屏的方法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> imgTarget = <span class="title function_">ref</span>(<span class="literal">null</span>)</span><br><span class="line"><span class="keyword">const</span> &#123;<span class="attr">enter</span>:onImgFullScreen&#125; = <span class="title function_">useFullscreen</span>(imgTarget)</span><br></pre></td></tr></table></figure><ol start="2"><li>将图片绑上标签，并onImgFullScreen绑定至全屏按钮点击事件：</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> &lt;!--    图片--&gt;</span><br><span class="line">      &lt;img</span><br><span class="line">        ref=&#x27;imgTarget&#x27;</span><br><span class="line">      /&gt;</span><br><span class="line">&lt;!--      全屏--&gt;</span><br><span class="line">&lt;m-button</span><br><span class="line">  @click=&#x27;onImgFullScreen&#x27;</span><br><span class="line">&gt;&lt;/m-button&gt;</span><br></pre></td></tr></table></figure><h2 id="11-6-构建floating基础布局"><a href="#11-6-构建floating基础布局" class="headerlink" title="11-6 构建floating基础布局"></a>11-6 构建floating基础布局</h2><ol><li>增加floating，修改layout&#x2F;components&#x2F;floating.vue</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&#x27;fixed bottom-10 right-2&#x27;&gt;</span><br><span class="line">&lt;!--    引导页--&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      class=&#x27;w-4 h-4 mb-1 bg-white dark:bg-zinc-900 border dark:border-0</span><br><span class="line">      border-zinc-200 rounded-full flex justify-center items-center</span><br><span class="line">      cursor-pointer duration-200 group hover:shadow-lg&#x27;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;m-svg-icon</span><br><span class="line">        name=&#x27;guide&#x27;</span><br><span class="line">        class=&#x27;w-2 h-2&#x27;</span><br><span class="line">        fillClass=&#x27;fill-zinc-900 dark:fill-zinc-200 group-hover:fill-main&#x27;</span><br><span class="line">      &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;!--    反馈--&gt;</span><br><span class="line">    &lt;m-popover class=&#x27;flex items-center&#x27; placement=&#x27;top-left&#x27;&gt;</span><br><span class="line">      &lt;template #reference&gt;</span><br><span class="line">        &lt;div</span><br><span class="line">          class=&#x27;w-4 h-4 mb-1 bg-white dark:bg-zinc-900 border dark:border-0</span><br><span class="line">      border-zinc-200 rounded-full flex justify-center items-center</span><br><span class="line">      cursor-pointer duration-200 group hover:shadow-lg&#x27;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;m-svg-icon</span><br><span class="line">            name=&#x27;feedback&#x27;</span><br><span class="line">            class=&#x27;w-2 h-2&#x27;</span><br><span class="line">            fillClass=&#x27;fill-zinc-900 dark:fill-zinc-200 group-hover:fill-main&#x27;</span><br><span class="line">          &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line"></span><br><span class="line">      &lt;div class=&#x27;w-[140px] overflow-hidden&#x27;&gt;</span><br><span class="line">        &lt;div</span><br><span class="line">          class=&#x27;flex items-center p-1 cursor-pointer rounded</span><br><span class="line">          hover:bg-zinc-100/60 dark:hover:bg-zinc-800&#x27;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;m-svg-icon</span><br><span class="line">            name=&#x27;feedback&#x27;</span><br><span class="line">            class=&#x27;w-1.5 h-1.5 mr-1&#x27;</span><br><span class="line">            fillClass=&#x27;fill-zinc-900 dark:fill-zinc-300&#x27;</span><br><span class="line">          &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">          &lt;span class=&#x27;text-zinc-800 dark:text-zinc-300 text-sm&#x27;&gt;立即吐槽&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/m-popover&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&#x27;scss&#x27; scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h2 id="11-7-样式修正：处理难看的scrollBar"><a href="#11-7-样式修正：处理难看的scrollBar" class="headerlink" title="11-7 样式修正：处理难看的scrollBar"></a>11-7 样式修正：处理难看的scrollBar</h2><p>目前咱们的floating的样式已经构建完成了。只不过旁边的scrollBar 看着是在是有点难看。</p><p>所以咱们接下来就需要修正下这个scrollBar的样式。</p><p>对于tailwind而言，默认并没有提供scrollBar的样式类名，想要处理scrollBar的样式，那么需要安装单独的插件：tailwind-scrollbar</p><ol><li>安装插件</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev tailwind-scrollbar</span><br></pre></td></tr></table></figure><ol start="2"><li>在tailwind.config.js中注册该插件：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">plugins</span>: [<span class="built_in">require</span>(<span class="string">&#x27;tailwind-scrollbar&#x27;</span>)],</span><br></pre></td></tr></table></figure><ol start="3"><li>在tailwind.config.js 中，让 scrollBar 支持 dark 模式：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">theme</span>: &#123;</span><br><span class="line">  <span class="attr">extend</span>: &#123;</span><br><span class="line">   ........</span><br><span class="line">    <span class="attr">variants</span>:&#123;</span><br><span class="line">      <span class="attr">scrollbars</span>:[<span class="string">&#x27;dark&#x27;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><ol start="4"><li>我们再main&#x2F;index.vue中进行使用</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div </span><br><span class="line">    class=&#x27;h-full overflow-auto bg-white dark:bg-zinc-800 duration-500</span><br><span class="line">    scrollbar-thin scrollbar-thumb-transparent xl:scrollbar-thumb-zinc-200</span><br><span class="line">    xl:dark:scrollbar-thumb-zinc-900 scrollbar-track-transparent&#x27;&gt;</span><br><span class="line">  &lt;navigation-vue/&gt;</span><br><span class="line">  &lt;div class=&#x27;max-w-screen-xl mx-auto relative m-1 xl:mt-4&#x27;&gt;</span><br><span class="line">    &lt;list-vue&gt;&lt;/list-vue&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><ol start="5"><li>如果我们想让右边的scrollBar有圆弧，那么我们再styles&#x2F;index.scss中新增</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">::-webkit-scrollbar-thumb&#123;</span><br><span class="line">  border-<span class="attr">radius</span>: 10px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="6"><li>同样的搜索记录那里也要处理，修改lib&#x2F;search&#x2F;index.vue里面的下拉区部分</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--下拉区--&gt;</span><br><span class="line">&lt;transition name=&#x27;slide&#x27;&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    class=&#x27;max-h-[368px] w-full text-base overflow-auto bg-white</span><br><span class="line">    dark:bg-zinc-800 absolute z-20 left-0 top-[56px] p-2 rounded border</span><br><span class="line">    border-zinc-200 dark:border-zinc-600 duration-200 hover:shadow-2xl</span><br><span class="line">    scrollbar-thin scrollbar-thumb-transparent xl:scrollbar-thumb-zinc-200</span><br><span class="line">    xl:dark:scrollbar-thumb-zinc-900 scrollbar-track-transparent&#x27;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;slot name=&#x27;dropdown&#x27;/&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/transition&gt;</span><br></pre></td></tr></table></figure><h2 id="11-8-功能引导解决方案"><a href="#11-8-功能引导解决方案" class="headerlink" title="11-8 功能引导解决方案"></a>11-8 功能引导解决方案</h2><ol><li>在这里我们使用driver.js</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install driver. js</span><br></pre></td></tr></table></figure><ol start="2"><li>在floating.vue中初始化Driver</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="comment">//1.导入</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Driver</span> <span class="keyword">from</span> <span class="string">&#x27;driver.js&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;driver.js/dist/driver.min.css&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;onMounted&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="comment">//2.初始化</span></span><br><span class="line"><span class="keyword">let</span> driver =<span class="literal">null</span></span><br><span class="line"><span class="title function_">onMounted</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  driver = <span class="keyword">new</span> <span class="title class_">Driver</span>(&#123;</span><br><span class="line">    <span class="attr">allowClose</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="attr">closeBtnText</span>:<span class="string">&#x27;关闭&#x27;</span>,</span><br><span class="line">    <span class="attr">nextBtnText</span>:<span class="string">&#x27;下一步&#x27;</span>,</span><br><span class="line">    <span class="attr">prevBtnText</span>:<span class="string">&#x27;上一步&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><ol start="3"><li>我们在layout&#x2F;components&#x2F;steps.js中创建自己的步骤</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//在哪个元素中高亮</span></span><br><span class="line">    <span class="attr">element</span>: <span class="string">&#x27;.guide-home&#x27;</span>,</span><br><span class="line">    <span class="comment">//配置对象</span></span><br><span class="line">    <span class="attr">popover</span>: &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;logo&#x27;</span>,</span><br><span class="line">      <span class="attr">description</span>: <span class="string">&#x27;点击可以返回首页&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//在哪个元素中高亮</span></span><br><span class="line">    <span class="attr">element</span>:<span class="string">&#x27;.guide-search&#x27;</span>,</span><br><span class="line">    <span class="comment">//配置对象</span></span><br><span class="line">    <span class="attr">popover</span>:&#123;</span><br><span class="line">      <span class="attr">title</span>:<span class="string">&#x27;搜索&#x27;</span>,</span><br><span class="line">      <span class="attr">description</span>:<span class="string">&#x27;搜索你期望的图片&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//在哪个元素中高亮</span></span><br><span class="line">    <span class="attr">element</span>:<span class="string">&#x27;.guide-theme&#x27;</span>,</span><br><span class="line">    <span class="comment">//配置对象</span></span><br><span class="line">    <span class="attr">popover</span>:&#123;</span><br><span class="line">      <span class="attr">title</span>:<span class="string">&#x27;风格&#x27;</span>,</span><br><span class="line">      <span class="attr">description</span>:<span class="string">&#x27;选择一个您喜欢的风格&#x27;</span>,</span><br><span class="line">      <span class="attr">position</span>:<span class="string">&#x27;left&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//在哪个元素中高亮</span></span><br><span class="line">    <span class="attr">element</span>:<span class="string">&#x27;.guide-my&#x27;</span>,</span><br><span class="line">    <span class="comment">//配置对象</span></span><br><span class="line">    <span class="attr">popover</span>:&#123;</span><br><span class="line">      <span class="attr">title</span>:<span class="string">&#x27;账户&#x27;</span>,</span><br><span class="line">      <span class="attr">description</span>:<span class="string">&#x27;这里标记了您的账户信息&#x27;</span>,</span><br><span class="line">      <span class="attr">position</span>:<span class="string">&#x27;left&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//在哪个元素中高亮</span></span><br><span class="line">    <span class="attr">element</span>:<span class="string">&#x27;.guide-start&#x27;</span>,</span><br><span class="line">    <span class="comment">//配置对象</span></span><br><span class="line">    <span class="attr">popover</span>:&#123;</span><br><span class="line">      <span class="attr">title</span>:<span class="string">&#x27;引导&#x27;</span>,</span><br><span class="line">      <span class="attr">description</span>:<span class="string">&#x27;这里可以再次查看引导信息&#x27;</span>,</span><br><span class="line">      <span class="attr">position</span>:<span class="string">&#x27;left&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//在哪个元素中高亮</span></span><br><span class="line">    <span class="attr">element</span>:<span class="string">&#x27;.guide-feedback&#x27;</span>,</span><br><span class="line">    <span class="comment">//配置对象</span></span><br><span class="line">    <span class="attr">popover</span>:&#123;</span><br><span class="line">      <span class="attr">title</span>:<span class="string">&#x27;反馈&#x27;</span>,</span><br><span class="line">      <span class="attr">description</span>:<span class="string">&#x27;您的任何不满都可以在这里告诉我们&#x27;</span>,</span><br><span class="line">      <span class="attr">position</span>:<span class="string">&#x27;left&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure><ol start="4"><li>我们在floating.vue中导入该步骤，并在引导页增加点击事件</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> steps <span class="keyword">from</span> <span class="string">&#x27;./steps.js&#x27;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 开始引导</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onGuideClick</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  <span class="comment">//指定引导步骤</span></span><br><span class="line">  driver.<span class="title function_">defineSteps</span>(steps)</span><br><span class="line">  <span class="comment">//开始</span></span><br><span class="line">  driver.<span class="title function_">start</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--    引导页--&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      @click=&#x27;onGuideClick&#x27;</span><br><span class="line">    &gt;</span><br><span class="line">    &lt;/div&gt;</span><br></pre></td></tr></table></figure><ol start="5"><li>我们需要给需要引导的元素添加标签，就是步骤里面的element，layout&#x2F;components&#x2F;header&#x2F;index.vue、layout&#x2F;components&#x2F;header&#x2F;header-search&#x2F;index.vue等等</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;img</span><br><span class="line">  v-lazy</span><br><span class="line">  class=&#x27;guide-home h-4 cusor-pointer mr-2&#x27;</span><br><span class="line">  src=&quot;https://m.imooc.com/static/wap/static/common/img/logo-small@2x.png&quot;</span><br><span class="line">  @click=&#x27;onToHome&#x27;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&#x27;w-full guide-search&#x27;&gt;</span><br><span class="line">  &lt;m-search v-model=&quot;inputValue&quot; &gt;</span><br><span class="line">  &lt;/m-search&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><h2 id="11-9-解决功能引导图标不显示的问题"><a href="#11-9-解决功能引导图标不显示的问题" class="headerlink" title="11-9 解决功能引导图标不显示的问题"></a>11-9 解决功能引导图标不显示的问题</h2><ol><li>首先解决图标被挡住的问题，在styles&#x2F;index.scss中新增样式</li></ol><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.driver-fix-stacking</span>&#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>其次解决关闭、下一步、上一步对不齐问题，同样在styles&#x2F;index.scss中新增样式</li></ol><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.driver-navigation-btns</span>&#123;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>最后解决一个floating两个图标跑偏问题，在floating.vue中增加样式</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;style lang=<span class="string">&#x27;scss&#x27;</span> scoped&gt;</span><br><span class="line">.<span class="property">driver</span>-fix-stacking&#123;</span><br><span class="line">  <span class="attr">position</span>: fixed;</span><br><span class="line">  z-<span class="attr">index</span>:<span class="number">100004</span>!important;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h2 id="11-10-总结"><a href="#11-10-总结" class="headerlink" title="11-10 总结"></a>11-10 总结</h2><p>我们处理了4个核心功能：</p><ol><li>文件下载</li><li>通用组件：message构建</li><li>全屏处理</li><li>引导处理</li></ol><p>那么到目前为止，咱们的首页功能就已经处理的差不多了。</p><p>那么接下来我们就需要处理，item点击的详情页面展示。</p><h1 id="12、高阶路由过渡处理方案-——-浏览器堆栈主动介入"><a href="#12、高阶路由过渡处理方案-——-浏览器堆栈主动介入" class="headerlink" title="12、高阶路由过渡处理方案 —— 浏览器堆栈主动介入"></a>12、高阶路由过渡处理方案 —— 浏览器堆栈主动介入</h1><p>路由过渡动效并没有什么稀奇的，但是如果想要构建一个高交互性的前台系统，仅依靠路由过渡动效就可以实现吗？</p><hr><h2 id="12-1-前言"><a href="#12-1-前言" class="headerlink" title="12-1 前言"></a>12-1 前言</h2><p>在vue中，两个路由进行跳转的时候，我们有时候会为其增加一些跳转的过渡动画，这是一个非常常见的需求。</p><p>通常情况下，这种过渡动画，我们可以直接使vue-router的过渡动效来进行实现。</p><p>那么对于目前咱们的项目而言，当我们item中击进入详情页的时候，我们也希望可以有一个对应的过渡动效，从而提升用户体验。</p><p>我们期望这个过渡动效可以：</p><ol><li>同时在PC端和移动端生效</li><li>进入新页面时：在点击的具体item中呈现由小到大的缩放动画</li><li>退出新页面时：呈现由大到小的缩放动画缩回至点击的具体item中</li></ol><p>那么这样的一个过渡动效我们应该如何进行实现呢？</p><p>直接通过vue-router的过渡动效可以实现吗？如果不行的话，那么我们又应该如何去做呢？</p><h2 id="12-2-VueRouter过渡动效可行性分析"><a href="#12-2-VueRouter过渡动效可行性分析" class="headerlink" title="12-2 VueRouter过渡动效可行性分析"></a>12-2 VueRouter过渡动效可行性分析</h2><p>我们知道接下来我们要实现的是：<strong>item到详情页的路由过渡动效</strong></p><p>那么这样的一个过渡动效，我们如何去做呢？</p><p>通常针对这种功能，我们首先都会想到vue-router 提供的过渡动效。那么我们本小节就要来看一下，这个过渡动效功能能不能满足咱们的业务需求呢？</p><p>想要判断这个问题，我们首先就需要搞明白vue-router 的过渡动效的过渡机制是什么？然后再根据这个机制来分析可行性。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;router-view v-slot=&quot;&#123; Component &#125;&quot;&gt;</span><br><span class="line">  &lt;transition name=&quot;fade&quot;&gt;</span><br><span class="line">    &lt;component :is=&quot;Component&quot; /&gt;</span><br><span class="line">  &lt;/transition&gt;</span><br><span class="line">&lt;/router-view&gt;</span><br></pre></td></tr></table></figure><p>以上这段代码是实现过渡动效的关键代码。</p><p>其中涉及到了三个组件：</p><ol><li>router-view：路由出口</li><li>transition：动画组件</li><li>component：动态组件</li></ol><p>那么据此可以得知，vue-router过渡动效产生的关键就是transition动画组件。</p><p>那么同时我们知道对于<strong>transition</strong>而言，它能够产生动画的关键，其实是其内部元素component的动态组件切换。</p><p>但是这样的切换他一定是基于整个页面组件的。也就是说如果我们利用这种过渡动效，那么一定是：<strong>从home页面到detail 页面的整体页面组件的切换。</strong></p><p>所以是<strong>无法</strong>实现咱们期望的这种路由过渡效果的。</p><h2 id="12-3-主动介入浏览器堆栈管理，分析可行性方案"><a href="#12-3-主动介入浏览器堆栈管理，分析可行性方案" class="headerlink" title="12-3 主动介入浏览器堆栈管理，分析可行性方案"></a>12-3 主动介入浏览器堆栈管理，分析可行性方案</h2><p><strong>什么是路由的跳转？</strong></p><p>所谓路由的跳转无非指的是两个部分：</p><ol><li>浏览器的url发生了变化</li><li>浏览器中展示的页面组件发生了变化</li></ol><p>那么只要满足这两点，我们就认为<strong>路径进行了跳转</strong></p><p>所以说，我们是不是可以换个思路，我们<strong>不去进行真实的路由跳转，而是先修改浏览器的URL，再切换展示的页面</strong><br><strong>（以组件的形式覆盖整个浏览器可视区域）</strong>。这样对于用户而言，是不是就完成了整个的路由跳转工作。</p><p>所以说我们的具体问题就变成了：</p><ol><li>如何让浏览器的url发生变化，但是不跳转页面</li><li>如何让一个新的组件以包含动画的形式进行展示</li></ol><p>那么想要完成第一个功能我们可以使用：<strong>History.pushState（）</strong>方法。</p><p>而第二个功能我们可以使用<strong>GSAP</strong>这个动画库来进行实现。</p><h2 id="12-4-主动介入浏览器堆栈管理"><a href="#12-4-主动介入浏览器堆栈管理" class="headerlink" title="12-4 主动介入浏览器堆栈管理"></a>12-4 主动介入浏览器堆栈管理</h2><ol><li>我们先给item.vue增加一个点击事件,下面增加一个点击事件，点击方法后将数据传递到同级的index.vue中</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;div</span><br><span class="line">  class=&quot;relative w-full rounded cursor-zoom-in group&quot;</span><br><span class="line">  :style=&quot;&#123;</span><br><span class="line">    backgroundColor:randomRGB()</span><br><span class="line">  &#125;&quot;</span><br><span class="line">  @click=&#x27;onToPinsClick&#x27;</span><br><span class="line">&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> emits = <span class="title function_">defineEmits</span>([<span class="string">&#x27;click&#x27;</span>])</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 进入详情点击事件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onToPinsClick</span> = (<span class="params"></span>) =&gt;&#123;</span><br><span class="line">  <span class="title function_">emits</span>(<span class="string">&#x27;click&#x27;</span>,&#123;</span><br><span class="line">    <span class="attr">id</span>:props.<span class="property">data</span>.<span class="property">id</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>我们在list&#x2F;index.vue中监听点击事件</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;item-vue :data=&quot;item&quot; :width=&quot;width&quot; @click=&#x27;onToPins&#x27;&gt;&lt;/item-vue&gt;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 进入pins</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onToPins</span> = (<span class="params">item</span>) =&gt;&#123;</span><br><span class="line">  <span class="comment">//修改浏览器的url</span></span><br><span class="line">  history.<span class="title function_">pushState</span>(<span class="literal">null</span>,<span class="literal">null</span>,<span class="string">`/pins/<span class="subst">$&#123;item.id&#125;</span>`</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="12-5-基于GSAP实现高阶路由过渡动画分析"><a href="#12-5-基于GSAP实现高阶路由过渡动画分析" class="headerlink" title="12-5 基于GSAP实现高阶路由过渡动画分析"></a>12-5 基于GSAP实现高阶路由过渡动画分析</h2><p>当url发生变化之后，我们接下来就只需要处理对应的动画就可以了。</p><p>动画的处理我们依赖于GSAP进行实现。对于GSAP而言，主要依赖两个方法：</p><ol><li>gsap.set（）：这个方法通常使用在动画开始之前，表示设置动画开始前的元素属性</li><li>gsap.to（）：这个方法表示<strong>最终元素展示的状态</strong></li></ol><p>GSAP 会基于set 和to的状态，来自动执行中间的补间动画。</p><p>所以我们只需要：</p><ol><li>创建一个对应的组件，使用 transition进行包裹</li><li>计算出set时，组件元素对应的样式属性</li><li>计算出to时，组件元素对应的样式属性</li></ol><p>然后就可以由GSAP自动实现对应的补间动画了。</p><h2 id="12-6-基于GSAP实现高阶路由过渡动画处理"><a href="#12-6-基于GSAP实现高阶路由过渡动画处理" class="headerlink" title="12-6 基于GSAP实现高阶路由过渡动画处理"></a>12-6 基于GSAP实现高阶路由过渡动画处理</h2><ol><li>创建 src&#x2F;views&#x2F;pins&#x2F;index.vue 组件，该组件的作用之后再说</li><li>src&#x2F;views&#x2F;pins&#x2F;components&#x2F;pins.vue 组件，该组件即为详情组件，在该组件中写入一些初始内容</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&#x27;fixed top-0 left-0 w-screen h-screen text-xl</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">  bg-slate-200 z-20&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &#123;&#123;id&#125;&#125;</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="title function_">defineProps</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">id</span>:&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">type</span>:<span class="title class_">String</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">required</span>:<span class="literal">true</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure><ol start="3"><li>在 src&#x2F;views&#x2F;main&#x2F;components&#x2F;list&#x2F;index.vue中使用 pins 组件，并使用 transition 进行包裹，并利用JavaScript钩子绑定对应的三个状态，并添加 css&#x3D;false</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--    响应内容展示--&gt;</span><br><span class="line">    &lt;transition</span><br><span class="line">      :css=&#x27;false&#x27;</span><br><span class="line">      @before-enter=&#x27;beforeEnter&#x27;</span><br><span class="line">      @enter=&#x27;enter&#x27;</span><br><span class="line">      @leaver=&#x27;leave&#x27;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;pins-vue v-if=&#x27;isVisablePins&#x27; :id=&#x27;currentPins.id&#x27;&gt;&lt;/pins-vue&gt;</span><br><span class="line">    &lt;/transition&gt;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//控制pins展示</span></span><br><span class="line"><span class="keyword">const</span> isVisiblePins = <span class="title function_">ref</span>(<span class="literal">false</span>)</span><br><span class="line"><span class="comment">//当前选中的pins属性</span></span><br><span class="line"><span class="keyword">const</span> currentPins = <span class="title function_">ref</span>(&#123;&#125;)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 进入pins</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onToPins</span> = (<span class="params">item</span>) =&gt;&#123;</span><br><span class="line">  <span class="comment">//修改浏览器的url</span></span><br><span class="line">  history.<span class="title function_">pushState</span>(<span class="literal">null</span>,<span class="literal">null</span>,<span class="string">`/pins/<span class="subst">$&#123;item.id&#125;</span>`</span>)</span><br><span class="line">  isVisiblePins.<span class="property">value</span> =<span class="literal">true</span></span><br><span class="line">  currentPins.<span class="property">value</span>=item</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="5"><li>那么此时点击即可展示出对应的pins组件</li></ol><p>接下来我们缺少的就是对应的动画内容了。</p><ol><li>在 src&#x2F;views&#x2F;main&#x2F;components&#x2F;list&#x2F;item.vue中，记录点击时当前 item图片的中心位置，该位置即为动画的起点，此处将使用到useElementBounding方法：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * pins跳转记录,记录图片的中心点(X或Y的位置 + 宽或高一半)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">  <span class="attr">x</span>: imgContainerX,</span><br><span class="line">  <span class="attr">y</span>: imgContainerY,</span><br><span class="line">  <span class="attr">width</span>: imgContainerWidth,</span><br><span class="line">  <span class="attr">height</span>: imgContainerHeight,</span><br><span class="line">&#125; = <span class="title function_">useElementBounding</span>(imgTarget)</span><br><span class="line"><span class="keyword">const</span> imgContainerCenter = <span class="title function_">computed</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">return</span>&#123;</span><br><span class="line">    <span class="attr">translateX</span>:<span class="built_in">parseInt</span>(imgContainerX.<span class="property">value</span>+imgContainerWidth.<span class="property">value</span>/<span class="number">2</span>),</span><br><span class="line">    <span class="attr">translateY</span>:<span class="built_in">parseInt</span>(imgContainerY.<span class="property">value</span>+imgContainerHeight.<span class="property">value</span>/<span class="number">2</span>),</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ol start="2"><li>在onToPinsClick 中，传递计算出的值：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">onToPinsClick</span> = (<span class="params"></span>) =&gt;&#123;</span><br><span class="line">  <span class="title function_">emits</span>(<span class="string">&#x27;click&#x27;</span>,&#123;</span><br><span class="line">    <span class="attr">id</span>:props.<span class="property">data</span>.<span class="property">id</span>,</span><br><span class="line">    <span class="attr">location</span>:imgContainerCenter.<span class="property">value</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>安装GSAP</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i --save gsap@3.9.1</span><br></pre></td></tr></table></figure><ol start="4"><li>在 src&#x2F;views&#x2F;main&#x2F;components&#x2F;list&#x2F;index.vue 中，填充三 transition 子：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">beforeEnter</span> = (<span class="params">el</span>) =&gt;&#123;</span><br><span class="line">  gsap.<span class="title function_">set</span>(el,&#123;</span><br><span class="line">    <span class="attr">scaleX</span>:<span class="number">0</span>,</span><br><span class="line">    <span class="attr">scaleY</span>:<span class="number">0</span>,</span><br><span class="line">    <span class="attr">transformOrigin</span>:<span class="string">&#x27;0 0&#x27;</span>,</span><br><span class="line">    <span class="attr">translateX</span>:currentPins.<span class="property">value</span>.<span class="property">location</span>?.<span class="property">translateX</span>,</span><br><span class="line">    <span class="attr">translateY</span>:currentPins.<span class="property">value</span>.<span class="property">location</span>?.<span class="property">translateY</span>,</span><br><span class="line">    <span class="attr">opacity</span>:<span class="number">0</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">enter</span> =(<span class="params">el,done</span>)=&gt;&#123;</span><br><span class="line">  gsap.<span class="title function_">to</span>(el,&#123;</span><br><span class="line">    <span class="attr">duration</span>:<span class="number">0.3</span>,</span><br><span class="line">    <span class="attr">scaleX</span>:<span class="number">1</span>,</span><br><span class="line">    <span class="attr">scaleY</span>:<span class="number">1</span>,</span><br><span class="line">    <span class="attr">transformOrigin</span>:<span class="string">&#x27;0 0&#x27;</span>,</span><br><span class="line">    <span class="attr">translateX</span>:currentPins.<span class="property">value</span>.<span class="property">location</span>?.<span class="property">translateX</span>,</span><br><span class="line">    <span class="attr">translateY</span>:currentPins.<span class="property">value</span>.<span class="property">location</span>?.<span class="property">translateY</span>,</span><br><span class="line">    <span class="attr">opacity</span>:<span class="number">1</span>,</span><br><span class="line">    <span class="attr">onComplete</span>:done</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">leave</span> =(<span class="params">el,done</span>)=&gt;&#123;</span><br><span class="line">  gsap.<span class="title function_">to</span>(el,&#123;</span><br><span class="line">    <span class="attr">duration</span>:<span class="number">0.3</span>,</span><br><span class="line">    <span class="attr">scaleX</span>:<span class="number">0</span>,</span><br><span class="line">    <span class="attr">scaleY</span>:<span class="number">0</span>,</span><br><span class="line">    <span class="attr">transformOrigin</span>:<span class="string">&#x27;0 0&#x27;</span>,</span><br><span class="line">    <span class="attr">translateX</span>:<span class="number">0</span>,</span><br><span class="line">    <span class="attr">translateY</span>:<span class="number">0</span>,</span><br><span class="line">    <span class="attr">opacity</span>:<span class="number">0</span>,</span><br><span class="line">    <span class="attr">onComplete</span>:done</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="5"><li>这个时候leave的状态还看不了，我们再从这里添加一个监听浏览器后退的事件，就可以了</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 监听浏览器后退按钮事件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">useEventListener</span>(<span class="variable language_">window</span>,<span class="string">&#x27;popstate&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  isVisiblePins.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="12-7-通用组件：navbar构建方案分析"><a href="#12-7-通用组件：navbar构建方案分析" class="headerlink" title="12-7 通用组件：navbar构建方案分析"></a>12-7 通用组件：navbar构建方案分析</h2><p>那么接下来我们就需要处理pins中对应的页面样式了。</p><p>pins的页面样式同时可以应用到PC端 和移动端。而在移动端中，则会展示对应的navbar 的内容，所以我们首先先构建出 navbar 通用组件，然后在基于navbar 构建对应的pins样式。</p><p>那么对于navbar而言：</p><ol><li>它分为左、中、右三个大的部分，三个部分都可以通过插槽进行指定</li><li>左、右两边的插槽可以自定义点击事件</li><li>同时navbar 有时候会存在吸顶的效果，所以我们最好还可以通过一个prop指定对应的吸顶展示</li></ol><h2 id="12-8-通用组件：构建navbar"><a href="#12-8-通用组件：构建navbar" class="headerlink" title="12-8 通用组件：构建navbar"></a>12-8 通用组件：构建navbar</h2><ol><li>创建组件lib&#x2F;navbar&#x2F;index.vue</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    class=&#x27;w-full h-5 border-b flex items-center z-10 bg-white</span><br><span class="line">    dark:bg-zinc-800 border-b-zinc-200 dark:border-b-zinc-700&#x27;</span><br><span class="line">    :class=&quot;[sticky?&#x27;sticky top-0 left-0&#x27;:&#x27;relative&#x27;]&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;!--左--&gt;</span><br><span class="line">    &lt;div class=&#x27;h-full w-5 absolute left-0 flex items-center justify-center&#x27;</span><br><span class="line">    @click=&#x27;onClickLeft&#x27;&gt;</span><br><span class="line">      &lt;slot name=&#x27;left&#x27;&gt;</span><br><span class="line">        &lt;m-svg-icon</span><br><span class="line">          name=&#x27;back&#x27;</span><br><span class="line">          class=&#x27;w-2 h-2&#x27;</span><br><span class="line">          fillClass=&#x27;fill-zinc-900 dark:fill-zinc-200&#x27;</span><br><span class="line">        &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">      &lt;/slot&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!--中--&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      class=&#x27;h-full flex items-center justify-center m-auto font-bold</span><br><span class="line">      text-base text-zinc-900 dark:text-zinc-200&#x27;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;slot/&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!--右--&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      class=&#x27;h-full w-5 absolute right-0 flex items-center justify-center&#x27;</span><br><span class="line">      @click=&#x27;onClickRight&#x27;&gt;</span><br><span class="line">      &lt;slot name=&#x27;right&#x27;/&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; useRouter &#125; from &#x27;vue-router&#x27;</span><br><span class="line"></span><br><span class="line">const props = defineProps(&#123;</span><br><span class="line">  //左边按钮的点击</span><br><span class="line">  clickLeft:Function,</span><br><span class="line">  //右边按钮的点击</span><br><span class="line">  clickRight:Function,</span><br><span class="line">  //是否吸顶</span><br><span class="line">  sticky:Boolean</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">const router = useRouter()</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 左侧按钮点击时间</span><br><span class="line"> */</span><br><span class="line">const onClickLeft = ()=&gt;&#123;</span><br><span class="line">  if (props.clickLeft)&#123;</span><br><span class="line">    props.clickLeft()</span><br><span class="line">    return</span><br><span class="line">  &#125;</span><br><span class="line">  router.back()</span><br><span class="line">&#125;</span><br><span class="line">/**</span><br><span class="line"> * 右侧按钮点击时间</span><br><span class="line"> */</span><br><span class="line">const onClickRight = ()=&gt;&#123;</span><br><span class="line">  if (props.clickRight)&#123;</span><br><span class="line">    props.clickRight()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><ol start="2"><li>在views&#x2F;pins&#x2F;components&#x2F;pins.vue中使用</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&#x27;fixed top-0 left-0 w-screen h-screen text-xl</span><br><span class="line">  bg-slate-200 z-20&#x27;&gt;</span><br><span class="line">    &#123;&#123;id&#125;&#125;</span><br><span class="line">    &lt;m-navbar&gt;测试&lt;/m-navbar&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h2 id="12-9-基于navbar处理响应式的pins页面"><a href="#12-9-基于navbar处理响应式的pins页面" class="headerlink" title="12-9 基于navbar处理响应式的pins页面"></a>12-9 基于navbar处理响应式的pins页面</h2><ol><li>我们创建接口方法api&#x2F;pexels.js</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取指定图片数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getPexelsFromId</span> = (<span class="params">id</span>) =&gt;&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>:<span class="string">`/pexels/<span class="subst">$&#123;id&#125;</span>`</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>其次在views&#x2F;pins&#x2F;components&#x2F;pins.vue中获取数据</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pexelData = <span class="title function_">ref</span>(&#123;&#125;)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getPexlesData</span> = <span class="keyword">async</span> (<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">getPexelsFromId</span>(props.<span class="property">id</span>)</span><br><span class="line">  pexelData.<span class="property">value</span>=data</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">getPexlesData</span>()</span><br></pre></td></tr></table></figure><ol start="3"><li>在tailwind.config.js中添加阴影样式</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">backdropBlur</span>:&#123;</span><br><span class="line">  <span class="string">&#x27;4xl&#x27;</span>:<span class="string">&#x27;240px&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>在views&#x2F;pins&#x2F;components&#x2F;pins.vue中写</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&#x27;fixed top-0 left-0 w-screen h-screen text-xl z-20</span><br><span class="line">  backdrop-blur-4xl bg-transparent pb-2 overflow-y-auto xl:p-2&#x27;&gt;</span><br><span class="line">    &lt;!--移动端下的navbar--&gt;</span><br><span class="line">    &lt;m-navbar v-if=&#x27;isMobileTerminal&#x27; sticky&gt;</span><br><span class="line">      &#123;&#123;pexelData.title&#125;&#125;</span><br><span class="line">      &lt;template #right&gt;</span><br><span class="line">        &lt;m-svg-icon</span><br><span class="line">          name=&#x27;share&#x27;</span><br><span class="line">          class=&#x27;w-3 h-3&#x27;</span><br><span class="line">          fillClass=&#x27;fill-zinc-900 dark:fill-zinc-200 rounded-sm&#x27;</span><br><span class="line">        &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/m-navbar&gt;</span><br><span class="line">    &lt;!--PC端--&gt;</span><br><span class="line">    &lt;m-svg-icon</span><br><span class="line">      v-else</span><br><span class="line">      name=&#x27;close&#x27;</span><br><span class="line">      class=&#x27;w-3 h-3 ml-1 p-0.5 cursor-pointer duration-200 rounded-sm</span><br><span class="line">      hover:bg-zinc-100 absolute right-2 top-2&#x27;</span><br><span class="line">      fillClass=&#x27;fill-zinc-400&#x27;</span><br><span class="line">      @click=&#x27;onPop&#x27;</span><br><span class="line">    &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">    &lt;!--内容区--&gt;</span><br><span class="line">    &lt;div </span><br><span class="line">         v-if=&#x27;pexelData.title&#x27;</span><br><span class="line">         class=&#x27;xl:w-[80%] xl:h-full xl:mx-auto xl:rounded-lg xl:flex&#x27;&gt;</span><br><span class="line">      &lt;img</span><br><span class="line">        class=&#x27;w-screen mb-2 xl:w-3/5 xl:h-full xl:rounded-tl-lg</span><br><span class="line">        xl:rounded-bl-lg&#x27;</span><br><span class="line">        :src=&#x27;pexelData.photo&#x27;</span><br><span class="line">        alt=&#x27;&#x27;</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class=&#x27;xl:w-2/5 xl:h-full xl:bg-whiter xl:dark:bg-zinc-900</span><br><span class="line">        xl:rounded-tr-lg xl:rounded-tb-lg xl:p-3&#x27;</span><br><span class="line">      &gt;</span><br><span class="line">&lt;!--        PC下：收藏、分享--&gt;</span><br><span class="line">        &lt;div v-if=&#x27;!isMobileTerminal&#x27; class=&#x27;flex justify-between mb-2&#x27;&gt;</span><br><span class="line">&lt;!--          分享--&gt;</span><br><span class="line">          &lt;m-svg-icon</span><br><span class="line">            name=&#x27;share&#x27;</span><br><span class="line">            class=&#x27;w-4 h-4 p-1 cursor-pointer hover:bg-zinc-200</span><br><span class="line">            dark:hover-zinc-800 duration-300 rounded&#x27;</span><br><span class="line">          &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">&lt;!--          收藏--&gt;</span><br><span class="line">          &lt;m-button</span><br><span class="line">            type=&#x27;info&#x27;</span><br><span class="line">            icon=&#x27;heart&#x27;</span><br><span class="line">            iconClass=&#x27;fill-zinc-900 dark:fill-zinc-200&#x27;</span><br><span class="line">          &gt;&lt;/m-button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">&lt;!--        标题--&gt;</span><br><span class="line">        &lt;p</span><br><span class="line">          class=&#x27;text-base text-zinc-900 dark:text-zinc-200 ml-1 font-bold</span><br><span class="line">          xl:text-xl xl:mb-5&#x27;</span><br><span class="line">        &gt;</span><br><span class="line">          &#123;&#123;pexelData.title&#125;&#125;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">&lt;!--        作者--&gt;</span><br><span class="line">        &lt;div class=&#x27;flex items-center mt-1 px-1&#x27;&gt;</span><br><span class="line">          &lt;img</span><br><span class="line">            v-lazy</span><br><span class="line">            class=&#x27;h-3 w-3 rounded-full&#x27;</span><br><span class="line">            :src=&#x27;pexelData.avatar&#x27;</span><br><span class="line">            alt=&#x27;&#x27;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;span class=&#x27;text-base text-zinc-900 dark:text-zinc-200 ml-1&#x27;&gt;</span><br><span class="line">            &#123;&#123;pexelData.author&#125;&#125;</span><br><span class="line">          &lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getPexelsFromId &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/pexeis&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;isMobileTerminal&#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/flexible&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useRouter &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> props = <span class="title function_">defineProps</span>(&#123;</span><br><span class="line">  <span class="attr">id</span>:&#123;</span><br><span class="line">    <span class="attr">type</span>:<span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">required</span>:<span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">useRouter</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 关闭</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onPop</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  router.<span class="title function_">back</span>()</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h2 id="12-10-处理刷新空白问题"><a href="#12-10-处理刷新空白问题" class="headerlink" title="12-10 处理刷新空白问题"></a>12-10 处理刷新空白问题</h2><ol><li>我们需要解决的就是一刷新上面的url就发生了变化，接下来进行处理，首先新增view&#x2F;pins&#x2F;index.vue</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&#x27;w-full h-full bg-zinc-200 dark:bg-zinc-800&#x27;&gt;</span><br><span class="line">    &lt;pins-vue :id=&#x27;$router.params.id&#x27;/&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import pinsVue from &#x27;./components/pins.vue&#x27;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><ol start="2"><li>其次在router&#x2F;modules&#x2F;pc-router.js和mobile-router.js增加同级路由</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;/pins/:id&#x27;</span>,</span><br><span class="line">  <span class="attr">name</span>:<span class="string">&#x27;pins&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>:<span class="function">()=&gt;</span><span class="title function_">import</span>(<span class="string">&#x27;@/view/pins/index.vue&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="13、人类行为验证处理方案-——-脱离UI组件库实现登录、注册-表单校验"><a href="#13、人类行为验证处理方案-——-脱离UI组件库实现登录、注册-表单校验" class="headerlink" title="13、人类行为验证处理方案 —— 脱离UI组件库实现登录、注册+表单校验"></a>13、人类行为验证处理方案 —— 脱离UI组件库实现登录、注册+表单校验</h1><p>难道你的登录注册只能依靠 UI 组件库实现吗？你的登录安全吗？如果有机器进行登录验证怎么办？进入本章带你脱离组件库，实现包含人类行为认证的登录、注册、表单校验功能。</p><hr><h2 id="13-1-前言"><a href="#13-1-前言" class="headerlink" title="13-1 前言"></a>13-1 前言</h2><p>说起登录、注册 模块，相信对于大家而言，肯定都是不阳生的。看定有很多同学一看这标题就说，这个有啥可讲的，不就是一个：</p><ol><li>调接口</li><li>拿token</li><li>存 token的过程吗？</li></ol><p>是的！</p><h2 id="13-2-构建登录模块基础UI结构"><a href="#13-2-构建登录模块基础UI结构" class="headerlink" title="13-2 构建登录模块基础UI结构"></a>13-2 构建登录模块基础UI结构</h2><p>本小节我们先去构建login登录业务的基础UI结构</p><ol><li>在src&#x2F;views&#x2F;layout&#x2F;components&#x2F;header&#x2F;header-my，vue 中新增-个 登录按钮</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">  &lt;template #reference&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        v-if=&#x27;false&#x27;</span><br><span class="line">     ...</span><br><span class="line">      &gt;</span><br><span class="line">    ...</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div v-else&gt;</span><br><span class="line">        &lt;m-button</span><br><span class="line">          class=&#x27;guide-my&#x27;</span><br><span class="line">          icon=&#x27;profile&#x27;</span><br><span class="line">          iconColor=&#x27;#fff&#x27;</span><br><span class="line">          @click=&#x27;onToLogin&#x27;</span><br><span class="line">        &gt;&lt;/m-button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">&lt;!--气泡--&gt;</span><br><span class="line">    &lt;div v-if=&#x27;false&#x27; &gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; useRouter &#125; from &#x27;vue-router&#x27;</span><br><span class="line"></span><br><span class="line">const router = useRouter()</span><br><span class="line">/**</span><br><span class="line"> * 登陆按钮点击事件</span><br><span class="line"> */</span><br><span class="line">const onToLogin = ()=&gt;&#123;</span><br><span class="line">  router.push(&#x27;/login&#x27;)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><ol start="2"><li>分别构建PC端下和移动端下对应的路由：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;/login&#x27;</span>,</span><br><span class="line">  <span class="attr">name</span>:<span class="string">&#x27;login&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>:<span class="function">()=&gt;</span><span class="title function_">import</span>(<span class="string">&#x27;@/view/login-register/login/index.vue&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li><p>创建 src&#x2F;views&#x2F;login-register&#x2F;login&#x2F;index.vue组件为登录组件</p></li><li><p>构建对应基础样式</p></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;1、全新的项目构建方案-——-vite&quot;&gt;&lt;a href=&quot;#1、全新的项目构建方案-——-vite&quot; class=&quot;headerlink&quot; title=&quot;1、全新的项目构建方案 —— vite&quot;&gt;&lt;/a&gt;1、全新的项目构建方案 —— vite&lt;/h1&gt;&lt;p&gt;vi</summary>
      
    
    
    
    
    <category term="Vue3" scheme="http://example.com/tags/Vue3/"/>
    
  </entry>
  
  <entry>
    <title>MyBatis 面试题之#{}和$ {}的区别是什么？</title>
    <link href="http://example.com/2022/09/26/MyBatis-%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B9%8B-%E5%92%8C-%E7%9A%84%E5%8C%BA%E5%88%AB%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F/"/>
    <id>http://example.com/2022/09/26/MyBatis-%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B9%8B-%E5%92%8C-%E7%9A%84%E5%8C%BA%E5%88%AB%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F/</id>
    <published>2022-09-26T09:20:09.000Z</published>
    <updated>2022-09-26T09:25:15.291Z</updated>
    
    <content type="html"><![CDATA[<ul><li>#{}是预编译处理，$ {}是字符串替换。 </li><li>Mybatis 在处理#{}时，会将 sql 中的#{}替换为?号，调用 PreparedStatement 的 set 方法来赋值； </li><li>Mybatis 在处理$ {}时，就是把${}替换成变量的值。 </li><li>使用#{}可以有效的防止 SQL 注入，提高系统安全性。</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;ul&gt;
&lt;li&gt;#{}是预编译处理，$ {}是字符串替换。 &lt;/li&gt;
&lt;li&gt;Mybatis 在处理#{}时，会将 sql 中的#{}替换为?号，调用 PreparedStatement 的 set 方法来赋值； &lt;/li&gt;
&lt;li&gt;Mybatis 在处理$ {}时，就是把$</summary>
      
    
    
    
    
    <category term="MyBatis 面试题" scheme="http://example.com/tags/MyBatis-%E9%9D%A2%E8%AF%95%E9%A2%98/"/>
    
  </entry>
  
  <entry>
    <title>MyBatis 面试题之MyBatis 与 Hibernate 有哪些不同？</title>
    <link href="http://example.com/2022/09/26/MyBatis-%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B9%8BMyBatis-%E4%B8%8E-Hibernate-%E6%9C%89%E5%93%AA%E4%BA%9B%E4%B8%8D%E5%90%8C%EF%BC%9F/"/>
    <id>http://example.com/2022/09/26/MyBatis-%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B9%8BMyBatis-%E4%B8%8E-Hibernate-%E6%9C%89%E5%93%AA%E4%BA%9B%E4%B8%8D%E5%90%8C%EF%BC%9F/</id>
    <published>2022-09-26T09:03:36.000Z</published>
    <updated>2022-09-26T09:10:19.798Z</updated>
    
    <content type="html"><![CDATA[<p>1、Mybatis 和 hibernate 不同，它不完全是一个ORM 框架，因为 MyBatis 需要程序员自己编写Sql 语句。</p><p> 2、Mybatis 直接编写原生态 sql，可以严格控制 sql 执行性能，灵活度高，非常适合对关系数据模型要求不高的软件开发，因为这类软件需求变化频繁，一但需求变化要求迅速输出成果。但是灵活的前提是 mybatis 无法做到数据库无关性， 如果需要实现支持多种数据库的软件，则需要自定义多套sql映射文件，工作量大。 </p><p>3、Hibernate 对象&#x2F;关系映射能力强，数据库无关性好，对于关系模型要求高的软件，如果用hibernate开发可以节省很多代码，提高效率。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;1、Mybatis 和 hibernate 不同，它不完全是一个ORM 框架，因为 MyBatis 需要程序员自己编写Sql 语句。&lt;/p&gt;
&lt;p&gt; 2、Mybatis 直接编写原生态 sql，可以严格控制 sql 执行性能，灵活度高，非常适合对关系数据模型要求不高的软件开</summary>
      
    
    
    
    
    <category term="MyBatis 面试题" scheme="http://example.com/tags/MyBatis-%E9%9D%A2%E8%AF%95%E9%A2%98/"/>
    
  </entry>
  
  <entry>
    <title>MyBatis 面试题之什么是 Mybatis？</title>
    <link href="http://example.com/2022/09/26/MyBatis-%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B9%8B%E4%BB%80%E4%B9%88%E6%98%AF-Mybatis%EF%BC%9F/"/>
    <id>http://example.com/2022/09/26/MyBatis-%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B9%8B%E4%BB%80%E4%B9%88%E6%98%AF-Mybatis%EF%BC%9F/</id>
    <published>2022-09-26T07:42:09.000Z</published>
    <updated>2022-09-26T08:03:24.292Z</updated>
    
    <content type="html"><![CDATA[<ul><li>MyBatis是一个半ORM（对象关系映射）框架，它内部封装了JDBC，<strong>开发时只需要关注SQL语句本身</strong>，不需要花费精力去处理加载驱动、创建连接、创建statement等繁杂的过程。程序员直接编写原生态sql，可以严格控制sql执行性能，灵活性高。</li><li><strong>MyBatis可以使用XML或注解来配置和映射原生信息</strong>，将POJO映射成数据库中的记录，避免了几乎所有的JDBC代码和手动设置参数及获取结果集。</li><li>通过xml文件或者注解的方式将要执行的各种statement配置起来，并通过java对象和statement中的sql的动态参数进行映射生成最终执行的sql语句，<strong>最后由mybatis框架执行sql并将结果映射为java对象并返回。</strong>（从sql执行到返回result的过程）。</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;ul&gt;
&lt;li&gt;MyBatis是一个半ORM（对象关系映射）框架，它内部封装了JDBC，&lt;strong&gt;开发时只需要关注SQL语句本身&lt;/strong&gt;，不需要花费精力去处理加载驱动、创建连接、创建statement等繁杂的过程。程序员直接编写原生态sql，可以严格控制sql执</summary>
      
    
    
    
    
    <category term="MyBatis 面试题" scheme="http://example.com/tags/MyBatis-%E9%9D%A2%E8%AF%95%E9%A2%98/"/>
    
  </entry>
  
  <entry>
    <title>动态规划系列之凑零钱问题</title>
    <link href="http://example.com/2022/09/06/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E7%B3%BB%E5%88%97%E4%B9%8B%E5%87%91%E9%9B%B6%E9%92%B1%E9%97%AE%E9%A2%98/"/>
    <id>http://example.com/2022/09/06/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E7%B3%BB%E5%88%97%E4%B9%8B%E5%87%91%E9%9B%B6%E9%92%B1%E9%97%AE%E9%A2%98/</id>
    <published>2022-09-06T01:24:13.000Z</published>
    <updated>2022-09-06T02:58:50.060Z</updated>
    
    <content type="html"><![CDATA[<h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>给你 k 种面值的硬币，面值分别为 c1, c2 … ck ，每种硬币的数量无限，再给一个总金额 amount ，问你最少需要几枚硬币凑出这个金额，如果不可能凑出，算法返回 -1 。</p><p>比如说 k &#x3D; 3 ，面值分别为 1，2，5，总金额 amount &#x3D; 11 。那么最少 需要 3 枚硬币凑出，即 11 &#x3D; 5 + 5 + 1。</p><h2 id="暴力递归"><a href="#暴力递归" class="headerlink" title="暴力递归"></a>暴力递归</h2><p>首先，这个问题是动态规划问题，因为它具有<strong>「最优子结构」</strong>的。要符 合「最优子结构」，<strong>子问题间必须互相独立</strong>。</p><p>比如你想求 amount &#x3D; 11 时的最少硬币数（原问题），如果你知道凑出 amount &#x3D; 10 的最少硬币数（子问题），你只需要把子问题的答案加一（再选一枚面值为 1 的硬币）就是原问题的答案，因为硬币的数量是没有限制的，子问题之间没有相互制，是互相独立的。</p><blockquote><p>如何列出正确的状态转移方程？</p></blockquote><ul><li>先确定<strong>「状态」</strong>，也就是原问题和子问题中变化的变量。由于硬币数量 无限，所以唯一的状态就是目标金额&#x3D;&#x3D;amount&#x3D;&#x3D; 。</li><li>然后确定&#x3D;&#x3D;dp&#x3D;&#x3D;函数的定义：当前的目标金额是 n ，至少需要 <strong>dp(n)</strong> 个硬币凑出该金额。</li><li>然后确定<strong>「选择」</strong>并择优，无论当的目标金额是多少，选择就是 从面额列表 &#x3D;&#x3D;coins&#x3D;&#x3D;中选择一个硬币，然后目标金额就会减少：</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 伪码框架</span><br><span class="line">def <span class="title function_">coinChange</span><span class="params">(coins: List[<span class="type">int</span>], amount: <span class="type">int</span>)</span>: </span><br><span class="line">    # 定义：要凑出金额 n，至少要 dp(n) 个硬币</span><br><span class="line">    def <span class="title function_">dp</span><span class="params">(n)</span>:</span><br><span class="line">        # 做选择，选择需要硬币最少的那个结果</span><br><span class="line">        <span class="keyword">for</span> coin in coins:</span><br><span class="line">            res = min(res, <span class="number">1</span> + dp(n - coin)) </span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">    # 我们要求的问题是 dp(amount)</span><br><span class="line">    <span class="keyword">return</span> dp(amount)</span><br></pre></td></tr></table></figure><p>最后明确 base case，显然目标金额为 0 时，所需硬币数量为 0；当目标金额小于 0 时，无解，返回 -1：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">def <span class="title function_">coinChange</span><span class="params">(coins: List[<span class="type">int</span>], amount: <span class="type">int</span>)</span>:</span><br><span class="line">    def <span class="title function_">dp</span><span class="params">(n)</span>:</span><br><span class="line">        # base <span class="keyword">case</span></span><br><span class="line">        <span class="type">if</span> <span class="variable">n</span> <span class="operator">=</span>= <span class="number">0</span>: <span class="keyword">return</span> <span class="number">0</span> </span><br><span class="line">        <span class="keyword">if</span> n &lt; <span class="number">0</span>: <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line">        # 求最小值，所以初始化为正无穷</span><br><span class="line">        res = <span class="type">float</span>(<span class="string">&#x27;INF&#x27;</span>) </span><br><span class="line">        <span class="keyword">for</span> coin in coins: </span><br><span class="line">            subproblem = dp(n - coin)</span><br><span class="line">            # 子问题无解，跳过</span><br><span class="line">            <span class="type">if</span> <span class="variable">subproblem</span> <span class="operator">=</span>= -<span class="number">1</span>: <span class="type">continue</span> </span><br><span class="line">            <span class="variable">res</span> <span class="operator">=</span> min(res, <span class="number">1</span> + subproblem)</span><br><span class="line">        <span class="keyword">return</span> res <span class="keyword">if</span> res != <span class="type">float</span>(<span class="string">&#x27;INF&#x27;</span>) <span class="keyword">else</span> -<span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> dp(amount)</span><br></pre></td></tr></table></figure><p>以上代码的数学形式就是状态转移方程：</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220906101913197.png"                      alt="image-20220906101913197"                ></p><p>至此，这个问题其实就解决了，只不过需要消除一下重叠子问题，比如 amount &#x3D; 11, coins &#x3D; {1,2,5} 时画出递归树看看：</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220906102037214.png"                      alt="image-20220906102037214"                ></p><p>时间复杂度分析：子问题总数 x 每个子问题的时间.</p><p>子问题总数为递归树节点个数，这个比较难看出来，是O(n^k)，总之是 指数级别的。每个子问题中含有一个 for 循环，复杂度为O(k)。所以总 时间复杂度为 O(k * n^k)，指数级别。</p><h2 id="带备忘录的递归"><a href="#带备忘录的递归" class="headerlink" title="带备忘录的递归"></a>带备忘录的递归</h2><p>只需要稍加修改，就可以通过备忘录消除子问题：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">def <span class="title function_">coinChange</span><span class="params">(coins: List[<span class="type">int</span>], amount: <span class="type">int</span>)</span>: </span><br><span class="line">    # 备忘录</span><br><span class="line">    memo = dict()</span><br><span class="line">    def <span class="title function_">dp</span><span class="params">(n)</span>:</span><br><span class="line">        # 查备忘录，避免重复计算</span><br><span class="line">        <span class="keyword">if</span> n in memo: <span class="keyword">return</span> memo[n]</span><br><span class="line">        <span class="type">if</span> <span class="variable">n</span> <span class="operator">=</span>= <span class="number">0</span>: <span class="keyword">return</span> <span class="number">0</span> </span><br><span class="line">        <span class="keyword">if</span> n &lt; <span class="number">0</span>: <span class="keyword">return</span> -<span class="number">1</span> </span><br><span class="line">        res = <span class="type">float</span>(<span class="string">&#x27;INF&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> coin in coins: </span><br><span class="line">            subproblem = dp(n - coin) </span><br><span class="line">            <span class="type">if</span> <span class="variable">subproblem</span> <span class="operator">=</span>= -<span class="number">1</span>: <span class="type">continue</span> </span><br><span class="line">            <span class="variable">res</span> <span class="operator">=</span> min(res, <span class="number">1</span> + subproblem)</span><br><span class="line">        # 记入备忘录</span><br><span class="line">        memo[n] = res <span class="keyword">if</span> res != <span class="type">float</span>(<span class="string">&#x27;INF&#x27;</span>) <span class="keyword">else</span> -<span class="number">1</span> </span><br><span class="line">        <span class="keyword">return</span> memo[n]                </span><br><span class="line">    <span class="keyword">return</span> dp(amount)</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;题目&quot;&gt;&lt;a href=&quot;#题目&quot; class=&quot;headerlink&quot; title=&quot;题目&quot;&gt;&lt;/a&gt;题目&lt;/h2&gt;&lt;p&gt;给你 k 种面值的硬币，面值分别为 c1, c2 … ck ，每种硬币的数量无限，再给一个总金额 amount ，问你最少需要几枚硬币凑出这</summary>
      
    
    
    
    
    <category term="动态规划系列" scheme="http://example.com/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E7%B3%BB%E5%88%97/"/>
    
  </entry>
  
  <entry>
    <title>MongoDB之索引</title>
    <link href="http://example.com/2022/08/30/MongoDB%E4%B9%8B%E7%B4%A2%E5%BC%95/"/>
    <id>http://example.com/2022/08/30/MongoDB%E4%B9%8B%E7%B4%A2%E5%BC%95/</id>
    <published>2022-08-30T01:51:56.000Z</published>
    <updated>2022-08-30T03:13:13.028Z</updated>
    
    <content type="html"><![CDATA[<h2 id="索引介绍"><a href="#索引介绍" class="headerlink" title="索引介绍"></a>索引介绍</h2><p>索引是一种用来快速查询数据的数据结构。B+Tree就是一种常用的数据库索引数据结构，MongoDB 采用B+Tree 做索引，索引创建在colletions上。MongoDB不使用索引的查询，先扫描所有的文档，再匹配符合条件的文档。 使用索引的查询，通过索引找到文档，使用索引能够极大的提升查询效率。</p><h3 id="MongoDB索引数据结构"><a href="#MongoDB索引数据结构" class="headerlink" title="MongoDB索引数据结构"></a>MongoDB索引数据结构</h3><blockquote><p>思考：MongoDB索引数据结构是B-Tree还是B+Tree? </p></blockquote><p>B-Tree说法来源于官方文档，然后就导致了分歧：有人说MongoDB索引数据结构使用的是B-Tree,有的 人又说是B+Tree。</p><ul><li>MongoDB官方文档：<a class="link"   href="https://docs.mongodb.com/manual/indexes/" >https://docs.mongodb.com/manual/indexes/<i class="fas fa-external-link-alt"></i></a></li><li>MongoDB indexes use a B-tree data structure.</li></ul><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220830095354722.png"                      alt="image-20220830095354722"                ></p><blockquote><p>WiredTiger官方文档：<a class="link"   href="https://source.wiredtiger.com/3.0.0/tune_page_size_and_comp.html" >https://source.wiredtiger.com/3.0.0/tune_page_size_and_comp.html<i class="fas fa-external-link-alt"></i></a> </p><p>WiredTiger maintains a table’s data in memory using a data structure called a B-Tree ( B+ Tree to be specific), referring to the nodes of a B-Tree as pages. Internal pages carry only keys. The leaf pages store both keys and values.</p></blockquote><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220830095416553.png"                      alt="image-20220830095416553"                ></p><p>参考数据结构网站：<a class="link"   href="https://www.cs.usfca.edu/~galles/visualization/Algorithms.html" >https://www.cs.usfca.edu/~galles/visualization/Algorithms.html<i class="fas fa-external-link-alt"></i></a></p><h3 id="索引的分类"><a href="#索引的分类" class="headerlink" title="索引的分类"></a>索引的分类</h3><ul><li>按照索引包含的字段数量，可以分为单键索引和组合索引（或复合索引）。 </li><li>按照索引字段的类型，可以分为主键索引和非主键索引。 </li><li>按照索引节点与物理记录的对应方式来分，可以分为聚簇索引和非聚簇索引，其中聚簇索引是指索引节点上直接包含了数据记录，而后者则仅仅包含一个指向数据记录的指针。 </li><li>按照索引的特性不同，又可以分为唯一索引、稀疏索引、文本索引、地理空间索引等</li></ul><p>与大多数数据库一样，MongoDB支持各种丰富的索引类型，包括单键索引、复合索引，唯一索引等一 些常用的结构。由于采用了灵活可变的文档类型，因此它也同样支持对嵌套字段、数组进行索引。通过建立合适的索引，我们可以极大地提升数据的检索速度。在一些特殊应用场景，MongoDB还支持地理 空间索引、文本检索索引、TTL索引等不同的特性。</p><h2 id="索引操作"><a href="#索引操作" class="headerlink" title="索引操作"></a>索引操作</h2><h3 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h3><blockquote><p>创建索引语法格式</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.createIndex(keys, options)</span><br></pre></td></tr></table></figure><ul><li>Key 值为你要创建的索引字段，1 按升序创建索引， -1  按降序创建索引</li><li>可选参数列表如下：</li></ul><table><thead><tr><th>Parameter</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>background</td><td>Boolean</td><td>建索引过程会阻塞其它数据库操作，background可指定以后台方式创建索引，即增加 “background” 可选参数。 “background” 默认值为false。</td></tr><tr><td>unique</td><td>Boolean</td><td>建立的索引是否唯一。指定为true创建唯一索引。默认值为false.</td></tr><tr><td>name</td><td>string</td><td>索引的名称。如果未指定，MongoDB的通过连接索引的字段名和排序顺序生成一个索引名称。</td></tr><tr><td>dropDups</td><td>Boolean</td><td>3.0+版本已废弃。在建立唯一索引时是否删除重复记录,指定 true 创建唯一索引。默认值为 false.</td></tr><tr><td>sparse</td><td>Boolean</td><td>对文档中不存在的字段数据不启用索引；这个参数需要特别注意，如果设置为true的话，在索引字段中不会查询出不包含对应字段的文档.。默认值为 false.</td></tr><tr><td>expireAfterSeconds</td><td>integer</td><td>指定一个以秒为单位的数值，完成 TTL设定，设定集 合的生存时间。</td></tr><tr><td>v</td><td>index version</td><td>索引的版本号。默认的索引版本取决于mongod创建 索引时运行的版本。</td></tr><tr><td>weights</td><td>document</td><td>索引权重值，数值在 1 到 99,999 之间，表示该索引 相对于其他索引字段的得分权重。</td></tr><tr><td>default_language</td><td>string</td><td>对于文本索引，该参数决定了停用词及词干和词器的 规则的列表。 默认为英语</td></tr><tr><td>language_override</td><td>string</td><td>对于文本索引，该参数指定了包含在文档中的字段 名，语言覆盖默认的language，默认值为 language.</td></tr></tbody></table><p>注意：3.0.0 版本前创建索引方法为 db.collection.ensureIndex()</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建索引后台执行</span></span><br><span class="line">db.values.createIndex(&#123;open: 1, close: 1&#125;, &#123;background: <span class="literal">true</span>&#125;)</span><br><span class="line"><span class="comment"># 创建唯一索引</span></span><br><span class="line">db.values.createIndex(&#123;title:1&#125;,&#123;unique:<span class="literal">true</span>&#125;)</span><br></pre></td></tr></table></figure><h3 id="查看索引"><a href="#查看索引" class="headerlink" title="查看索引"></a>查看索引</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看索引信息 </span></span><br><span class="line">db.books.getIndexes() </span><br><span class="line"><span class="comment">#查看索引键 </span></span><br><span class="line">db.books.getIndexKeys()</span><br></pre></td></tr></table></figure><blockquote><p>查看索引占用空间</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.totalIndexSize([is_detail])</span><br></pre></td></tr></table></figure><p>is_detail：可选参数，传入除0或false外的任意数据，都会显示该集合中每个索引的大小及总大小。如果传入0或false则只显示该集合中所有索引的总大小。默认值为false。</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220830100537937.png"                      alt="image-20220830100537937"                ></p><h3 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a>删除索引</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#删除集合指定索引</span></span><br><span class="line">db.col.dropIndex(<span class="string">&quot;索引名称&quot;</span>)</span><br><span class="line"><span class="comment">#删除集合所有索引</span></span><br><span class="line">db.col.dropIndexes()</span><br></pre></td></tr></table></figure><h2 id="索引类型"><a href="#索引类型" class="headerlink" title="索引类型"></a>索引类型</h2><h3 id="单键索引（Single-Field-Indexes）"><a href="#单键索引（Single-Field-Indexes）" class="headerlink" title="单键索引（Single Field Indexes）"></a>单键索引（Single Field Indexes）</h3><p>在某一个特定的字段上建立索引 mongoDB在ID上建立了唯一的单键索引,所以经常会使用id来进行查询； 在索引字段上进行精确匹配、排序以及范围查找都会使用此索引</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220830100852763.png"                      alt="image-20220830100852763"                ></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.books.createIndex(&#123;title:1&#125;)</span><br></pre></td></tr></table></figure><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220830100913784.png"                      alt="image-20220830100913784"                ></p><blockquote><p>对内嵌文档字段创建索引</p></blockquote><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220830100944904.png"                      alt="image-20220830100944904"                ></p><h3 id="复合索引（Compound-Index）"><a href="#复合索引（Compound-Index）" class="headerlink" title="复合索引（Compound Index）"></a>复合索引（Compound Index）</h3><p>复合索引是多个字段组合而成的索引，其性质和单字段索引类似。但不同的是，复合索引中字段的顺序、字段的升降序对查询性能有直接的影响，因此在设计复合索引时则需要考虑不同的查询场景。</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220830102152170.png"                      alt="image-20220830102152170"                ></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.books.createIndex(&#123;<span class="built_in">type</span>:1,favCount:1&#125;)</span><br></pre></td></tr></table></figure><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220830102245434.png"                      alt="image-20220830102245434"                ></p><h3 id="多键索引（Multikey-Index）"><a href="#多键索引（Multikey-Index）" class="headerlink" title="多键索引（Multikey Index）"></a>多键索引（Multikey Index）</h3><p>在数组的属性上建立索引。针对这个数组的任意值的查询都会定位到这个文档,既多个索引入口或者键值引用同一个文档</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220830102330508.png"                      alt="image-20220830102330508"                ></p><blockquote><p>准备inventory集合</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.inventory.insertMany([</span><br><span class="line">&#123; _id: 5, <span class="built_in">type</span>: <span class="string">&quot;food&quot;</span>, item: <span class="string">&quot;aaa&quot;</span>, ratings: [ 5, 8, 9 ] &#125;, &#123; _id: 6, <span class="built_in">type</span>: <span class="string">&quot;food&quot;</span>, item: <span class="string">&quot;bbb&quot;</span>, ratings: [ 5, 9 ] &#125;,</span><br><span class="line">&#123; _id: 7, <span class="built_in">type</span>: <span class="string">&quot;food&quot;</span>, item: <span class="string">&quot;ccc&quot;</span>, ratings: [ 9, 5, 8 ] &#125;, &#123; _id: 8, <span class="built_in">type</span>: <span class="string">&quot;food&quot;</span>, item: <span class="string">&quot;ddd&quot;</span>, ratings: [ 9, 5 ] &#125;,</span><br><span class="line">&#123; _id: 9, <span class="built_in">type</span>: <span class="string">&quot;food&quot;</span>, item: <span class="string">&quot;eee&quot;</span>, ratings: [ 5, 9, 5 ] &#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure><blockquote><p>创建多键索引</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.inventory.createIndex( &#123; ratings: 1 &#125; )</span><br></pre></td></tr></table></figure><p>多键索引很容易与复合索引产生混淆，复合索引是多个字段的组合，而多键索引则仅仅是在一个字段上 出现了多键（multi key）。而实质上，多键索引也可以出现在复合字段上</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建复合多键索引</span></span><br><span class="line">db.inventory.createIndex( &#123; item:1,ratings: 1&#125; )</span><br></pre></td></tr></table></figure><p>注意： MongoDB并不支持一个复合索引中同时出现多个数组字段 </p><blockquote><p>嵌入文档的索引数组</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">db.inventory.insertMany([</span><br><span class="line">&#123;</span><br><span class="line">  _id: 1,</span><br><span class="line">  item: <span class="string">&quot;abc&quot;</span>,</span><br><span class="line">  stock: [</span><br><span class="line">    &#123; size: <span class="string">&quot;S&quot;</span>, color: <span class="string">&quot;red&quot;</span>, quantity: 25 &#125;,</span><br><span class="line">    &#123; size: <span class="string">&quot;S&quot;</span>, color: <span class="string">&quot;blue&quot;</span>, quantity: 10 &#125;, </span><br><span class="line">    &#123; size: <span class="string">&quot;M&quot;</span>, color: <span class="string">&quot;blue&quot;</span>, quantity: 50 &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">  _id: 2,</span><br><span class="line">  item: <span class="string">&quot;def&quot;</span>,</span><br><span class="line">  stock: [</span><br><span class="line">    &#123; size: <span class="string">&quot;S&quot;</span>, color: <span class="string">&quot;blue&quot;</span>, quantity: 20 &#125;,</span><br><span class="line">    &#123; size: <span class="string">&quot;M&quot;</span>, color: <span class="string">&quot;blue&quot;</span>, quantity: 5 &#125;,</span><br><span class="line">    &#123; size: <span class="string">&quot;M&quot;</span>, color: <span class="string">&quot;black&quot;</span>, quantity: 10 &#125;, </span><br><span class="line">    &#123; size: <span class="string">&quot;L&quot;</span>, color: <span class="string">&quot;red&quot;</span>, quantity: 2 &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">  _id: 3,</span><br><span class="line">  item: <span class="string">&quot;ijk&quot;</span>,</span><br><span class="line">  stock: [</span><br><span class="line">    &#123; size: <span class="string">&quot;M&quot;</span>, color: <span class="string">&quot;blue&quot;</span>, quantity: 15 &#125;,</span><br><span class="line">    &#123; size: <span class="string">&quot;L&quot;</span>, color: <span class="string">&quot;blue&quot;</span>, quantity: 100 &#125;, </span><br><span class="line">    &#123; size: <span class="string">&quot;L&quot;</span>, color: <span class="string">&quot;red&quot;</span>, quantity: 25 &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure><p>在包含嵌套对象的数组字段上创建多键索引</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.inventory.createIndex( &#123; <span class="string">&quot;stock.size&quot;</span>: 1, <span class="string">&quot;stock.quantity&quot;</span>: 1 &#125; )</span><br></pre></td></tr></table></figure><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220830102657115.png"                      alt="image-20220830102657115"                ></p><h3 id="地理空间索引（Geospatial-Index）"><a href="#地理空间索引（Geospatial-Index）" class="headerlink" title="地理空间索引（Geospatial Index）"></a>地理空间索引（Geospatial Index）</h3><p>在移动互联网时代，基于地理位置的检索（LBS）功能几乎是所有应用系统的标配。MongoDB为地理空 间检索提供了非常方便的功能。地理空间索引（2dsphereindex）就是专门用于实现位置检索的一种 殊索引。</p><p><strong>案例：MongoDB如何实现“查询附近商家”？</strong></p><p>假设商家的数据模型如下：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">db.restaurant.insert(&#123; </span><br><span class="line">    restaurantId: 0, </span><br><span class="line">    restaurantName:<span class="string">&quot;兰州牛肉面&quot;</span>, </span><br><span class="line">    location : &#123;</span><br><span class="line">        <span class="built_in">type</span>: <span class="string">&quot;Point&quot;</span>, </span><br><span class="line">        coordinates: [ -73.97, 40.77 ] </span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>创建一个2dsphere索引</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.restaurant.createIndex(&#123;location : <span class="string">&quot;2dsphere&quot;</span>&#125;)</span><br></pre></td></tr></table></figure><p>查询附近10000米商家信息</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">db.restaurant.find( &#123;</span><br><span class="line">    location:&#123;</span><br><span class="line">        <span class="variable">$near</span> :&#123;</span><br><span class="line">            <span class="variable">$geometry</span> :&#123;</span><br><span class="line">                <span class="built_in">type</span> : <span class="string">&quot;Point&quot;</span> , </span><br><span class="line">                coordinates : [  -73.88, 40.78 ]</span><br><span class="line">            &#125; ,</span><br><span class="line">            <span class="variable">$maxDistance</span>:10000</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; )</span><br></pre></td></tr></table></figure><ul><li>$near查询操作符，用于实现附近商家的检索，返回数据结果会按距离排序。 </li><li>$geometry操作符用于指定一个GeoJSON格式的地理空间对象，type&#x3D;Point表示地理坐标点， coordinates则是用户当前所在的经纬度位置；$maxDistance限定了最大距离，单位是米。</li></ul><h3 id="全文索引（Text-Indexes）"><a href="#全文索引（Text-Indexes）" class="headerlink" title="全文索引（Text Indexes）"></a>全文索引（Text Indexes）</h3><p>MongoDB支持全文检索功能，可通过建立文本索引来实现简易的分词检索。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.reviews.createIndex( &#123; comments: <span class="string">&quot;text&quot;</span> &#125; )</span><br></pre></td></tr></table></figure><p>$text操作符可以在有text index的集合上执行文本检索。$text将会使用空格和标点符号作为分隔符对检索字符串进行分词， 并且对检索字符串中所有的分词结果进行一个逻辑上的 OR 操作。<br>全文索引能解决快速文本查找的需求，比如有一个博客文章集合，需要根据博客的内容来快速查找，则 可以针对博客内容建立文本索引。</p><h4 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h4><p>数据准备</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">db.stores.insert(</span><br><span class="line">   [</span><br><span class="line">     &#123; _id: 1, name: <span class="string">&quot;Java Hut&quot;</span>, description: <span class="string">&quot;Coffee and cakes&quot;</span> &#125;,</span><br><span class="line">     &#123; _id: 2, name: <span class="string">&quot;Burger Buns&quot;</span>, description: <span class="string">&quot;Gourmet hamburgers&quot;</span> &#125;,</span><br><span class="line">     &#123; _id: 3, name: <span class="string">&quot;Coffee Shop&quot;</span>, description: <span class="string">&quot;Just coffee&quot;</span> &#125;,</span><br><span class="line">     &#123; _id: 4, name: <span class="string">&quot;Clothes Clothes Clothes&quot;</span>, description: <span class="string">&quot;Discount clothing&quot;</span> &#125;,</span><br><span class="line">     &#123; _id: 5, name: <span class="string">&quot;Java Shopping&quot;</span>, description: <span class="string">&quot;Indonesian goods&quot;</span> &#125;</span><br><span class="line">   ]</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>创建name和description的全文索引</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.stores.createIndex(&#123;name: <span class="string">&quot;text&quot;</span>, description: <span class="string">&quot;text&quot;</span>&#125;)</span><br></pre></td></tr></table></figure><p>测试<br>通过$text操作符来查寻数据中所有包含“coffee”,”shop”，“java”列表中任何词语的商店</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.stores.find(&#123;<span class="variable">$text</span>: &#123;<span class="variable">$search</span>: <span class="string">&quot;java coffee shop&quot;</span>&#125;&#125;)</span><br></pre></td></tr></table></figure><p>MongoDB的文本索引功能存在诸多限制，而官方并未提供中文分词的功能，这使得该功能的应用场景十分受限。</p><h3 id="Hash索引（Hashed-Indexes）"><a href="#Hash索引（Hashed-Indexes）" class="headerlink" title="Hash索引（Hashed Indexes）"></a>Hash索引（Hashed Indexes）</h3><p>不同于传统的B-Tree索引,哈希索引使用hash函数来创建索引。在索引字段上进行精确匹配,但不支持范围查询,不支持多键hash； Hash索引上的入口是均匀分布的,在分片集合中非常有用；</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users. createIndex(&#123;username : <span class="string">&#x27;hashed&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure><h3 id="通配符索引（Wildcard-Indexes）"><a href="#通配符索引（Wildcard-Indexes）" class="headerlink" title="通配符索引（Wildcard Indexes）"></a>通配符索引（Wildcard Indexes）</h3><p>MongoDB的文档模式是动态变化的，而通配符索引可以建立在一些不可预知的字段上，以此实现查询的加速。MongoDB 4.2 引入了通配符索引来支持对未知或任意字段的查询。</p><h4 id="案例-1"><a href="#案例-1" class="headerlink" title="案例"></a>案例</h4><p>准备商品数据，不同商品属性不一样</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">db.products.insert([</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;product_name&quot;</span> : <span class="string">&quot;Spy Coat&quot;</span>, </span><br><span class="line">      <span class="string">&quot;product_attributes&quot;</span> : &#123;</span><br><span class="line">        <span class="string">&quot;material&quot;</span> : [ <span class="string">&quot;Tweed&quot;</span>, <span class="string">&quot;Wool&quot;</span>, <span class="string">&quot;Leather&quot;</span> ], </span><br><span class="line">        <span class="string">&quot;size&quot;</span> : &#123;</span><br><span class="line">          <span class="string">&quot;length&quot;</span> : 72,</span><br><span class="line">          <span class="string">&quot;units&quot;</span> : <span class="string">&quot;inches&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;product_name&quot;</span> : <span class="string">&quot;Spy Pen&quot;</span>, </span><br><span class="line">      <span class="string">&quot;product_attributes&quot;</span> : &#123;</span><br><span class="line">         <span class="string">&quot;colors&quot;</span> : [ <span class="string">&quot;Blue&quot;</span>, <span class="string">&quot;Black&quot;</span> ],</span><br><span class="line">                  <span class="string">&quot;secret_feature&quot;</span> : &#123; </span><br><span class="line">           <span class="string">&quot;name&quot;</span> : <span class="string">&quot;laser&quot;</span>, </span><br><span class="line">           <span class="string">&quot;power&quot;</span> : <span class="string">&quot;1000&quot;</span>, </span><br><span class="line">           <span class="string">&quot;units&quot;</span> : <span class="string">&quot;watts&quot;</span>,</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;product_name&quot;</span> : <span class="string">&quot;Spy Book&quot;</span> </span><br><span class="line">    &#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure><p>创建通配符索引</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.products.createIndex( &#123; <span class="string">&quot;product_attributes.$**&quot;</span> : 1 &#125; )</span><br></pre></td></tr></table></figure><p>测试<br>通配符索引可以支持任意单字段查询 product_attributes或其嵌入字段：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.products.find( &#123; <span class="string">&quot;product_attributes.size.length&quot;</span> : &#123; <span class="variable">$gt</span> : 60 &#125; &#125; ) db.products.find( &#123; <span class="string">&quot;product_attributes.material&quot;</span> : <span class="string">&quot;Leather&quot;</span> &#125; ) db.products.find( &#123; <span class="string">&quot;product_attributes.secret_feature.name&quot;</span> : <span class="string">&quot;laser&quot;</span> &#125; )</span><br></pre></td></tr></table></figure><p><strong>注意事项</strong> </p><ul><li>通配符索引不兼容的索引类型或属性</li></ul><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220830103545433.png"                      alt="image-20220830103545433"                ></p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220830103555165.png"                      alt="image-20220830103555165"                ></p><ul><li>通配符索引是稀疏的，不索引空字段。因此，通配符索引不能支持查询字段不存在的文档。</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通配符索引不能支持以下查询</span></span><br><span class="line">db.products.find( &#123;<span class="string">&quot;product_attributes&quot;</span> : &#123; <span class="variable">$exists</span> : <span class="literal">false</span> &#125; &#125; ) db.products.aggregate([</span><br><span class="line">  &#123; <span class="variable">$match</span> : &#123; <span class="string">&quot;product_attributes&quot;</span> : &#123; <span class="variable">$exists</span> : <span class="literal">false</span> &#125; &#125; &#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure><ul><li>通配符索引为文档或数组的内容生成条目，而不是文档&#x2F;数组本身。因此通配符索引不能支持精确的文档&#x2F;数组相等匹配。通配符索引可以支持查询字段等于空文档{}的情况。</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#通配符索引不能支持以下查询:</span></span><br><span class="line">db.products.find(&#123; <span class="string">&quot;product_attributes.colors&quot;</span> : [ <span class="string">&quot;Blue&quot;</span>, <span class="string">&quot;Black&quot;</span> ] &#125; )</span><br><span class="line">db.products.aggregate([&#123;</span><br><span class="line">  <span class="variable">$match</span> : &#123; <span class="string">&quot;product_attributes.colors&quot;</span> : [ <span class="string">&quot;Blue&quot;</span>, <span class="string">&quot;Black&quot;</span> ] &#125; </span><br><span class="line">  &#125;])</span><br></pre></td></tr></table></figure><h2 id="索引属性"><a href="#索引属性" class="headerlink" title="索引属性"></a>索引属性</h2><h3 id="唯一索引（Unique-Indexes）"><a href="#唯一索引（Unique-Indexes）" class="headerlink" title="唯一索引（Unique Indexes）"></a>唯一索引（Unique Indexes）</h3><p>在现实场景中，唯一性是很常见的一种索引约束需求，重复的数据记录会带来许多处理上的麻烦，比如订单的编号、用户的登录名等。通过建立唯一性索引，可以保证集合中文档的指定字段拥有唯一值。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建唯一索引 </span></span><br><span class="line">db.values.createIndex(&#123;title:1&#125;,&#123;unique:<span class="literal">true</span>&#125;)</span><br><span class="line"><span class="comment"># 复合索引支持唯一性约束 </span></span><br><span class="line">db.values.createIndex(&#123;title:1，<span class="built_in">type</span>:1&#125;,&#123;unique:<span class="literal">true</span>&#125;) </span><br><span class="line"><span class="comment">#多键索引支持唯一性约束</span></span><br><span class="line">db.inventory.createIndex( &#123; ratings: 1 &#125;,&#123;unique:<span class="literal">true</span>&#125; )</span><br></pre></td></tr></table></figure><ul><li>唯一性索引对于文档中缺失的字段，会使用null值代替，因此不允许存在多个文档缺失索引字段的情况。 </li><li>对于分片的集合，唯一性约束必须匹配分片规则。换句话说，为了保证全局的唯一性，分片键必须作为唯一性索引的前缀字段。</li></ul><h3 id="部分索引（Partial-Indexes）"><a href="#部分索引（Partial-Indexes）" class="headerlink" title="部分索引（Partial Indexes）"></a>部分索引（Partial Indexes）</h3><p>部分索引仅对满足指定过滤器表达式的文档进行索引。通过在一个集合中为文档的一个子集建立索引， 部分索引具有更低的存储需求和更低的索引创建和维护的性能成本。3.2新版功能。 </p><p>部分索引提供了稀疏索引功能的超集，应该优先于稀疏索引。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.restaurants.createIndex( </span><br><span class="line">   &#123; cuisine: 1, name: 1 &#125;, </span><br><span class="line">   &#123; partialFilterExpression: &#123; rating: &#123; <span class="variable">$gt</span>: 5 &#125; &#125; &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>partialFilterExpression选项接受指定过滤条件的文档: </p><ul><li>等式表达式(例如:field: value或使用$eq操作符)</li><li>$exists: true</li><li>$gt， $gte， $lt， $lte </li><li>$type</li><li>顶层的$and</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 符合条件，使用索引</span></span><br><span class="line">db.restaurants.find( &#123; cuisine: <span class="string">&quot;Italian&quot;</span>, rating: &#123; <span class="variable">$gte</span>: 8 &#125; &#125; )</span><br><span class="line"><span class="comment"># 不符合条件，不能使用索引</span></span><br><span class="line">db.restaurants.find( &#123; cuisine: <span class="string">&quot;Italian&quot;</span> &#125; )</span><br></pre></td></tr></table></figure><h4 id="案例1"><a href="#案例1" class="headerlink" title="案例1"></a>案例1</h4><p>restaurants集合数据</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">db.restaurants.insert(&#123;</span><br><span class="line">   <span class="string">&quot;_id&quot;</span> : ObjectId(<span class="string">&quot;5641f6a7522545bc535b5dc9&quot;</span>), </span><br><span class="line">   <span class="string">&quot;address&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;building&quot;</span> : <span class="string">&quot;1007&quot;</span>,</span><br><span class="line">      <span class="string">&quot;coord&quot;</span> : [</span><br><span class="line">         -73.856077,</span><br><span class="line">         40.848447</span><br><span class="line">      ],</span><br><span class="line">      <span class="string">&quot;street&quot;</span> : <span class="string">&quot;Morris Park Ave&quot;</span>,</span><br><span class="line">      <span class="string">&quot;zipcode&quot;</span> : <span class="string">&quot;10462&quot;</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="string">&quot;borough&quot;</span> : <span class="string">&quot;Bronx&quot;</span>,</span><br><span class="line">   <span class="string">&quot;cuisine&quot;</span> : <span class="string">&quot;Bakery&quot;</span>,</span><br><span class="line">   <span class="string">&quot;rating&quot;</span> : &#123; <span class="string">&quot;date&quot;</span> : ISODate(<span class="string">&quot;2014-03-03T00:00:00Z&quot;</span>), </span><br><span class="line">                <span class="string">&quot;grade&quot;</span> : <span class="string">&quot;A&quot;</span>,</span><br><span class="line">                <span class="string">&quot;score&quot;</span> : 2</span><br><span class="line">              &#125;,</span><br><span class="line">   <span class="string">&quot;name&quot;</span> : <span class="string">&quot;Morris Park Bake Shop&quot;</span>,</span><br><span class="line">   <span class="string">&quot;restaurant_id&quot;</span> : <span class="string">&quot;30075445&quot;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>创建索引</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.restaurants.createIndex(</span><br><span class="line">   &#123; borough: 1, cuisine: 1 &#125;,</span><br><span class="line">   &#123; partialFilterExpression: &#123; <span class="string">&#x27;rating.grade&#x27;</span>: &#123; <span class="variable">$eq</span>: <span class="string">&quot;A&quot;</span> &#125; &#125; &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>测试</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.restaurants.find( &#123; borough: <span class="string">&quot;Bronx&quot;</span>, <span class="string">&#x27;rating.grade&#x27;</span>: <span class="string">&quot;A&quot;</span> &#125; ) db.restaurants.find( &#123; borough: <span class="string">&quot;Bronx&quot;</span>, cuisine: <span class="string">&quot;Bakery&quot;</span> &#125; )</span><br></pre></td></tr></table></figure><p><strong>唯一约束结合部分索引使用导致唯一约束失效的问题</strong> </p><p>注意：如果同时指定了partialFilterExpression和唯一约束，那么唯一约束只适用于满足筛选器表达式的文档。如果文档不满足筛选条件，那么带有惟一约束的部分索引不会阻止插入不满足惟一约束的文档。</p><h4 id="案例2"><a href="#案例2" class="headerlink" title="案例2"></a>案例2</h4><p>users集合数据准备</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.users.insertMany( [</span><br><span class="line">   &#123; username: <span class="string">&quot;david&quot;</span>, age: 29 &#125;,</span><br><span class="line">   &#123; username: <span class="string">&quot;amanda&quot;</span>, age: 35 &#125;, </span><br><span class="line">   &#123; username: <span class="string">&quot;rajiv&quot;</span>, age: 57 &#125;</span><br><span class="line">] )</span><br></pre></td></tr></table></figure><p>创建索引，指定username字段和部分过滤器表达式age: {$gte: 21}的唯一约束。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.users.createIndex(</span><br><span class="line">   &#123; username: 1 &#125;,</span><br><span class="line">   &#123; unique: <span class="literal">true</span>, partialFilterExpression: &#123; age: &#123; <span class="variable">$gte</span>: 21 &#125; &#125; &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>测试 </p><p>索引防止了以下文档的插入，因为文档已经存在，且指定的用户名和年龄字段大于21:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.users.insertMany( [</span><br><span class="line">   &#123; username: <span class="string">&quot;david&quot;</span>, age: 27 &#125;,</span><br><span class="line">   &#123; username: <span class="string">&quot;amanda&quot;</span>, age: 25 &#125;, </span><br><span class="line">   &#123; username: <span class="string">&quot;rajiv&quot;</span>, age: 32 &#125;</span><br><span class="line">] )</span><br></pre></td></tr></table></figure><p>但是，以下具有重复用户名的文档是允许的，因为唯一约束只适用于年龄大于或等于21岁的文档。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.users.insertMany( [</span><br><span class="line">   &#123; username: <span class="string">&quot;david&quot;</span>, age: 20 &#125;,</span><br><span class="line">   &#123; username: <span class="string">&quot;amanda&quot;</span> &#125;,</span><br><span class="line">   &#123; username: <span class="string">&quot;rajiv&quot;</span>, age: null &#125; ] )</span><br></pre></td></tr></table></figure><h3 id="稀疏索引（Sparse-Indexes）"><a href="#稀疏索引（Sparse-Indexes）" class="headerlink" title="稀疏索引（Sparse Indexes）"></a>稀疏索引（Sparse Indexes）</h3><p>索引的稀疏属性确保索引只包含具有索引字段的文档的条目，索引将跳过没有索引字段的文档。<br>特性： 只对存在字段的文档进行索引（包括字段值为null的文档）</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#不索引不包含xmpp_id字段的文档</span></span><br><span class="line">db.addresses.createIndex( &#123; <span class="string">&quot;xmpp_id&quot;</span>: 1 &#125;, &#123; sparse: <span class="literal">true</span> &#125; )</span><br></pre></td></tr></table></figure><p>如果稀疏索引会导致查询和排序操作的结果集不完整，MongoDB将不会使用该索引，除非hint()明确指定索引。</p><h4 id="案例1-1"><a href="#案例1-1" class="headerlink" title="案例1"></a>案例1</h4><p>数据准备</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.scores.insertMany([</span><br><span class="line">    &#123;<span class="string">&quot;userid&quot;</span> : <span class="string">&quot;newbie&quot;</span>&#125;, </span><br><span class="line">    &#123;<span class="string">&quot;userid&quot;</span> : <span class="string">&quot;abby&quot;</span>, <span class="string">&quot;score&quot;</span> : 82&#125;, </span><br><span class="line">    &#123;<span class="string">&quot;userid&quot;</span> : <span class="string">&quot;nina&quot;</span>, <span class="string">&quot;score&quot;</span> : 90&#125; </span><br><span class="line">    ])</span><br></pre></td></tr></table></figure><p>创建稀疏索引</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.scores.createIndex( &#123; score: 1 &#125; , &#123; sparse: <span class="literal">true</span> &#125; )</span><br></pre></td></tr></table></figure><p>测试</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用稀疏索引</span></span><br><span class="line">db.scores.find( &#123; score: &#123; <span class="variable">$lt</span>: 90 &#125; &#125; )</span><br><span class="line"></span><br><span class="line"><span class="comment"># 即使排序是通过索引字段，MongoDB也不会选择稀疏索引来完成查询，以返回完整的结果 </span></span><br><span class="line">db.scores.find().<span class="built_in">sort</span>( &#123; score: -1 &#125; )</span><br><span class="line"></span><br><span class="line"><span class="comment"># 要使用稀疏索引，使用hint()显式指定索引</span></span><br><span class="line">db.scores.find().<span class="built_in">sort</span>( &#123; score: -1 &#125; ).hint( &#123; score: 1 &#125; )</span><br></pre></td></tr></table></figure><p>同时具有稀疏性和唯一性的索引可以防止集合中存在字段值重复的文档，但允许不包含此索引字段的文 档插入。</p><h4 id="案例2-1"><a href="#案例2-1" class="headerlink" title="案例2"></a>案例2</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建具有唯一约束的稀疏索引</span></span><br><span class="line">db.scores.createIndex( &#123; score: 1 &#125; , &#123; sparse: <span class="literal">true</span>, unique: <span class="literal">true</span> &#125; )</span><br></pre></td></tr></table></figure><p>测试 </p><p>这个索引将允许插入具有唯一的分数字段值或不包含分数字段的文档。因此，给定scores集合中的现有文档，索引允许以下插入操作:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">db.scores.insertMany( [</span><br><span class="line">   &#123; <span class="string">&quot;userid&quot;</span>: <span class="string">&quot;AAAAAAA&quot;</span>, <span class="string">&quot;score&quot;</span>: 43 &#125;, </span><br><span class="line">   &#123; <span class="string">&quot;userid&quot;</span>: <span class="string">&quot;BBBBBBB&quot;</span>, <span class="string">&quot;score&quot;</span>: 34 &#125;, </span><br><span class="line">   &#123; <span class="string">&quot;userid&quot;</span>: <span class="string">&quot;CCCCCCC&quot;</span> &#125;,</span><br><span class="line">   &#123; <span class="string">&quot;userid&quot;</span>: <span class="string">&quot;CCCCCCC&quot;</span> &#125;</span><br><span class="line">] )</span><br></pre></td></tr></table></figure><p>索引不允许添加下列文件，因为已经存在评分为82和90的文件：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.scores.insertMany( [</span><br><span class="line">   &#123; <span class="string">&quot;userid&quot;</span>: <span class="string">&quot;AAAAAAA&quot;</span>, <span class="string">&quot;score&quot;</span>: 82 &#125;, </span><br><span class="line">   &#123; <span class="string">&quot;userid&quot;</span>: <span class="string">&quot;BBBBBBB&quot;</span>, <span class="string">&quot;score&quot;</span>: 90 &#125;</span><br><span class="line">] )</span><br></pre></td></tr></table></figure><h3 id="TTL索引（TTL-Indexes）"><a href="#TTL索引（TTL-Indexes）" class="headerlink" title="TTL索引（TTL Indexes）"></a>TTL索引（TTL Indexes）</h3><p>在一般的应用系统中，并非所有的数据都需要永久存储。例如一些系统事件、用户消息等，这些数据随着时间的推移，其重要程度逐渐降低。更重要的是，存储这些大量的历史数据需要花费较高的成本，因此项目中通常会对过期且不再使用的数据进行老化处理。<br>通常的做法如下：</p><p>方案一：为每个数据记录一个时间戳，应用侧开启一个定时器，按时间戳定期删除过期的数据。</p><p>方案二：数据按日期进行分表，同一天的数据归档到同一张表，同样使用定时器删除过期的表。</p><p>对于数据老化，MongoDB提供了一种更加便捷的做法：TTL（Time To Live）索引。TTL索引需要声明在一个日期类型的字段中，TTL 索引是特殊的单字段索引，MongoDB 可以使用它在一定时间或特定时钟时间后自动从集合中删除文档。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建 TTL 索引，TTL 值为3600秒</span></span><br><span class="line">db.eventlog.createIndex( &#123; <span class="string">&quot;lastModifiedDate&quot;</span>: 1 &#125;, &#123; expireAfterSeconds: 3600 &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>对集合创建TTL索引之后，MongoDB会在周期性运行的后台线程中对该集合进行检查及数据清理工作。 除了数据老化功能，TTL索引具有普通索引的功能，同样可以用于加速数据的查询。<br>TTL 索引不保证过期数据会在过期后立即被删除。文档过期和 MongoDB 从数据库中删除文档的时间之 间可能存在延迟。删除过期文档的后台任务每 60 秒运行一次。因此，在文档到期和后台任务运行之间 的时间段内，文档可能会保留在集合中。</p><h4 id="案例-2"><a href="#案例-2" class="headerlink" title="案例"></a>案例</h4><p>数据准备</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.log_events.insertOne( &#123; </span><br><span class="line">   <span class="string">&quot;createdAt&quot;</span>: new Date(), </span><br><span class="line">   <span class="string">&quot;logEvent&quot;</span>: 2, </span><br><span class="line">   <span class="string">&quot;logMessage&quot;</span>: <span class="string">&quot;Success!&quot;</span> </span><br><span class="line">   &#125;)</span><br></pre></td></tr></table></figure><p>创建TTL索引</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.log_events.createIndex( &#123; <span class="string">&quot;createdAt&quot;</span>: 1 &#125;, &#123; expireAfterSeconds: 20 &#125; )</span><br></pre></td></tr></table></figure><blockquote><p>可变的过期时间 </p></blockquote><p>TTL索引在创建之后，仍然可以对过期时间进行修改。这需要使用collMod命令对索引的定义进行变更</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.runCommand(&#123;collMod:<span class="string">&quot;log_events&quot;</span>,index:&#123;keyPattern: &#123;createdAt:1&#125;,expireAfterSeconds:600&#125;&#125;)</span><br></pre></td></tr></table></figure><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220830105132497.png"                      alt="image-20220830105132497"                ></p><blockquote><p>使用约束</p></blockquote><p>TTL索引的确可以减少开发的工作量，而且通过数据库自动清理的方式会更加高效、可靠，但是在使用 TTL索引时需要注意以下的限制：</p><ul><li>TTL索引只能支持单个字段，并且必须是非_id字段。</li><li>TTL索引不能用于固定集合。 </li><li>TTL索引无法保证及时的数据老化，MongoDB会通过后台的TTLMonitor定时器来清理老化数据， 默认的间隔时间是1分钟。当然如果在数据库负载过高的情况下，TTL的行为则会进一步受到影响。 </li><li>TTL索引对于数据的清理仅仅使用了remove命令，这种方式并不是很高效。因此TTL Monitor在运行期间对系统CPU、磁盘都会造成一定的压力。相比之下，按日期分表的方式操作会更加高效。</li></ul><h3 id="隐藏索引（Hidden-Indexes）"><a href="#隐藏索引（Hidden-Indexes）" class="headerlink" title="隐藏索引（Hidden Indexes）"></a>隐藏索引（Hidden Indexes）</h3><p>隐藏索引对查询规划器不可见，不能用于支持查询。通过对规划器隐藏索引，用户可以在不实际删除索引的情况下评估删除索引的潜在影响。如果影响是负面的，用户可以取消隐藏索引，而不必重新创建已删除的索引。4.4新版功能。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建隐藏索引</span></span><br><span class="line">db.restaurants.createIndex(&#123; borough: 1 &#125;,&#123; hidden: <span class="literal">true</span> &#125;); </span><br><span class="line"><span class="comment"># 隐藏现有索引</span></span><br><span class="line">db.restaurants.hideIndex( &#123; borough: 1&#125; );</span><br><span class="line">db.restaurants.hideIndex( <span class="string">&quot;索引名称&quot;</span> )</span><br><span class="line"><span class="comment"># 取消隐藏索引</span></span><br><span class="line">db.restaurants.unhideIndex( &#123; borough: 1&#125; ); db.restaurants.unhideIndex( <span class="string">&quot;索引名称&quot;</span> );</span><br></pre></td></tr></table></figure><h4 id="案例-3"><a href="#案例-3" class="headerlink" title="案例"></a>案例</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.scores.insertMany([</span><br><span class="line">    &#123;<span class="string">&quot;userid&quot;</span> : <span class="string">&quot;newbie&quot;</span>&#125;, </span><br><span class="line">    &#123;<span class="string">&quot;userid&quot;</span> : <span class="string">&quot;abby&quot;</span>, <span class="string">&quot;score&quot;</span> : 82&#125;, </span><br><span class="line">    &#123;<span class="string">&quot;userid&quot;</span> : <span class="string">&quot;nina&quot;</span>, <span class="string">&quot;score&quot;</span> : 90&#125; </span><br><span class="line">    ])</span><br></pre></td></tr></table></figure><p>创建隐藏索引</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.scores.createIndex( </span><br><span class="line">   &#123; userid: 1 &#125;,</span><br><span class="line">   &#123; hidden: <span class="literal">true</span> &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>查看索引信息</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.scores.getIndexes()</span><br></pre></td></tr></table></figure><p>索引属性hidden只在值为true时返回</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220830105447459.png"                      alt="image-20220830105447459"                ></p><p>测试</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 不使用索引 </span></span><br><span class="line">db.scores.find(&#123;userid:<span class="string">&quot;abby&quot;</span>&#125;).explain()</span><br><span class="line"><span class="comment">#取消隐藏索引</span></span><br><span class="line">db.scores.unhideIndex( &#123; userid: 1&#125; ); </span><br><span class="line"><span class="comment">#使用索引 </span></span><br><span class="line">db.scores.find(&#123;userid:<span class="string">&quot;abby&quot;</span>&#125;).explain()</span><br></pre></td></tr></table></figure><h2 id="索引使用建议"><a href="#索引使用建议" class="headerlink" title="索引使用建议"></a>索引使用建议</h2><blockquote><p>为每一个查询建立合适的索引 </p></blockquote><p>这个是针对于数据量较大比如说超过几十上百万（文档数目）数量级的集合。如果没有索引MongoDB 需要把所有的Document从盘上读到内存，这会对MongoDB服务器造成较大的压力并影响到其他请求的执行。</p><blockquote><p>创建合适的复合索引，不要依赖于交叉索引 </p></blockquote><p>如果你的查询会使用到多个字段，MongoDB有两个索引技术可以使用：交叉索引和复合索引。交叉索引就是针对每个字段单独建立一个单字段索引，然后在查询执行时候使用相应的单字段索引进行索引交叉而得到查询结果。交叉索引目前触发率较低，所以如果你有一个多字段查询的时候，建议使用复合索引能够保证索引正常的使用。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查找所有年龄小于30岁的深圳市马拉松运动员</span></span><br><span class="line">db.athelets.find(&#123;sport: <span class="string">&quot;marathon&quot;</span>, location: <span class="string">&quot;sz&quot;</span>, age: &#123;<span class="variable">$lt</span>: 30&#125;&#125;&#125;) </span><br><span class="line"><span class="comment">#创建复合索引</span></span><br><span class="line">db.athelets.createIndex(&#123;sport:1, location:1, age:1&#125;)</span><br></pre></td></tr></table></figure><blockquote><p>复合索引字段顺序：匹配条件在前，范围条件在后（Equality First, Range After） </p></blockquote><p>前面的例子，在创建复合索引时如果条件有匹配和范围之分，那么匹配条件（sport: “marathon”) 应该在复合索引的前面。范围条件(age: &lt;30)字段应该放在复合索引的后面。 </p><blockquote><p>尽可能使用覆盖索引（Covered Index）</p></blockquote><blockquote><p>建索引要在后台运行 </p></blockquote><p>在对一个集合创建索引时，该集合所在的数据库将不接受其他读写操作。对大数据量的集合建索引，建议使用后台运行选项 {background: true}</p><h2 id="explain执行计划详解"><a href="#explain执行计划详解" class="headerlink" title="explain执行计划详解"></a>explain执行计划详解</h2><p>通常我们需要关心的问题： </p><ul><li>查询是否使用了索引</li><li>索引是否减少了扫描的记录数量 </li><li>是否存在低效的内存排序</li></ul><p>MongoDB提供了explain命令，它可以帮助我们评估指定查询模型（querymodel）的执行计划，根据实际情况进行调整，然后提高查询效率。</p><p>explain()方法的形式如下:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.find().explain(&lt;verbose&gt;)</span><br></pre></td></tr></table></figure><ul><li>verbose  可选参数，表示执行计划的输出模式，默认queryPlanner</li></ul><table><thead><tr><th>模式名字</th><th>描述</th></tr></thead><tbody><tr><td>queryPlanner</td><td>执行计划的详细信息，包括查询计划、集合信息、查询条件、最佳执行计划、查询方式和 MongoDB 服务信息等</td></tr><tr><td>exectionStats</td><td>最佳执行计划的执行情况和被拒绝的计划等信息</td></tr><tr><td>allPlansExecution</td><td>选择并执行最佳执行计划，并返回最佳执行计划和其他执行计划的执行情况</td></tr></tbody></table><h3 id="queryPlanner"><a href="#queryPlanner" class="headerlink" title="queryPlanner"></a>queryPlanner</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 未创建title的索引 </span></span><br><span class="line">db.books.find(&#123;title:<span class="string">&quot;book-1&quot;</span>&#125;).explain(<span class="string">&quot;queryPlanner&quot;</span>)</span><br></pre></td></tr></table></figure><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220830110141287.png"                      alt="image-20220830110141287"                ></p><table><thead><tr><th>字段名称</th><th>描述</th></tr></thead><tbody><tr><td>plannerVersion</td><td>执行计划的版本</td></tr><tr><td>namespace</td><td>查询的集合</td></tr><tr><td>indexFilterSet</td><td>是否使用索引</td></tr><tr><td>parsedQuery</td><td>查询条件</td></tr><tr><td>winningPlan</td><td>最佳执行计划</td></tr><tr><td>stage</td><td>查询方式</td></tr><tr><td>filter</td><td>过滤条件</td></tr><tr><td>direction</td><td>查询顺序</td></tr><tr><td>rejectedPlans</td><td>拒绝的执行计划</td></tr><tr><td>serverInfo</td><td>mongodb服务器信息</td></tr></tbody></table><h3 id="executionStats"><a href="#executionStats" class="headerlink" title="executionStats"></a>executionStats</h3><p>executionStats 模式的返回信息中包含了 queryPlanner 模式的所有字段，并且还包含了最佳执行计划的执行情况</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建索引 </span></span><br><span class="line">db.books.createIndex(&#123;title:1&#125;)</span><br><span class="line">db.books.find(&#123;title:<span class="string">&quot;book-1&quot;</span>&#125;).explain(<span class="string">&quot;executionStats&quot;</span>)</span><br></pre></td></tr></table></figure><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220830110439124.png"                      alt="image-20220830110439124"                ></p><table><thead><tr><th>字段名称</th><th>描述</th></tr></thead><tbody><tr><td>winningPlan.inputStage</td><td>用来描述子stage， 并且为其父stage提 供文档和索引关键字</td></tr><tr><td>winningPlan.inputStage.stage</td><td>子查询方式</td></tr><tr><td>winningPlan.inputStage.keyPattern</td><td>所扫描的index内容</td></tr><tr><td>winningPlan.inputStage.indexName</td><td>索引名</td></tr><tr><td>winningPlan.inputStage.isMultiKey</td><td>是否是Multikey。如 果索引建立在array 上，将是true</td></tr><tr><td>executionStats.executionSuccess</td><td>是否执行成功</td></tr><tr><td>executionStats.nReturned</td><td>返回的个数</td></tr><tr><td>executionStats.executionTimeMillis</td><td>这条语句执行时间</td></tr><tr><td>executionStats.executionStages.executionTimeMillisEstimate</td><td>检索文档获取数据的时间</td></tr><tr><td>executionStats.executionStages.inputStage.executionTimeMillisEstimate</td><td>扫描获取数据的时间</td></tr><tr><td>executionStats.totalKeysExamined</td><td>索引扫描次数</td></tr><tr><td>executionStats.totalDocsExamined</td><td>文档扫描次数</td></tr><tr><td>executionStats.executionStages.isEOF</td><td>是否到达 steam 结 尾，1 或者 true 代 表已到达结尾</td></tr><tr><td>executionStats.executionStages.works</td><td>工作单元数，一个查 询会分解成小的工作 单元</td></tr><tr><td>executionStats.executionStages.advanced</td><td>优先返回的结果数</td></tr><tr><td>executionStats.executionStages.docsExamined</td><td>文档检查数</td></tr></tbody></table><h3 id="allPlansExecution"><a href="#allPlansExecution" class="headerlink" title="allPlansExecution"></a>allPlansExecution</h3><p>allPlansExecution返回的信息包含 executionStats 模式的内容，且包含allPlansExecution:[]块</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;allPlansExecution&quot;</span> : [</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="string">&quot;nReturned&quot;</span> : &lt;int&gt;, </span><br><span class="line">         <span class="string">&quot;executionTimeMillisEstimate&quot;</span> : &lt;int&gt;, </span><br><span class="line">         <span class="string">&quot;totalKeysExamined&quot;</span> : &lt;int&gt;, </span><br><span class="line">         <span class="string">&quot;totalDocsExamined&quot;</span> :&lt;int&gt;, </span><br><span class="line">         <span class="string">&quot;executionStages&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;stage&quot;</span> : &lt;STAGEA&gt;, </span><br><span class="line">            <span class="string">&quot;nReturned&quot;</span> : &lt;int&gt;, </span><br><span class="line">            <span class="string">&quot;executionTimeMillisEstimate&quot;</span> : &lt;int&gt;, </span><br><span class="line">            ...</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">               &#125;, </span><br><span class="line">      ... </span><br><span class="line">   ]</span><br></pre></td></tr></table></figure><blockquote><p>stage状态</p></blockquote><table><thead><tr><th>状态</th><th>描述</th></tr></thead><tbody><tr><td>COLLSCAN</td><td>全表扫描</td></tr><tr><td>IXSCAN</td><td>索引扫描</td></tr><tr><td>FETCH</td><td>根据索引检索指定文档</td></tr><tr><td>SHARD_MERGE</td><td>将各个分片返回数据进行合并</td></tr><tr><td>SORT</td><td>在内存中进行了排序</td></tr><tr><td>LIMIT</td><td>使用limit限制返回数</td></tr><tr><td>SKIP</td><td>使用skip进行跳过</td></tr><tr><td>IDHACK</td><td>对_id进行查询</td></tr><tr><td>SHARDING_FILTER</td><td>通过mongos对分片数据进行查询</td></tr><tr><td>COUNTSCAN</td><td>count不使用Index进行count时的stage返回</td></tr><tr><td>COUNT_SCAN</td><td>count使用了Index进行count时的stage返回</td></tr><tr><td>SUBPLA</td><td>未使用到索引的$or查询的stage返回</td></tr><tr><td>TEXT</td><td>使用全文索引进行查询时候的stage返回</td></tr><tr><td>PROJECTION</td><td>限定返回字段时候stage的返回</td></tr></tbody></table><p>执行计划的返回结果中尽量不要出现以下stage: </p><ul><li>COLLSCAN(全表扫描)</li><li>SORT(使用sort但是无index) </li><li>不合理的SKIP </li><li>SUBPLA(未用到index的$or) </li><li>COUNTSCAN(不使用index进行count)</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;索引介绍&quot;&gt;&lt;a href=&quot;#索引介绍&quot; class=&quot;headerlink&quot; title=&quot;索引介绍&quot;&gt;&lt;/a&gt;索引介绍&lt;/h2&gt;&lt;p&gt;索引是一种用来快速查询数据的数据结构。B+Tree就是一种常用的数据库索引数据结构，MongoDB 采用B+Tree 做索引</summary>
      
    
    
    
    
    <category term="MongoDB" scheme="http://example.com/tags/MongoDB/"/>
    
  </entry>
  
  <entry>
    <title>MongoDB之视图</title>
    <link href="http://example.com/2022/08/30/MongoDB%E4%B9%8B%E8%A7%86%E5%9B%BE/"/>
    <id>http://example.com/2022/08/30/MongoDB%E4%B9%8B%E8%A7%86%E5%9B%BE/</id>
    <published>2022-08-30T01:40:33.000Z</published>
    <updated>2022-08-30T01:51:19.302Z</updated>
    
    <content type="html"><![CDATA[<p>MongoDB视图是一个可查询的对象，它的内容由其他集合或视图上的聚合管道定义。 MongoDB不会将 视图内容持久化到磁盘。 当客户端查询视图时，视图的内容按需计算。 MongoDB可以要求客户端具有 查询视图的权限。 MongoDB不支持对视图进行写操作。</p><p><strong>作用：</strong></p><ul><li>数据抽象</li><li>保护敏感数据的一种方法 </li><li>将敏感数据投影到视图之外</li><li>只读 </li><li>结合基于角色的授权，可按角色访问信息</li></ul><p>数据准备</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> orders = <span class="keyword">new</span> <span class="title class_">Array</span>();</span><br><span class="line"><span class="keyword">var</span> shipping = <span class="keyword">new</span> <span class="title class_">Array</span>();</span><br><span class="line"><span class="keyword">var</span> addresses = [<span class="string">&quot;广西省玉林市&quot;</span>, <span class="string">&quot;湖南省岳阳市&quot;</span>, <span class="string">&quot;湖北省荆州市&quot;</span>, <span class="string">&quot;甘肃省兰州市&quot;</span>, <span class="string">&quot;吉林省松 原市&quot;</span>, <span class="string">&quot;江西省景德镇&quot;</span>, <span class="string">&quot;辽宁省沈阳市&quot;</span>, <span class="string">&quot;福建省厦门市&quot;</span>, <span class="string">&quot;广东省广州市&quot;</span>, <span class="string">&quot;北京市朝阳区&quot;</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">10000</span>; i &lt; <span class="number">20000</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> orderNo = i + <span class="title class_">Math</span>.<span class="title function_">random</span>().<span class="title function_">toString</span>().<span class="title function_">substr</span>(<span class="number">2</span>, <span class="number">5</span>);</span><br><span class="line">    orders[i] = &#123; <span class="attr">orderNo</span>: orderNo, <span class="attr">userId</span>: i, <span class="attr">price</span>: <span class="title class_">Math</span>.<span class="title function_">round</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">10000</span>) / <span class="number">100</span>, <span class="attr">qty</span>: <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">10</span>) + <span class="number">1</span>, <span class="attr">orderTime</span>: <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">setSeconds</span>(<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">10000</span>))) &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> address = addresses[<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">10</span>)];</span><br><span class="line">    shipping[i] = &#123; <span class="attr">orderNo</span>: orderNo, <span class="attr">address</span>: address, <span class="attr">recipienter</span>: <span class="string">&quot;Wilson&quot;</span>, <span class="attr">province</span>: address.<span class="title function_">substr</span>(<span class="number">0</span>, <span class="number">3</span>), <span class="attr">city</span>: address.<span class="title function_">substr</span>(<span class="number">3</span>, <span class="number">3</span>) &#125;</span><br><span class="line">&#125;</span><br><span class="line">db.<span class="property">order</span>.<span class="title function_">insert</span>(orders); </span><br><span class="line">db.<span class="property">shipping</span>.<span class="title function_">insert</span>(shipping);</span><br></pre></td></tr></table></figure><hr><h2 id="创建视图"><a href="#创建视图" class="headerlink" title="创建视图"></a>创建视图</h2><blockquote><p>基本语法格式</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">db.createView(</span><br><span class="line">  <span class="string">&quot;&lt;viewName&gt;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;&lt;source&gt;&quot;</span>,</span><br><span class="line">  [&lt;pipeline&gt;],</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;collation&quot;</span> : &#123; &lt;collation&gt; &#125; </span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><ul><li>viewName : 必须，视图名称 </li><li>source : 必须，数据源，集合&#x2F;视图 </li><li>[] : 可选，一组管道</li><li>collation       可选，排序规则</li></ul><h3 id="单个集合创建视图"><a href="#单个集合创建视图" class="headerlink" title="单个集合创建视图"></a>单个集合创建视图</h3><p>假设现在查看当天最高的10笔订单视图，例如需要实时显示金额最高的订单</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">db.createView(</span><br><span class="line">    <span class="string">&quot;orderInfo&quot;</span>,         //视图名称</span><br><span class="line">    <span class="string">&quot;order&quot;</span>,             //数据源</span><br><span class="line">    [</span><br><span class="line">        //筛选符合条件的订单，大于当天，这里要注意时区</span><br><span class="line">        &#123; <span class="variable">$match</span>: &#123; <span class="string">&quot;orderTime&quot;</span>: &#123; <span class="variable">$gte</span>: ISODate(<span class="string">&quot;2022-01-26T00:00:00.000Z&quot;</span>) &#125; &#125; &#125;,</span><br><span class="line">          //按金额倒序</span><br><span class="line">        &#123; <span class="variable">$sort</span>: &#123; <span class="string">&quot;price&quot;</span>: -1 &#125; &#125;,</span><br><span class="line">        //限制10个文档</span><br><span class="line">        &#123; <span class="variable">$limit</span>: 10 &#125;,</span><br><span class="line">        //选择要显示的字段</span><br><span class="line">        //0: 排除字段，若字段上使用（_id除外），就不能有其他包含字段 </span><br><span class="line">        //1: 包含字段</span><br><span class="line">        &#123; <span class="variable">$project</span>: &#123; _id: 0, orderNo: 1, price: 1, orderTime: 1 &#125; &#125; </span><br><span class="line">    ]</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>视图创建成功后可以直接使用视图查询数据</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220830094629289.png"                      alt="image-20220830094629289"                ></p><h3 id="多个集合创建视图"><a href="#多个集合创建视图" class="headerlink" title="多个集合创建视图"></a>多个集合创建视图</h3><p>跟单个是集合是一样，只是多了$lookup连接操作符，视图根据管道最终结果显示，所以可以关联多个 集合</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">db.orderDetail.drop()</span><br><span class="line">db.createView(</span><br><span class="line">    <span class="string">&quot;orderDetail&quot;</span>,</span><br><span class="line">    <span class="string">&quot;order&quot;</span>,</span><br><span class="line">    [</span><br><span class="line">        &#123; <span class="variable">$lookup</span>: &#123; from: <span class="string">&quot;shipping&quot;</span>, localField: <span class="string">&quot;orderNo&quot;</span>, foreignField: <span class="string">&quot;orderNo&quot;</span>, as: <span class="string">&quot;shipping&quot;</span> &#125; &#125;,</span><br><span class="line">        &#123; <span class="variable">$project</span>: &#123; <span class="string">&quot;orderNo&quot;</span>: 1, <span class="string">&quot;price&quot;</span>: 1, <span class="string">&quot;shipping.address&quot;</span>: 1 &#125; &#125;</span><br><span class="line">    ]</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220830094819835.png"                      alt="image-20220830094819835"                ></p><h2 id="修改视图"><a href="#修改视图" class="headerlink" title="修改视图"></a>修改视图</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">db.runCommand(&#123;</span><br><span class="line">    collMod: <span class="string">&quot;orderInfo&quot;</span>,</span><br><span class="line">    viewOn: <span class="string">&quot;order&quot;</span>,</span><br><span class="line">    pipeline: [</span><br><span class="line">        &#123; <span class="variable">$match</span>: &#123; <span class="string">&quot;orderTime&quot;</span>: &#123; <span class="variable">$gte</span>: ISODate(<span class="string">&quot;2020-04-13T16:00:00.000Z&quot;</span>) &#125; &#125; &#125;,</span><br><span class="line">        &#123; <span class="variable">$sort</span>: &#123; <span class="string">&quot;price&quot;</span>: -1 &#125; &#125;,</span><br><span class="line">        &#123; <span class="variable">$limit</span>: 10 &#125;,</span><br><span class="line">        //增加qty</span><br><span class="line">        &#123; <span class="variable">$project</span>: &#123; _id: 0, orderNo: 1, price: 1, qty: 1, orderTime: 1 &#125; &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220830094916569.png"                      alt="image-20220830094916569"                ></p><h2 id="删除视图"><a href="#删除视图" class="headerlink" title="删除视图"></a>删除视图</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.orderInfo.drop();</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;MongoDB视图是一个可查询的对象，它的内容由其他集合或视图上的聚合管道定义。 MongoDB不会将 视图内容持久化到磁盘。 当客户端查询视图时，视图的内容按需计算。 MongoDB可以要求客户端具有 查询视图的权限。 MongoDB不支持对视图进行写操作。&lt;/p&gt;
&lt;p</summary>
      
    
    
    
    
    <category term="MongoDB" scheme="http://example.com/tags/MongoDB/"/>
    
  </entry>
  
  <entry>
    <title>MongoDB之聚合操作</title>
    <link href="http://example.com/2022/08/29/MongoDB%E4%B9%8B%E8%81%9A%E5%90%88%E6%93%8D%E4%BD%9C/"/>
    <id>http://example.com/2022/08/29/MongoDB%E4%B9%8B%E8%81%9A%E5%90%88%E6%93%8D%E4%BD%9C/</id>
    <published>2022-08-29T08:56:21.000Z</published>
    <updated>2022-08-29T14:57:58.778Z</updated>
    
    <content type="html"><![CDATA[<p>聚合操作处理数据记录并返回计算结果(诸如统计平均值，求和等)。聚合操作组值来自多个文档，可以对 分组数据执行各种操作以返回单个结果。聚合操作包含三类：单一作用聚合、聚合管道、MapReduce。</p><ul><li>单一作用聚合：提供了对常见聚合过程的简单访问，操作都从单个集合聚合文档。 </li><li>聚合管道是一个数据聚合的框架，模型基于数据处理流水线的概念。文档进入多级管道，将文档转换为聚合结果。 </li><li>MapReduce操作具有两个阶段：处理每个文档并向每个输入文档发射一个或多个对象的map阶段，以及reduce组合map操作的输出阶段。</li></ul><hr><h2 id="单一作用聚合"><a href="#单一作用聚合" class="headerlink" title="单一作用聚合"></a>单一作用聚合</h2><p>MongoDB提供 db.collection.estimatedDocumentCount(), db.collection.count(), db.collection.distinct() 这类单一作用的聚合函数。 所有这些操作都聚合来自单个集合的文档。虽然这 些操作提供了对公共聚合过程的简单访问，但它们缺乏聚合管道和map-Reduce的灵活性和功能。</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220829170729522.png"                      alt="image-20220829170729522"                ></p><table><thead><tr><th>函数</th><th>描述</th></tr></thead><tbody><tr><td>db.collection.estimatedDocumentCount()</td><td>忽略查询条件，返回集合或视图中所有文档的计数</td></tr><tr><td>db.collection.count()</td><td>返回与find()集合或视图的查询匹配的文档计数 。等同于 db.collection.find(query).count()构造</td></tr><tr><td>db.collection.distinct()</td><td>在单个集合或视图中查找指定字段的不同值，并在数组中返回结果。</td></tr></tbody></table><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#检索books集合中所有文档的计数 </span></span><br><span class="line">db.books.estimatedDocumentCount() </span><br><span class="line"><span class="comment">#计算与查询匹配的所有文档 </span></span><br><span class="line">db.books.count(&#123;favCount:&#123;<span class="variable">$gt</span>:50&#125;&#125;) </span><br><span class="line"><span class="comment">#返回不同type的数组</span></span><br><span class="line">db.books.distinct(<span class="string">&quot;type&quot;</span>) </span><br><span class="line"><span class="comment">#返回收藏数大于90的文档不同type的数组 </span></span><br><span class="line">db.books.distinct(<span class="string">&quot;type&quot;</span>,&#123;favCount:&#123;<span class="variable">$gt</span>:90&#125;&#125;)</span><br></pre></td></tr></table></figure><p>注意：在分片群集上，如果存在孤立文档或正在进行块迁移，则db.collection.count()没有查询谓词可能 导致计数不准确。要避免这些情况，请在分片群集上使用 db.collection.aggregate()方法。</p><h2 id="聚合管道"><a href="#聚合管道" class="headerlink" title="聚合管道"></a>聚合管道</h2><h3 id="什么是-MongoDB-聚合框架"><a href="#什么是-MongoDB-聚合框架" class="headerlink" title="什么是 MongoDB 聚合框架"></a>什么是 MongoDB 聚合框架</h3><p>MongoDB 聚合框架（Aggregation Framework）是一个计算框架，它可以： </p><ul><li>作用在一个或几个集合上；</li><li>对集合中的数据进行的一系列运算； </li><li>将这些数据转化为期望的形式；</li></ul><p>从效果而言，聚合框架相当于 SQL 查询中的GROUP BY、 LEFT OUTER JOIN 、 AS等。 </p><h3 id="管道（Pipeline）和阶段（Stage）"><a href="#管道（Pipeline）和阶段（Stage）" class="headerlink" title="管道（Pipeline）和阶段（Stage）"></a>管道（Pipeline）和阶段（Stage）</h3><p>整个聚合运算过程称为管道（Pipeline），它是由多个阶段（Stage）组成的， 每个管道： </p><ul><li>接受一系列文档（原始数据）；</li><li>每个阶段对这些文档进行一系列运算；</li><li>结果文档输出给下一个阶段；</li></ul><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220829172754819.png"                      alt="image-20220829172754819"                ></p><p>聚合管道操作语法</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pipeline = [<span class="variable">$stage1</span>, <span class="variable">$stage2</span>, ...<span class="variable">$stageN</span>]; </span><br><span class="line">db.collection.aggregate(pipeline, &#123;options&#125;)</span><br></pre></td></tr></table></figure><ul><li>pipelines 一组数据聚合阶段。除$out、$Merge和$geonear阶段之外，每个阶段都可以在管道中出现多次。</li><li>options 可选，聚合操作的其他参数。包含：查询计划、是否使用临时文件、 游标、最大操作时间、读写策略、强制索引等等</li></ul><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220829181826782.png"                      alt="image-20220829181826782"                ></p><blockquote><p>常用的管道聚合阶段</p></blockquote><p>聚合管道包含非常丰富的聚合阶段，下面是最常用的聚合阶段</p><table><thead><tr><th>阶段</th><th>描述</th><th>SQL等价运算符</th></tr></thead><tbody><tr><td>$match</td><td>筛选条件</td><td>WHERE</td></tr><tr><td>$project</td><td>投影</td><td>AS</td></tr><tr><td>$lookup</td><td>左外连接</td><td>LEFT OUTER JOIN</td></tr><tr><td>$sort</td><td>排序</td><td>ORDER BY</td></tr><tr><td>$group</td><td>分组</td><td>GROUP BY</td></tr><tr><td>$skip&#x2F;$limit</td><td>分页</td><td></td></tr><tr><td>$unwind</td><td>展开数组</td><td></td></tr><tr><td>$graphLookup</td><td>图搜索</td><td></td></tr><tr><td>$facet&#x2F;$bucket</td><td>分面搜索</td><td></td></tr></tbody></table><p>文档：<a class="link"   href="https://www.mongodb.com/docs/manual/reference/operator/aggregation-pipeline/" >Aggregation Pipeline Stages — MongoDB Manual<i class="fas fa-external-link-alt"></i></a></p><h4 id="数据准备"><a href="#数据准备" class="headerlink" title="数据准备"></a>数据准备</h4><p>准备数据集，执行脚本</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> tags = [<span class="string">&quot;nosql&quot;</span>,<span class="string">&quot;mongodb&quot;</span>,<span class="string">&quot;document&quot;</span>,<span class="string">&quot;developer&quot;</span>,<span class="string">&quot;popular&quot;</span>];</span><br><span class="line"><span class="keyword">var</span> types = [<span class="string">&quot;technology&quot;</span>,<span class="string">&quot;sociality&quot;</span>,<span class="string">&quot;travel&quot;</span>,<span class="string">&quot;novel&quot;</span>,<span class="string">&quot;literature&quot;</span>]; <span class="keyword">var</span> books=[];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">50</span>;i++)&#123;</span><br><span class="line">    <span class="keyword">var</span> typeIdx = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>()*types.<span class="property">length</span>); </span><br><span class="line">    <span class="keyword">var</span> tagIdx = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>()*tags.<span class="property">length</span>); </span><br><span class="line">    <span class="keyword">var</span> tagIdx2 = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>()*tags.<span class="property">length</span>); </span><br><span class="line">    <span class="keyword">var</span> favCount = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>()*<span class="number">100</span>);</span><br><span class="line">    <span class="keyword">var</span> username = <span class="string">&quot;xx00&quot;</span>+<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>()*<span class="number">10</span>); </span><br><span class="line">    <span class="keyword">var</span> age = <span class="number">20</span> + <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>()*<span class="number">15</span>);</span><br><span class="line">    <span class="keyword">var</span> book = &#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&quot;book-&quot;</span>+i,</span><br><span class="line">        <span class="attr">type</span>: types[typeIdx],</span><br><span class="line">        <span class="attr">tag</span>: [tags[tagIdx],tags[tagIdx2]], </span><br><span class="line">        <span class="attr">favCount</span>: favCount,</span><br><span class="line">        <span class="attr">author</span>: &#123;<span class="attr">name</span>:username,<span class="attr">age</span>:age&#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    books.<span class="title function_">push</span>(book)</span><br><span class="line">&#125;</span><br><span class="line">db.<span class="property">books</span>.<span class="title function_">insertMany</span>(books);</span><br></pre></td></tr></table></figure><h4 id="project"><a href="#project" class="headerlink" title="$project"></a>$project</h4><p> 投影操作， 将原始字段投影成指定名称， 如将集合中的 title 投影成 name</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.books.aggregate([&#123;<span class="variable">$project</span>:&#123;name:<span class="string">&quot;<span class="variable">$title</span>&quot;</span>&#125;&#125;])</span><br></pre></td></tr></table></figure><p>$project 可以灵活控制输出文档的格式，也可以剔除不需要的字段</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.books.aggregate([&#123;<span class="variable">$project</span>:&#123;name:<span class="string">&quot;<span class="variable">$title</span>&quot;</span>,_id:0,<span class="built_in">type</span>:1,author:1&#125;&#125;])</span><br></pre></td></tr></table></figure><p>从嵌套文档中排除字段</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.books.aggregate([ </span><br><span class="line">    &#123;<span class="variable">$project</span>:&#123;name:<span class="string">&quot;<span class="variable">$title</span>&quot;</span>,_id:0,<span class="built_in">type</span>:1,<span class="string">&quot;author.name&quot;</span>:1&#125;&#125; ])</span><br><span class="line">或者</span><br><span class="line">db.books.aggregate([ </span><br><span class="line">    &#123;<span class="variable">$project</span>:&#123;name:<span class="string">&quot;<span class="variable">$title</span>&quot;</span>,_id:0,<span class="built_in">type</span>:1,author:&#123;name:1&#125;&#125;&#125; ])</span><br></pre></td></tr></table></figure><h4 id="match"><a href="#match" class="headerlink" title="$match"></a>$match</h4><p>$match用于对文档进行筛选，之后可以在得到的文档子集上做聚合，$match可以使用除了地理空间之外的所有常规查询操作符，在实际应用中尽可能将$match放在管道的前面位置。这样有两个好处：一是 可以快速将不需要的文档过滤掉，以减少管道的工作量；二是如果再投射和分组之前执行$match，查询可以使用索引。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.books.aggregate([&#123;<span class="variable">$match</span>:&#123;<span class="built_in">type</span>:<span class="string">&quot;technology&quot;</span>&#125;&#125;])</span><br></pre></td></tr></table></figure><p>筛选管道操作和其他管道操作配合时候时，尽量放到开始阶段，这样可以减少后续管道操作符要操作的文档数，提升效率</p><h4 id="count"><a href="#count" class="headerlink" title="$count"></a>$count</h4><p>计数并返回与查询匹配的结果数</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.books.aggregate([    &#123;<span class="variable">$match</span>:&#123;<span class="built_in">type</span>:<span class="string">&quot;technology&quot;</span>&#125;&#125;,    &#123;<span class="variable">$count</span>: <span class="string">&quot;type_count&quot;</span>&#125; ])</span><br></pre></td></tr></table></figure><p>$match阶段筛选出type匹配technology的文档，并传到下一阶段； </p><p>$count阶段返回聚合管道中剩余文档的计数，并将该值分配给type_count</p><h4 id="group"><a href="#group" class="headerlink" title="$group"></a>$group</h4><p>按指定的表达式对文档进行分组，并将每个不同分组的文档输出到下一个阶段。输出文档包含一个_id字段，该字段按键包含不同的组。<br>输出文档还可以包含计算字段，该字段保存由$group的_id字段分组的一些accumulator表达式的值。 $group不会输出具体的文档而只是统计信息。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="variable">$group</span>: &#123; _id: &lt;expression&gt;, &lt;field1&gt;: &#123; &lt;accumulator1&gt; : &lt;expression1&gt; &#125;, ... &#125; &#125;</span><br></pre></td></tr></table></figure><ul><li>id字段是必填的;但是，可以指定id值为null来为整个输入文档计算累计值。 </li><li>剩余的计算字段是可选的，并使用运算符进行计算。 </li><li>_id和表达式可以接受任何有效的表达式。</li></ul><blockquote><p>accumulator操作符</p></blockquote><table><thead><tr><th>名称</th><th>描述</th><th>类比 sql</th></tr></thead><tbody><tr><td>$avg</td><td>计算均值</td><td>avg</td></tr><tr><td>$first</td><td>返回每组第一个文档，如果有排序，按照排序，如果没有按照默认的存储的顺序的第一个文档。</td><td>limit 0,1</td></tr><tr><td>$last</td><td>返回每组最后一个文档，如果有排序，按照排序，如果没有按照默认 的存储的顺序的最后个文档。</td><td></td></tr><tr><td>$max</td><td>根据分组，获取集合中所有文档对应值得最大值。</td><td>max</td></tr><tr><td>$min</td><td>根据分组，获取集合中所有文档对应值得最小值。</td><td>min</td></tr><tr><td>$push</td><td>将指定的表达式的值添加到一个数组中。</td><td></td></tr><tr><td>$addToSet</td><td>将表达式的值添加到一个集合中（无重复值，无序）。</td><td>sum</td></tr><tr><td>$sum</td><td>计算总和</td><td></td></tr><tr><td>$stdDevPop</td><td>返回输入值的总体标准偏差（population standard deviation）</td><td></td></tr><tr><td>$stdDevSamp</td><td>返回输入值的样本标准偏差（the sample standard deviation）</td><td></td></tr></tbody></table><p>$group阶段的内存限制为100M。默认情况下，如果stage超过此限制，$group将产生错误。但是，要允许处理大型数据集，请将allowDiskUse选项设置为true以启用$group操作以写入临时文件。</p><blockquote><p>book的数量，收藏总数和平均值</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.books.aggregate([ </span><br><span class="line">    &#123;<span class="variable">$group</span>:&#123;_id:null,count:&#123;<span class="variable">$sum</span>:1&#125;,pop:&#123;<span class="variable">$sum</span>:<span class="string">&quot;<span class="variable">$favCount</span>&quot;</span>&#125;,avg: &#123;<span class="variable">$avg</span>:<span class="string">&quot;<span class="variable">$favCount</span>&quot;</span>&#125;&#125;&#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure><blockquote><p>统计每个作者的book收藏总数</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.books.aggregate([ </span><br><span class="line">    &#123;<span class="variable">$group</span>:&#123;_id:<span class="string">&quot;<span class="variable">$author</span>.name&quot;</span>,pop:&#123;<span class="variable">$sum</span>:<span class="string">&quot;<span class="variable">$favCount</span>&quot;</span>&#125;&#125;&#125; </span><br><span class="line">])</span><br></pre></td></tr></table></figure><blockquote><p>统计每个作者的每本book的收藏数</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.books.aggregate([ </span><br><span class="line">    &#123;<span class="variable">$group</span>:&#123;_id:&#123;name:<span class="string">&quot;<span class="variable">$author</span>.name&quot;</span>,title:<span class="string">&quot;<span class="variable">$title</span>&quot;</span>&#125;,pop:&#123;<span class="variable">$sum</span>:<span class="string">&quot;<span class="variable">$favCount</span>&quot;</span>&#125;&#125;&#125; ])</span><br></pre></td></tr></table></figure><blockquote><p>每个作者的book的type合集</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.books.aggregate([ </span><br><span class="line">    &#123;<span class="variable">$group</span>:&#123;_id:<span class="string">&quot;<span class="variable">$author</span>.name&quot;</span>,types:&#123;<span class="variable">$addToSet</span>:<span class="string">&quot;<span class="variable">$type</span>&quot;</span>&#125;&#125;&#125; </span><br><span class="line">])</span><br></pre></td></tr></table></figure><h4 id="unwind"><a href="#unwind" class="headerlink" title="$unwind"></a>$unwind</h4><p>可以将数组拆分为单独的文档<br>v3.2+支持如下语法：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="variable">$unwind</span>:</span><br><span class="line">    &#123;</span><br><span class="line">     <span class="comment">#要指定字段路径，在字段名称前加上$符并用引号括起来。</span></span><br><span class="line">      path: &lt;field path&gt;, </span><br><span class="line">      <span class="comment">#可选,一个新字段的名称用于存放元素的数组索引。该名称不能以$开头。 </span></span><br><span class="line">      includeArrayIndex: &lt;string&gt;,</span><br><span class="line">      <span class="comment">#可选，default :false，若为true,如果路径为空，缺少或为空数组，则$unwind输出文档 </span></span><br><span class="line">      preserveNullAndEmptyArrays: &lt;boolean&gt;</span><br><span class="line"> &#125; &#125;</span><br></pre></td></tr></table></figure><blockquote><p>姓名为xx006的作者的book的tag数组拆分为多个文档</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.books.aggregate([ </span><br><span class="line">    &#123;<span class="variable">$match</span>:&#123;<span class="string">&quot;author.name&quot;</span>:<span class="string">&quot;xx006&quot;</span>&#125;&#125;, </span><br><span class="line">    &#123;<span class="variable">$unwind</span>:<span class="string">&quot;<span class="variable">$tag</span>&quot;</span>&#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure><blockquote><p>每个作者的book的tag合集</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.books.aggregate([</span><br><span class="line">    &#123;<span class="variable">$unwind</span>:<span class="string">&quot;<span class="variable">$tag</span>&quot;</span>&#125;, </span><br><span class="line">    &#123;<span class="variable">$group</span>:&#123;_id:<span class="string">&quot;<span class="variable">$author</span>.name&quot;</span>,types:&#123;<span class="variable">$addToSet</span>:<span class="string">&quot;<span class="variable">$tag</span>&quot;</span>&#125;&#125;&#125; </span><br><span class="line">])</span><br></pre></td></tr></table></figure><blockquote><p>案例 </p></blockquote><p>示例数据</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">db.books.insert([</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;title&quot;</span> : <span class="string">&quot;book-51&quot;</span>, </span><br><span class="line">    <span class="string">&quot;type&quot;</span> : <span class="string">&quot;technology&quot;</span>, </span><br><span class="line">    <span class="string">&quot;favCount&quot;</span> : 11, </span><br><span class="line">     <span class="string">&quot;tag&quot;</span>:[],</span><br><span class="line">    <span class="string">&quot;author&quot;</span> : &#123; </span><br><span class="line">        <span class="string">&quot;name&quot;</span> : <span class="string">&quot;fox&quot;</span>, </span><br><span class="line">        <span class="string">&quot;age&quot;</span> : 28</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,&#123;</span><br><span class="line">    <span class="string">&quot;title&quot;</span> : <span class="string">&quot;book-52&quot;</span>, </span><br><span class="line">    <span class="string">&quot;type&quot;</span> : <span class="string">&quot;technology&quot;</span>, </span><br><span class="line">    <span class="string">&quot;favCount&quot;</span> : 15, </span><br><span class="line">    <span class="string">&quot;author&quot;</span> : &#123; </span><br><span class="line">        <span class="string">&quot;name&quot;</span> : <span class="string">&quot;fox&quot;</span>, </span><br><span class="line">        <span class="string">&quot;age&quot;</span> : 28</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,&#123;</span><br><span class="line">    <span class="string">&quot;title&quot;</span> : <span class="string">&quot;book-53&quot;</span>, </span><br><span class="line">    <span class="string">&quot;type&quot;</span> : <span class="string">&quot;technology&quot;</span>, </span><br><span class="line">    <span class="string">&quot;tag&quot;</span> : [ </span><br><span class="line">        <span class="string">&quot;nosql&quot;</span>, </span><br><span class="line">        <span class="string">&quot;document&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;favCount&quot;</span> : 20, </span><br><span class="line">    <span class="string">&quot;author&quot;</span> : &#123; </span><br><span class="line">        <span class="string">&quot;name&quot;</span> : <span class="string">&quot;fox&quot;</span>, </span><br><span class="line">        <span class="string">&quot;age&quot;</span> : 28</span><br><span class="line">    &#125;</span><br><span class="line">&#125;])</span><br></pre></td></tr></table></figure><p>测试</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用includeArrayIndex选项来输出数组元素的数组索引</span></span><br><span class="line">db.books.aggregate([</span><br><span class="line">    &#123;<span class="variable">$match</span>:&#123;<span class="string">&quot;author.name&quot;</span>:<span class="string">&quot;fox&quot;</span>&#125;&#125;,</span><br><span class="line">    &#123;<span class="variable">$unwind</span>:&#123;path:<span class="string">&quot;<span class="variable">$tag</span>&quot;</span>, includeArrayIndex: <span class="string">&quot;arrayIndex&quot;</span>&#125;&#125;</span><br><span class="line">])</span><br><span class="line"><span class="comment"># 使用preserveNullAndEmptyArrays选项在输出中包含缺少size字段，null或空数组的文档 </span></span><br><span class="line">db.books.aggregate([</span><br><span class="line">    &#123;<span class="variable">$match</span>:&#123;<span class="string">&quot;author.name&quot;</span>:<span class="string">&quot;fox&quot;</span>&#125;&#125;,</span><br><span class="line">    &#123;<span class="variable">$unwind</span>:&#123;path:<span class="string">&quot;<span class="variable">$tag</span>&quot;</span>, preserveNullAndEmptyArrays: <span class="literal">true</span>&#125;&#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure><h4 id="limit"><a href="#limit" class="headerlink" title="$limit"></a>$limit</h4><p>限制传递到管道中下一阶段的文档数</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.books.aggregate([ </span><br><span class="line">    &#123;<span class="variable">$limit</span> : 5 &#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure><p>此操作仅返回管道传递给它的前5个文档。 $limit对其传递的文档内容没有影响。<br>注意：当$sort在管道中的$limit之前立即出现时，$sort操作只会在过程中维持前n个结果，其中n是指定的限制，而MongoDB只需要将n个项存储在内存中。</p><h4 id="skip"><a href="#skip" class="headerlink" title="$skip"></a>$skip</h4><p>跳过进入stage的指定数量的文档，并将其余文档传递到管道中的下一个阶段</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.books.aggregate([ </span><br><span class="line">    &#123;<span class="variable">$skip</span> : 5 &#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure><p>此操作将跳过管道传递给它的前5个文档。 $skip对沿着管道传递的文档的内容没有影响。</p><h4 id="sort"><a href="#sort" class="headerlink" title="$sort"></a>$sort</h4><p>对所有输入文档进行排序，并按排序顺序将它们返回到管道。<br>语法：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="variable">$sort</span>: &#123; &lt;field1&gt;: &lt;<span class="built_in">sort</span> order&gt;, &lt;field2&gt;: &lt;<span class="built_in">sort</span> order&gt; ... &#125; &#125;</span><br></pre></td></tr></table></figure><p>要对字段进行排序，请将排序顺序设置为1或-1，以分别指定升序或降序排序，如下例所示：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.books.aggregate([</span><br><span class="line">    &#123;<span class="variable">$sort</span> : &#123;favCount:-1,title:1&#125;&#125; </span><br><span class="line">    ])</span><br></pre></td></tr></table></figure><h4 id="lookup"><a href="#lookup" class="headerlink" title="$lookup"></a>$lookup</h4><p>Mongodb 3.2版本新增，主要用来实现多表关联查询， 相当关系型数据库中多表关联查询。每个输入待处理的文档，经过$lookup 阶段的处理，输出的新文档中会包含一个新生成的数组（可根据需要命名 新key ）。数组列存放的数据是来自被Join集合的适配文档，如果没有，集合为空（即 为[ ])<br>语法：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">db.collection.aggregate([&#123;</span><br><span class="line">      <span class="variable">$lookup</span>: &#123;</span><br><span class="line">             from: <span class="string">&quot;&lt;collection to join&gt;&quot;</span>,</span><br><span class="line">             localField: <span class="string">&quot;&lt;field from the input documents&gt;&quot;</span>, </span><br><span class="line">             foreignField: <span class="string">&quot;&lt;field from the documents of the from collection&gt;&quot;</span>, </span><br><span class="line">             as: <span class="string">&quot;&lt;output array field&gt;&quot;</span></span><br><span class="line">           &#125;</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><table><thead><tr><th>属性</th><th>作用</th></tr></thead><tbody><tr><td>from</td><td>同一个数据库下等待被Join的集合。</td></tr><tr><td>localField</td><td>源集合中的match值，如果输入的集合中，某文档没有 localField这个Key （Field），在处理的过程中，会默认为此文档含有 localField：null的键值对。</td></tr><tr><td>foreignField</td><td>待Join的集合的match值，如果待Join的集合中，文档没有foreignField值，在处 理的过程中，会默认为此文档含有 foreignField：null的键值对。</td></tr><tr><td>as</td><td>为输出文档的新增值命名。如果输入的集合中已存在该值，则会覆盖掉</td></tr></tbody></table><p>注意：null &#x3D; null 此为真</p><p>其语法功能类似于下面的伪SQL语句：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span>, <span class="operator">&lt;</span>output <span class="keyword">array</span> field<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">FROM</span> collection</span><br><span class="line"><span class="keyword">WHERE</span> <span class="operator">&lt;</span>output <span class="keyword">array</span> field<span class="operator">&gt;</span> <span class="keyword">IN</span> (<span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line">                               <span class="keyword">FROM</span> <span class="operator">&lt;</span>collection <span class="keyword">to</span> <span class="keyword">join</span><span class="operator">&gt;</span> </span><br><span class="line">                               <span class="keyword">WHERE</span> <span class="operator">&lt;</span>foreignField<span class="operator">&gt;=</span> <span class="operator">&lt;</span>collection.localField<span class="operator">&gt;</span>);</span><br></pre></td></tr></table></figure><p><strong>案例</strong><br>数据准备</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.customer.insert(&#123;customerCode:1,name:<span class="string">&quot;customer1&quot;</span>,phone:<span class="string">&quot;13112345678&quot;</span>,address: <span class="string">&quot;test1&quot;</span>&#125;) db.customer.insert(&#123;customerCode:2,name:<span class="string">&quot;customer2&quot;</span>,phone:<span class="string">&quot;13112345679&quot;</span>,address: <span class="string">&quot;test2&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">db.order.insert(&#123;orderId:1,orderCode:<span class="string">&quot;order001&quot;</span>,customerCode:1,price:200&#125;) db.order.insert(&#123;orderId:2,orderCode:<span class="string">&quot;order002&quot;</span>,customerCode:2,price:400&#125;)</span><br><span class="line"></span><br><span class="line">db.orderItem.insert(&#123;itemId:1,productName:<span class="string">&quot;apples&quot;</span>,qutity:2,orderId:1&#125;) db.orderItem.insert(&#123;itemId:2,productName:<span class="string">&quot;oranges&quot;</span>,qutity:2,orderId:1&#125;) db.orderItem.insert(&#123;itemId:3,productName:<span class="string">&quot;mangoes&quot;</span>,qutity:2,orderId:1&#125;) db.orderItem.insert(&#123;itemId:4,productName:<span class="string">&quot;apples&quot;</span>,qutity:2,orderId:2&#125;) db.orderItem.insert(&#123;itemId:5,productName:<span class="string">&quot;oranges&quot;</span>,qutity:2,orderId:2&#125;) db.orderItem.insert(&#123;itemId:6,productName:<span class="string">&quot;mangoes&quot;</span>,qutity:2,orderId:2&#125;)</span><br></pre></td></tr></table></figure><blockquote><p>关联查询</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">db.customer.aggregate([</span><br><span class="line">    &#123;<span class="variable">$lookup</span>: &#123;</span><br><span class="line">       from: <span class="string">&quot;order&quot;</span>, </span><br><span class="line">       localField: <span class="string">&quot;customerCode&quot;</span>, </span><br><span class="line">       foreignField: <span class="string">&quot;customerCode&quot;</span>, </span><br><span class="line">       as: <span class="string">&quot;customerOrder&quot;</span></span><br><span class="line">     &#125;</span><br><span class="line">    &#125;</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">db.order.aggregate([ </span><br><span class="line">    &#123;<span class="variable">$lookup</span>: &#123; </span><br><span class="line">               from: <span class="string">&quot;customer&quot;</span>,</span><br><span class="line">               localField: <span class="string">&quot;customerCode&quot;</span>, </span><br><span class="line">               foreignField: <span class="string">&quot;customerCode&quot;</span>, </span><br><span class="line">               as: <span class="string">&quot;curstomer&quot;</span></span><br><span class="line">             &#125;</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;<span class="variable">$lookup</span>: &#123;</span><br><span class="line">               from: <span class="string">&quot;orderItem&quot;</span>, </span><br><span class="line">               localField: <span class="string">&quot;orderId&quot;</span>, </span><br><span class="line">               foreignField: <span class="string">&quot;orderId&quot;</span>, </span><br><span class="line">               as: <span class="string">&quot;orderItem&quot;</span></span><br><span class="line">             &#125;</span><br><span class="line">    &#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure><p><strong>聚合操作示例1</strong></p><blockquote><p>统计每个分类的book文档数量</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.books.aggregate([ </span><br><span class="line">    &#123;<span class="variable">$group</span>:&#123;_id:<span class="string">&quot;<span class="variable">$type</span>&quot;</span>,total:&#123;<span class="variable">$sum</span>:1&#125;&#125;&#125;, </span><br><span class="line">    &#123;<span class="variable">$sort</span>:&#123;total:-1&#125;&#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure><blockquote><p>标签的热度排行，标签的热度则按其关联book文档的收藏数（favCount）来计算</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">db.books.aggregate([ </span><br><span class="line">    &#123;<span class="variable">$match</span>:&#123;favCount:&#123;<span class="variable">$gt</span>:0&#125;&#125;&#125;, </span><br><span class="line">    &#123;<span class="variable">$unwind</span>:<span class="string">&quot;<span class="variable">$tag</span>&quot;</span>&#125;, </span><br><span class="line">    &#123;<span class="variable">$group</span>:&#123;_id:<span class="string">&quot;<span class="variable">$tag</span>&quot;</span>,total:&#123;<span class="variable">$sum</span>:<span class="string">&quot;<span class="variable">$favCount</span>&quot;</span>&#125;&#125;&#125;, </span><br><span class="line">    &#123;<span class="variable">$sort</span>:&#123;total:-1&#125;&#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure><ol><li>$match阶段：用于过滤favCount&#x3D;0的文档。</li><li>$unwind阶段：用于将标签数组进行展开，这样一个包含3个标签的文档会被拆解为3个条目。 </li><li><ol start="3"><li>$group阶段：对拆解后的文档进行分组计算，$sum：”$favCount”表示按favCount字段进行累<br>加。</li></ol></li><li>$sort阶段：接收分组计算的输出，按total得分进行排序。</li></ol><p><strong>统计book文档收藏数[0,10),[10,60),[60,80),[80,100),[100,+∞）</strong><br><a class="link"   href="https://docs.mongodb.com/manual/reference/operator/aggregation/bucket/" >https://docs.mongodb.com/manual/reference/operator/aggregation/bucket/<i class="fas fa-external-link-alt"></i></a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">db.books.aggregate([&#123;</span><br><span class="line">    <span class="variable">$bucket</span>:&#123; </span><br><span class="line">        groupBy:<span class="string">&quot;<span class="variable">$favCount</span>&quot;</span>, </span><br><span class="line">        boundaries:[0,10,60,80,100], </span><br><span class="line">        default:<span class="string">&quot;other&quot;</span>, </span><br><span class="line">        output:&#123;<span class="string">&quot;count&quot;</span>:&#123;<span class="variable">$sum</span>:1&#125;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;])</span><br></pre></td></tr></table></figure><p><strong>聚合操作示例2</strong></p><p>导入邮政编码数据集 :<a class="link"   href="https://media.mongodb.org/zips.json" >https://media.mongodb.org/zips.json<i class="fas fa-external-link-alt"></i></a><br>使用mongoimport工具导入数据（<a class="link"   href="https://www.mongodb.com/try/download/database-tools%EF%BC%89" >https://www.mongodb.com/try/download/database-tools）<i class="fas fa-external-link-alt"></i></a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mongoimport -h 192.168.65.204 -d aggdemo -u fox -p fox --</span><br><span class="line">authenticationDatabase=admin -c zips --file </span><br><span class="line">D:\ProgramData\mongodb\import\zips.json</span><br></pre></td></tr></table></figure><blockquote><p>h,–host ：代表远程连接的数据库地址，默认连接本地Mongo数据库；<br>–port：代表远程连接的数据库的端口，默认连接的远程端口27017；<br>-u,–username：代表连接远程数据库的账号，如果设置数据库的认证，需要指定用户账号；<br>-p,–password：代表连接数据库的账号对应的密码；<br>-d,–db：代表连接的数据库；<br>-c,–collection：代表连接数据库中的集合；<br>-f, –fields：代表导入集合中的字段；<br>–type：代表导入的文件类型，包括csv和json,tsv文件，默认json格式；<br>–file：导入的文件名称<br>–headerline：导入csv文件时，指明第一行是列名，不需要导入；</p></blockquote><blockquote><p>返回人口超过1000万的州</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.zips.aggregate( [</span><br><span class="line">   &#123; <span class="variable">$group</span>: &#123; _id: <span class="string">&quot;<span class="variable">$state</span>&quot;</span>, totalPop: &#123; <span class="variable">$sum</span>: <span class="string">&quot;<span class="variable">$pop</span>&quot;</span> &#125; &#125; &#125;, </span><br><span class="line">   &#123; <span class="variable">$match</span>: &#123; totalPop: &#123; <span class="variable">$gt</span>: 10*1000*1000 &#125; &#125; &#125;</span><br><span class="line">] )</span><br></pre></td></tr></table></figure><p>这个聚合操作的等价SQL是:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> state, <span class="built_in">SUM</span>(pop) <span class="keyword">AS</span> totalPop <span class="keyword">FROM</span> zips</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> state</span><br><span class="line"><span class="keyword">HAVING</span> totalPop <span class="operator">&gt;=</span> (<span class="number">10</span><span class="operator">*</span><span class="number">1000</span><span class="operator">*</span><span class="number">1000</span>)</span><br></pre></td></tr></table></figure><blockquote><p>返回各州平均城市人口</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">db.zips.aggregate( [</span><br><span class="line">   &#123; <span class="variable">$group</span>: &#123; _id: &#123; state: <span class="string">&quot;<span class="variable">$state</span>&quot;</span>, city: <span class="string">&quot;<span class="variable">$city</span>&quot;</span> &#125;, cityPop: &#123; <span class="variable">$sum</span>: <span class="string">&quot;<span class="variable">$pop</span>&quot;</span> &#125; </span><br><span class="line">   &#125; &#125;,</span><br><span class="line">   &#123; <span class="variable">$group</span>: &#123; _id: <span class="string">&quot;<span class="variable">$_id</span>.state&quot;</span>, avgCityPop: &#123; <span class="variable">$avg</span>: <span class="string">&quot;<span class="variable">$cityPop</span>&quot;</span> &#125; &#125; &#125;,</span><br><span class="line">   &#123; <span class="variable">$sort</span>:&#123;avgCityPop:-1&#125;&#125;</span><br><span class="line">] )</span><br></pre></td></tr></table></figure><blockquote><p>按州返回最大和最小的城市</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">db.zips.aggregate( [ </span><br><span class="line">   &#123; <span class="variable">$group</span>:</span><br><span class="line">      &#123;</span><br><span class="line">              _id: &#123; state: <span class="string">&quot;<span class="variable">$state</span>&quot;</span>, city: <span class="string">&quot;<span class="variable">$city</span>&quot;</span> &#125;,</span><br><span class="line">        pop: &#123; <span class="variable">$sum</span>: <span class="string">&quot;<span class="variable">$pop</span>&quot;</span> &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;,</span><br><span class="line">   &#123; <span class="variable">$sort</span>: &#123; pop: 1 &#125; &#125;,</span><br><span class="line">   &#123; <span class="variable">$group</span>:</span><br><span class="line">      &#123;</span><br><span class="line">        _id : <span class="string">&quot;<span class="variable">$_id</span>.state&quot;</span>,</span><br><span class="line">        biggestCity:  &#123; <span class="variable">$last</span>: <span class="string">&quot;<span class="variable">$_id</span>.city&quot;</span> &#125;,</span><br><span class="line">        biggestPop:   &#123; <span class="variable">$last</span>: <span class="string">&quot;<span class="variable">$pop</span>&quot;</span> &#125;,</span><br><span class="line">        smallestCity: &#123; <span class="variable">$first</span>: <span class="string">&quot;<span class="variable">$_id</span>.city&quot;</span> &#125;, </span><br><span class="line">        smallestPop:  &#123; <span class="variable">$first</span>: <span class="string">&quot;<span class="variable">$pop</span>&quot;</span> &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;,</span><br><span class="line">  &#123; <span class="variable">$project</span>:</span><br><span class="line">    &#123; _id: 0,</span><br><span class="line">      state: <span class="string">&quot;<span class="variable">$_id</span>&quot;</span>,</span><br><span class="line">      biggestCity:  &#123; name: <span class="string">&quot;<span class="variable">$biggestCity</span>&quot;</span>,  pop: <span class="string">&quot;<span class="variable">$biggestPop</span>&quot;</span> &#125;, </span><br><span class="line">      smallestCity: &#123; name: <span class="string">&quot;<span class="variable">$smallestCity</span>&quot;</span>, pop: <span class="string">&quot;<span class="variable">$smallestPop</span>&quot;</span> &#125; </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">   &#123; <span class="variable">$sort</span>: &#123; state: 1 &#125; &#125;</span><br><span class="line">] )</span><br></pre></td></tr></table></figure><h2 id="MapReduce"><a href="#MapReduce" class="headerlink" title="MapReduce"></a>MapReduce</h2><p>MapReduce操作将大量的数据处理工作拆分成多个线程并行处理，然后将结果合并在一起。MongoDB 提供的Map-Reduce非常灵活，对于大规模数据分析也相当实用。<br>MapReduce具有两个阶段：</p><ol><li>将具有相同Key的文档数据整合在一起的map阶段</li><li>组合map操作的结果进行统计输出的reduce阶段</li></ol><blockquote><p>MapReduce的基本语法</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">db.collection.mapReduce(</span><br><span class="line">   <span class="function"><span class="title">function</span></span>() &#123;emit(key,value);&#125;,  //map 函数 </span><br><span class="line">   <span class="keyword">function</span>(key,values) &#123;<span class="built_in">return</span> reduceFunction&#125;,   //reduce 函数 </span><br><span class="line">   &#123;</span><br><span class="line">      out: &lt;collection&gt;,</span><br><span class="line">      query: &lt;document&gt;,</span><br><span class="line">      <span class="built_in">sort</span>: &lt;document&gt;,</span><br><span class="line">      <span class="built_in">limit</span>: &lt;number&gt;,</span><br><span class="line">     finalize: &lt;<span class="keyword">function</span>&gt;,</span><br><span class="line">     scope: &lt;document&gt;,</span><br><span class="line">     jsMode: &lt;boolean&gt;,</span><br><span class="line">     verbose: &lt;boolean&gt;,</span><br><span class="line">     bypassDocumentValidation: &lt;boolean&gt;</span><br><span class="line">   &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><ul><li>map，将数据拆分成键值对，交给reduce函数 </li><li>reduce，根据键将值做统计运算 </li><li>out，可选，将结果汇入指定表 </li><li>quey，可选筛选数据的条件，筛选的数据送入map </li><li>sort，排序完后，送入map</li><li>limit，限制送入map的文档数</li><li>finalize，可选，修改reduce的结果后进行输出 </li><li>scope，可选，指定map、reduce、finalize的全局变量 </li><li>jsMode，可选，默认false。在mapreduce过程中是否将数 据转换成bson格式。 </li><li>verbose，可选，是否在结果中显示时间，默认false</li><li>bypassDocmentValidation，可选，是否略过数据校验</li></ul><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220829225109887.png"                      alt="image-20220829225109887"                ></p><h2 id="Springboot中整合MongoDB进行聚合操作"><a href="#Springboot中整合MongoDB进行聚合操作" class="headerlink" title="Springboot中整合MongoDB进行聚合操作"></a>Springboot中整合MongoDB进行聚合操作</h2><p>MongoTemplate提供了aggregate方法来实现对数据的聚合操作。</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220829225214539.png"                      alt="image-20220829225214539"                ></p><blockquote><p>基于聚合管道mongodb提供的可操作的内容</p></blockquote><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220829225233836.png"                      alt="image-20220829225233836"                ></p><blockquote><p>基于聚合操作Aggregation.group，mongodb提供可选的表达式</p></blockquote><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220829225249700.png"                      alt="image-20220829225249700"                ></p><p><strong>示例：以聚合管道示例2为例</strong> </p><p>实体结构</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Document(&quot;zips&quot;)</span> </span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Zips</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span>   <span class="comment">//映射文档中的_id </span></span><br><span class="line">    <span class="keyword">private</span> String id; </span><br><span class="line">    <span class="meta">@Field</span></span><br><span class="line">    <span class="keyword">private</span> String city; </span><br><span class="line">    <span class="meta">@Field</span></span><br><span class="line">    <span class="keyword">private</span> Double[] loc; </span><br><span class="line">    <span class="meta">@Field</span></span><br><span class="line">    <span class="keyword">private</span> Integer pop; </span><br><span class="line">    <span class="meta">@Field</span></span><br><span class="line">    <span class="keyword">private</span> String state;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>返回人口超过1000万的州</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.zips.aggregate( [</span><br><span class="line">   &#123; <span class="variable">$group</span>: &#123; _id: <span class="string">&quot;<span class="variable">$state</span>&quot;</span>, totalPop: &#123; <span class="variable">$sum</span>: <span class="string">&quot;<span class="variable">$pop</span>&quot;</span> &#125; &#125; &#125;, </span><br><span class="line">   &#123; <span class="variable">$match</span>: &#123; totalPop: &#123; <span class="variable">$gt</span>: 10*1000*1000 &#125; &#125; &#125;</span><br><span class="line">] )</span><br></pre></td></tr></table></figure><p>java实现</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//$group</span></span><br><span class="line">    <span class="type">GroupOperation</span> <span class="variable">groupOperation</span> <span class="operator">=</span>Aggregation.group(<span class="string">&quot;state&quot;</span>).sum(<span class="string">&quot;pop&quot;</span>).as(<span class="string">&quot;totalPop&quot;</span>);</span><br><span class="line">    </span><br><span class="line">        <span class="comment">//$match</span></span><br><span class="line">    <span class="type">MatchOperation</span> <span class="variable">matchOperation</span> <span class="operator">=</span> Aggregation.match( Criteria.where(<span class="string">&quot;totalPop&quot;</span>).gte(<span class="number">10</span>*<span class="number">1000</span>*<span class="number">1000</span>));</span><br><span class="line">    </span><br><span class="line">        <span class="comment">// 按顺序组合每一个聚合步骤 </span></span><br><span class="line">    TypedAggregation&lt;Zips&gt; typedAggregation =Aggregation.newAggregation(Zips.class, groupOperation, matchOperation);</span><br><span class="line">    </span><br><span class="line">        <span class="comment">//执行聚合操作,如果不使用 Map，也可以使用自定义的实体类来接收数据 </span></span><br><span class="line">    AggregationResults&lt;Map&gt; aggregationResults = mongoTemplate.aggregate(typedAggregation, Map.class);</span><br><span class="line">    <span class="comment">// 取出最终结果</span></span><br><span class="line">    List&lt;Map&gt; mappedResults = aggregationResults.getMappedResults(); </span><br><span class="line">    <span class="keyword">for</span>(Map map:mappedResults)&#123;</span><br><span class="line">        System.out.println(map);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><blockquote><p>返回各州平均城市人口</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.zips.aggregate( [</span><br><span class="line">   &#123; <span class="variable">$group</span>: &#123; _id: &#123; state: <span class="string">&quot;<span class="variable">$state</span>&quot;</span>, city: <span class="string">&quot;<span class="variable">$city</span>&quot;</span> &#125;, cityPop: &#123; <span class="variable">$sum</span>: <span class="string">&quot;<span class="variable">$pop</span>&quot;</span> &#125; &#125; &#125;,</span><br><span class="line">   &#123; <span class="variable">$group</span>: &#123; _id: <span class="string">&quot;<span class="variable">$_id</span>.state&quot;</span>, avgCityPop: &#123; <span class="variable">$avg</span>: <span class="string">&quot;<span class="variable">$cityPop</span>&quot;</span> &#125; &#125; &#125;,</span><br><span class="line">   &#123; <span class="variable">$sort</span>:&#123;avgCityPop:-1&#125;&#125;</span><br><span class="line">] )</span><br></pre></td></tr></table></figure><p>java实现</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span>&#123; </span><br><span class="line">    <span class="comment">//$group</span></span><br><span class="line">    </span><br><span class="line">        <span class="type">GroupOperation</span> <span class="variable">groupOperation</span> <span class="operator">=</span> Aggregation.group(<span class="string">&quot;state&quot;</span>,<span class="string">&quot;city&quot;</span>).sum(<span class="string">&quot;pop&quot;</span>).as(<span class="string">&quot;cityPop&quot;</span>); </span><br><span class="line">    <span class="comment">//$group</span></span><br><span class="line">    <span class="type">GroupOperation</span> <span class="variable">groupOperation2</span> <span class="operator">=</span> Aggregation.group(<span class="string">&quot;_id.state&quot;</span>).avg(<span class="string">&quot;cityPop&quot;</span>).as(<span class="string">&quot;avgCityPop&quot;</span>); </span><br><span class="line">    <span class="comment">//$sort</span></span><br><span class="line">    <span class="type">SortOperation</span> <span class="variable">sortOperation</span> <span class="operator">=</span> Aggregation.sort(Sort.Direction.DESC,<span class="string">&quot;avgCityPop&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 按顺序组合每一个聚合步骤</span></span><br><span class="line">    TypedAggregation&lt;Zips&gt; typedAggregation = Aggregation.newAggregation(Zips.class, </span><br><span class="line">            groupOperation, groupOperation2,sortOperation);</span><br><span class="line">    </span><br><span class="line">        <span class="comment">//执行聚合操作,如果不使用 Map，也可以使用自定义的实体类来接收数据 </span></span><br><span class="line">    AggregationResults&lt;Map&gt; aggregationResults = mongoTemplate.aggregate(typedAggregation, Map.class);</span><br><span class="line">    <span class="comment">// 取出最终结果</span></span><br><span class="line">    List&lt;Map&gt; mappedResults = aggregationResults.getMappedResults(); </span><br><span class="line">    <span class="keyword">for</span>(Map map:mappedResults)&#123;</span><br><span class="line">        System.out.println(map);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>按州返回最大和最小的城市</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">db.zips.aggregate( [</span><br><span class="line">   &#123; <span class="variable">$group</span>:</span><br><span class="line">      &#123;</span><br><span class="line">        _id: &#123; state: <span class="string">&quot;<span class="variable">$state</span>&quot;</span>, city: <span class="string">&quot;<span class="variable">$city</span>&quot;</span> &#125;,</span><br><span class="line">        pop: &#123; <span class="variable">$sum</span>: <span class="string">&quot;<span class="variable">$pop</span>&quot;</span> &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;,</span><br><span class="line">   &#123; <span class="variable">$sort</span>: &#123; pop: 1 &#125; &#125;,</span><br><span class="line">   &#123; <span class="variable">$group</span>:</span><br><span class="line">      &#123;</span><br><span class="line">        _id : <span class="string">&quot;<span class="variable">$_id</span>.state&quot;</span>,</span><br><span class="line">        biggestCity:  &#123; <span class="variable">$last</span>: <span class="string">&quot;<span class="variable">$_id</span>.city&quot;</span> &#125;,</span><br><span class="line">        biggestPop:   &#123; <span class="variable">$last</span>: <span class="string">&quot;<span class="variable">$pop</span>&quot;</span> &#125;,</span><br><span class="line">        smallestCity: &#123; <span class="variable">$first</span>: <span class="string">&quot;<span class="variable">$_id</span>.city&quot;</span> &#125;, </span><br><span class="line">        smallestPop:  &#123; <span class="variable">$first</span>: <span class="string">&quot;<span class="variable">$pop</span>&quot;</span> &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;,</span><br><span class="line">  &#123; <span class="variable">$project</span>:</span><br><span class="line">    &#123; _id: 0,</span><br><span class="line">      state: <span class="string">&quot;<span class="variable">$_id</span>&quot;</span>,</span><br><span class="line">      biggestCity:  &#123; name: <span class="string">&quot;<span class="variable">$biggestCity</span>&quot;</span>,  pop: <span class="string">&quot;<span class="variable">$biggestPop</span>&quot;</span> &#125;, </span><br><span class="line">      smallestCity: &#123; name: <span class="string">&quot;<span class="variable">$smallestCity</span>&quot;</span>, pop: <span class="string">&quot;<span class="variable">$smallestPop</span>&quot;</span> &#125; </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">   &#123; <span class="variable">$sort</span>: &#123; state: 1 &#125; &#125;</span><br><span class="line">] )</span><br></pre></td></tr></table></figure><p>java实现</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test3</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//$group</span></span><br><span class="line">    <span class="type">GroupOperation</span> <span class="variable">groupOperation</span> <span class="operator">=</span> Aggregation </span><br><span class="line">            .group(<span class="string">&quot;state&quot;</span>,<span class="string">&quot;city&quot;</span>).sum(<span class="string">&quot;pop&quot;</span>).as(<span class="string">&quot;pop&quot;</span>);</span><br><span class="line">    </span><br><span class="line">        <span class="comment">//$sort</span></span><br><span class="line">    <span class="type">SortOperation</span> <span class="variable">sortOperation</span> <span class="operator">=</span> Aggregation </span><br><span class="line">            .sort(Sort.Direction.ASC,<span class="string">&quot;pop&quot;</span>);</span><br><span class="line">    </span><br><span class="line">        <span class="comment">//$group</span></span><br><span class="line">    <span class="type">GroupOperation</span> <span class="variable">groupOperation2</span> <span class="operator">=</span> Aggregation </span><br><span class="line">            .group(<span class="string">&quot;_id.state&quot;</span>) </span><br><span class="line">            .last(<span class="string">&quot;_id.city&quot;</span>).as(<span class="string">&quot;biggestCity&quot;</span>) </span><br><span class="line">            .last(<span class="string">&quot;pop&quot;</span>).as(<span class="string">&quot;biggestPop&quot;</span>) </span><br><span class="line">            .first(<span class="string">&quot;_id.city&quot;</span>).as(<span class="string">&quot;smallestCity&quot;</span>) </span><br><span class="line">            .first(<span class="string">&quot;pop&quot;</span>).as(<span class="string">&quot;smallestPop&quot;</span>);</span><br><span class="line">    </span><br><span class="line">        <span class="comment">//$project</span></span><br><span class="line">    <span class="type">ProjectionOperation</span> <span class="variable">projectionOperation</span> <span class="operator">=</span> Aggregation </span><br><span class="line">            .project(<span class="string">&quot;state&quot;</span>,<span class="string">&quot;biggestCity&quot;</span>,<span class="string">&quot;smallestCity&quot;</span>) </span><br><span class="line">            .and(<span class="string">&quot;_id&quot;</span>).as(<span class="string">&quot;state&quot;</span>)</span><br><span class="line">            .andExpression(</span><br><span class="line">                    <span class="string">&quot;&#123; name: \&quot;$biggestCity\&quot;,  pop: \&quot;$biggestPop\&quot; &#125;&quot;</span>) </span><br><span class="line">            .as(<span class="string">&quot;biggestCity&quot;</span>)</span><br><span class="line">            .andExpression(</span><br><span class="line">                    <span class="string">&quot;&#123; name: \&quot;$smallestCity\&quot;, pop: \&quot;$smallestPop\&quot; &#125;&quot;</span> </span><br><span class="line">            ).as(<span class="string">&quot;smallestCity&quot;</span>)</span><br><span class="line">            .andExclude(<span class="string">&quot;_id&quot;</span>);</span><br><span class="line">    </span><br><span class="line">        <span class="comment">//$sort</span></span><br><span class="line">    <span class="type">SortOperation</span> <span class="variable">sortOperation2</span> <span class="operator">=</span> Aggregation </span><br><span class="line">            .sort(Sort.Direction.ASC,<span class="string">&quot;state&quot;</span>);</span><br><span class="line">    </span><br><span class="line">        <span class="comment">// 按顺序组合每一个聚合步骤</span></span><br><span class="line">    TypedAggregation&lt;Zips&gt; typedAggregation = Aggregation.newAggregation( </span><br><span class="line">            Zips.class, groupOperation, sortOperation, groupOperation2, </span><br><span class="line">            projectionOperation,sortOperation2);</span><br><span class="line">    </span><br><span class="line">        <span class="comment">//执行聚合操作,如果不使用 Map，也可以使用自定义的实体类来接收数据 </span></span><br><span class="line">    AggregationResults&lt;Map&gt; aggregationResults = mongoTemplate </span><br><span class="line">            .aggregate(typedAggregation, Map.class);</span><br><span class="line">    <span class="comment">// 取出最终结果</span></span><br><span class="line">    List&lt;Map&gt; mappedResults = aggregationResults.getMappedResults(); </span><br><span class="line">    <span class="keyword">for</span>(Map map:mappedResults)&#123;</span><br><span class="line">        System.out.println(map);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;聚合操作处理数据记录并返回计算结果(诸如统计平均值，求和等)。聚合操作组值来自多个文档，可以对 分组数据执行各种操作以返回单个结果。聚合操作包含三类：单一作用聚合、聚合管道、MapReduce。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;单一作用聚合：提供了对常见聚合过程的简单访问，操作都</summary>
      
    
    
    
    
    <category term="MongoDB" scheme="http://example.com/tags/MongoDB/"/>
    
  </entry>
  
  <entry>
    <title>MongoDB之整合SpringBoot</title>
    <link href="http://example.com/2022/08/29/MongoDB%E4%B9%8B%E6%95%B4%E5%90%88SpringBoot/"/>
    <id>http://example.com/2022/08/29/MongoDB%E4%B9%8B%E6%95%B4%E5%90%88SpringBoot/</id>
    <published>2022-08-29T08:33:12.000Z</published>
    <updated>2022-08-29T08:54:10.408Z</updated>
    
    <content type="html"><![CDATA[<h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><p>1.引入依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--spring data mongodb--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-mongodb<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2.配置yml</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span> </span><br><span class="line">  <span class="attr">data:</span> </span><br><span class="line">    <span class="attr">mongodb:</span></span><br><span class="line">      <span class="attr">uri:</span> <span class="string">mongodb://fox:fox@192.168.65.174:27017/test?authSource=admin</span> </span><br><span class="line">      <span class="comment">#uri等同于下面的配置</span></span><br><span class="line">      <span class="comment">#database: test</span></span><br><span class="line">      <span class="comment">#host: 192.168.65.174</span></span><br><span class="line">      <span class="comment">#port: 27017</span></span><br><span class="line">      <span class="comment">#username: fox</span></span><br><span class="line">      <span class="comment">#password: fox</span></span><br><span class="line">      <span class="comment">#authentication-database: admin</span></span><br></pre></td></tr></table></figure><p>连接配置参考文档：<a class="link"   href="https://docs.mongodb.com/manual/reference/connection-string/" >https://docs.mongodb.com/manual/reference/connection-string/<i class="fas fa-external-link-alt"></i></a> </p><p>3.使用时注入mongoTemplate</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">MongoTemplate mongoTemplate;</span><br></pre></td></tr></table></figure><h2 id="集合操作"><a href="#集合操作" class="headerlink" title="集合操作"></a>集合操作</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCollection</span><span class="params">()</span>&#123;   </span><br><span class="line"></span><br><span class="line"><span class="type">boolean</span> <span class="variable">exists</span> <span class="operator">=</span> mongoTemplate.collectionExists(<span class="string">&quot;emp&quot;</span>); </span><br><span class="line">    <span class="keyword">if</span> (exists) &#123;</span><br><span class="line">        <span class="comment">//删除集合 </span></span><br><span class="line">        mongoTemplate.dropCollection(<span class="string">&quot;emp&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//创建集合</span></span><br><span class="line">    mongoTemplate.createCollection(<span class="string">&quot;emp&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="文档操作"><a href="#文档操作" class="headerlink" title="文档操作"></a>文档操作</h2><h3 id="相关注解"><a href="#相关注解" class="headerlink" title="相关注解"></a>相关注解</h3><ul><li>@Document<ul><li>修饰范围: 用在类上</li><li>作用: 用来映射这个类的一个对象为mongo中一条文档数据。 </li><li>属性:( value 、collection )用来指定操作的集合名称</li></ul></li><li>@Id<ul><li>修饰范围: 用在成员变量、方法上</li><li>作用: 用来将成员变量的值映射为文档的_id的值</li></ul></li><li>@Field<ul><li>修饰范围: 用在成员变量、方法上</li><li>作用: 用来将成员变量及其值映射为文档中一个key:value对。</li><li>属性:( name , value )用来指定在文档中 key的名称,默认为成员变量名</li></ul></li><li>@Transient <ul><li>修饰范围:用在成员变量、方法上</li><li>作用:用来指定此成员变量不参与文档的序列化</li></ul></li></ul><h3 id="创建实体"><a href="#创建实体" class="headerlink" title="创建实体"></a>创建实体</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Document(&quot;emp&quot;)</span>  <span class="comment">//对应emp集合中的一个文档 @Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Employee</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span>   <span class="comment">//映射文档中的_id </span></span><br><span class="line">    <span class="keyword">private</span> Integer id; </span><br><span class="line">    <span class="meta">@Field(&quot;username&quot;)</span> </span><br><span class="line">    <span class="keyword">private</span> String name; </span><br><span class="line">    <span class="meta">@Field</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age; </span><br><span class="line">    <span class="meta">@Field</span></span><br><span class="line">    <span class="keyword">private</span> Double salary; </span><br><span class="line">    <span class="meta">@Field</span></span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="添加文档"><a href="#添加文档" class="headerlink" title="添加文档"></a>添加文档</h3><p>insert方法返回值是新增的Document对象，里面包含了新增后id的值。如果集合不存在会自动创建集合。通过Spring Data MongoDB还会给集合中多加一个class的属性，存储新增时Document对应Java中 类的全限定路径。这么做为了查询时能把Document转换为Java类型。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testInsert</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">1</span>, <span class="string">&quot;小明&quot;</span>, <span class="number">30</span>,<span class="number">10000.00</span>, <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//添加文档</span></span><br><span class="line">    <span class="comment">// sava:  _id存在时更新数据 </span></span><br><span class="line">    <span class="comment">//mongoTemplate.save(employee);</span></span><br><span class="line">    <span class="comment">// insert： _id存在抛出异常   支持批量操作 </span></span><br><span class="line">    mongoTemplate.insert(employee);</span><br><span class="line"></span><br><span class="line">    List&lt;Employee&gt; list = Arrays.asList(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">2</span>, <span class="string">&quot;张三&quot;</span>, <span class="number">21</span>,<span class="number">5000.00</span>, <span class="keyword">new</span> <span class="title class_">Date</span>()), </span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">3</span>, <span class="string">&quot;李四&quot;</span>, <span class="number">26</span>,<span class="number">8000.00</span>, <span class="keyword">new</span> <span class="title class_">Date</span>()), </span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">4</span>, <span class="string">&quot;王五&quot;</span>,<span class="number">22</span>, <span class="number">8000.00</span>, <span class="keyword">new</span> <span class="title class_">Date</span>()), </span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">5</span>, <span class="string">&quot;张龙&quot;</span>,<span class="number">28</span>, <span class="number">6000.00</span>, <span class="keyword">new</span> <span class="title class_">Date</span>()), </span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">6</span>, <span class="string">&quot;赵虎&quot;</span>,<span class="number">24</span>, <span class="number">7000.00</span>, <span class="keyword">new</span> <span class="title class_">Date</span>()), </span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">7</span>, <span class="string">&quot;赵六&quot;</span>,<span class="number">28</span>, <span class="number">12000.00</span>, <span class="keyword">new</span> <span class="title class_">Date</span>())); </span><br><span class="line">    <span class="comment">//插入多条数据 </span></span><br><span class="line">    mongoTemplate.insert(list,Employee.class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="查询文档"><a href="#查询文档" class="headerlink" title="查询文档"></a>查询文档</h3><p>Criteria是标准查询的接口，可以引用静态的Criteria.where的把多个条件组合在一起，就可以轻松地将多个方法标准和查询连接起来，方便我们操作查询语句。</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220829164216857.png"                      alt="image-20220829164216857"                ></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFind</span><span class="params">()</span>&#123;</span><br><span class="line">   System.out.println(<span class="string">&quot;==========查询所有文档===========&quot;</span>); </span><br><span class="line">    <span class="comment">//查询所有文档</span></span><br><span class="line">    List&lt;Employee&gt; list = mongoTemplate.findAll(Employee.class); </span><br><span class="line">    list.forEach(System.out::println);</span><br><span class="line">    </span><br><span class="line">    System.out.println(<span class="string">&quot;==========根据_id查询===========&quot;</span>); </span><br><span class="line">    <span class="comment">//根据_id查询</span></span><br><span class="line">    <span class="type">Employee</span> <span class="variable">e</span> <span class="operator">=</span> mongoTemplate.findById(<span class="number">1</span>, Employee.class); </span><br><span class="line">    System.out.println(e);</span><br><span class="line">    </span><br><span class="line">    System.out.println(<span class="string">&quot;==========findOne返回第一个文档===========&quot;</span>); </span><br><span class="line">    <span class="comment">//如果查询结果是多个，返回其中第一个文档对象</span></span><br><span class="line">    <span class="type">Employee</span> <span class="variable">one</span> <span class="operator">=</span> mongoTemplate.findOne(<span class="keyword">new</span> <span class="title class_">Query</span>(), Employee.class); </span><br><span class="line">    System.out.println(one);</span><br><span class="line">    </span><br><span class="line">     System.out.println(<span class="string">&quot;==========条件查询===========&quot;</span>);</span><br><span class="line">    <span class="comment">//new Query() 表示没有条件</span></span><br><span class="line">    <span class="comment">//查询薪资大于等于8000的员工</span></span><br><span class="line">    <span class="comment">//Query query = new Query(Criteria.where(&quot;salary&quot;).gte(8000)); </span></span><br><span class="line">    <span class="comment">//查询薪资大于4000小于10000的员工</span></span><br><span class="line">    <span class="comment">//Query query = new Query(Criteria.where(&quot;salary&quot;).gt(4000).lt(10000)); </span></span><br><span class="line">    <span class="comment">//正则查询（模糊查询）  java中正则不需要有//</span></span><br><span class="line">    <span class="comment">//Query query = new Query(Criteria.where(&quot;name&quot;).regex(&quot;张&quot;));</span></span><br><span class="line">    </span><br><span class="line">     <span class="comment">//and  or  多条件查询</span></span><br><span class="line">    <span class="type">Criteria</span> <span class="variable">criteria</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Criteria</span>(); </span><br><span class="line">    <span class="comment">//and  查询年龄大于25&amp;薪资大于8000的员工</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//criteria.andOperator(Criteria.where(&quot;age&quot;).gt(25),Criteria.where(&quot;salary&quot;).gt (8000));</span></span><br><span class="line">    <span class="comment">//or 查询姓名是张三或者薪资大于8000的员工 </span></span><br><span class="line">    criteria.orOperator(Criteria.where(<span class="string">&quot;name&quot;</span>).is(<span class="string">&quot;张 三&quot;</span>),Criteria.where(<span class="string">&quot;salary&quot;</span>).gt(<span class="number">5000</span>));</span><br><span class="line">    <span class="type">Query</span> <span class="variable">query</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Query</span>(criteria);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//sort排序 </span></span><br><span class="line">    <span class="comment">//query.with(Sort.by(Sort.Order.desc(&quot;salary&quot;)));</span></span><br><span class="line">     <span class="comment">//skip limit 分页  skip用于指定跳过记录数，limit则用于限定返回结果数量。 </span></span><br><span class="line">    query.with(Sort.by(Sort.Order.desc(<span class="string">&quot;salary&quot;</span>))) </span><br><span class="line">            .skip(<span class="number">0</span>)  <span class="comment">//指定跳过记录数</span></span><br><span class="line">            .limit(<span class="number">4</span>);  <span class="comment">//每页显示记录数</span></span><br><span class="line">    </span><br><span class="line">        <span class="comment">//查询结果</span></span><br><span class="line">    List&lt;Employee&gt; employees = mongoTemplate.find( query, Employee.class); </span><br><span class="line">    employees.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFindByJson</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//使用json字符串方式查询</span></span><br><span class="line">    <span class="comment">//等值查询</span></span><br><span class="line">    <span class="comment">//String json = &quot;&#123;name:&#x27;张三&#x27;&#125;&quot;;</span></span><br><span class="line">    <span class="comment">//多条件查询</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> <span class="string">&quot;&#123;$or:[&#123;age:&#123;$gt:25&#125;&#125;,&#123;salary:&#123;$gte:8000&#125;&#125;]&#125;&quot;</span>; </span><br><span class="line">    <span class="type">Query</span> <span class="variable">query</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BasicQuery</span>(json);</span><br><span class="line">        <span class="comment">//查询结果</span></span><br><span class="line">    List&lt;Employee&gt; employees = mongoTemplate.find( query, Employee.class); </span><br><span class="line">    employees.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="更新文档"><a href="#更新文档" class="headerlink" title="更新文档"></a>更新文档</h3><p>在Mongodb中无论是使用客户端API还是使用Spring Data，更新返回结果一定是受行数影响。如果更新后的结果和更新前的结果是相同，返回0。</p><ul><li>updateFirst() 只更新满足条件的第一条记录 </li><li>updateMulti() 更新所有满足条件的记录 </li><li>upsert() 没有符合条件的记录则插入数据</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUpdate</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//query设置查询条件</span></span><br><span class="line">    <span class="type">Query</span> <span class="variable">query</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Query</span>(Criteria.where(<span class="string">&quot;salary&quot;</span>).gte(<span class="number">15000</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;==========更新前===========&quot;</span>);</span><br><span class="line">    List&lt;Employee&gt; employees = mongoTemplate.find(query, Employee.class); </span><br><span class="line">    employees.forEach(System.out::println);</span><br><span class="line">     <span class="type">Update</span> <span class="variable">update</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Update</span>(); </span><br><span class="line">    <span class="comment">//设置更新属性 </span></span><br><span class="line">    update.set(<span class="string">&quot;salary&quot;</span>,<span class="number">13000</span>);</span><br><span class="line">    <span class="comment">//updateFirst() 只更新满足条件的第一条记录</span></span><br><span class="line">    <span class="comment">//UpdateResult updateResult = mongoTemplate.updateFirst(query, update, Employee.class);</span></span><br><span class="line">    <span class="comment">//updateMulti() 更新所有满足条件的记录</span></span><br><span class="line">        <span class="comment">//UpdateResult updateResult = mongoTemplate.updateMulti(query, update, Employee.class);</span></span><br><span class="line">    </span><br><span class="line">     <span class="comment">//upsert() 没有符合条件的记录则插入数据 </span></span><br><span class="line">    <span class="comment">//update.setOnInsert(&quot;id&quot;,11);  //指定_id</span></span><br><span class="line">    <span class="type">UpdateResult</span> <span class="variable">updateResult</span> <span class="operator">=</span> mongoTemplate.upsert(query, update, Employee.class);</span><br><span class="line">    </span><br><span class="line">        <span class="comment">//返回修改的记录数 </span></span><br><span class="line">    System.out.println(updateResult.getModifiedCount());</span><br><span class="line">    </span><br><span class="line">    System.out.println(<span class="string">&quot;==========更新后===========&quot;</span>); </span><br><span class="line">    employees = mongoTemplate.find(query, Employee.class); </span><br><span class="line">    employees.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="删除文档"><a href="#删除文档" class="headerlink" title="删除文档"></a>删除文档</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDelete</span><span class="params">()</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//删除所有文档</span></span><br><span class="line">    <span class="comment">//mongoTemplate.remove(new Query(),Employee.class);</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//条件删除</span></span><br><span class="line">    <span class="type">Query</span> <span class="variable">query</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Query</span>(Criteria.where(<span class="string">&quot;salary&quot;</span>).gte(<span class="number">10000</span>)); </span><br><span class="line">    mongoTemplate.remove(query,Employee.class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;环境准备&quot;&gt;&lt;a href=&quot;#环境准备&quot; class=&quot;headerlink&quot; title=&quot;环境准备&quot;&gt;&lt;/a&gt;环境准备&lt;/h2&gt;&lt;p&gt;1.引入依赖&lt;/p&gt;
&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=</summary>
      
    
    
    
    
    <category term="MongoDB" scheme="http://example.com/tags/MongoDB/"/>
    
  </entry>
  
  <entry>
    <title>MongoDB之文档操作</title>
    <link href="http://example.com/2022/08/29/MongoDB%E4%B9%8B%E6%96%87%E6%A1%A3%E6%93%8D%E4%BD%9C/"/>
    <id>http://example.com/2022/08/29/MongoDB%E4%B9%8B%E6%96%87%E6%A1%A3%E6%93%8D%E4%BD%9C/</id>
    <published>2022-08-29T07:47:35.000Z</published>
    <updated>2022-08-29T08:32:30.405Z</updated>
    
    <content type="html"><![CDATA[<h2 id="插入文档"><a href="#插入文档" class="headerlink" title="插入文档"></a>插入文档</h2><p>3.2 版本之后新增了 db.collection.insertOne() 和db.collection.insertMany()。</p><h3 id="新增单个文档"><a href="#新增单个文档" class="headerlink" title="新增单个文档"></a>新增单个文档</h3><ul><li>insertOne: 支持writeConcern</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">db.collection.insertOne( </span><br><span class="line">   &lt;document&gt;,</span><br><span class="line">   &#123;</span><br><span class="line">      writeConcern: &lt;document&gt; </span><br><span class="line">   &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><blockquote><p>writeConcern 决定一个写操作落到多少个节点上才算成功。writeConcern 的取值包括：<br>0：发起写操作，不关心是否成功；<br>1~集群最大数据节点数：写操作需要被复制到指定节点数才算成功；<br>majority：写操作需要被复制到大多数节点上才算成功。</p></blockquote><ul><li>insert: 若插入的数据主键已经存在，则会抛 DuplicateKeyException 异常，提示主键重复，不保 存当前数据。</li><li>save: 如果 _id 主键存在则更新数据，如果不存在就插入数据。</li></ul><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220829155202395.png"                      alt="image-20220829155202395"                ></p><h3 id="批量新增文档"><a href="#批量新增文档" class="headerlink" title="批量新增文档"></a>批量新增文档</h3><ul><li>insertMany:向指定集合中插入多条文档数据</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">db.collection.insertMany(</span><br><span class="line">   [ &lt;document 1&gt; , &lt;document 2&gt;, ... ], </span><br><span class="line">   &#123;</span><br><span class="line">      writeConcern: &lt;document&gt;, </span><br><span class="line">      ordered: &lt;boolean&gt;</span><br><span class="line">   &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><blockquote><p>writeConcern：写入策略，默认为 1，即要求确认写操作，0 是不要求。</p><p>ordered：指定是否按顺序写入，默认 true，按顺序写入。 </p></blockquote><ul><li>insert和save也可以实现批量插入</li></ul><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220829155357085.png"                      alt="image-20220829155357085"                ></p><h3 id="测试：批量插入50条随机数据"><a href="#测试：批量插入50条随机数据" class="headerlink" title="测试：批量插入50条随机数据"></a>测试：批量插入50条随机数据</h3><p>编辑脚本book.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> tags = [<span class="string">&quot;nosql&quot;</span>,<span class="string">&quot;mongodb&quot;</span>,<span class="string">&quot;document&quot;</span>,<span class="string">&quot;developer&quot;</span>,<span class="string">&quot;popular&quot;</span>];</span><br><span class="line"><span class="keyword">var</span> types = [<span class="string">&quot;technology&quot;</span>,<span class="string">&quot;sociality&quot;</span>,<span class="string">&quot;travel&quot;</span>,<span class="string">&quot;novel&quot;</span>,<span class="string">&quot;literature&quot;</span>]; <span class="keyword">var</span> books=[];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">50</span>;i++)&#123;</span><br><span class="line">    <span class="keyword">var</span> typeIdx = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>()*types.<span class="property">length</span>);</span><br><span class="line">    <span class="keyword">var</span> tagIdx = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>()*tags.<span class="property">length</span>);</span><br><span class="line">    <span class="keyword">var</span> favCount = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>()*<span class="number">100</span>);</span><br><span class="line">    <span class="keyword">var</span> book = &#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&quot;book-&quot;</span>+i,</span><br><span class="line">        <span class="attr">type</span>: types[typeIdx],</span><br><span class="line">        <span class="attr">tag</span>: tags[tagIdx],</span><br><span class="line">        <span class="attr">favCount</span>: favCount,</span><br><span class="line">        <span class="attr">author</span>: <span class="string">&quot;xxx&quot;</span>+i</span><br><span class="line">    &#125;;</span><br><span class="line">    books.<span class="title function_">push</span>(book)</span><br><span class="line">&#125;</span><br><span class="line">db.<span class="property">books</span>.<span class="title function_">insertMany</span>(books);</span><br></pre></td></tr></table></figure><p>进入mongo shell，执行</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">load(<span class="string">&quot;books.js&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="查询文档"><a href="#查询文档" class="headerlink" title="查询文档"></a>查询文档</h2><p>find 查询集合中的若干文档。语法格式如下：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.find(query, projection)</span><br></pre></td></tr></table></figure><ul><li>query ：可选，使用查询操作符指定查询条件</li><li>projection ：可选，使用投影操作符指定返回的键。查询时返回文档中所有键值， 只需省略该参数即可（默认省略）。投影时，id为1的时候，其他字段必须是1；id是0的时候，其他字段可以是 0；如果没有_id字段约束，多个其他字段必须同为0或同为1。</li></ul><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220829160011274.png"                      alt="image-20220829160011274"                ></p><p>如果查询返回的条目数量较多，mongo shell则会自动实现分批显示。默认情况下每次只显示20条，可以输入it命令读取下一批。    </p><p>findOne查询集合中的第一个文档。语法格式如下：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.findOne(query, projection)</span><br></pre></td></tr></table></figure><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220829160353620.png"                      alt="image-20220829160353620"                ></p><h3 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询"></a>条件查询</h3><blockquote><p>指定条件查询</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查询带有nosql标签的book文档：</span></span><br><span class="line">db.books.find(&#123;tag:<span class="string">&quot;nosql&quot;</span>&#125;)</span><br><span class="line"><span class="comment">#按照id查询单个book文档： </span></span><br><span class="line">db.books.find(&#123;_id:ObjectId(<span class="string">&quot;61caa09ee0782536660494d9&quot;</span>)&#125;) </span><br><span class="line"><span class="comment">#查询分类为“travel”、收藏数超过60个的book文档： </span></span><br><span class="line">db.books.find(&#123;<span class="built_in">type</span>:<span class="string">&quot;travel&quot;</span>,favCount:&#123;<span class="variable">$gt</span>:60&#125;&#125;)</span><br></pre></td></tr></table></figure><blockquote><p>查询条件对照表</p></blockquote><table><thead><tr><th>SQL</th><th>MQL</th></tr></thead><tbody><tr><td>a &#x3D; 1</td><td>{a: 1}</td></tr><tr><td>a &lt;&gt; 1</td><td>{a: {$ne: 1}}</td></tr><tr><td>a &gt; 1</td><td>{a: {$gt: 1}}</td></tr><tr><td>a &gt;&#x3D; 1</td><td>{a: {$gte: 1}}</td></tr><tr><td>a &lt; 1</td><td>{a: {$lt: 1}}</td></tr><tr><td>a &lt;&#x3D; 1</td><td>{a: {$lte: 1}}</td></tr></tbody></table><blockquote><p>查询逻辑对照表</p></blockquote><table><thead><tr><th>SQL</th><th>MQL</th></tr></thead><tbody><tr><td>a &#x3D; 1 AND b &#x3D; 1</td><td>{a: 1, b: 1}或{$and: [{a: 1}, {b: 1}]}</td></tr><tr><td>a &#x3D; 1 OR b &#x3D; 1</td><td>{$or: [{a: 1}, {b: 1}]}</td></tr><tr><td>a IS NULL</td><td>{a: {$exists: false}}</td></tr><tr><td>a IN (1, 2, 3)</td><td>{a: {$in: [1, 2, 3]}}</td></tr></tbody></table><p>查询逻辑运算符</p><ul><li>$lt: 存在并小于</li><li>$lte: 存在并小于等于</li><li>$gt: 存在并大于</li><li>$gte: 存在并大于等于</li><li>$ne: 不存在或存在但不等于</li><li>$in: 存在并在指定数组中</li><li>$nin: 不存在或不在指定数组中 </li><li>$or: 匹配两个或多个条件中的一个 </li><li>$and: 匹配全部条件</li></ul><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220829161008284.png"                      alt="image-20220829161008284"                ></p><h3 id="排序-amp-分页"><a href="#排序-amp-分页" class="headerlink" title="排序&amp;分页"></a>排序&amp;分页</h3><blockquote><p>指定排序</p></blockquote><p>在 MongoDB 中使用 sort() 方法对数据进行排序</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#指定按收藏数（favCount）降序返回 </span></span><br><span class="line">db.books.find(&#123;<span class="built_in">type</span>:<span class="string">&quot;travel&quot;</span>&#125;).<span class="built_in">sort</span>(&#123;favCount:-1&#125;)</span><br></pre></td></tr></table></figure><blockquote><p>分页查询 </p></blockquote><p>skip用于指定跳过记录数，limit则用于限定返回结果数量。可以在执行find命令的同时指定skip、limit 参数，以此实现分页的功能。比如，假定每页大小为8条，查询第3页的book文档：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.books.find().skip(8).<span class="built_in">limit</span>(4)</span><br></pre></td></tr></table></figure><h3 id="正则表达式匹配查询"><a href="#正则表达式匹配查询" class="headerlink" title="正则表达式匹配查询"></a>正则表达式匹配查询</h3><p>MongoDB 使用 $regex 操作符来设置匹配字符串的正则表达式。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#使用正则表达式查找type包含 so 字符串的book </span></span><br><span class="line">db.books.find(&#123;<span class="built_in">type</span>:&#123;<span class="variable">$regex</span>:<span class="string">&quot;so&quot;</span>&#125;&#125;) </span><br><span class="line"><span class="comment">#或者</span></span><br><span class="line">db.books.find(&#123;<span class="built_in">type</span>:/so/&#125;)</span><br></pre></td></tr></table></figure><h2 id="更新文档"><a href="#更新文档" class="headerlink" title="更新文档"></a>更新文档</h2><p>可以用update命令对指定的数据进行更新，命令的格式如下：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.update(query,update,options)</span><br></pre></td></tr></table></figure><ul><li>query：描述更新的查询条件； </li><li>update：描述更新的动作及新的内容； </li><li>options：描述更新的选项<ul><li>upsert:  可选，如果不存在update的记录，是否插入新的记录。默认false，不插入</li><li>multi: 可选，是否按条件查询出的多条记录全部更新。 默认false,只更新找到的第一条记录 </li><li>writeConcern :可选，决定一个写操作落到多少个节点上才算成功。</li></ul></li></ul><h3 id="更新操作符"><a href="#更新操作符" class="headerlink" title="更新操作符"></a>更新操作符</h3><table><thead><tr><th>操作符</th><th>格式</th><th>描述</th></tr></thead><tbody><tr><td>$set</td><td>{$set:{field:value}}</td><td>指定一个键并更新值，若键不存在则创 建</td></tr><tr><td>$unset</td><td>{$unset : {field : 1 }}</td><td>删除一个键</td></tr><tr><td>$inc</td><td>{$inc : {field : value } }</td><td>对数值类型进行增减</td></tr><tr><td>$rename</td><td>{$rename : {old_field_name : new_field_name } }</td><td>修改字段名称</td></tr><tr><td>$push</td><td>{ $push : {field : value } }</td><td>将数值追加到数组中，若数组不存在则 会进行初始化</td></tr><tr><td>$pushAll</td><td>{$pushAll : {field : value_array }}</td><td>追加多个值到一个数组字段内</td></tr><tr><td>$pull</td><td>{$pull : {field : _value } }</td><td>从数组中删除指定的元素</td></tr><tr><td>$addToSet</td><td>{$addToSet : {field : value } }</td><td>添加元素到数组中，具有排重功能</td></tr><tr><td>$pop</td><td>{$pop : {field : 1 }}</td><td>删除数组的第一个或最后一个元素</td></tr></tbody></table><h3 id="更新单个文档"><a href="#更新单个文档" class="headerlink" title="更新单个文档"></a>更新单个文档</h3><p>某个book文档被收藏了，则需要将该文档的favCount字段自增</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.books.update(&#123;_id:ObjectId(<span class="string">&quot;61caa09ee0782536660494d9&quot;</span>)&#125;,&#123;<span class="variable">$inc</span>:&#123;favCount:1&#125;&#125;)</span><br></pre></td></tr></table></figure><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220829161842815.png"                      alt="image-20220829161842815"                ></p><h3 id="更新多个文档"><a href="#更新多个文档" class="headerlink" title="更新多个文档"></a>更新多个文档</h3><p>默认情况下，update命令只在更新第一个文档之后返回，如果需要更新多个文档，则可以使用multi选项。<br>将分类为“novel”的文档的增加发布时间（publishedDate）</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.books.update(&#123;<span class="built_in">type</span>:<span class="string">&quot;novel&quot;</span>&#125;,&#123;<span class="variable">$set</span>:&#123;publishedDate:new Date()&#125;&#125;,&#123;<span class="string">&quot;multi&quot;</span>:<span class="literal">true</span>&#125;)</span><br></pre></td></tr></table></figure><blockquote><p>multi : 可选，mongodb 默认是false,只更新找到的第一条记录，如果这个参数为true,就把按条件查出来多条记录全部更新</p></blockquote><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220829161941114.png"                      alt="image-20220829161941114"                ></p><p>update命令的选项配置较多，为了简化使用还可以使用一些快捷命令: </p><ul><li>updateOne：更新单个文档。</li><li>updateMany：更新多个文档。 </li><li>replaceOne：替换单个文档。</li></ul><h3 id="使用upsert命令"><a href="#使用upsert命令" class="headerlink" title="使用upsert命令"></a>使用upsert命令</h3><p>upsert是一种特殊的更新，其表现为如果目标文档不存在，则执行插入命令。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.books.update(</span><br><span class="line">    &#123;title:<span class="string">&quot;my book&quot;</span>&#125;, </span><br><span class="line">    &#123;<span class="variable">$set</span>:&#123;tags:[<span class="string">&quot;nosql&quot;</span>,<span class="string">&quot;mongodb&quot;</span>],<span class="built_in">type</span>:<span class="string">&quot;none&quot;</span>,author:<span class="string">&quot;fox&quot;</span>&#125;&#125;, </span><br><span class="line">    &#123;upsert:<span class="literal">true</span>&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>nMatched、nModified都为0，表示没有文档被匹配及更新，nUpserted&#x3D;1提示执行了upsert动作</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220829162142374.png"                      alt="image-20220829162142374"                ></p><h3 id="实现replace语义"><a href="#实现replace语义" class="headerlink" title="实现replace语义"></a>实现replace语义</h3><p>update命令中的更新描述（update）通常由操作符描述，如果更新描述中不包含任何操作符，那么 MongoDB会实现文档的replace语义</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.books.update(</span><br><span class="line">    &#123;title:<span class="string">&quot;my book&quot;</span>&#125;, </span><br><span class="line">    &#123;justTitle:<span class="string">&quot;my first book&quot;</span>&#125; </span><br><span class="line">)  </span><br></pre></td></tr></table></figure><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220829162429690.png"                      alt="image-20220829162429690"                ></p><h3 id="findAndModify命令"><a href="#findAndModify命令" class="headerlink" title="findAndModify命令"></a>findAndModify命令</h3><p>findAndModify兼容了查询和修改指定文档的功能，findAndModify只能更新单个文档</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//将某个book文档的收藏数（favCount）加1 db.books.findAndModify(&#123; </span><br><span class="line">    query:&#123;_id:ObjectId(<span class="string">&quot;61caa09ee0782536660494dd&quot;</span>)&#125;, </span><br><span class="line">    update:&#123;<span class="variable">$inc</span>:&#123;favCount:1&#125;&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>该操作会返回符合查询条件的文档数据，并完成对文档的修改。</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220829162519574.png"                      alt="image-20220829162519574"                ></p><p>默认情况下，findAndModify会返回修改前的“旧”数据。如果希望返回修改后的数据，则可以指定new选项</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.books.findAndModify(&#123; </span><br><span class="line">    query:&#123;_id:ObjectId(<span class="string">&quot;61caa09ee0782536660494dd&quot;</span>)&#125;, </span><br><span class="line">    update:&#123;<span class="variable">$inc</span>:&#123;favCount:1&#125;&#125;,</span><br><span class="line">    new: <span class="literal">true</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>与findAndModify语义相近的命令如下： </p><ul><li>findOneAndUpdate：更新单个文档并返回更新前（或更新后）的文档。</li><li>findOneAndReplace：替换单个文档并返回替换前（或替换后）的文档。</li></ul><h2 id="删除文档"><a href="#删除文档" class="headerlink" title="删除文档"></a>删除文档</h2><h3 id="使用-remove-删除文档"><a href="#使用-remove-删除文档" class="headerlink" title="使用 remove 删除文档"></a>使用 remove 删除文档</h3><ul><li>remove 命令需要配合查询条件使用； </li><li>匹配查询条件的文档会被删除； </li><li>指定一个空文档条件会删除所有文档；</li></ul><p>示例：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.user.remove(&#123;age:28&#125;)// 删除age 等于28的记录 </span><br><span class="line">db.user.remove(&#123;age:&#123;<span class="variable">$lt</span>:25&#125;&#125;)   // 删除age 小于25的记录 </span><br><span class="line">db.user.remove( &#123; &#125; ) // 删除所有记录</span><br><span class="line">db.user.remove() //报错</span><br></pre></td></tr></table></figure><p>remove命令会删除匹配条件的全部文档，如果希望明确限定只删除一个文档，则需要指定justOne参数，命令格式如下：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.remove(query,justOne)</span><br></pre></td></tr></table></figure><p>例如：删除满足type:novel条件的首条记录</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.books.remove(&#123;<span class="built_in">type</span>:<span class="string">&quot;novel&quot;</span>&#125;,<span class="literal">true</span>)</span><br></pre></td></tr></table></figure><h3 id="使用-delete-删除文档"><a href="#使用-delete-删除文档" class="headerlink" title="使用 delete 删除文档"></a>使用 delete 删除文档</h3><p>官方推荐使用 deleteOne() 和 deleteMany() 方法删除文档，语法格式如下：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.books.deleteMany (&#123;&#125;)  //删除集合下全部文档</span><br><span class="line">db.books.deleteMany (&#123; <span class="built_in">type</span>:<span class="string">&quot;novel&quot;</span> &#125;)  //删除 <span class="built_in">type</span>等于 novel 的全部文档 </span><br><span class="line">db.books.deleteOne (&#123; <span class="built_in">type</span>:<span class="string">&quot;novel&quot;</span> &#125;)  //删除 <span class="built_in">type</span>等于novel 的一个文档</span><br></pre></td></tr></table></figure><p>注意： remove、deleteMany等命令需要对查询范围内的文档逐个删除，如果希望删除整个集合，则使用drop命令会更加高效</p><h3 id="返回被删除文档"><a href="#返回被删除文档" class="headerlink" title="返回被删除文档"></a>返回被删除文档</h3><p>remove、deleteOne等命令在删除文档后只会返回确认性的信息，如果希望获得被删除的文档，则可以使用findOneAndDelete命令</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.books.findOneAndDelete(&#123;<span class="built_in">type</span>:<span class="string">&quot;novel&quot;</span>&#125;)</span><br></pre></td></tr></table></figure><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220829163156175.png"                      alt="image-20220829163156175"                ></p><p>除了在结果中返回删除文档，findOneAndDelete命令还允许定义“删除的顺序”，即按照指定顺序删除找 到的第一个文档</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.books.findOneAndDelete(&#123;<span class="built_in">type</span>:<span class="string">&quot;novel&quot;</span>&#125;,&#123;<span class="built_in">sort</span>:&#123;favCount:1&#125;&#125;)</span><br></pre></td></tr></table></figure><p>remove、deleteOne等命令只能按默认顺序删除，利用这个特性，findOneAndDelete可以实现队列的先进先出。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;插入文档&quot;&gt;&lt;a href=&quot;#插入文档&quot; class=&quot;headerlink&quot; title=&quot;插入文档&quot;&gt;&lt;/a&gt;插入文档&lt;/h2&gt;&lt;p&gt;3.2 版本之后新增了 db.collection.insertOne() 和db.collection.insertMan</summary>
      
    
    
    
    
    <category term="MongoDB" scheme="http://example.com/tags/MongoDB/"/>
    
  </entry>
  
  <entry>
    <title>MongoDB之快速开始</title>
    <link href="http://example.com/2022/08/29/MongoDB%E4%B9%8B%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/"/>
    <id>http://example.com/2022/08/29/MongoDB%E4%B9%8B%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/</id>
    <published>2022-08-29T07:10:53.000Z</published>
    <updated>2022-08-29T07:46:49.744Z</updated>
    
    <content type="html"><![CDATA[<h2 id="linux安装MongoDB"><a href="#linux安装MongoDB" class="headerlink" title="linux安装MongoDB"></a>linux安装MongoDB</h2><p>环境准备：</p><ul><li>linux系统： centos7</li><li>安装MongoDB社区版</li></ul><p>下载MongoDB Community Server<br>下载地址：<a class="link"   href="https://www.mongodb.com/try/download/community" >https://www.mongodb.com/try/download/community<i class="fas fa-external-link-alt"></i></a></p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220829151346373.png"                      alt="image-20220829151346373"                ></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#下载MongoDB</span></span><br><span class="line">wget https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-rhel70-4.4.9.tgz </span><br><span class="line">tar -zxvf mongodb-linux-x86_64-rhel70-4.4.9.tgz</span><br></pre></td></tr></table></figure><h3 id="启动MongoDB-Server"><a href="#启动MongoDB-Server" class="headerlink" title="启动MongoDB Server"></a>启动MongoDB Server</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建dbpath和logpath</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /mongodb/data /mongodb/log  /mongodb/conf </span><br><span class="line"><span class="comment">#进入mongodb目录，启动mongodb服务</span></span><br><span class="line">bin/mongod --port=27017 --dbpath=/mongodb/data </span><br><span class="line">--logpath=/mongodb/log/mongodb.log \ </span><br><span class="line">--bind_ip=0.0.0.0 --fork</span><br></pre></td></tr></table></figure><blockquote><p>–dbpath :指定数据文件存放目录<br>–logpath :指定日志文件，注意是指定文件不是目录<br>–logappend :使用追加的方式记录日志<br>–port:指定端口，默认为27017<br>–bind_ip:默认只监听localhost网卡<br>–fork: 后台启动<br>–auth: 开启认证模式</p></blockquote><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220829151738922.png"                      alt="image-20220829151738922"                ></p><blockquote><p><strong>添加环境变量</strong></p></blockquote><p>修改&#x2F;etc&#x2F;profile，添加环境变量,方便执行MongoDB命令</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> MONGODB_HOME=/usr/local/soft/mongodb</span><br><span class="line">PATH=<span class="variable">$PATH</span>:<span class="variable">$MONGODB_HOME</span>/bin</span><br></pre></td></tr></table></figure><p>然后执行source &#x2F;etc&#x2F;profile 重新加载环境变量</p><h3 id="利用配置文件启动服务"><a href="#利用配置文件启动服务" class="headerlink" title="利用配置文件启动服务"></a><strong>利用配置文件启动服务</strong></h3><p>编辑&#x2F;mongodb&#x2F;conf&#x2F;mongo.conf文件，内容如下：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">systemLog:</span><br><span class="line">    destination: file</span><br><span class="line">    path: /mongodb/log/mongod.log <span class="comment"># log path</span></span><br><span class="line">    logAppend: <span class="literal">true</span></span><br><span class="line">storage:</span><br><span class="line">    dbPath: /mongodb/data <span class="comment"># data directory</span></span><br><span class="line">    engine: wiredTiger <span class="comment">#存储引擎</span></span><br><span class="line">    journal: <span class="comment">#是否启用journal日志</span></span><br><span class="line">    enabled: <span class="literal">true</span></span><br><span class="line">net:</span><br><span class="line">    bindIp: 0.0.0.0</span><br><span class="line">    port: 27017 <span class="comment"># port</span></span><br><span class="line">processManagement:</span><br><span class="line">    fork: <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>注意：一定要yaml格式 </p><p>启动mongod</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongod -f /mongodb/conf/mongo.conf</span><br></pre></td></tr></table></figure><blockquote><p><strong>关闭MongoDB服务</strong> </p></blockquote><p>方式1：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongod --port=27017 --dbpath=/mongodb/data --shutdown</span><br></pre></td></tr></table></figure><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220829152144844.png"                      alt="image-20220829152144844"                ></p><p>方式2：<br>进入mongo shell</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">use admin </span><br><span class="line">db.shutdownServer()</span><br></pre></td></tr></table></figure><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220829152213212.png"                      alt="image-20220829152213212"                ></p><h2 id="Mongo-shell使用"><a href="#Mongo-shell使用" class="headerlink" title="Mongo shell使用"></a>Mongo shell使用</h2><p>mongo是MongoDB的交互式JavaScript Shell界面，它为系统管理员提供了强大的界面，并为开发人员提供了直接测试数据库查询和操作的方法。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongo --port=27017</span><br></pre></td></tr></table></figure><blockquote><p>–port:指定端口，默认为27017<br>–host:连接的主机地址，默认127.0.0.1</p></blockquote><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220829152313411.png"                      alt="image-20220829152313411"                ></p><h3 id="JavaScript支持"><a href="#JavaScript支持" class="headerlink" title="JavaScript支持"></a>JavaScript支持</h3><p>mongo shell是基于JavaScript语法的，MongoDB使用了SpiderMonkey作为其内部的JavaScript解释器引擎，这是由Mozilla官方提供的JavaScript内核解释器，该解释器也被同样用于大名鼎鼎的Firefox浏览器产品之中。SpiderMonkey对ECMA Script标准兼容性非常好，可以支持ECMA Script 6。可以通过下 面的命令检查JavaScript解释器的版本：</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220829152430977.png"                      alt="image-20220829152430977"                ></p><h3 id="mongo-shell常用命令"><a href="#mongo-shell常用命令" class="headerlink" title="mongo shell常用命令"></a>mongo shell常用命令</h3><table><thead><tr><th>命令</th><th>说明</th></tr></thead><tbody><tr><td>show dbs |show databases</td><td>显示数据库列表</td></tr><tr><td>use 数据库名</td><td>切换数据库，如果不存在创建数据库</td></tr><tr><td>db.dropDatabase()</td><td>删除数据库</td></tr><tr><td>show collections| show tables</td><td>显示当前数据库的集合列表</td></tr><tr><td>db.集合名.stats()</td><td>查看集合详情</td></tr><tr><td>db.集合名.drop()</td><td>删除集合</td></tr><tr><td>show users</td><td>显示当前数据库的用户列表</td></tr><tr><td>show roles</td><td>显示当前数据库的角色列表</td></tr><tr><td>show profile</td><td>显示最近发生的操作</td></tr><tr><td>load(“xxx.js”)</td><td>执行一个JavaScript脚本文件</td></tr><tr><td>exit |quit()</td><td>退出当前shell</td></tr><tr><td>help</td><td>查看mongodb支持哪些命令</td></tr><tr><td>db.help()</td><td>查询当前数据库支持的方法</td></tr><tr><td>db.集合名.help()</td><td>显示集合的帮助信息</td></tr><tr><td>db.version()</td><td>查看数据库版本</td></tr></tbody></table><h3 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看所有库</span></span><br><span class="line">show dbs</span><br><span class="line"><span class="comment"># 切换到指定数据库，不存在则创建 </span></span><br><span class="line">use <span class="built_in">test</span></span><br><span class="line"><span class="comment"># 删除当前数据库 </span></span><br><span class="line">db.dropDatabase()</span><br></pre></td></tr></table></figure><h3 id="集合操作"><a href="#集合操作" class="headerlink" title="集合操作"></a>集合操作</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看集合</span></span><br><span class="line">show collections</span><br><span class="line"><span class="comment">#创建集合</span></span><br><span class="line">db.createCollection(<span class="string">&quot;emp&quot;</span>) </span><br><span class="line"><span class="comment">#删除集合</span></span><br><span class="line">db.emp.drop()</span><br></pre></td></tr></table></figure><blockquote><p>创建集合语法</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.createCollection(name, options)</span><br></pre></td></tr></table></figure><p><strong>options参数</strong></p><table><thead><tr><th>字段</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>capped</td><td>布尔</td><td>（可选）如果为true，则创建固定集合。固定集合是指有着固定大小的集合， 当达到最大值时，它会自动覆盖最早的文档。</td></tr><tr><td>size</td><td>数值</td><td>（可选）为固定集合指定一个最大值（以字节计）。如果 capped 为 true，也需要指定该字段。</td></tr><tr><td>max</td><td>数值</td><td>（可选）指定固定集合中包含文档的最大数量。</td></tr></tbody></table><p>注意： 当集合不存在时，向集合中插入文档也会创建集合</p><h2 id="安全认证"><a href="#安全认证" class="headerlink" title="安全认证"></a>安全认证</h2><h3 id="创建管理员账号"><a href="#创建管理员账号" class="headerlink" title="创建管理员账号"></a>创建管理员账号</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置管理员用户名密码需要切换到admin库</span></span><br><span class="line">use admin</span><br><span class="line"><span class="comment">#创建管理员 </span></span><br><span class="line">db.createUser(&#123;user:<span class="string">&quot;fox&quot;</span>,<span class="built_in">pwd</span>:<span class="string">&quot;fox&quot;</span>,roles:[<span class="string">&quot;root&quot;</span>]&#125;) </span><br><span class="line"><span class="comment"># 查看所有用户信息</span></span><br><span class="line">show <span class="built_in">users</span></span><br><span class="line"><span class="comment">#删除用户</span></span><br><span class="line">db.dropUser(<span class="string">&quot;fox&quot;</span>)</span><br></pre></td></tr></table></figure><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220829154210470.png"                      alt="image-20220829154210470"                ></p><h3 id="常用权限"><a href="#常用权限" class="headerlink" title="常用权限"></a>常用权限</h3><table><thead><tr><th>权限名</th><th>描述</th></tr></thead><tbody><tr><td>read</td><td>允许用户读取指定数据库</td></tr><tr><td>readWrite</td><td>允许用户读写指定数据库</td></tr><tr><td>dbAdmin</td><td>允许用户在指定数据库中执行管理函数，如索引创建、删除，查看统 计或访问system.profile</td></tr><tr><td>dbOwner</td><td>允许用户在指定数据库中执行任意操作，增、删、改、查等</td></tr><tr><td>userAdmin</td><td>允许用户向system.users集合写入，可以在指定数据库里创建、删 除和管理用户</td></tr><tr><td>clusterAdmin</td><td>只在admin数据库中可用，赋予用户所有分片和复制集相关函数的管 理权限</td></tr><tr><td>readAnyDatabase</td><td>只在admin数据库中可用，赋予用户所有分片和复制集相关函数的管 理权限</td></tr><tr><td>readWriteAnyDatabase</td><td>只在admin数据库中可用，赋予用户所有数据库的读写权限</td></tr><tr><td>userAdminAnyDatabase</td><td>只在admin数据库中可用，赋予用户所有数据库的userAdmin权限</td></tr><tr><td>dbAdminAnyDatabase</td><td>只在admin数据库中可用，赋予用户所有数据库的dbAdmin权限</td></tr><tr><td>root</td><td>只在admin数据库中可用。超级账号，超级权限</td></tr></tbody></table><p>用户认证，返回1表示认证成功</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220829154531037.png"                      alt="image-20220829154531037"                ></p><h3 id="创建应用数据库用户"><a href="#创建应用数据库用户" class="headerlink" title="创建应用数据库用户"></a>创建应用数据库用户</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">use appdb </span><br><span class="line">db.createUser(&#123;user:<span class="string">&quot;appdb&quot;</span>,<span class="built_in">pwd</span>:<span class="string">&quot;fox&quot;</span>,roles:[<span class="string">&quot;dbOwner&quot;</span>]&#125;)</span><br></pre></td></tr></table></figure><p>默认情况下，MongoDB不会启用鉴权，以鉴权模式启动MongoDB</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongod -f /mongodb/conf/mongo.conf --auth</span><br></pre></td></tr></table></figure><p>启用鉴权之后，连接MongoDB的相关操作都需要提供身份认证。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongo 192.168.65.174:27017 -u fox -p fox --authenticationDatabase=admin</span><br></pre></td></tr></table></figure><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220829154640467.png"                      alt="image-20220829154640467"                ></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;linux安装MongoDB&quot;&gt;&lt;a href=&quot;#linux安装MongoDB&quot; class=&quot;headerlink&quot; title=&quot;linux安装MongoDB&quot;&gt;&lt;/a&gt;linux安装MongoDB&lt;/h2&gt;&lt;p&gt;环境准备：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;lin</summary>
      
    
    
    
    
    <category term="MongoDB" scheme="http://example.com/tags/MongoDB/"/>
    
  </entry>
  
  <entry>
    <title>MongoDB之介绍</title>
    <link href="http://example.com/2022/08/29/MongoDB%E4%B9%8B%E4%BB%8B%E7%BB%8D/"/>
    <id>http://example.com/2022/08/29/MongoDB%E4%B9%8B%E4%BB%8B%E7%BB%8D/</id>
    <published>2022-08-29T06:49:15.000Z</published>
    <updated>2022-08-29T07:10:29.216Z</updated>
    
    <content type="html"><![CDATA[<h2 id="什么是MongoDB"><a href="#什么是MongoDB" class="headerlink" title="什么是MongoDB"></a>什么是MongoDB</h2><p>MongoDB是一个文档数据库（以 JSON 为数据模型），由C++语言编写，旨在为WEB应用提供可扩展的 高性能数据存储解决方案。<br>MongoDB是一个介于关系数据库和非关系数据库之间的产品，是非关系数据库当中功能最丰富，最像关系数据库的。它支持的数据结构非常松散，数据格式是BSON，一种类似JSON的二进制形式的存储格 式，简称Binary JSON ，和JSON一样支持内嵌的文档对象和数组对象，因此可以存储比较复杂的数据类 型。MongoDB最大的特点是它支持的查询语言非常强大，其语法有点类似于面向对象的查询语言，几乎可以实现类似关系数据库单表查询的绝大部分功能，而且还支持对数据建立索引。<strong>原则上 Oracle 和 MySQL 能做的事情，MongoDB 都能做（包括 ACID 事务）。</strong></p><p>MongoDB在数据库总排名第5，仅次于Oracle、MySQL等RDBMS，在NoSQL数据库排名首位。从诞生 以来，其项目应用广度、社区活跃指数持续上升。</p><p>MongoDB概念与关系型数据库（RDBMS）非常类似：</p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220829145345660.png"                      alt="image-20220829145345660" style="zoom:200%;"                 ><ul><li>数据库（database）：最外层的概念，可以理解为逻辑上的名称空间，一个数据库包含多个不同名称的集合。</li><li>集合（collection）：相当于SQL中的表，一个集合可以存放多个不同的文档。 </li><li>文档（document）：一个文档相当于数据表中的一行，由多个不同的字段组成。 </li><li>字段（field）：文档中的一个属性，等同于列（column）。 </li><li>索引（index）：独立的检索式数据结构，与SQL概念一致。 </li><li>id：每个文档中都拥有一个唯一的id字段，相当于SQL中的主键（primary key）。 </li><li>视图（view）：可以看作一种虚拟的（非真实存在的）集合，与SQL中的视图类似。从MongoDB 3.4版本开始提供了视图功能，其通过聚合管道技术实现。 </li><li>聚合操作（$lookup）：MongoDB用于实现“类似”表连接（tablejoin）的聚合操作符。</li></ul><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220829145755705.png"                      alt="image-20220829145755705"                ></p><p>尽管这些概念大多与SQL标准定义类似，但MongoDB与传统RDBMS仍然存在不少差异，包括： </p><ul><li>半结构化，在一个集合中，文档所拥有的字段并不需要是相同的，而且也不需要对所用的字段进行声明。因此，MongoDB具有很明显的半结构化特点。除了松散的表结构，文档还可以支持多级的 嵌套、数组等灵活的数据类型，非常契合面向对象的编程模型。 </li><li>弱关系，MongoDB没有外键的约束，也没有非常强大的表连接能力。类似的功能需要使用聚合管 道技术来弥补。</li></ul><h2 id="MongoDB技术优势"><a href="#MongoDB技术优势" class="headerlink" title="MongoDB技术优势"></a>MongoDB技术优势</h2><p>MongoDB基于灵活的JSON文档模型，非常适合敏捷式的快速开发。与此同时，其与生俱来的高可用、 高水平扩展能力使得它在处理海量、高并发的数据应用时颇具优势。</p><ul><li>JSON 结构和对象模型接近，开发代码量低 </li><li>JSON的动态模型意味着更容易响应新的业务需求 </li><li>复制集提供99.999%高可用 </li><li>分片架构支持海量数据和无缝扩容</li></ul><p><strong>简单直观：从错综复杂的关系模型到一目了然的对象模型</strong></p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220829150247312.png"                      alt="image-20220829150247312"                ></p><p><strong>快速：最简单快速的开发方式</strong></p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220829150306331.png"                      alt="image-20220829150306331"                ></p><p><strong>灵活：快速响应业务变化</strong></p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220829150445395.png"                      alt="image-20220829150445395"                ></p><p><strong>MongoDB优势：原生的高可用</strong></p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220829150529354.png"                      alt="image-20220829150529354"                ></p><p><strong>MongoDB优势：横向扩展能力</strong></p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220829150548370.png"                      alt="image-20220829150548370"                ></p><h2 id="MongoDB应用场景"><a href="#MongoDB应用场景" class="headerlink" title="MongoDB应用场景"></a>MongoDB应用场景</h2><p>从目前阿里云 MongoDB 云数据库上的用户看，MongoDB 的应用已经渗透到各个领域： </p><ul><li>游戏场景，使用 MongoDB 存储游戏用户信息，用户的装备、积分等直接以内嵌文档的形式存储，<br>方便查询、更新；</li><li>物流场景，使用 MongoDB 存储订单信息，订单状态在运送过程中会不断更新，以MongoDB 内嵌数组的形式来存储，一次查询就能将订单所有的变更读取出来；</li><li>社交场景，使用 MongoDB 存储存储用户信息，以及用户发表的朋友圈信息，通过地理位置索引实 现附近的人、地点等功能；</li><li>物联网场景，使用 MongoDB 存储所有接入的智能设备信息，以及设备汇报的日志信息，并对这些 信息进行多维度的分析；</li><li>视频直播，使用 MongoDB 存储用户信息、礼物信息等； </li><li>大数据应用，使用云数据库MongoDB作为大数据的云存储系统，随时进行数据提取分析，掌握行 业动态。|</li></ul><p>国内外知名互联网公司都在使用MongoDB：</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220829150844843.png"                      alt="image-20220829150844843"                ></p><h3 id="如何考虑是否选择MongoDB"><a href="#如何考虑是否选择MongoDB" class="headerlink" title="如何考虑是否选择MongoDB?"></a>如何考虑是否选择MongoDB?</h3><p>没有某个业务场景必须要使用MongoDB才能解决，但使用MongoDB通常能让你以更低的成本解决问 题。如果你不清楚当前业务是否适合使用MongoDB,可以通过做几道选择题来辅助决策。</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220829151009948.png"                      alt="image-20220829151009948"                ></p><p>只要有一项需求满足就可以考虑使用MongoDB，匹配越多，选择MongoDB越合适。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;什么是MongoDB&quot;&gt;&lt;a href=&quot;#什么是MongoDB&quot; class=&quot;headerlink&quot; title=&quot;什么是MongoDB&quot;&gt;&lt;/a&gt;什么是MongoDB&lt;/h2&gt;&lt;p&gt;MongoDB是一个文档数据库（以 JSON 为数据模型），由C++语言编写</summary>
      
    
    
    
    
    <category term="MongoDB" scheme="http://example.com/tags/MongoDB/"/>
    
  </entry>
  
  <entry>
    <title>动态规划系列之斐波那契数列</title>
    <link href="http://example.com/2022/08/26/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E7%B3%BB%E5%88%97%E4%B9%8B%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E6%95%B0%E5%88%97/"/>
    <id>http://example.com/2022/08/26/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E7%B3%BB%E5%88%97%E4%B9%8B%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E6%95%B0%E5%88%97/</id>
    <published>2022-08-26T02:10:06.000Z</published>
    <updated>2022-08-26T02:45:24.894Z</updated>
    
    <content type="html"><![CDATA[<p>动态规划的一般流程就是三步：暴力的递归解法 -&gt; 带备忘录的递归解法 -&gt; 迭代的动态规划解法。</p><p>就思考流程来说，就分为以下几步：找到状态和选择 -&gt; 明确dp数组&#x2F;函数的定义 -&gt; 找到状态之间的关系。</p><hr><h2 id="动态规划详解"><a href="#动态规划详解" class="headerlink" title="动态规划详解"></a>动态规划详解</h2><p>动态规划问题的一般形式就是求最值。动态规划其实就是运筹学的一种&#x3D;&#x3D;最优化方法&#x3D;&#x3D;，只不过在计算机问题上应用比较多，比如说求<strong>最长递增子序列、最小编辑距离</strong>等。</p><p>求解动态规划的核心问题是<code>穷举</code>。</p><ul><li>这类问题存在&#x3D;&#x3D;重叠子问题&#x3D;&#x3D;，所以需要&#x3D;&#x3D;备忘录&#x3D;&#x3D;或者&#x3D;&#x3D;DP table&#x3D;&#x3D;来优化穷举过程，避免不必要的计算。</li><li>只有列出正确的&#x3D;&#x3D;状态转移方程&#x3D;&#x3D;才能正确的穷举。</li></ul><p>以上提到的重叠子问题、最优子结构、状态转移方程就是动态规划三要素。</p><h2 id="斐波那契数列"><a href="#斐波那契数列" class="headerlink" title="斐波那契数列"></a>斐波那契数列</h2><h3 id="暴力递归"><a href="#暴力递归" class="headerlink" title="暴力递归"></a>暴力递归</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">fib</span><span class="params">(<span class="type">int</span> N)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (N == <span class="number">1</span> || N == <span class="number">2</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> fib(N - <span class="number">1</span>) + fib(N - <span class="number">2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>画出递归树，如下所示：</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220826102315737.png"                      alt="image-20220826102315737"                ></p><p>递归算法的时间复杂度怎么计算：<strong>子问题个数乘以解决一个子问题需要的时间（其中子问题的个数，即递归树中节点的总数）</strong></p><p>所以上述问题的时间复杂度就是O(2^n) * O(1) &#x3D; O(2^n) （指数级别，爆炸）</p><p>观察递归树，很明显发现了算法低效的原因：存在大量重复计算，比如 f(18) 被计算了两次，而且你可以看到，以 f(18) 为根的这个递归树 体量巨大，多算一遍，会耗费巨大的时间。更何况，还不止 f(18) 这 一个节点被重复计算，所以这个算法及其低效。</p><p>这就是动态规划问题的第一个性质：<strong>重叠子问题</strong></p><h3 id="带备忘录的递归解法"><a href="#带备忘录的递归解法" class="headerlink" title="带备忘录的递归解法"></a>带备忘录的递归解法</h3><p>即然耗时的原因是重复计 &#x3D;算，那么我们可以造一个「备忘录」，每次算出某个子问题的答案后别急着返回，先记到「备忘录」里再返回；每次遇到一个子问题先去「备忘录」里查一查，如果发现之前已经解决过这个问题了，直接把答案拿出来用，不要再耗时去计算了。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">fib</span><span class="params">(<span class="type">int</span> N)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (N &lt; <span class="number">1</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 备忘录全初始化为 0</span></span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; <span class="title function_">memo</span><span class="params">(N + <span class="number">1</span>, <span class="number">0</span>)</span>;</span><br><span class="line">    <span class="comment">// 初始化最简情况</span></span><br><span class="line">    <span class="keyword">return</span> helper(memo, N);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">helper</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; memo, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="comment">// base case </span></span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">1</span> || n == <span class="number">2</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// 已经计算过</span></span><br><span class="line">    <span class="keyword">if</span> (memo[n] != <span class="number">0</span>) <span class="keyword">return</span> memo[n];</span><br><span class="line">    memo[n] = helper(memo, n - <span class="number">1</span>) + </span><br><span class="line">             helper(memo, n - <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">return</span> memo[n];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>递归树如下所示：</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220826103114296.png"                      alt="image-20220826103114296"                ></p><p>上述的意思就是把之前计算过的子问题的答案直接拿来用，也就不存在冗余了。如下所示：</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220826103354245.png"                      alt="image-20220826103354245"                ></p><p>可以得出上述得时间复杂度是O(n)。</p><p>但是这种解法叫做<strong>自顶向下</strong>，而动态规划是&#x3D;&#x3D;自底向上&#x3D;&#x3D;。（啥叫「自底向上」？我们直接从最底下，最简单，问题规模最小的 f(1) 和 f(2) 开始往上推，直到推到我们想要的答案 f(20) ，这 就是动态规划的思路，这也是为什么动态规划一般都脱离了递归，而是由循环迭代完成计算。）</p><h3 id="dp数组得迭代解法"><a href="#dp数组得迭代解法" class="headerlink" title="dp数组得迭代解法"></a>dp数组得迭代解法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">fib</span><span class="params">(<span class="type">int</span> N)</span> &#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; <span class="title function_">dp</span><span class="params">(N + <span class="number">1</span>, <span class="number">0</span>)</span>;</span><br><span class="line">    <span class="comment">// base case</span></span><br><span class="line">    dp[<span class="number">1</span>] = dp[<span class="number">2</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">3</span>; i &lt;= N; i++)</span><br><span class="line">        dp[i] = dp[i - <span class="number">1</span>] + dp[i - <span class="number">2</span>];</span><br><span class="line">    <span class="keyword">return</span> dp[N];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220826103848130.png"                      alt="image-20220826103848130"                ></p><p>实际上，带备忘录的递归解法中的&#x3D;&#x3D;备忘录&#x3D;&#x3D;，最终完成后就是这个&#x3D;&#x3D;DP table&#x3D;&#x3D;</p><p>引出&#x3D;&#x3D;状态转换方程&#x3D;&#x3D;：描述问题结构的数学形式：</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220826104036557.png"                      alt="image-20220826104036557"                ></p><p>很容易发现，其实状态转移方程直接代表着暴力解法。动态规划问题最困难的就是写出状态转移方程，即这个暴力解。上面的几种解法中的所有操作，都是围绕这个方程式的不同表现形式。</p><h3 id="最终优化"><a href="#最终优化" class="headerlink" title="最终优化"></a>最终优化</h3><p>根据斐波那契数列的状态转移方程，当前状态只和之前的两个状态有关，其实并不需要那么长的一个 DP table 来存储所有的状态，只要想办法存储之前的两个状态就行了。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">fib</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">2</span> || n == <span class="number">1</span>) </span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">prev</span> <span class="operator">=</span> <span class="number">1</span>, curr = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">3</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> prev + curr;</span><br><span class="line">        prev = curr;</span><br><span class="line">        curr = sum;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> curr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上旨在演示算法设计螺旋上升的过程。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;动态规划的一般流程就是三步：暴力的递归解法 -&amp;gt; 带备忘录的递归解法 -&amp;gt; 迭代的动态规划解法。&lt;/p&gt;
&lt;p&gt;就思考流程来说，就分为以下几步：找到状态和选择 -&amp;gt; 明确dp数组&amp;#x2F;函数的定义 -&amp;gt; 找到状态之间的关系。&lt;/p&gt;
&lt;hr&gt;
&lt;</summary>
      
    
    
    
    
    <category term="动态规划系列" scheme="http://example.com/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E7%B3%BB%E5%88%97/"/>
    
  </entry>
  
  <entry>
    <title>k8s之CRI</title>
    <link href="http://example.com/2022/08/25/k8s%E4%B9%8BCRI/"/>
    <id>http://example.com/2022/08/25/k8s%E4%B9%8BCRI/</id>
    <published>2022-08-25T01:49:19.000Z</published>
    <updated>2022-08-25T01:53:40.087Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p><strong>Kubernetes</strong> 节点的底层由一个叫做<strong>容器运行时</strong>的软件进行支撑，它主要负责启停容器。</p><p><strong>Docker</strong> 是目前最广为人知的容器运行时软件，但是它并非唯一。在这几年中，容器运行时这个领域发展的迅速。为了使得 <strong>Kubernetes</strong> 的扩展变得更加容易，一直在打磨支持容器运行时的 <strong>K8S</strong>插件 <strong>API</strong>，也就是 容器运行时接口 ( Container Runtime Interface, CRI) 。</p><h2 id="k8s架构"><a href="#k8s架构" class="headerlink" title="k8s架构"></a>k8s架构</h2><p>这里通过分析 <strong>k8s</strong> 目前默认的一种容器运行时架构，来帮助我们更好的理解 <strong>k8s</strong> 运行时的背后逻辑，同时引出 <strong>CRI</strong> 和 <strong>OCI</strong> 提出的背景。</p><p>我们在创建 <strong>k8s</strong> 集群的时候，首先需要搭建 <strong>master</strong> 节点，其次需要创建 <strong>node</strong> 节点，并将 <strong>node</strong> 节点加入到 <strong>k8s</strong> 集群中。当我们构建好 <strong>k8s</strong> 集群后，可以通过下面命令来创建应用对应的pod</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f nginx.yml</span><br></pre></td></tr></table></figure><p>执行完成后，该命令首先会提交给 <strong>API Server</strong> ，然后解析 <strong>yml</strong> 文件，并对其以 <strong>API</strong> 对象的形式存到 <strong>etcd</strong> 里。</p><p>这时候，<strong>master</strong> 组件中的 <strong>Controller Manager</strong> 会通过控制循环的方式来做编排工作，创建应用所需的Pod。同时 <strong>Scheduler</strong> 会 <strong>watch etcd</strong> 中新 <strong>pod</strong> 的变化，如果他发现有一个新的 <strong>pod</strong> 的变化。</p><p>如果 <strong>Scheduler</strong> 发现有一个新的 <strong>pod</strong> 出现，它会运行调度算法，然后选择出最佳的 <strong>Node</strong> 节点，并将这个节点的名字写到 <strong>pod</strong> 对象的 <strong>NodeName</strong> 字段上，这一步就是所谓的 <strong>Bind Pod to Node</strong>，然后把 <strong>bind</strong> 的结果写到 <strong>etcd</strong>。</p><p>其次，当我们在构建 <strong>k8s</strong> 集群的时候，默认每个节点都会初始化创建一个 <strong>kubectl</strong> 进程，<strong>kubectl</strong> 进程会  <strong>watch etcd</strong> 中 <strong>pod</strong> 的变化，当 <strong>kubectl</strong> 进程监听到 <strong>pod</strong> 的 <strong>bind</strong> 的更新操作，并且 <strong>bind</strong> 的节点是本节点时，它会接管接下来的所有事情，如镜像下载，创建容器等。</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/595328-20220924154453278-2062939099.jpg"                      alt="595328-20220924154453278-2062939099"                ></p><h2 id="k8s默认容器运行时架构"><a href="#k8s默认容器运行时架构" class="headerlink" title="k8s默认容器运行时架构"></a>k8s默认容器运行时架构</h2><p>接下来将通过 <strong>k8s</strong> 默认集成的容器运行时架构，来看 <strong>kubernetes</strong> 如何创建一个容器 （如下图）</p><ul><li><strong>kubernetes</strong> 通过 <strong>CRI</strong> (Container Runtime Interface) 接口调用 <strong>dockershim</strong>，请求创建一个容器。这一步中，<strong>Kubectl</strong> 可以视作一个简单的 <strong>CRI Client</strong>，而 <strong>dockershim</strong> 就是接收的 <strong>Server</strong>。</li><li><strong>dockershim</strong> 收到请求后，通过适配的方式，适配成 <strong>Docker Daemon</strong> 的请求格式，发到 <strong>Docker Daemon</strong> 上请求创建一个容器。在 docker 1.12 后的版本，docker daemon 被拆分成了 <strong>dockerd</strong> 和 <strong>containerd</strong>，其中，<strong>containerd</strong> 负责操作容器。</li><li><strong>dockerd</strong> 收到请求后，会调用 <strong>containerd</strong> 进程去创建一个容器</li><li><strong>containerd</strong> 收到请求后，并不会自己直接去操作容器，而是创建一个叫做 <strong>containerd-shim</strong> 的进程，让 <strong>containerd-shim</strong> 去操作容器，创建 <strong>containerd-shim</strong> 的目的主要有以下几个<ul><li>让 <strong>containerd-shim</strong> 做诸如收集状态，维持 stdin 等 fd 打开等工作。</li><li>允许容器运行时( <strong>runC</strong> ) 启动容器后退出，不必为每个容器一直运行一个容器运行时的 <strong>runC</strong></li><li>即使在 <strong>containerd</strong> 和 <strong>dockerd</strong> 都挂掉的情况下，容器的标准 IO 和其它的文件描述符也是可以用的</li><li>向 <strong>containerd</strong> 报告容器的退出状态</li><li>在不中断容器运行时的情况下，升级或重启 <strong>dockerd</strong></li></ul></li><li>而 <strong>containerd-shim</strong> 在这一步需要调用 <strong>runC</strong> 这个命令行工具，来启动容器，<strong>runC</strong> 是 <strong>OCI</strong> (Open Container Initiative， 开放标准协议) 的一个参考实现。主要用来设置 <strong>namespaces</strong> 和 <strong>cgroups</strong>，挂载 root filesystem等操作。</li><li><strong>runC</strong> 启动完容器后，本身会直接退出。<strong>containerd-shim</strong> 则会成为容器进程的父进程，负责收集容器进程的状态，上报给 <strong>containerd</strong>，并在容器中的 <strong>pid</strong> 为 <strong>1</strong> 的进程退出后接管容器中的子进程进行清理，确保不会出现僵尸进程 (关闭进程描述符)。</li></ul><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/595328-20220924162334102-1814702716.png"                      alt="595328-20220924162334102-1814702716"                ></p><h2 id="容器与容器编排背景"><a href="#容器与容器编排背景" class="headerlink" title="容器与容器编排背景"></a>容器与容器编排背景</h2><p>从 <strong>k8s</strong> 的容器运行时可以看出，<strong>kubectl</strong> 启动容器的过程经过了很长的一段调用链路。这个是由于在容器及编排领域各大厂商与 <strong>docker</strong> 之间的竞争以及 <strong>docker</strong> 公司为了抢占 <strong>Pass</strong> ( Platform-as-a-service，平台服务)  领域市场，对架构做出的一系列调整。</p><p>其实 <strong>k8s</strong> 最开始的运行时架构链路调用没有这么复杂：kubelet想要创建容器直接通过 <strong>docker api</strong> 调用 <strong>Docker Daemon</strong> ， 然后Docker Daemon 调用 libcontainer 这个库来启动容器。</p><p>后面为了防止 <strong>docker</strong> 垄断以及受控 docker 运行时，各大厂商于是就联合起来，制订出开放容器标准<strong>OCI</strong> ( Open Containers Initiative ) 。大家可以基于这个标准开发自己的容器运行时。Docker公司则把 <strong>libcontainer</strong> 做了一层封装，变成 <strong>runC</strong> 捐献给 <strong>CNCF</strong> 作为 <strong>OCI</strong> 的参考实现。</p><p>接下来就是 <strong>Docker</strong> 要搞 <strong>Swarm</strong> 进军 <strong>PaaS</strong> 市场，于是做了个架构切分，把容器操作都移动到一个单独的 <strong>Daemon</strong> 进程的 <strong>containerd</strong> 中去，让 Docker Daemon专门负责上层封装编排，但是最终 <strong>Swarm</strong> 败给了 <strong>K8S</strong> ，于是Docker公司就把 <strong>Containerd</strong> 捐给了 CNCF，专注于搞 <strong>Docker</strong> 企业版了。</p><p>与此同时，容器领域 <strong>core os</strong> 公司推出了 <strong>rkt</strong> 容器运行时，希望 <strong>k8s</strong> 原生支持 <strong>rkt</strong> 作为运行时，由于 <strong>core os</strong> 与 <strong>Google</strong> 的关系，最终 <strong>rkt</strong> 运行时的支持在 <strong>2016</strong> 年也被合并进 <strong>kubelet</strong> 主干代码里，这样做反而给 <strong>k8s</strong> 中负责维护 <strong>kubelet</strong> 的小组 <strong>SIG-Node</strong> 带来了更大的负担，每一次 <strong>kubectl</strong> 的更新都要维护 <strong>docker</strong> 和 <strong>rkt</strong> 作为两部分代码。与此同时，随着虚拟化技术强隔离容器技术 <strong>runV</strong> (Kata Containers 前身, 后与 intel clear container 合并)的逐渐成熟。<strong>K8S</strong> 上游对虚拟化容器的支持很快被提上日程。为了从集成每一种运行时都要维护的一份代码中解救出来，<strong>K8S SIG-Node</strong> 工作组决定对容器的操作统一地抽象成一个接口，这样 <strong>kubelet</strong> 只需要跟这个接口打交道，而具体地容器运行时，他们只需要实现该接口，并对kubelet暴露 <strong>gRPC</strong> 服务即可。这个统一地抽象的接口就是 <strong>k8s</strong> 中俗称的 <strong>CRI</strong>。</p><h2 id="CRI接口"><a href="#CRI接口" class="headerlink" title="CRI接口"></a>CRI接口</h2><p><strong>CRI</strong> (容器运行时接口)基于 <strong>gRPC</strong> 定义了 <strong>RuntimeService</strong> 和 <strong>ImageService</strong> 等两个 <strong>gRPC</strong> 服务，分别用于容器运行时和镜像的管理。如下所示</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Runtime service defines the public APIs for remote container runtimes</span></span><br><span class="line">service RuntimeService &#123;</span><br><span class="line">    <span class="comment">// Version returns the runtime name, runtime version, and runtime API version.</span></span><br><span class="line">    rpc Version(VersionRequest) returns (VersionResponse) &#123;&#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// RunPodSandbox creates and starts a pod-level sandbox. Runtimes must ensure</span></span><br><span class="line">    <span class="comment">// the sandbox is in the ready state on success.</span></span><br><span class="line">    rpc RunPodSandbox(RunPodSandboxRequest) returns (RunPodSandboxResponse) &#123;&#125;</span><br><span class="line">    <span class="comment">// StopPodSandbox stops any running process that is part of the sandbox and</span></span><br><span class="line">    <span class="comment">// reclaims network resources (e.g., IP addresses) allocated to the sandbox.</span></span><br><span class="line">    <span class="comment">// If there are any running containers in the sandbox, they must be forcibly</span></span><br><span class="line">    <span class="comment">// terminated.</span></span><br><span class="line">    <span class="comment">// This call is idempotent, and must not return an error if all relevant</span></span><br><span class="line">    <span class="comment">// resources have already been reclaimed. kubelet will call StopPodSandbox</span></span><br><span class="line">    <span class="comment">// at least once before calling RemovePodSandbox. It will also attempt to</span></span><br><span class="line">    <span class="comment">// reclaim resources eagerly, as soon as a sandbox is not needed. Hence,</span></span><br><span class="line">    <span class="comment">// multiple StopPodSandbox calls are expected.</span></span><br><span class="line">    rpc StopPodSandbox(StopPodSandboxRequest) returns (StopPodSandboxResponse) &#123;&#125;</span><br><span class="line">    <span class="comment">// RemovePodSandbox removes the sandbox. If there are any running containers</span></span><br><span class="line">    <span class="comment">// in the sandbox, they must be forcibly terminated and removed.</span></span><br><span class="line">    <span class="comment">// This call is idempotent, and must not return an error if the sandbox has</span></span><br><span class="line">    <span class="comment">// already been removed.</span></span><br><span class="line">    rpc RemovePodSandbox(RemovePodSandboxRequest) returns (RemovePodSandboxResponse) &#123;&#125;</span><br><span class="line">    <span class="comment">// PodSandboxStatus returns the status of the PodSandbox. If the PodSandbox is not</span></span><br><span class="line">    <span class="comment">// present, returns an error.</span></span><br><span class="line">    rpc PodSandboxStatus(PodSandboxStatusRequest) returns (PodSandboxStatusResponse) &#123;&#125;</span><br><span class="line">    <span class="comment">// ListPodSandbox returns a list of PodSandboxes.</span></span><br><span class="line">    rpc ListPodSandbox(ListPodSandboxRequest) returns (ListPodSandboxResponse) &#123;&#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// CreateContainer creates a new container in specified PodSandbox</span></span><br><span class="line">    rpc CreateContainer(CreateContainerRequest) returns (CreateContainerResponse) &#123;&#125;</span><br><span class="line">    <span class="comment">// StartContainer starts the container.</span></span><br><span class="line">    rpc StartContainer(StartContainerRequest) returns (StartContainerResponse) &#123;&#125;</span><br><span class="line">    <span class="comment">// StopContainer stops a running container with a grace period (i.e., timeout).</span></span><br><span class="line">    <span class="comment">// This call is idempotent, and must not return an error if the container has</span></span><br><span class="line">    <span class="comment">// already been stopped.</span></span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> what must the runtime do after the grace period is reached?</span></span><br><span class="line">    rpc StopContainer(StopContainerRequest) returns (StopContainerResponse) &#123;&#125;</span><br><span class="line">    <span class="comment">// RemoveContainer removes the container. If the container is running, the</span></span><br><span class="line">    <span class="comment">// container must be forcibly removed.</span></span><br><span class="line">    <span class="comment">// This call is idempotent, and must not return an error if the container has</span></span><br><span class="line">    <span class="comment">// already been removed.</span></span><br><span class="line">    rpc RemoveContainer(RemoveContainerRequest) returns (RemoveContainerResponse) &#123;&#125;</span><br><span class="line">    <span class="comment">// ListContainers lists all containers by filters.</span></span><br><span class="line">    rpc ListContainers(ListContainersRequest) returns (ListContainersResponse) &#123;&#125;</span><br><span class="line">    <span class="comment">// ContainerStatus returns status of the container. If the container is not</span></span><br><span class="line">    <span class="comment">// present, returns an error.</span></span><br><span class="line">    rpc ContainerStatus(ContainerStatusRequest) returns (ContainerStatusResponse) &#123;&#125;</span><br><span class="line">    <span class="comment">// UpdateContainerResources updates ContainerConfig of the container.</span></span><br><span class="line">    rpc UpdateContainerResources(UpdateContainerResourcesRequest) returns (UpdateContainerResourcesResponse) &#123;&#125;</span><br><span class="line">    <span class="comment">// ReopenContainerLog asks runtime to reopen the stdout/stderr log file</span></span><br><span class="line">    <span class="comment">// for the container. This is often called after the log file has been</span></span><br><span class="line">    <span class="comment">// rotated. If the container is not running, container runtime can choose</span></span><br><span class="line">    <span class="comment">// to either create a new log file and return nil, or return an error.</span></span><br><span class="line">    <span class="comment">// Once it returns error, new container log file MUST NOT be created.</span></span><br><span class="line">    rpc ReopenContainerLog(ReopenContainerLogRequest) returns (ReopenContainerLogResponse) &#123;&#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// ExecSync runs a command in a container synchronously.</span></span><br><span class="line">    rpc ExecSync(ExecSyncRequest) returns (ExecSyncResponse) &#123;&#125;</span><br><span class="line">    <span class="comment">// Exec prepares a streaming endpoint to execute a command in the container.</span></span><br><span class="line">    rpc Exec(ExecRequest) returns (ExecResponse) &#123;&#125;</span><br><span class="line">    <span class="comment">// Attach prepares a streaming endpoint to attach to a running container.</span></span><br><span class="line">    rpc Attach(AttachRequest) returns (AttachResponse) &#123;&#125;</span><br><span class="line">    <span class="comment">// PortForward prepares a streaming endpoint to forward ports from a PodSandbox.</span></span><br><span class="line">    rpc PortForward(PortForwardRequest) returns (PortForwardResponse) &#123;&#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// ContainerStats returns stats of the container. If the container does not</span></span><br><span class="line">    <span class="comment">// exist, the call returns an error.</span></span><br><span class="line">    rpc ContainerStats(ContainerStatsRequest) returns (ContainerStatsResponse) &#123;&#125;</span><br><span class="line">    <span class="comment">// ListContainerStats returns stats of all running containers.</span></span><br><span class="line">    rpc ListContainerStats(ListContainerStatsRequest) returns (ListContainerStatsResponse) &#123;&#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// UpdateRuntimeConfig updates the runtime configuration based on the given request.</span></span><br><span class="line">    rpc UpdateRuntimeConfig(UpdateRuntimeConfigRequest) returns (UpdateRuntimeConfigResponse) &#123;&#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Status returns the status of the runtime.</span></span><br><span class="line">    rpc Status(StatusRequest) returns (StatusResponse) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// ImageService defines the public APIs for managing images.</span></span><br><span class="line">service ImageService &#123;</span><br><span class="line">    <span class="comment">// ListImages lists existing images.</span></span><br><span class="line">    rpc ListImages(ListImagesRequest) returns (ListImagesResponse) &#123;&#125;</span><br><span class="line">    <span class="comment">// ImageStatus returns the status of the image. If the image is not</span></span><br><span class="line">    <span class="comment">// present, returns a response with ImageStatusResponse.Image set to</span></span><br><span class="line">    <span class="comment">// nil.</span></span><br><span class="line">    rpc ImageStatus(ImageStatusRequest) returns (ImageStatusResponse) &#123;&#125;</span><br><span class="line">    <span class="comment">// PullImage pulls an image with authentication config.</span></span><br><span class="line">    rpc PullImage(PullImageRequest) returns (PullImageResponse) &#123;&#125;</span><br><span class="line">    <span class="comment">// RemoveImage removes the image.</span></span><br><span class="line">    <span class="comment">// This call is idempotent, and must not return an error if the image has</span></span><br><span class="line">    <span class="comment">// already been removed.</span></span><br><span class="line">    rpc RemoveImage(RemoveImageRequest) returns (RemoveImageResponse) &#123;&#125;</span><br><span class="line">    <span class="comment">// ImageFSInfo returns information of the filesystem that is used to store images.</span></span><br><span class="line">    rpc ImageFsInfo(ImageFsInfoRequest) returns (ImageFsInfoResponse) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>具体容器运行时则需要实现 <strong>CRI</strong> 定义的接口（即 <strong>gRPC Server</strong>，通常称为 <strong>CRI shim</strong>）。容器运行时在启动 <strong>gRPC server</strong> 时需要监听在本地的 <strong>Unix Socket</strong> （Windows 使用 tcp 格式）。</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a class="link"   href="https://www.kubernetes.org.cn/1079.html" >https://www.kubernetes.org.cn/1079.html<i class="fas fa-external-link-alt"></i></a></p><p><a class="link"   href="https://www.cnblogs.com/justinli/p/11578951.html" >https://www.cnblogs.com/justinli/p/11578951.html<i class="fas fa-external-link-alt"></i></a>    </p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;Kubernetes&lt;/strong&gt; 节点的底层由一个叫做&lt;strong&gt;容器运行时&lt;/strong&gt;的软件进行支撑，它主</summary>
      
    
    
    
    
    <category term="k8s" scheme="http://example.com/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>k8s之使用Rancher2.0搭建Kubernetes集群</title>
    <link href="http://example.com/2022/08/25/k8s%E4%B9%8B%E4%BD%BF%E7%94%A8Rancher2-0%E6%90%AD%E5%BB%BAKubernetes%E9%9B%86%E7%BE%A4/"/>
    <id>http://example.com/2022/08/25/k8s%E4%B9%8B%E4%BD%BF%E7%94%A8Rancher2-0%E6%90%AD%E5%BB%BAKubernetes%E9%9B%86%E7%BE%A4/</id>
    <published>2022-08-25T01:41:51.000Z</published>
    <updated>2022-08-25T01:47:13.677Z</updated>
    
    <content type="html"><![CDATA[<p>中文文档：<a class="link"   href="https://docs.rancher.cn/docs/rancher2" >https://docs.rancher.cn/docs/rancher2<i class="fas fa-external-link-alt"></i></a></p><h2 id="安装Rancher2-0"><a href="#安装Rancher2-0" class="headerlink" title="安装Rancher2.0"></a>安装Rancher2.0</h2><p>使用下面命令，我们快速的安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动 rancher【没有的话会从后台拉取】</span></span><br><span class="line">docker run -d -p 80:80 -p 443:443 rancher/rancher:v2.0.0</span><br><span class="line"><span class="comment"># 查看</span></span><br><span class="line">docker ps -a</span><br></pre></td></tr></table></figure><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20201123160929063.png"                      alt="image-20201123160929063"                ></p><p>我们可以来查看我们的日志</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logs  eloquent_curie</span><br></pre></td></tr></table></figure><p>同时，我们可以直接访问我们新建的Rancher集群</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://192.168.177.150/</span><br></pre></td></tr></table></figure><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20221123161958206.png"                      alt="image-20201123161958206"                ></p><p>第一次登录，需要我们填写密码，我们自己的密码后，点击下一步，完成后即可进入到我们的控制台</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20221123180845117.png"                      alt="image-20201123180845117"                ></p><h2 id="导入K8S集群"><a href="#导入K8S集群" class="headerlink" title="导入K8S集群"></a>导入K8S集群</h2><p>在我们安装好Rancher2.0后，我们就可以导入我们的K8S集群进行管理了</p><p>首先我们点击 Add Cluster ，然后选择 IMPORT 导入我们的集群</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20201123194902242.png"                      alt="image-20201123194902242"                ></p><p>然后会有Add Cluster页面，下面我们通过命令来添加</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20221123194958021.png"                      alt="image-20201123194958021"                ></p><p>我们首先选择上面这条，在我们的master节点上执行，将我们的集群被Rancher接管</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f https://192.168.177.130/v3/import/6pqf9w75fmx4pt94tpbpklxd2t5qkq2fm9v6dgl6w8z6rc8727bpdk.yaml</span><br></pre></td></tr></table></figure><p>如果执行命令有问题的话，我们可以提前把脚本下载下来，然后拷贝到里面的 rancher.yaml</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f rancher.yaml</span><br></pre></td></tr></table></figure><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20221123200210728.png"                      alt="image-20201123200210728"                ></p><p>在执行上述命令，可能会出现这个问题，我们只需要把里面的 extensions&#x2F;v1beta1 修改成  apps&#x2F;v1 即可</p><p>修改完成后，再次执行即可</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20221123200337426.png"                      alt="image-20201123200337426"                ></p><p>我们通过下面命令，查看我们创建的pods</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods  -n cattle-system</span><br></pre></td></tr></table></figure><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20201123200558313.png"                      alt="image-20201123200558313"                ></p><p>执行完上述操作后，我们到Rancher的UI界面，点击Done，即可看到我们的集群被成功导入</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20221123200834363.png"                      alt="image-20201123200834363"                ></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;中文文档：&lt;a class=&quot;link&quot;   href=&quot;https://docs.rancher.cn/docs/rancher2&quot; &gt;https://docs.rancher.cn/docs/rancher2&lt;i class=&quot;fas fa-external-link-</summary>
      
    
    
    
    
    <category term="k8s" scheme="http://example.com/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>k8s之配置默认存储类</title>
    <link href="http://example.com/2022/08/25/k8s%E4%B9%8B%E9%85%8D%E7%BD%AE%E9%BB%98%E8%AE%A4%E5%AD%98%E5%82%A8%E7%B1%BB/"/>
    <id>http://example.com/2022/08/25/k8s%E4%B9%8B%E9%85%8D%E7%BD%AE%E9%BB%98%E8%AE%A4%E5%AD%98%E5%82%A8%E7%B1%BB/</id>
    <published>2022-08-25T01:39:17.000Z</published>
    <updated>2022-08-25T01:41:10.383Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>今天在配置Kubesphere的时候，出现了下面的错误</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20221123095552088.png"                      alt="image-20201123095552088"                ></p><p>经过排查，发现是这个原因</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20221123095637801.png"                      alt="image-20201123095637801"                ></p><p>我通过下面命令，查看Kubernetes集群中的默认存储类</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get storageclass</span><br></pre></td></tr></table></figure><p>发现空空如也，所以问题应该就出现在这里了~，下面我们给k8s集群安装上默认的存储类</p><h2 id="安装nfs"><a href="#安装nfs" class="headerlink" title="安装nfs"></a>安装nfs</h2><p>我们使用的是nfs来作为k8s的存储类</p><p>首先找一台新的服务器，作为nfs服务端，然后进行 nfs的安装 【服务器：192.168.177.141】</p><p>然后使用命令安装nfs</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y nfs-utils</span><br></pre></td></tr></table></figure><p>首先创建存放数据的目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /data/k8s</span><br></pre></td></tr></table></figure><p>设置挂载路径</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 打开文件</span></span><br><span class="line">vim /etc/exports</span><br><span class="line"><span class="comment"># 添加如下内容</span></span><br><span class="line">/data/k8s *(rw,no_root_squash)</span><br></pre></td></tr></table></figure><h2 id="node节点上安装"><a href="#node节点上安装" class="headerlink" title="node节点上安装"></a>node节点上安装</h2><p>然后需要在k8s集群node节点上安装nfs，这里需要在 node1 和 node2节点上安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y nfs-utils</span><br></pre></td></tr></table></figure><p>执行完成后，会自动帮我们挂载上</p><h2 id="启动nfs"><a href="#启动nfs" class="headerlink" title="启动nfs"></a>启动nfs</h2><p>在node节点上配置完成后，我们就接着到刚刚nfs服务器，启动我们的nfs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start nfs</span><br></pre></td></tr></table></figure><h2 id="配置StorageClass"><a href="#配置StorageClass" class="headerlink" title="配置StorageClass"></a>配置StorageClass</h2><p>要使用StorageClass，我们就得安装对应的自动配置程序，比如上面我们使用的是nfs，那么我们就需要使用到一个 nfs-client 的自动配置程序，我们也叫它 Provisioner，这个程序使用我们已经配置的nfs服务器，来自动创建持久卷，也就是自动帮我们创建PV</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">自动创建的 PV 以<span class="variable">$&#123;namespace&#125;</span>-<span class="variable">$&#123;pvcName&#125;</span>-<span class="variable">$&#123;pvName&#125;</span>这样的命名格式创建在 NFS 服务器上的共享数据目录中</span><br><span class="line">而当这个 PV 被回收后会以archieved-<span class="variable">$&#123;namespace&#125;</span>-<span class="variable">$&#123;pvcName&#125;</span>-<span class="variable">$&#123;pvName&#125;</span>这样的命名格式存在 NFS 服务器上。</span><br></pre></td></tr></table></figure><p>当然在部署nfs-client之前，我们需要先成功安装上 nfs 服务器，上面已经安装好了，服务地址是192.168.177.141，共享数据目录是&#x2F;data&#x2F;k8s&#x2F;，然后接下来我们部署 nfs-client 即可，我们也可以直接参考 <a class="link"   href="https://github.com/kubernetes-incubator/external-storage/tree/master/nfs-client" >nfs-client 文档<i class="fas fa-external-link-alt"></i></a>，进行安装即可。</p><h3 id="配置Deployment"><a href="#配置Deployment" class="headerlink" title="配置Deployment"></a>配置Deployment</h3><p>首先配置 Deployment，将里面的对应的参数替换成我们自己的 nfs 配置（nfs-client.yaml）</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nfs-client-provisioner</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nfs-client-provisioner</span></span><br><span class="line">  <span class="attr">strategy:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">Recreate</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nfs-client-provisioner</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">serviceAccountName:</span> <span class="string">nfs-client-provisioner</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-client-provisioner</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">quay.io/external_storage/nfs-client-provisioner:latest</span></span><br><span class="line">          <span class="attr">volumeMounts:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-client-root</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/persistentvolumes</span></span><br><span class="line">          <span class="attr">env:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">PROVISIONER_NAME</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">fuseim.pri/ifs</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NFS_SERVER</span></span><br><span class="line">              <span class="attr">value:</span> <span class="number">192.168</span><span class="number">.177</span><span class="number">.141</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NFS_PATH</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">/data/k8s</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-client-root</span></span><br><span class="line">          <span class="attr">nfs:</span></span><br><span class="line">            <span class="attr">server:</span> <span class="number">192.168</span><span class="number">.177</span><span class="number">.141</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/data/k8s</span></span><br></pre></td></tr></table></figure><h3 id="替换配置"><a href="#替换配置" class="headerlink" title="替换配置"></a>替换配置</h3><p>将环境变量 NFS_SERVER 和 NFS_PATH 替换，当然也包括下面的 nfs 配置，我们可以看到我们这里使用了一个名为 nfs-client-provisioner 的serviceAccount，所以我们也需要创建一个 sa，然后绑定上对应的权限：（nfs-client-sa.yaml）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: ServiceAccount</span><br><span class="line">metadata:</span><br><span class="line">  name: nfs-client-provisioner</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">kind: ClusterRole</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">metadata:</span><br><span class="line">  name: nfs-client-provisioner-runner</span><br><span class="line">rules:</span><br><span class="line">  - apiGroups: [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    resources: [<span class="string">&quot;persistentvolumes&quot;</span>]</span><br><span class="line">    verbs: [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;create&quot;</span>, <span class="string">&quot;delete&quot;</span>]</span><br><span class="line">  - apiGroups: [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    resources: [<span class="string">&quot;persistentvolumeclaims&quot;</span>]</span><br><span class="line">    verbs: [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;update&quot;</span>]</span><br><span class="line">  - apiGroups: [<span class="string">&quot;storage.k8s.io&quot;</span>]</span><br><span class="line">    resources: [<span class="string">&quot;storageclasses&quot;</span>]</span><br><span class="line">    verbs: [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>]</span><br><span class="line">  - apiGroups: [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    resources: [<span class="string">&quot;events&quot;</span>]</span><br><span class="line">    verbs: [<span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;create&quot;</span>, <span class="string">&quot;update&quot;</span>, <span class="string">&quot;patch&quot;</span>]</span><br><span class="line">  - apiGroups: [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    resources: [<span class="string">&quot;endpoints&quot;</span>]</span><br><span class="line">    verbs: [<span class="string">&quot;create&quot;</span>, <span class="string">&quot;delete&quot;</span>, <span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;patch&quot;</span>, <span class="string">&quot;update&quot;</span>]</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">kind: ClusterRoleBinding</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">metadata:</span><br><span class="line">  name: run-nfs-client-provisioner</span><br><span class="line">subjects:</span><br><span class="line">  - kind: ServiceAccount</span><br><span class="line">    name: nfs-client-provisioner</span><br><span class="line">    namespace: default</span><br><span class="line">roleRef:</span><br><span class="line">  kind: ClusterRole</span><br><span class="line">  name: nfs-client-provisioner-runner</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br></pre></td></tr></table></figure><p>我们这里新建的一个名为 nfs-client-provisioner 的ServiceAccount，然后绑定了一个名为 nfs-client-provisioner-runner 的ClusterRole，而该ClusterRole声明了一些权限，其中就包括对persistentvolumes的增、删、改、查等权限，所以我们可以利用该ServiceAccount来自动创建 PV。</p><h3 id="创建StorageClass对象"><a href="#创建StorageClass对象" class="headerlink" title="创建StorageClass对象"></a>创建StorageClass对象</h3><p>nfs-client 的 Deployment 声明完成后，我们就可以来创建一个StorageClass对象了：（nfs-client-class.yaml）</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">storage.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StorageClass</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">course-nfs-storage</span></span><br><span class="line"><span class="attr">provisioner:</span> <span class="string">fuseim.pri/ifs</span> <span class="comment"># or choose another name, must match deployment&#x27;s env PROVISIONER_NAME&#x27;</span></span><br></pre></td></tr></table></figure><p>我们声明了一个名为 course-nfs-storage 的StorageClass对象，注意下面的provisioner对应的值一定要和上面的Deployment下面的 PROVISIONER_NAME 这个环境变量的值一样</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">storage.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StorageClass</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">course-nfs-storage</span></span><br><span class="line"><span class="attr">provisioner:</span> <span class="string">fuseim.pri/ifs</span> <span class="comment"># or choose another name, must match deployment&#x27;s env PROVISIONER_NAME&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="创建资源对象"><a href="#创建资源对象" class="headerlink" title="创建资源对象"></a>创建资源对象</h3><p>在我们准备好上述的配置文件后，我们就可以开始创建我们的资源对象了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f nfs-client.yaml</span><br><span class="line">kubectl create -f nfs-client-sa.yaml</span><br><span class="line">kubectl create -f nfs-client-class.yaml</span><br></pre></td></tr></table></figure><p>创建完成后，使用下面命令来查看资源状态</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods</span><br><span class="line"><span class="comment"># 查看存储类</span></span><br><span class="line">kubectl get storageclass</span><br></pre></td></tr></table></figure><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20201123104358758.png"                      alt="image-20201123104358758"                ></p><p>我们可以设置这个 course-nfs-storage 的 StorageClass 为 Kubernetes 的默认存储后端，我们可以用 kubectl patch 命令来更新</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl patch storageclass course-nfs-storage -p <span class="string">&#x27;&#123;&quot;metadata&quot;: &#123;&quot;annotations&quot;:&#123;&quot;storageclass.kubernetes.io/is-default-class&quot;:&quot;true&quot;&#125;&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>执行完命令后，我们默认存储类就配置成功了~</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;今天在配置Kubesphere的时候，出现了下面的错误&lt;/p&gt;
&lt;p&gt;&lt;img  
                     lazyloa</summary>
      
    
    
    
    
    <category term="k8s" scheme="http://example.com/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>k8s之可视化界面kubesphere</title>
    <link href="http://example.com/2022/08/25/k8s%E4%B9%8B%E5%8F%AF%E8%A7%86%E5%8C%96%E7%95%8C%E9%9D%A2kubesphere/"/>
    <id>http://example.com/2022/08/25/k8s%E4%B9%8B%E5%8F%AF%E8%A7%86%E5%8C%96%E7%95%8C%E9%9D%A2kubesphere/</id>
    <published>2022-08-25T01:33:26.000Z</published>
    <updated>2022-08-25T01:36:40.372Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Kubernetes也提供了默认的dashboard页面，但是功能不是很强大，这里就不使用了</p><p>而是采用Kubesphere大桶全部的devops链路，通过kubesphere集成了很多套件</p><ul><li><a class="link"   href="https://kubesphere.io/zh/" >https://kubesphere.io/zh/<i class="fas fa-external-link-alt"></i></a> ：集群要求高</li><li><a class="link"   href="https://kuboard.cn/%EF%BC%9A%E5%BC%80%E6%BA%90kuboard%E4%B9%9F%E4%B8%8D%E9%94%99%EF%BC%8C%E9%9B%86%E7%BE%A4%E8%A6%81%E6%B1%82%E4%B8%8D%E9%AB%98%E3%80%90%E8%BD%BB%E9%87%8F%E7%BA%A7%E3%80%91" >https://kuboard.cn/：开源kuboard也不错，集群要求不高【轻量级】<i class="fas fa-external-link-alt"></i></a></li></ul><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>KubeSphere是一款面向云原生设计的开源项目，在目前主流容器调度平台Kubernetes之上构建的分布式多租户容器管理平台，提供简单易用的操作界面以及向导式操作方式，在降低用户使用容器调度平台学习成本的同时，极大降低开发、测试、运维的日常工作的复杂度。</p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件"></a>前提条件</h3><p><a class="link"   href="https://kubesphere.com.cn/docs/quick-start/minimal-kubesphere-on-k8s/" >https://kubesphere.com.cn/docs/quick-start/minimal-kubesphere-on-k8s/<i class="fas fa-external-link-alt"></i></a></p><ul><li>Kubernetes 版本必须为 “1.15.x，1.16.x，1.17.x 或 1.18.x”；</li><li>确保您的计算机满足最低硬件要求：CPU &gt; 1 核，内存 &gt; 2 G；</li><li>在安装之前，需要配置 Kubernetes 集群中的默认存储类；</li><li>当使用 <code>--cluster-signing-cert-file</code> 和 <code>--cluster-signing-key-file</code> 参数启动时，在 kube-apiserver 中会激活 CSR 签名功能。 请参阅 <a class="link"   href="https://github.com/kubesphere/kubesphere/issues/1925#issuecomment-591698309" >RKE 安装问题<i class="fas fa-external-link-alt"></i></a>；</li><li>有关在 Kubernetes 上安装 KubeSphere 的前提条件的详细信息，请参阅<a class="link"   href="https://kubesphere.com.cn/docs/installing-on-kubernetes/introduction/prerequisites/" >前提条件<i class="fas fa-external-link-alt"></i></a>。</li></ul><h3 id="安装helm"><a href="#安装helm" class="headerlink" title="安装helm"></a>安装helm</h3><p>下面我们需要在 <strong>master</strong> 节点安装 <strong>helm</strong></p><p>Helm是Kubernetes的包管理器。包管理器类似于我们在 <strong>Ubuntu</strong> 中使用的 <strong>apt</strong>。<strong>Centos</strong> 中使用的 <strong>yum</strong> 或者<strong>Python</strong> 中的 <strong>pip</strong> 一样，能快速查找、下载和安装软件包。Helm由客户端组件helm和服务端组件Tiller组成，能够将一组K8S资源打包统一管理，是查找、共享和使用为Kubernetes构建的软件的最佳方式。</p><p>安装3.0的 helm 首先我们需要去 <a class="link"   href="https://helm.sh/docs/intro/quickstart/" >官网下载<i class="fas fa-external-link-alt"></i></a></p><ul><li>第一步，<a class="link"   href="https://github.com/helm/helm/releases" >下载helm<i class="fas fa-external-link-alt"></i></a>安装压缩文件，上传到linux系统中</li><li>第二步，解压helm压缩文件，把解压后的helm目录复制到 usr&#x2F;bin 目录中</li><li>使用命令：helm</li></ul><h2 id="部署KubeSphere"><a href="#部署KubeSphere" class="headerlink" title="部署KubeSphere"></a>部署KubeSphere</h2><h3 id="安装前"><a href="#安装前" class="headerlink" title="安装前"></a>安装前</h3><p>如果您的服务器无法访问 GitHub，则可以分别复制 <a class="link"   href="https://github.com/kubesphere/ks-installer/releases/download/v3.0.0/kubesphere-installer.yaml" >kubesphere-installer.yaml<i class="fas fa-external-link-alt"></i></a> 和 <a class="link"   href="https://github.com/kubesphere/ks-installer/releases/download/v3.0.0/cluster-configuration.yaml" >cluster-configuration.yaml<i class="fas fa-external-link-alt"></i></a> 中的内容并将其粘贴到本地文件中。然后，您可以对本地文件使用 <code>kubectl apply -f</code> 来安装 KubeSphere。</p><p>同时查看k8s集群的默认存储类</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get storageclass</span><br></pre></td></tr></table></figure><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20201123094120860.png"                      alt="image-20201123094120860"                ></p><p>如果没有默认存储类，那么就需要安装默认的存储类，参考博客：<a class="link"   href="http://moguit.cn/#/info?blogOid=575" >Kubernetes配置默认存储类<i class="fas fa-external-link-alt"></i></a></p><p>因为我安装的是 <strong>nfs</strong>，所以在安装了 <strong>nfs</strong> 服务器启动</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start nfs</span><br></pre></td></tr></table></figure><h3 id="开始安装"><a href="#开始安装" class="headerlink" title="开始安装"></a>开始安装</h3><p>如果无法正常访问github，可以提前把文件下载到本地</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f https://github.com/kubesphere/ks-installer/releases/download/v3.0.0/kubesphere-installer.yaml</span><br><span class="line"></span><br><span class="line">kubectl apply -f https://github.com/kubesphere/ks-installer/releases/download/v3.0.0/cluster-configuration.yaml</span><br></pre></td></tr></table></figure><p>如果下载到了本地，可以这样安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装</span></span><br><span class="line">kubectl apply -f kubesphere-installer.yaml</span><br><span class="line">kubectl apply -f cluster-configuration.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 卸载</span></span><br><span class="line">kubectl delete -f kubesphere-installer.yaml</span><br><span class="line">kubectl delete -f cluster-configuration.yaml</span><br></pre></td></tr></table></figure><h3 id="检查安装日志"><a href="#检查安装日志" class="headerlink" title="检查安装日志"></a>检查安装日志</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl logs -n kubesphere-system $(kubectl get pod -n kubesphere-system -l app=ks-install -o jsonpath=<span class="string">&#x27;&#123;.items[0].metadata.name&#125;&#x27;</span>) -f</span><br></pre></td></tr></table></figure><p>然后在查看pod运行状况</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pod -n kubesphere-system</span><br></pre></td></tr></table></figure><p>能够发现，我们还有两个容器正在创建</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20210110104812804.png"                      alt="image-20210110104812804"                ></p><p>使用 <code>kubectl get pod --all-namespaces</code> 查看所有 Pod 是否在 KubeSphere 的相关命名空间中正常运行。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods --all-namespaces</span><br></pre></td></tr></table></figure><p>能够发现所有的节点已经成功运行</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20220113102423851.png"                      alt="image-20210113102423851"                ></p><p>如果是，请通过以下命令检查控制台的端口：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get svc/ks-console -n kubesphere-system</span><br></pre></td></tr></table></figure><p>能够看到我们的服务确保在安全组中打开了端口 30880，并通过 NodePort（IP：30880）</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20221123152147871.png"                      alt="image-20201123152147871"                ></p><p>使用默认帐户和密码（admin&#x2F;P@88w0rd）访问 Web 控制台。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 图形化页面  admin  P@88w0rd</span></span><br><span class="line">http://192.168.177.130:30880/</span><br></pre></td></tr></table></figure><p>登录控制台后，您可以在组件中检查不同组件的状态。如果要使用相关服务，可能需要等待某些组件启动并运行。</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/kubesphere-components.png"                      alt="kubesphere-components-zh"                ></p><h2 id="错误排查"><a href="#错误排查" class="headerlink" title="错误排查"></a>错误排查</h2><h3 id="错误1"><a href="#错误1" class="headerlink" title="错误1"></a>错误1</h3><p>kubesphere无法登录，提示 account is not active</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://raw.githubusercontent.com/ainianxu/image/master/image-20210110110018004.png"                      alt="image-20210110110018004"                ></p><p>kubesphere 安装完成后会创建默认账户admin&#x2F;P@88w0rd，待ks-controller-manager启动就绪，user controller 会将 user CRD中定义的password加密，user会被转换为active状态，至此账户才可以正常登录。</p><p>当安装完成后遇到默认账户无法登录，看到account is not active相关错误提示时，需要检查ks-controller-manager的运行状态和日志。常见问题及解决方式如下:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">kubectl -n kubesphere-system get ValidatingWebhookConfiguration users.iam.kubesphere.io -o yaml &gt;&gt; users.iam.kubesphere.io.yaml</span><br><span class="line"></span><br><span class="line">kubectl -n kubesphere-system get secret ks-controller-manager-webhook-cert -o yaml &gt;&gt; ks-controller-manager-webhook-cert.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># edit ca as pr</span></span><br><span class="line">kubectl -n kubesphere-system apply -f ks-controller-manager-webhook-cert.yaml</span><br><span class="line">kubectl -n kubesphere-system apply -f users.iam.kubesphere.io.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># restart</span></span><br><span class="line">kubectl -n kubesphere-system rollout restart deploy ks-controller-manager</span><br></pre></td></tr></table></figure><p>来源：<a class="link"   href="https://kubesphere.com.cn/forum/d/2217-account-is-not-active" >https://kubesphere.com.cn/forum/d/2217-account-is-not-active<i class="fas fa-external-link-alt"></i></a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;Kubernetes也提供了默认的dashboard页面，但是功能不是很强大，这里就不使用了&lt;/p&gt;
&lt;p&gt;而是采用Kubesphere大桶</summary>
      
    
    
    
    
    <category term="k8s" scheme="http://example.com/tags/k8s/"/>
    
  </entry>
  
</feed>
